<!DOCTYPE html>
<meta charset='utf-8'>
<title>Archived Comments</title>
<style>
body {
    font-family: sans-serif;
    font-size: 14px;
    margin: auto;
    max-width: 800px;
}
body > h1 {
    text-align: center;
}
hr {
    width: 600px;
    text-align: center;
}
.thread h1 {
    font-size: 18px;
    font-weight: bold;
}
.thread .empty {
    color: gray;
    font-style: italic;
    margin: 20px 20px;
}
.comment {
    border-left: 3px solid green;
    margin: 10px 0 10px 20px;
    padding: 8px;
}
.comment .author {
    font-weight: bold;
}
.comment time {
    color: #777;
    font-size: 12px;
}
.comment p {
    margin: 20px 0 0 0;
}
.comment .body {
    padding: 0;
    max-width: 600px;
    overflow-x: auto;
}
</style>
<h1>Archived Comments</h1>
<div class='thread'><h1 id='2010-12-21'><a href='/blog/2010/12/21/'>Pth and ncurses</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2011-07-09'><a href='/blog/2011/07/09/'>Pendulum Waves</a></h1><div class='comment'><div class='author'>possiblywrong</div><time datetime='2011-07-09T00:00:00Z'>Sat, 09 Jul 2011 00:00:00 UTC</time><div class='body'><p><br>Very cool!  I remember first seeing this video on Richard Wiseman's blog (see <a href="http://richardwiseman.wordpress.com/2011/05/04/the-most-beautiful-video-ever/" rel="nofollow noopener" title="http://richardwiseman.wordpress.com/2011/05/04/the-most-beautiful-video-ever/">here</a>).  He has a lot of interesting visual effects, illusions, etc.<br></p></div><div class='comment'><div class='author'>Finder999</div><time datetime='2011-09-12T21:59:44Z'>Mon, 12 Sep 2011 21:59:44 UTC</time><div class='body'><p>Is it possible to have the source code of this applet and to have the possibility to reduce or raise the lenght of each pendulum or all together or  to reduce or raise the speed of  the set of pendulum.</p></div></div></div><div class='comment'><div class='author'>Finder999</div><time datetime='2011-09-12T22:01:33Z'>Mon, 12 Sep 2011 22:01:33 UTC</time><div class='body'><p>Is it possible to have the source code of this applet and to have the possibility to reduce or raise the lenght of each pendulum or all together or  to reduce or raise the speed of  the set of pendulum.      </p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2011-09-12T22:26:44Z'>Mon, 12 Sep 2011 22:26:44 UTC</time><div class='body'><p>The source is linked at the bottom of the post (at "git clone"). All of those values are constants (directly or indirectly) in the Display class, so they're easy to tweak and play with.</p></div></div></div></div><hr/><div class='thread'><h1 id='2011-01-10'><a href='/blog/2011/01/10/'>Flip Foolflim the Dragon Traitor</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2010-11-25'><a href='/blog/2010/11/25/'>Football Parity</a></h1><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2010-11-25T00:00:00Z'>Thu, 25 Nov 2010 00:00:00 UTC</time><div class='body'><p><br>My data have 253 games for 2008 and 255 games for 2009, so it appears I might be missing a few games. I probably also have some score errors. I basically just copy/pasted from the first source, then did some spot checking and filled in missing values using the second source, which appears to be more reliable.<br></p><p><br>I don't see any 2009 data on the website you linked, and the 2008 data lists a full 256 games. Where did 231 and 244 come from?<br></p><p><br>Also, thanks for that link. Those data should be interesting to toy with.<br></p></div></div><div class='comment'><div class='author'>possiblywrong</div><time datetime='2010-11-25T00:00:00Z'>Thu, 25 Nov 2010 00:00:00 UTC</time><div class='body'><p><br>After some discussion, I realized that I made too strong a statement in my earlier comment about tournaments.  It is *not* sufficient to simply have no team win/lose all of its games for there to exist a Hamiltonian cycle.  Strong-connectedness is the right equivalent condition, and it did not occur to me that there might be tournaments that are *not* strongly connected despite having no zero in/out-degrees.  There are... but a minimal example requires 6 teams.<br></p></div></div><div class='comment'><div class='author'>possiblywrong</div><time datetime='2010-11-25T00:00:00Z'>Thu, 25 Nov 2010 00:00:00 UTC</time><div class='body'><p><br>You're right, Rasp only has data for seasons up through 2008.  And when I found discrepancies I went to ESPN and NFL's sites to settle them.<br></p><p><br>The 231 and 244 were from the graph2008.el and graph2009.el extractions, which were just the edge counts in the corresponding graphs, the result of eliminating multiple edges when team A beats team B twice.<br></p></div></div><div class='comment'><div class='author'>possiblywrong</div><time datetime='2010-11-25T00:00:00Z'>Thu, 25 Nov 2010 00:00:00 UTC</time><div class='body'><p><br>The original graphic and a lot of the reddit comments seem to use this as evidence for "parity" within the league.  But I don't buy it; it is not clear (to me, at least) whether Hamiltonian cycles might be extremely common, as long as no team wins/loses all of its games (A).  For example, the NBA and NHL both have "tournament" schedules (in the graph-theoretic sense of the word), in which case there *always* exists a Hamiltonian cycle in any regular season satisfying (A) above.<br></p><p><br>After poking around with this problem, starting with your data, then going to <a href="http://www2.stetson.edu/~jrasp/data.htm" rel="nofollow noopener" title="http://www2.stetson.edu/~jrasp/data.htm">http://www2.stetson.edu/~jrasp/data.htm</a> for earlier seasons, the data didn't look right.  The NFL currently has a 16-game season, so there should be 256 total games.  The data here indicate 231 and 224 games, resp., in 2008/2009.<br></p><p><br>A closer look at 2008 suggests that the differences were due to (1) eliminating multiple edges when team A beats team B twice, which is not relevant to this problem; (2) two incorrect games, Cleveland beating Buffalo and Tampa beating Minnesota (actually, Rasp's data is wrong two, indicating that Seattle beat Washington); and most interestingly, (3) including Cinci beating Philly when they in fact tied!  I made the same error in my initial extraction.<br></p><p><br>Interesting problem...<br></p></div></div><div class='comment'><div class='author'>J.R. Parsons</div><time datetime='2011-10-05T19:20:40Z'>Wed, 05 Oct 2011 19:20:40 UTC</time><div class='body'><p>Chris - is there a quick way to prove or estimate the existence of a Hamiltonian path in a data set of that size?  In particular, if we know that by (say) week 8, no teams remain winless or undefeated, is there a back-of-the-envelope way to take 32 teams with 4 incoming/outgoing paths on average, and arrive at an approximate probability of the existence of the Hamiltonian?</p><p>Does the NFL's scheduling setup improve the odds of a Hamiltonian existing?  In particular, we can say with certainty that Team A will play its division rivals B,C, and D twice each, and that A will have 11 distinct opponents in common with B,C, and D?  Also, those other eight rivals (E-H and I-L) are themselves divisional rivals?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2011-10-05T20:52:42Z'>Wed, 05 Oct 2011 20:52:42 UTC</time><div class='body'><p>Heh, while I have a good understanding of the rules of football, I know little about its implementations. I've watched maybe three NFL games on television and only one in person -- and that's only because I was in the halftime show. I don't know how they determine the who, where, and when, so I can't say how likely it is to occur.</p><p>It would seem to be a lot easier to prove the absence of a cycle than the existence of one. Finding a Hamiltonian cycle on an arbitrary graph is NP-complete, so, until more progress is made on the P=NP problem, the only way to prove a cycle exists would be to find one.</p><p>As far as estimation goes, I guess you could use any of the NP search techniques for quickly finding local maxima -- as measured by path length -- and try to make some meaningful statement about the result. I can't think of anything other than that. My personal guess just from searching the 2009 dataset would be that in the absence of a winless or undefeated team, a cycle would most probably exist. Of the tiny space I searched, I found millions of cycles in the 2009 dataset, though they all shared a large common subset path; a local maxima, I guess.<br></p></div><div class='comment'><div class='author'>J.R. Parsons</div><time datetime='2011-10-06T17:26:30Z'>Thu, 06 Oct 2011 17:26:30 UTC</time><div class='body'><p>Okay, so off the top of my head: assume the "any given Sunday" adage holds true and that each team has a 50% chance to win a game.  That means that each team has a 75% chance of having an edge that points toward a divisional opponent (3 of the 32 other teams) and a 50% chance of having an edge that points toward a non-divisional opponent.  So for any randomly-chosen list of all 32 teams, there is a 6.4 x 10^-21 chance that the list happens to be a Hamiltonian cycle.</p><p>If your estimate of the search space (2^118) is correct, then that points to a very large number of paths probably existing.  </p><p>If win probability for each of 32 teams is drawn from a win probability distribution like this one (<a href="http://www.advancednflstats.com/2011/01/2010-team-efficiency-rankings-final.html)" rel="nofollow noopener" title="http://www.advancednflstats.com/2011/01/2010-team-efficiency-rankings-final.html)">http://www.advancednflstats...</a> and I take into account duplicate edges from divisional games, the probability of finding a Hamiltonian with a random draw from all possible match-ups drops to 2e-25.  Note that this is taken from the larger draw space (2^118) but it still looks like a full exploration of a randomized season should tend to have something like a few hundred million valid Hamiltonian cycles.</p><p>Probability and graph theory are not my strong suits -- I haven't taken a formal class in either -- but I think I'm a lot closer to understanding how these things come to occur.  Thanks for doing a lot of the legwork!</p></div></div><div class='comment'><div class='author'>J.R. Parsons</div><time datetime='2011-10-06T17:36:26Z'>Thu, 06 Oct 2011 17:36:26 UTC</time><div class='body'><p>Oh - on further reflection, your discussion of local maxima and winless teams makes me think that searching for a handful of most-likely minimum cases could rule out the most likely scenarios under which no Hamiltonian cycle would exist.  Check right away for the likelihood of a winless or undefeated team; then add the likelihood of two near-perfect divisional opponents going 15-1 or 1-15 so that each has only the other upstream, and admits no third node upstream.  Then look at the vanishingly-small probability of three teams going 14-2 such that each has only the other two upstream.</p><p>Conversely, the likelihood that a 15-1 or 1-15 team will exist without being locked down as above actually helps find a Hamiltonian cycle, because that team has only one incoming or outgoing edge on one side, and so it can be considered a supernode with its neighbor... yeah?  And every Hamiltonian cycle would have to pass through that node the same way.  </p></div></div></div></div></div><hr/><div class='thread'><h1 id='2009-05-27'><a href='/blog/2009/05/27/'>Knight&#39;s Tour</a></h1><div class='comment'><div class='author'>Gavin Black</div><time datetime='2009-05-27T00:00:00Z'>Wed, 27 May 2009 00:00:00 UTC</time><div class='body'><p><br>I think this is actually a problem with the code, running it on another machine in Cygwin I get:  "Error while dumping state(Probably corrupted stack) segmentation fault(core dumped)".  </p></div></div><div class='comment'><div class='author'>Gavin Black</div><time datetime='2009-05-27T00:00:00Z'>Wed, 27 May 2009 00:00:00 UTC</time><div class='body'><p><br>Is the nxn Knights Tour always solvable?  I couldn't find online whether it was or not, and if it's not it could explain why some of them hang.</p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-05-27T00:00:00Z'>Wed, 27 May 2009 00:00:00 UTC</time><div class='body'><p><br>Cygwin gets really weird. If I run it with a 128x128 board (and other various sizes) it drops out without completing and without reporting any errors. When I say "without completing", I mean that is doesn't print a board <i>or</i> "No solution." and one of those should always be output. It also returns success to the shell.<br></p><p><br>I can't get the error you reported, though the same thing might be happening, just silently.<br></p><p><br>If I run it with a 55x55 board it locks up, though on GNU/Linux it spits out an answer after a few milliseconds. No idea why it hangs.<br></p><p><br>Now check this code out,<br></p><p><br></p><pre>#include &lt;stdio.h&gt;<br><br>void recurse(int x)<br>{<br>  if (x == 0)<br>    {<br>      printf("%p\n", &amp;x);<br>      return;<br>    }<br>  recurse(x - 1);<br>}<br><br>int main()<br>{<br>  recurse(129273);<br>  printf("Done.\n");<br>}<br></pre><p><br></p><p></p><p><br>With Cygwin, gcc with no options, on my system here at work this works fine. But change that <code>129273</code> to <code>12927<b>4</b></code> and it will crash as described above. The stack frame size here is 16 bytes. So this means after 2068368 bytes (~2020kb) of stack something bad is happening.<br></p><p><br>If I add the <code>-mno-cygwin</code> option, it can go slightly further. On GNU/Linux I can take it to around 500000 before it segfaults.<br></p><p><br>Is it running into the text segment here? Note the size/value of the printed pointer. Pretty low.<br></p><p><br>My conclusion is that the crashing is the program running out of stack space. A 128x128 board needs 16,384 (+ some overhead) calls on the stack. Multiply that by the stack frame size of the knight's tour program and it goes beyond the few kilobytes of stack space made available.<br></p><p><br>Is there a compiler option for providing a bigger stack? The only available course of action might be to use iteration and build a stack manually in the heap, where I have GBs to work with rather than kB.<br></p><p><br>This has been a little lesson on the limitations of C for me.<br></p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-05-27T00:00:00Z'>Wed, 27 May 2009 00:00:00 UTC</time><div class='body'><p><br>I really don't know. I assume after a certain size that any board has a solution, because it can be broken down into smaller boards that have solutions.<br></p></div></div></div><hr/><div class='thread'><h1 id='2010-11-16'><a href='/blog/2010/11/16/'>Software Serial Codes</a></h1><div class='comment'><div class='author'>Gavin Black</div><time datetime='2010-11-16T00:00:00Z'>Tue, 16 Nov 2010 00:00:00 UTC</time><div class='body'><p><br>I would think the easiest attack against anything that doesn't phone home would be to get a serial key from someone who legitimately has one and just use that. Still interesting that brute forcing is minimized with an even split between the checksum and the serial number.</p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2010-11-16T00:00:00Z'>Tue, 16 Nov 2010 00:00:00 UTC</time><div class='body'><p><br>In the case where the software talks to other instances of itself (a multiplayer game, for example), it might compare serial codes and, if they match, refuse to talk to each other. You would have to (in order of general difficulty) either purchase another serial code, figure out how to make your own serial codes, or modify the software's behavior. Also, future versions of the software may reject published serial codes. Share a serial code too much and it stops working.<br></p><p><br>Brute forcing might not necessarily be minimized by an even split. I suspect my implementation might benefit from a larger checksum and smaller code, because it's harder to iterate over the code segment than the checksum segment: not every checksum has a matching code, but the reverse is always true. But in general the brute force attack will be iterating over the smaller set. An even split maximizes the size of both sets.<br></p></div></div></div><hr/><div class='thread'><h1 id='2010-05-11'><a href='/blog/2010/05/11/'>Emacs UUIDs</a></h1><div class='comment'><div class='author'>Ron</div><time datetime='2010-05-11T00:00:00Z'>Tue, 11 May 2010 00:00:00 UTC</time><div class='body'><p><br>Case and point of not relying on data being avaible on the internet Martin Blais site is down.</p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2010-05-11T00:00:00Z'>Tue, 11 May 2010 00:00:00 UTC</time><div class='body'><p><br>Thanks for pointing that out, Ron. Perfect example of what I was talking about. I've added a local mirror of Martin's code next to the original link.<br></p></div></div><div class='comment'><div class='author'>Ron</div><time datetime='2010-05-11T00:00:00Z'>Tue, 11 May 2010 00:00:00 UTC</time><div class='body'><p><br>djcp, has some info on getting ip data from win32 here (as well as linux ,and probably other unixs including MacOs and Cygwin).<br></p><p><br><a href="http://emacs-fu.blogspot.com/2009/05/getting-your-ip-address.html" rel="nofollow noopener" title="http://emacs-fu.blogspot.com/2009/05/getting-your-ip-address.html">http://emacs-fu.blogspot.com/2009/05/getting-your-ip-address.html</a><br></p><p><br>So a hack that I derived from that can be found here<br></p><p><br><a href="http://gist.github.com/399236" rel="nofollow noopener" title="http://gist.github.com/399236">http://gist.github.com/399236</a><br></p><p><br>I currently dont have any windows machines to test, and the win32 info is only based on googled screenshots. I would be curious to know if it works on an actual win32 build. And rereading your post suggests other hardware resources needed. Well mac address ill probably need at some point anyway.<br></p><p><br></p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2010-05-11T00:00:00Z'>Tue, 11 May 2010 00:00:00 UTC</time><div class='body'><p><br>Yes, that works in Windows, but with the caveat that ipconfig uses dashes instead of colons. You must know since the <code>string-match</code> pattern is tuned to it. I actually had a problem in Linux because <code>ifconfig</code> is in <code>/sbin</code>, which isn't in my regular user path. I changed it to an absolute path in the code.<br></p><p><br>So you've solved it for GNU/Linux and Windows, so now you have to solve it for Macs and the other dozen operating systems Emacs runs on. :-)<br></p><p><br>I think I prefer the pseudo-random methods anyway, as 128-bits from a decent PRNG with proper seeding should always be practically unique.<br></p></div></div></div><hr/><div class='thread'><h1 id='2010-11-15'><a href='/blog/2010/11/15/'>Elisp Function Composition</a></h1><div class='comment'><div class='author'>Gavin Black</div><time datetime='2010-11-15T00:00:00Z'>Mon, 15 Nov 2010 00:00:00 UTC</time><div class='body'><p><br>Just have to point out that Haskell has implicit partial application and function composition ;)<br></p><p><br>Something like:<br><code><br></code></p><pre><code>foo x = (+) x<br>bar x y = x - y<br>faz = foo . bar 2<br>faz 3 4<br></code></pre><p><code><br></code><br></p><p></p><p><br>is perfectly valid</p></div></div><div class='comment'><div class='author'>Mark</div><time datetime='2017-12-25T21:31:41Z'>Mon, 25 Dec 2017 21:31:41 UTC</time><div class='body'><p>Works great. Thanks for sharing.</p></div><div class='comment'><div class='author'>Yu0</div><time datetime='2019-12-05T10:19:19Z'>Thu, 05 Dec 2019 10:19:19 UTC</time><div class='body'><p>Nowadays it is probably better to use the <code>dash.el</code> function <code>-&gt;</code> or the more convenient macro <code>--&gt;</code>. E.g. <code>(--&gt; 13 (prin1-to-string it) (concat it "::" it))</code> will give the string <code>"13::13"</code>.</p><p>Seems like that function was added to <code>dash.el</code> around 2012<a href="https://github.com/magnars/dash.el/blame/e85ed7aa93ef0959b630607bca17af90c74b34be/dash.el#L1489" rel="nofollow noopener" title="https://github.com/magnars/dash.el/blame/e85ed7aa93ef0959b630607bca17af90c74b34be/dash.el#L1489"> [1]</a>.</p><p>[1] <a href="https://github.com/magnars/dash.el/blame/e85ed7aa93ef0959b630607bca17af90c74b34be/dash.el#L1489" rel="nofollow noopener" title="https://github.com/magnars/dash.el/blame/e85ed7aa93ef0959b630607bca17af90c74b34be/dash.el#L1489">https://github.com/magnars/...</a></p></div></div></div></div><hr/><div class='thread'><h1 id='2010-10-20'><a href='/blog/2010/10/20/'>Sudoku Applet</a></h1><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2010-10-20T00:00:00Z'>Wed, 20 Oct 2010 00:00:00 UTC</time><div class='body'><p><br>Yeah, I like cranking up all the static code checks on all my (personal) projects, no matter the language. With Java, I use Checkstyle and <a href="http://git.nullprogram.com/?p=Sudoku.git;a=blob;f=build.xml;h=1511d85a7e439caaafe90b89b6f9a4f03a7d168c;hb=dd1862ded4d8d9348fc046ebddfaa8d50329cb99" rel="nofollow noopener" title="http://git.nullprogram.com/?p=Sudoku.git;a=blob;f=build.xml;h=1511d85a7e439caaafe90b89b6f9a4f03a7d168c;hb=dd1862ded4d8d9348fc046ebddfaa8d50329cb99">compile with the <code>-Xlint</code> switch</a>, which issues a warning when a <code>serialVersionUID</code> is not provided when extending a Serializable class. Emacs generates the actual UID for me, so it's very little effort to do.<br></p><p><br>But I'm not actually doing any serialization in this particular project. I'm just dotting my <i>i</i>s and crossing my <i>t</i>s for the bureaucratic Java libraries.<br></p></div></div><div class='comment'><div class='author'>Gavin Black</div><time datetime='2010-10-20T00:00:00Z'>Wed, 20 Oct 2010 00:00:00 UTC</time><div class='body'><p><br>Interesting, I was thrown by the serialVersionUID at first since I'd never seen it before. I never knew there was a standard way to do serialization in Java.  <br><br><br><br>It seems unfortunate this isn't inherit to objects themselves like it is in most other languages (ie. JSON in Javascript, memcpy for C structs, print/read in Lisp, and read/show in Haskell ;).   Actually looking at Wikipedia it looks like the considerations were: Some classes are tied to JVM state, might have incompatible class versions, and it would allow allow access to private members. To me these seem like complete cop-out reasons though :P</p></div></div></div><hr/><div class='thread'><h1 id='2010-10-18'><a href='/blog/2010/10/18/'>Java Applets Demo Page</a></h1><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2010-10-18T00:00:00Z'>Mon, 18 Oct 2010 00:00:00 UTC</time><div class='body'><p><br>Hmmm, the model for a double pendulum looks pretty complicated. It's going to take some time for me to understand it.<br></p></div></div><div class='comment'><div class='author'>Mike Abraham</div><time datetime='2010-10-18T00:00:00Z'>Mon, 18 Oct 2010 00:00:00 UTC</time><div class='body'><p><br>This is awesome.  I propose another simple physics simulation that demonstrates chaos:  the double pendulum.</p></div></div></div><hr/><div class='thread'><h1 id='2010-10-15'><a href='/blog/2010/10/15/'>Introducing Java Mode Plus</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2010-10-17'><a href='/blog/2010/10/17/'>A Modest Chess Engine</a></h1><div class='comment'><div class='author'>possiblywrong</div><time datetime='2010-10-17T00:00:00Z'>Sun, 17 Oct 2010 00:00:00 UTC</time><div class='body'><p><br>This is very cool, thanks for posting it!  I just tried it out and was promptly beaten.<br></p><p><br>I like the idea, as you suggest, of pitting AIs against each other.  I have wanted to do this with a couple of recent projects of mine (Pente and Keryo-Pente, and Carcassonne; see links below), but I also have not been at all interested in climbing around in an icky mediator API.<br></p><p><br>There is another way, though, at least for "one-offs" against a particular opponent.  A handy approach that I used in both games was to *not* distinguish any player as human or computer ahead of time, but instead, let the user on any given turn choose to play a specific move with the mouse, or press space to "do what the computer would do."<br></p><p><br>This way, I can pit my AI against some other AI (e.g., Mark Mammel's WPente), by running both versions simultaneously.  I play WPente as a human; when the WPente AI moves, I make the same move in *my* version manually (e.g., like a human).  I then use my AI to make the next move, which I "sneakernet" over to WPente.<br></p><p><br>Thanks again!<br></p><p><br><a href="http://possiblywrong.wordpress.com/2010/05/31/pente-from-the-apple-to-today/" rel="nofollow noopener" title="http://possiblywrong.wordpress.com/2010/05/31/pente-from-the-apple-to-today/">http://possiblywrong.wordpress.com/2010/05/31/pente-from-the-apple-to-today/</a><br></p><p><br><a href="http://possiblywrong.wordpress.com/2010/09/06/carcassonne-update/" rel="nofollow noopener" title="http://possiblywrong.wordpress.com/2010/09/06/carcassonne-update/">http://possiblywrong.wordpress.com/2010/09/06/carcassonne-update/</a><br></p></div></div><div class='comment'><div class='author'>Michael Abraham</div><time datetime='2010-10-17T00:00:00Z'>Sun, 17 Oct 2010 00:00:00 UTC</time><div class='body'><p><br>I actually came by here to dig up a copy of MATBOTS.  This chess engine is cool stuff, Chris!  I beat the snot out of it but it is still impressive. </p></div></div><div class='comment'><div class='author'>Roberto Munter</div><time datetime='2010-10-17T00:00:00Z'>Sun, 17 Oct 2010 00:00:00 UTC</time><div class='body'><p><br>Fantastic!!<br></p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2010-10-17T00:00:00Z'>Sun, 17 Oct 2010 00:00:00 UTC</time><div class='body'><p><br>I did do some sneakernet play between GNU Chess and my AI, which is how I know with certainty that my AI isn't very strong. That's a good idea, stepping the computer moves manually. That would make it easier to analyze the game rather than the rapid back-and-forth that would normally happen.<br></p><p><br>Those two posts you linked are very interesting, and sound familiar to my own experience.<br></p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2010-10-17T00:00:00Z'>Sun, 17 Oct 2010 00:00:00 UTC</time><div class='body'><p><br>I found some more information on engine strength and search depth: <a href="http://www.reddit.com/r/chess/comments/h5ryn/question_for_people_who_know_something_about/" rel="nofollow noopener" title="http://www.reddit.com/r/chess/comments/h5ryn/question_for_people_who_know_something_about/">Question for people who know something about computer strengths and human ratings...</a><br></p></div></div><div class='comment'><div class='author'>Folkert van Heusden</div><time datetime='2016-07-26T19:51:55Z'>Tue, 26 Jul 2016 19:51:55 UTC</time><div class='body'><p>Consider implementing the uci/xboard protocol in it. You can then interface it to internet chess servers, let it battle and find out what elo rating it has.</p></div></div></div><hr/><div class='thread'><h1 id='2010-10-16'><a href='/blog/2010/10/16/'>Lorenz Chaotic Water Wheel Applet</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2010-10-14'><a href='/blog/2010/10/14/'>Jump to Java Documentation from Emacs</a></h1><div class='comment'><div class='author'>Timo</div><time datetime='2013-06-19T20:41:11Z'>Wed, 19 Jun 2013 20:41:11 UTC</time><div class='body'><p>This is wonderful, thank you! I especially like the new automatic importing.</p></div></div></div><hr/><div class='thread'><h1 id='2010-10-06'><a href='/blog/2010/10/06/'>Emacs Set Window to 80 Columns</a></h1><div class='comment'><div class='author'>Max</div><time datetime='2014-09-24T09:01:32Z'>Wed, 24 Sep 2014 09:01:32 UTC</time><div class='body'><p>Thanks for this post. Exactly what I was looking for.</p></div></div><div class='comment'><div class='author'>Ted Mielczarek</div><time datetime='2017-05-17T13:32:36Z'>Wed, 17 May 2017 13:32:36 UTC</time><div class='body'><p>I realize this is a very old post, but I couldn't get this to work in Emacs 24. Your code would give me the error "No window on the right of this one". I poked around a bit and I think maybe it's trying to resize the minibuffer window in modern Emacs? In any event, I rewrote it to resize the current frame instead and it works now. Here's my code:</p><p></p><pre><code><br><br>(defun set-80-columns ()<br>  "Set the selected frame to 80 columns."<br>  (interactive)<br>  (set-frame-width (selected-frame) 80))<br></code></pre></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-05-17T13:44:45Z'>Wed, 17 May 2017 13:44:45 UTC</time><div class='body'><p>In the article when I say "window" I'm using the Emacs term, which is that pane inside the OS window (Emacs frame). There needs to be another window to the right to fill in the space beyond 80 columns, which is what Emacs was complaining about. It still seems to work as intended (equally as crudely) with the latest Emacs here in 2017. It sounds like the frame version you figured out is what you really wanted in the first place. Thanks for sharing it!</p></div></div></div></div><hr/><div class='thread'><h1 id='2010-10-04'><a href='/blog/2010/10/04/'>SampleJavaProject</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2010-09-30'><a href='/blog/2010/09/30/'>Emacs Find All Files</a></h1><div class='comment'><div class='author'>Oliver</div><time datetime='2010-09-30T00:00:00Z'>Thu, 30 Sep 2010 00:00:00 UTC</time><div class='body'><p><br>Handy, thanks!</p></div></div></div><hr/><div class='thread'><h1 id='2010-09-29'><a href='/blog/2010/09/29/'>Elisp Higher-order Conversion to Interactive</a></h1><div class='comment'><div class='author'>E Sabof</div><time datetime='2013-06-07T21:44:04Z'>Fri, 07 Jun 2013 21:44:04 UTC</time><div class='body'><p>There is a small error in your post. `compose' isn't part of standard emacs.</p></div></div></div><hr/><div class='thread'><h1 id='2010-09-21'><a href='/blog/2010/09/21/'>Throw Up a Quick HTTP Server</a></h1><div class='comment'><div class='author'>possiblywrong</div><time datetime='2010-09-21T00:00:00Z'>Tue, 21 Sep 2010 00:00:00 UTC</time><div class='body'><p><br>You saved me some time, too.  I found this post deeply embedded in a Google search while trying to tweak my x64 Ubuntu 10.2 installation without an internet connection.  (My work desktop is Windows, but I have another KVM-switched standalone Linux box).<br></p><p><br>I think the problem is even worse than you describe.  I was using the CD (not the DVD) burned from the .iso, which mounts as some long volume name... but apt seems to hard-code the location where it expects the CD to be (/media/cdrom, I think).  Serving the CD from Python works great, though.<br></p><p><br>Thanks!<br></p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2010-09-21T00:00:00Z'>Tue, 21 Sep 2010 00:00:00 UTC</time><div class='body'><p><br>That <i>exactly</i> describes the problem I was having with the DVD, but I had assumed it was only due to it being the less-popular DVD. I'm a little surprised to see it's totally broken for both types of media. Looks like nobody is testing it.<br></p><p><br>Off topic question: you say you found this post deep in a Google search? I noticed you have <a href="http://possiblywrong.wordpress.com/2010/08/30/the-value-of-mathematics/" rel="nofollow noopener" title="http://possiblywrong.wordpress.com/2010/08/30/the-value-of-mathematics/">a post linking to the Howard County Times</a>. I currently live in Howard county, and if you do too that's an interesting coincidence. Or perhaps Google does something with search results varying by locality.<br></p></div></div><div class='comment'><div class='author'>Michal Zuber</div><time datetime='2014-12-05T05:38:02Z'>Fri, 05 Dec 2014 05:38:02 UTC</time><div class='body'><p>Yeah, really cool stuff, added to my bash aliases:<br>alias webshare='echo "Visit http://$(hostname):8080/"; python3 -m http.server 8080'</p></div></div></div><hr/><div class='thread'><h1 id='2010-09-08'><a href='/blog/2010/09/08/'>Middleman Parallelization</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2010-08-13'><a href='/blog/2010/08/13/'>Java is Death By A Thousand Paper Cuts</a></h1><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2010-08-13T00:00:00Z'>Fri, 13 Aug 2010 00:00:00 UTC</time><div class='body'><p><br>JRuby is something I've been interested in, but I haven't really looked into it. The JVM language I'd really like most to get into Clojure, Lisp on the JVM. The problem is the serious lack of support: my package manager doesn't handle it; Clojure Slime is a huge pain to set up, has no documentation, and is half-unmaintained; and Clojure contrib is even worse.<br></p></div></div><div class='comment'><div class='author'>Luke Maciak</div><time datetime='2010-08-13T00:00:00Z'>Fri, 13 Aug 2010 00:00:00 UTC</time><div class='body'><p><br>Oops... You already mentioned Clojure. Oh well. :P</p></div></div><div class='comment'><div class='author'>Luke Maciak</div><time datetime='2010-08-13T00:00:00Z'>Fri, 13 Aug 2010 00:00:00 UTC</time><div class='body'><p><br>I feel your pain man.  It's even worse when I switch to C++. <br></p><p><br>Then again Java was what I used all throughout college so I tend to forgive it a lot of it's flaws due to nostalgia and stuff like that.<br></p><p><br>I guess it's probably to late for this, but next time you need to write for the JVM maybe try Clojure? It is a lisp dialect written for jvm.<br></p><p><br>I have only played with it a little bit and I think it is a bit different from say Common Lisp but it is worth giving a shot if Java is driving you nuts. :)</p></div></div><div class='comment'><div class='author'>Jeff</div><time datetime='2010-08-13T00:00:00Z'>Fri, 13 Aug 2010 00:00:00 UTC</time><div class='body'><p><br>Have you considered Jython and Nailgun, or maybe JRuby? I never got along well with Java.</p></div></div></div><hr/><div class='thread'><h1 id='2010-08-07'><a href='/blog/2010/08/07/'>Distributed Computing with Emacs</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2010-07-26'><a href='/blog/2010/07/26/'>Elisp Memoize</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2010-07-21'><a href='/blog/2010/07/21/'>GIMP Painting</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2010-07-19'><a href='/blog/2010/07/19/'>GIMP Space Elevator Drawing</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2010-07-01'><a href='/blog/2010/07/01/'>Emacs Byte Compilation</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2009-05-28'><a href='/blog/2009/05/28/'>Elisp Running Time Macro</a></h1><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-05-28T00:00:00Z'>Thu, 28 May 2009 00:00:00 UTC</time><div class='body'><p><br>I've realized that this function could be a lot shorter, cleaner, and more correct just by using <code>float-time</code>. So I fixed it. Enjoy!<br></p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-05-28T00:00:00Z'>Thu, 28 May 2009 00:00:00 UTC</time><div class='body'><p><br>Yeah, I <i>love</i> Emacs. It's a really fantastic editor/IDE and portable programming environment. And thoroughly self-documented. You mentioned running code in any buffer: if you fire up Emacs info and open one of the elisp manuals, you can execute the examples right inside the manual as you read it. Very convenient.<br></p><p><br>I keep using elisp, rather than other lisps, because I don't even need a separate interpreter -- it's built right into the editor -- and all of the documentation is right there. What's this function do? <code>C-x f <i>function</i></code>. Want more depth? <code>M-x elisp-index-search <i>function</i></code>.<br></p><p><br>Now if only elisp had closures, bignums, modules/namespaces, a C interface, continuations, and was reasonably fast (i.e. it was more like Common Lisp or Scheme) it could be used as a serious programming language. Without these, it's still good for writing little experiments. I suspect it will gain most of these features someday.<br></p><p><br>While I am wishing, I wish it had a flexible regex type, like Javascript or Perl, too. Putting regular expressions in strings is silly.<br></p></div></div><div class='comment'><div class='author'>Lukasz Grzegorz Maciak</div><time datetime='2009-05-28T00:00:00Z'>Thu, 28 May 2009 00:00:00 UTC</time><div class='body'><p><br>Nice! I'm bookmarking this for future reference. I'm pretty sure this will become useful at some point.<br></p><p><br>Btw, all these recent elisp posts made me start messing around with Emacs again and I love the fact that I can type a function into a buffer, and then run it on that very same buffer. :) </p></div></div></div><hr/><div class='thread'><h1 id='2010-06-10'><a href='/blog/2010/06/10/'>Emacs ParEdit and IELM</a></h1><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2010-06-10T00:00:00Z'>Thu, 10 Jun 2010 00:00:00 UTC</time><div class='body'><p><br>Yup, I've used eshell a bit, mostly at work (to avoid the horrible <code>cmd.exe</code>). But since it doesn't live in a real terminal emulator it has limited usefulness. It's also lacking documentation at the moment, so it can be hard to figure out how to make it do some of the cool things it can do, such as redirect input/output to/from buffers.<br></p></div></div><div class='comment'><div class='author'>Joseph Gay</div><time datetime='2010-06-10T00:00:00Z'>Thu, 10 Jun 2010 00:00:00 UTC</time><div class='body'><p><br>Hi, you may already be aware of eshell. I just thought I'd mention that it supports lisp input.</p></div></div><div class='comment'><div class='author'>Egarrulo</div><time datetime='2012-01-21T04:01:17Z'>Sat, 21 Jan 2012 04:01:17 UTC</time><div class='body'><p>Thank you for this useful snippet of code.</p><p>Regarding Eshell's lack of documentation, have a look at this tutorial: <br><a href="http://www.masteringemacs.org/articles/2010/12/13/complete-guide-mastering-eshell/" rel="nofollow noopener" title="http://www.masteringemacs.org/articles/2010/12/13/complete-guide-mastering-eshell/">http://www.masteringemacs.o...</a></p><p>What do you mean by "since it doesn't live in a real terminal emulator it has limited usefulness"? Maybe because it doesn't work with console programs which take up all the screen (like vim, mutt, etc.)?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2012-01-21T04:32:44Z'>Sat, 21 Jan 2012 04:32:44 UTC</time><div class='body'><p>Yup, you've got it. It can't do curses type stuff because it doesn't interpret escape sequences (ANSI, VT100, etc.) like a real terminal would. This isn't eshell's fault, so it's not a complaint from me. Emacs *does* have the ability to be a terminal emulator (ansi-term), but it unavoidably interferes with Emacs' own bindings.</p></div></div></div><div class='comment'><div class='author'>essay-on-time writing service</div><time datetime='2016-02-07T06:06:10Z'>Sun, 07 Feb 2016 06:06:10 UTC</time><div class='body'><p>This is really wonderful and useful for those Emac users who wanted to make use of this extension. It has a unique feature that can give a person some output that they need.</p></div></div><div class='comment'><div class='author'>Andrew Kirkpatrick</div><time datetime='2018-04-23T03:33:22Z'>Mon, 23 Apr 2018 03:33:22 UTC</time><div class='body'><p>I know this is a little late, but you can put that same advice on 'inferior-emacs-lisp-mode in order to have the parens appear at the first prompt.</p></div></div></div><hr/><div class='thread'><h1 id='2010-06-07'><a href='/blog/2010/06/07/'>Elisp Printed Hash Tables</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2010-05-20'><a href='/blog/2010/05/20/'>Identifying Files</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2010-05-13'><a href='/blog/2010/05/13/'>Neat Random Inn Generator</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2010-04-16'><a href='/blog/2010/04/16/'>LZMA and XZ Binaries</a></h1><div class='comment'><div class='author'>Gavin Black</div><time datetime='2010-04-16T00:00:00Z'>Fri, 16 Apr 2010 00:00:00 UTC</time><div class='body'><p><br>Looks like it was mysteriously added to lzma and xz utils pages :P<br></p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2010-04-16T00:00:00Z'>Fri, 16 Apr 2010 00:00:00 UTC</time><div class='body'><p><br>Ah, it does, and I just tested at work to confirm. Thanks for pointing that out. I've never used the beta versions before so I didn't know.<br></p></div></div><div class='comment'><div class='author'>Jeff Borck</div><time datetime='2010-04-16T00:00:00Z'>Fri, 16 Apr 2010 00:00:00 UTC</time><div class='body'><p><br>7-zip now seems to support XZ, <a href="http://www.7-zip.org/history.txt" rel="nofollow noopener" title="http://www.7-zip.org/history.txt">as of 9.04 beta</a>.</p></div></div><div class='comment'><div class='author'>Gavin Black</div><time datetime='2010-04-16T00:00:00Z'>Fri, 16 Apr 2010 00:00:00 UTC</time><div class='body'><p><br>Nice job!  You ought to add that to the Wiki page or somewhere visible, since I think you have the only native Windows xz utility.</p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2010-04-16T00:00:00Z'>Fri, 16 Apr 2010 00:00:00 UTC</time><div class='body'><p><br>Eh, I don't want to put my own link on Wikipedia. That's bad form and bad ettiquette. But <a href="http://en.wikipedia.org/wiki/Xz" rel="nofollow noopener" title="http://en.wikipedia.org/wiki/Xz">if <i>you</i> wanted to do</a> it I can't stop you! ;-)<br></p></div></div><div class='comment'><div class='author'>Midzuki</div><time datetime='2010-04-16T00:00:00Z'>Fri, 16 Apr 2010 00:00:00 UTC</time><div class='body'><p><br>Thanks!<br></p><p><br>Yes, yet another usefull item for my software collection.<br></p><p><br>^__^<br></p></div></div></div><hr/><div class='thread'><h1 id='2010-04-13'><a href='/blog/2010/04/13/'>Scheme Live Coding</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2010-04-12'><a href='/blog/2010/04/12/'>Scheme Neural Network</a></h1><div class='comment'><div class='author'>baoxiang pan</div><time datetime='2014-04-24T01:55:56Z'>Thu, 24 Apr 2014 01:55:56 UTC</time><div class='body'><p>cool!!!!</p></div></div><div class='comment'><div class='author'>amz3</div><time datetime='2016-01-14T18:42:35Z'>Thu, 14 Jan 2016 18:42:35 UTC</time><div class='body'><p>thx!</p></div></div></div><hr/><div class='thread'><h1 id='2007-11-13'><a href='/blog/2007/11/13/'>Neural Network Blackjack Game</a></h1><div class='comment'><div class='author'>abcd</div><time datetime='2014-09-27T03:33:51Z'>Sat, 27 Sep 2014 03:33:51 UTC</time><div class='body'><p>Stumbled upon this. Interesting method and nice write up. Thanks.</p></div></div></div><hr/><div class='thread'><h1 id='2010-03-31'><a href='/blog/2010/03/31/'>Emacs cat-safe</a></h1><div class='comment'><div class='author'>Kelsey Wellons</div><time datetime='2010-03-31T00:00:00Z'>Wed, 31 Mar 2010 00:00:00 UTC</time><div class='body'><p><br>I wonder who's cute little paw that is? :)</p></div></div></div><hr/><div class='thread'><h1 id='2010-02-18'><a href='/blog/2010/02/18/'>Function Pointers are Special</a></h1><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2010-02-18T00:00:00Z'>Thu, 18 Feb 2010 00:00:00 UTC</time><div class='body'><p><br>NealAbq, I think that's exactly what's going on, at least in the case of x86. The x86 ISA has different models for object code, medium and compact, where the function pointers are different sizes than data pointers. I found a discussion of it, including an example of this in action, on Stack Overflow: <a href="http://stackoverflow.com/questions/1473935/can-the-size-of-pointers-vary-depending-on-whats-pointed-to" rel="nofollow noopener" title="http://stackoverflow.com/questions/1473935/can-the-size-of-pointers-vary-depending-on-whats-pointed-to">Can the Size of Pointers Vary Depending on whats Pointed To?</a>. It also links to this comp.lang.c FAQ question: <a href="http://c-faq.com/ptrs/generic.html" rel="nofollow noopener" title="http://c-faq.com/ptrs/generic.html">Question 4.13</a>.<br></p><p><br>I'm going to add those links to my post now.<br></p></div></div><div class='comment'><div class='author'>NealAbq</div><time datetime='2010-02-18T00:00:00Z'>Thu, 18 Feb 2010 00:00:00 UTC</time><div class='body'><p><br>Thanks. I'd almost forgotten about small/medium/compact/large, although they still matter sometimes if you're doing embedded systems. <br></p><p><br>Apparently Intel gives us 6 memory models, although only medium and compact have skewed-up pointers: <br></p><p><br><a href="http://en.wikipedia.org/wiki/Intel_Memory_Model" rel="nofollow noopener" title="http://en.wikipedia.org/wiki/Intel_Memory_Model">http://en.wikipedia.org/wiki/Intel_Memory_Model</a><br></p></div></div><div class='comment'><div class='author'>NealAbq</div><time datetime='2010-02-18T00:00:00Z'>Thu, 18 Feb 2010 00:00:00 UTC</time><div class='body'><p><br>When are function pointers different? Is it a "near" vs "far" pointer thing, where you tell the compiler to assume data pointers are all "near" unless explicitly marked "far", and all function pointers are "far"?<br></p></div></div><div class='comment'><div class='author'>Gavin Black</div><time datetime='2010-02-18T00:00:00Z'>Thu, 18 Feb 2010 00:00:00 UTC</time><div class='body'><p><br>Finally something to replace giving printouts of Whitespace programs to interviewees and asking them to debug it :-D</p></div></div></div><hr/><div class='thread'><h1 id='2010-02-06'><a href='/blog/2010/02/06/'>Common Lisp Quick Reference</a></h1><div class='comment'><div class='author'>_</div><time datetime='2015-03-17T08:21:24Z'>Tue, 17 Mar 2015 08:21:24 UTC</time><div class='body'><p>Greatness is here   0 COMMENTS!?!!?!?!?!?!!?!?</p></div></div><div class='comment'><div class='author'>celestine virgen</div><time datetime='2016-03-22T23:37:27Z'>Tue, 22 Mar 2016 23:37:27 UTC</time><div class='body'><p>Interesting article . I Appreciate the facts , Does someone know if my business might be able to acquire a fillable HUD-1 document to edit ?</p></div></div></div><hr/><div class='thread'><h1 id='2010-02-04'><a href='/blog/2010/02/04/'>Wisp Screencasts</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2010-01-24'><a href='/blog/2010/01/24/'>Wisp Lisp</a></h1><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2010-01-24T00:00:00Z'>Sun, 24 Jan 2010 00:00:00 UTC</time><div class='body'><p><br>Hmmm, that can only mean that something is passing a size of 0 to <code>realloc()</code> at some point. It returned <code>NULL</code> and it was thought to be an error.<br></p><p><br>That's the kind of stuff I'm working on ironing out right now. The number of defined functions will expand once I have the core pretty solid. I look forward to the point where I'm just adding interesting language features, exposing interesting library interfaces, and optimizing things.<br></p><p><br>I'm also nearing the point where I can start benchmarking its performance. Right now it seems to be on par with non-compiled Emacs lisp. However, I have the advantage of much fewer language features.<br></p></div></div></div><hr/><div class='thread'><h1 id='2010-01-15'><a href='/blog/2010/01/15/'>Setting up a Common Lisp Environment</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2009-12-21'><a href='/blog/2009/12/21/'>Magick Thumbnails</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2009-12-13'><a href='/blog/2009/12/13/'>Game of Life in Java</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2009-12-06'><a href='/blog/2009/12/06/'>Tweaking Emacs for Ant and Java</a></h1><div class='comment'><div class='author'>Gavin Black</div><time datetime='2009-12-06T00:00:00Z'>Sun, 06 Dec 2009 00:00:00 UTC</time><div class='body'><p><br>A very similar effect can be achieved with a real editor using <a href="http://www.vim.org/scripts/script.php?script_id=155" rel="nofollow noopener" title="http://www.vim.org/scripts/script.php?script_id=155">ant_menu.vim plugin</a>.  You simply copy it to $VIM_HOME/plugins and then: ,b to build; ,f to find; ,t to build a target; etc. All of which go into a separate buffer on a split screen.  <br><br>You can run the program using <b>:!whatever_command</b>.  Or if you want to be fancy and run it in it's own buffer you could do <b>:e name</b> then <b>:%!whatever_command</b>.<br></p><p><br></p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-12-06T00:00:00Z'>Sun, 06 Dec 2009 00:00:00 UTC</time><div class='body'><p><br>As an addendum:<br></p><p><br>What's also nice about this, and Emacs in general, is that the setup is portable. That is, they make me use Windows at work for some stuff (i.e. management making decisions they didn't quite understand), but I can still set up a nearly identical development environment as the one I enjoy on GNU/Linux. If you have <code>javac</code> and <code>ant</code> in your path, you're all ready to use my stuff in the post.<br></p><p><br>However, you might want to adjust the <code>"/"</code> part to suit the weird filesystem layout Windows uses. Is there an generic elisp function for detecting the filesystem root?<br></p></div></div><div class='comment'><div class='author'>ckoch</div><time datetime='2013-05-23T17:08:32Z'>Thu, 23 May 2013 17:08:32 UTC</time><div class='body'><p>You can also set the compile-command which defaults to <b>make -k</b> with the <b>ant -emacs -f </b> by adding the following to your init.el: <b>(setq compile-command "ant \-emacs \-f")</b></p></div></div></div><hr/><div class='thread'><h1 id='2009-12-05'><a href='/blog/2009/12/05/'>First Maryland Snow of 2009</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2009-11-03'><a href='/blog/2009/11/03/'>Emacs Web Servlets</a></h1><div class='comment'><div class='author'>Rick Hanson</div><time datetime='2011-08-30T06:30:33Z'>Tue, 30 Aug 2011 06:30:33 UTC</time><div class='body'><p>This is freakin' awesome!  Thanks for sharing.</p></div></div></div><hr/><div class='thread'><h1 id='2009-10-26'><a href='/blog/2009/10/26/'>Your BitTorrent Client is Probably Defective by Design</a></h1><div class='comment'><div class='author'>Ahmed Fasih</div><time datetime='2018-01-02T02:43:26Z'>Tue, 02 Jan 2018 02:43:26 UTC</time><div class='body'><p>Alas, as of 2016, BEP 27 Private Torrents is officially listed as “accepted”: <a href="https://github.com/bittorrent/bittorrent.org/pull/27" rel="nofollow noopener" title="https://github.com/bittorrent/bittorrent.org/pull/27">https://github.com/bittorre...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-01-04T21:26:59Z'>Thu, 04 Jan 2018 21:26:59 UTC</time><div class='body'><p>Honestly I'm surprised it only happened that recently. It was already a de facto standard more than a decade earlier. I just wish open source clients allowed it to be overridden/ignored by the user, just as how most of the open source PDF readers ignore PDF DRM flags (no-print, etc.).</p></div></div></div></div><hr/><div class='thread'><h1 id='2009-10-10'><a href='/blog/2009/10/10/'>Comments Upgrade with Avatars</a></h1><div class='comment'><div class='author'>stephy</div><time datetime='2009-10-10T00:00:00Z'>Sat, 10 Oct 2009 00:00:00 UTC</time><div class='body'><p><br>The picture of spam totally cracked me up. I know nothing about code and computer speak but the Spam did resonate with me. :)</p></div></div><div class='comment'><div class='author'>Matt Stine</div><time datetime='2009-10-10T00:00:00Z'>Sat, 10 Oct 2009 00:00:00 UTC</time><div class='body'><p><br>hawt.</p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-10-10T00:00:00Z'>Sat, 10 Oct 2009 00:00:00 UTC</time><div class='body'><p><br>I actually swiped that image <a href="http://en.wikipedia.org/wiki/File:Spam_with_cans.jpeg" rel="nofollow noopener" title="http://en.wikipedia.org/wiki/File:Spam_with_cans.jpeg">right from Wikipedia</a>, which is indicated, as required, by mousing over the image to see the image's title attribute. Thanks to the Free licensing Wikipedia uses I can do this without risking some kind of Fair Use/copyright infringement thing.<br></p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-10-10T00:00:00Z'>Sat, 10 Oct 2009 00:00:00 UTC</time><div class='body'><p><br>Check out that sexy avatar to the left!<br></p></div></div></div><hr/><div class='thread'><h1 id='2009-09-27'><a href='/blog/2009/09/27/'>Unorderable Sets</a></h1><div class='comment'><div class='author'>Gavin Black</div><time datetime='2009-09-27T00:00:00Z'>Sun, 27 Sep 2009 00:00:00 UTC</time><div class='body'><p><br>Hmmm, it is pretty hard to come up with items that don't imply order and are easy to compute with.  Your word idea works, but you'd have to use something expensive like a hashmap.<br><br><br><br>You could also use unicode to get non-alphabetical symbols (Mathematics, punction, etc), which would still have an underlying number associated with them.  I don't think asian languages have an ordering associated with their characters either, since they are essentially ideograms.   <br></p></div></div><div class='comment'><div class='author'>Luke Maciak</div><time datetime='2009-09-27T00:00:00Z'>Sun, 27 Sep 2009 00:00:00 UTC</time><div class='body'><p><br>I submit that it is impossible to create such set. As soon as you list the members, it will become possible to design a hash function that will transform that set into a linearly orderable set of hash values. This is of course only necessary if there is no explicit presentation order. <br></p><p><br>Ordering and indexing things is just something that we humans do, and we do it fairly well. So I would say that any attempt at enforcing un-orderability of a set will fail, as sooner or later someone will come up with the ordering.<br></p><p><br>But if you want a set without an inherent ordering, why not just assign each person in your village a <a href="http://en.wikipedia.org/wiki/Globally_Unique_Identifier" rel="nofollow noopener" title="http://en.wikipedia.org/wiki/Globally_Unique_Identifier">GUID</a>. They still can be ordered an indexed quite easily, but this ordering is less intuitive than that of social security numbers for example.</p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-09-27T00:00:00Z'>Sun, 27 Sep 2009 00:00:00 UTC</time><div class='body'><p><br>@Gavin: I thought that maybe another culture would have some kind of assumed unordered set. I'll have to check up on that.<br></p><p><br>@Luke: Yup, anyone can easily define an order to a finite set (I think any infinite set would be ordered by its very definition), so I guess the best we could hope for is designing the set such that defining an order is difficult and the defined order is unintuitive.<br></p><p><br>I like the the GUID idea. It's similar to my mention of assigning large numbers in a semi-random way. The assignment process could be a hash of (typically) unchanging physical properties like height, eye color, hair color, skin color, date of birth, blood type, handedness, length of right index finger, etc. If villagers understand how naming assignments work, smaller identifiers could be used and no one would assume a meaningful ordering. (Not that I condone imprisoning innocent people in an Orwellian village.)<br></p></div></div><div class='comment'><div class='author'>Tino</div><time datetime='2009-09-27T00:00:00Z'>Sun, 27 Sep 2009 00:00:00 UTC</time><div class='body'><p><br>I think (but are not sure) that every set can be assigned an order. It is an interesting question though. My first idea for avoiding ordering was a continuous 2D-surface of points. But even there you can create an order after, say, the distance to the origin and the angle to the x-axis. My guess is that any finite or infinite set can be mapped to points on an N-dimensional coordinate system, and then use a similar ordering in N dimensions.<br></p><p><br>But it seems you are also hinting towards a more cultural question; if there is any "set" in our culture that we think of as inherently unordered. For that, how about the a set of colors? <br></p><p><br>I think most humans think of colors as an unordered set, even though it is of course *possible* to order them in many ways. A good test would be to give a number of colored rectangles to people and the task to "please order these". With colors you would probably get widely different results, while with e.g., names, words, and social security numbers, almost everyone would just sort them alphanumerically.<br></p></div></div></div><hr/><div class='thread'><h1 id='2009-09-02'><a href='/blog/2009/09/02/'>SumoBots Programming Game</a></h1><div class='comment'><div class='author'>jb</div><time datetime='2009-09-02T00:00:00Z'>Wed, 02 Sep 2009 00:00:00 UTC</time><div class='body'><p><br>Interesting, thanks for sharing !</p></div></div></div><hr/><div class='thread'><h1 id='2009-09-01'><a href='/blog/2009/09/01/'>null program Turns Two Years Old</a></h1><div class='comment'><div class='author'>Gavin Black</div><time datetime='2009-09-01T00:00:00Z'>Tue, 01 Sep 2009 00:00:00 UTC</time><div class='body'><p><br>"beautilluminate" <br></p><p><br>Wow a word that has no results on google. I guess it will now, or will fade into crastelanimousity</p></div></div><div class='comment'><div class='author'>David Engel</div><time datetime='2009-09-01T00:00:00Z'>Tue, 01 Sep 2009 00:00:00 UTC</time><div class='body'><p><br>Congratulations! I'm just on the starting end of my blog, but I have to agree: <a href="http://blosxom.sourceforge.net" rel="nofollow noopener" title="http://blosxom.sourceforge.net">Blosxom</a> is a great choice.</p></div></div><div class='comment'><div class='author'>Someone</div><time datetime='2009-09-01T00:00:00Z'>Tue, 01 Sep 2009 00:00:00 UTC</time><div class='body'><p><br>beautilluminate</p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-09-01T00:00:00Z'>Tue, 01 Sep 2009 00:00:00 UTC</time><div class='body'><p><br>@Gavin: Hmm, I thought I read somewhere about the blog photograph claim. I can't find a source for it to prove it, though. So maybe I am wrong. In any case, Ferrari Guy reminds me a bit of <a href="http://www.hrwiki.org/wiki/Limozeen" rel="nofollow noopener" title="http://www.hrwiki.org/wiki/Limozeen">Limozeen</a>.<br></p><p><br>And the "preview" goes in the "preview" area. Notice the gap above it? ;-) That's why.<br></p><p><br>@David: Where's your blog, David? Drop us a link.<br></p></div></div><div class='comment'><div class='author'>Gavin Black</div><time datetime='2009-09-01T00:00:00Z'>Tue, 01 Sep 2009 00:00:00 UTC</time><div class='body'><p><br>Congrats on 2 years of having your site :)<br></p><p><br>I'd be interested on seeing the study on portraits on websites.  I have the opposite intuition, the reader can make up the image of you they want and not pass judgment based on looks.  I think I feel that way because when I was little I saw ESR after reading the Jargon File, and it was like being hit with a bat :)  <br></p><p><br>Actually I take that back after seeing <a href="http://ferrariguyforhire.com/" rel="nofollow noopener" title="http://ferrariguyforhire.com/">Ferrari Guy</a>, site portraits FTW!<br></p><p><br></p></div></div><div class='comment'><div class='author'>Gavin Black</div><time datetime='2009-09-01T00:00:00Z'>Tue, 01 Sep 2009 00:00:00 UTC</time><div class='body'><p><br>I just noticed something kinda weird.  When you preview a comment it is put under the others, but when you submit it goes on top :p  </p></div></div><div class='comment'><div class='author'>Matt Stine</div><time datetime='2009-09-01T00:00:00Z'>Tue, 01 Sep 2009 00:00:00 UTC</time><div class='body'><p><br>Congratulations, Chris!  I'm barely consistent enough to sign on to Jabber once a week, let alone write a blog post every seven days!  Here's to another two years!  :)</p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-09-01T00:00:00Z'>Tue, 01 Sep 2009 00:00:00 UTC</time><div class='body'><p><br>I had also checked that against Google and noticed it had no results, so I don't know what Someone was intervocabmunicating. I'm going to have some unique search terms pointing here now.<br></p></div></div></div><hr/><div class='thread'><h1 id='2009-08-28'><a href='/blog/2009/08/28/'>An Entropy-Efficient Virtual Dice Rolling Algorithm</a></h1><div class='comment'><div class='author'>Elsie Howard</div><time datetime='2014-06-24T11:05:52Z'>Tue, 24 Jun 2014 11:05:52 UTC</time><div class='body'><p>Nice post. Cristopher, your project is awesome, this algorithm is perfect. I like your work. Thanks for sharing here.</p></div></div></div><hr/><div class='thread'><h1 id='2009-08-23'><a href='/blog/2009/08/23/'>Lossless Optimizers</a></h1><div class='comment'><div class='author'>Kelsey Wellons</div><time datetime='2009-08-23T00:00:00Z'>Sun, 23 Aug 2009 00:00:00 UTC</time><div class='body'><p><br>How about <b><i>MS Paint</i></b>? :)</p></div></div></div><hr/><div class='thread'><h1 id='2009-08-11'><a href='/blog/2009/08/11/'>IRC Random Number Generator</a></h1><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-08-11T00:00:00Z'>Tue, 11 Aug 2009 00:00:00 UTC</time><div class='body'><p><br>"You could inject small amounts of other random data periodically to deter anyone listening in."<br></p><p><br>Perhaps with <a href="http://en.wikipedia.org/wiki/Fortuna_(PRNG)" rel="nofollow noopener" title="http://en.wikipedia.org/wiki/Fortuna_(PRNG)">Fortuna</a>?<br></p></div></div><div class='comment'><div class='author'>Gavin Black</div><time datetime='2009-08-11T00:00:00Z'>Tue, 11 Aug 2009 00:00:00 UTC</time><div class='body'><p><br>The idea of network based RNG doesn't seem like a bad idea.  You could inject small amounts of other random data periodically to deter anyone listening in.  <br><br><br>Or better yet if you try to find the delta as a value of CPU clock cycles you'll get clock-drift randomness too. <br><br><br>Not sure why you picked IRC though, since it's so slow (/b/ would be good if you could rely on it being up).<br>Seems that even network latency itself could be used to generate a lot of data pretty quickly, e.g. repeatedly fetch from an ad server (Since they often serve up different content each time) and measure the amount of cycles that occurred.<br></p></div></div></div><hr/><div class='thread'><h1 id='2009-08-08'><a href='/blog/2009/08/08/'>Flying Spaghetti Monster in the HTML 5 Spec</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2009-08-05'><a href='/blog/2009/08/05/'>Web Pages Are Liquids</a></h1><div class='comment'><div class='author'>JKirchartz</div><time datetime='2009-08-05T00:00:00Z'>Wed, 05 Aug 2009 00:00:00 UTC</time><div class='body'><p><br>Definitely true, webpages should be liquid and accept changes in font-size for accessibility and so that it doesn't look terrible on screens of different resolution (iPhone to HDtv)<br></p><p><br>But typography is important in that line-length is really closely related to read-ability. It's easier to read on a per-line basis than per-word.<br></p><p><br>To be liquid and follow those rules change all pixel measurements to em. <a href="http://en.wikipedia.org/wiki/Em_(typography)" rel="nofollow noopener" title="http://en.wikipedia.org/wiki/Em_(typography)">http://en.wikipedia.org/wiki/Em_(typography)</a> has some good links and data.</p></div></div><div class='comment'><div class='author'>David Engel</div><time datetime='2009-08-05T00:00:00Z'>Wed, 05 Aug 2009 00:00:00 UTC</time><div class='body'><p><br>I agree, to a point. I don't like non-liquid designs generally, especially because of the issues lower resolutions have, but on machines with very high resolution, the extended line length becomes a usability issue - it is accepted that paragraphs that are very wide - I think more than 20 words wide - are difficult to read for the average person. That's why I am in favor of setting a maximum width based on the font size, which will leave the empty space you are noting.</p></div></div></div><hr/><div class='thread'><h1 id='2009-08-02'><a href='/blog/2009/08/02/'>Ad-blocking and the Regrettable URL Format</a></h1><div class='comment'><div class='author'>Gavin Black</div><time datetime='2009-08-02T00:00:00Z'>Sun, 02 Aug 2009 00:00:00 UTC</time><div class='body'><p><br>So you're advocating the Java <a href="http://java.sun.com/docs/codeconv/html/CodeConventions.doc8.html" rel="nofollow noopener" title="http://java.sun.com/docs/codeconv/html/CodeConventions.doc8.html">package naming convention</a> :)  <br><br><br>I don't think it would be too hard to write something that translates URLs back and forth between the two, since the first 3 are the only reordered ones.  <br><br><br>Also I'm pretty sure <a href="http://*.whatever.com/*" rel="nofollow noopener" title="http://*.whatever.com/*">http://*.whatever.com/*</a> is supported in newer versions of adblock.  I have several entries like that and just tested my doubleclick one.</p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-08-02T00:00:00Z'>Sun, 02 Aug 2009 00:00:00 UTC</time><div class='body'><p><br>Yup, just because Java did it doesn't necessarily make it bad. (But that's a good rule of thumb! :-P)<br></p><p><br>And yeah, that pattern works in Adblock Plus just fine. I'm just tired of typing it. Adblock Plus provides a list of likely patterns that is one item too short. Let's say the single-pixel tracker was at "<a href="http://beacon7.example.com/tracker/pixel.gif" rel="nofollow noopener" title="http://beacon7.example.com/tracker/pixel.gif">http://beacon7.example.com/tracker/pixel.gif</a> ". Adblock Plus would present me,<br></p><p><br></p><pre><a href="http://beacon7.example.com/tracker/pixel.gif" rel="nofollow noopener" title="http://beacon7.example.com/tracker/pixel.gif">http://beacon7.example.com/tracker/pixel.gif</a><br><a href="http://beacon7.example.com/tracker/*" rel="nofollow noopener" title="http://beacon7.example.com/tracker/*">http://beacon7.example.com/tracker/*</a><br><a href="http://beacon7.example.com/*" rel="nofollow noopener" title="http://beacon7.example.com/*">http://beacon7.example.com/*</a><br>Text box for custom a filter<br></pre><p><br></p><p></p><p><br>I'd like another quick option available for me so I don't have to type it out every time,<br></p><pre><a href="http://*.example.com/*" rel="nofollow noopener" title="http://*.example.com/*">http://*.example.com/*</a><br></pre><p><br></p><p></p><p><br>That's what I <i>do</i> use, and it's the most common pattern in my blocklist. This pattern is less efficient than the alternate-universe URL where we need only one glob. It's also erroneous, as in the case of, say, a wiki documenting this as a bad website,<br></p><p><br><a href="http://example.net/wiki/beacon7.example.com/screenshot.png" rel="nofollow noopener" title="http://example.net/wiki/beacon7.example.com/screenshot.png">http://example.net/wiki/beacon7.example.com/screenshot.png</a><br></p><p><br>Our screenshot would be blocked. To resolve this, Adblock Plus has some new kind of pattern that only matches domain names. I haven't used it yet, though.<br></p><p><br>You mentioned translating the URL, an idea which was also in the back of my mind. Adblock Plus could work on translated URLs, potentially simplifying, optimizing, and disambiguating patterns (and translations should be cheap). It introduces an ambiguity because this maps many-to-one.<br></p><pre><a href="http://wiki.example.net/" rel="nofollow noopener" title="http://wiki.example.net/">http://wiki.example.net/</a><br><a href="http://example.net/wiki/" rel="nofollow noopener" title="http://example.net/wiki/">http://example.net/wiki/</a><br></pre><p><br>Both translate to,<br></p><pre><a href="http://net/example/wiki/" rel="nofollow noopener" title="http://net/example/wiki/">http://net/example/wiki/</a><br></pre><p><br>Now that I think about it, the alternate URL scheme would have some of its own issues: instead of DNS resolving subdomains to different machines, it would have to be handled during the HTTP handshake by the server. Instead, maybe something like this one-to-one mapping would be more desirable for the above two URLs,<br></p><pre><a href="http://net.example.wiki/" rel="nofollow noopener" title="http://net.example.wiki/">http://net.example.wiki/</a><br><a href="http://net.example/wiki/" rel="nofollow noopener" title="http://net.example/wiki/">http://net.example/wiki/</a><br></pre><p><br></p><p></p><p><br>(Oh, and <a href="http://www.rfc-editor.org/rfc/rfc2606.txt" rel="nofollow noopener" title="http://www.rfc-editor.org/rfc/rfc2606.txt">RFC2606</a> suggests using reserved names, like <a href="http://example.com" rel="nofollow noopener" title="example.com">example.com</a> or <a href="http://example.net" rel="nofollow noopener" title="example.net">example.net</a>, for testing and documentation. ;-) )<br></p></div></div></div><hr/><div class='thread'><h1 id='2009-07-29'><a href='/blog/2009/07/29/'>Three Rivers Stadium Implosion</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2009-07-28'><a href='/blog/2009/07/28/'>Television Commercials</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2009-07-20'><a href='/blog/2009/07/20/'>Dry Ice Potato Gun</a></h1><div class='comment'><div class='author'>Luke Maciak</div><time datetime='2009-07-20T00:00:00Z'>Mon, 20 Jul 2009 00:00:00 UTC</time><div class='body'><p><br>This is officially one of the more awesome things I have seen lately. :)</p></div></div><div class='comment'><div class='author'>Matt Stine</div><time datetime='2009-07-20T00:00:00Z'>Mon, 20 Jul 2009 00:00:00 UTC</time><div class='body'><p><br>Chris,<br></p><p><br><a href="http://hackaday.com/2009/08/11/dry-ice-cannon/" rel="nofollow noopener" title="http://hackaday.com/2009/08/11/dry-ice-cannon/">http://hackaday.com/2009/08/11/dry-ice-cannon/</a><br>is a slightly more advanced version of our original invention:<br><a href="http://nullprogram.com/blog/2009/07/20" rel="nofollow noopener" title="http://nullprogram.com/blog/2009/07/20">http://nullprogram.com/blog/2009/07/20</a><br></p><p><br>Just thought I'd share, and I have to wonder if these people saw your blog post when coming up with their idea.  :)<br></p><p><br> Matt<br></p><p><br>PS, I just saw your awesomely hideous "OMFG YOU USE INTERNET EXPLORER" banner, since I loaded your blog from work using IE6.  :O  Nice touch!</p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-07-20T00:00:00Z'>Mon, 20 Jul 2009 00:00:00 UTC</time><div class='body'><p><br>@Luke: Thanks!<br></p><p><br>Looking more closely at the video I see that the camera shakes when the gun fires. I think this adds a nice, subtle visual effect that makes it seem more than it is.<br></p></div></div></div><hr/><div class='thread'><h1 id='2009-07-03'><a href='/blog/2009/07/03/'>Lisp Fantasy Name Generator</a></h1><div class='comment'><div class='author'>anonymous</div><time datetime='2009-07-03T00:00:00Z'>Fri, 03 Jul 2009 00:00:00 UTC</time><div class='body'><p><br>I use mine to create names for my, <i> uhhhhh </i>, World of Warcraft characters :o</p></div></div></div><hr/><div class='thread'><h1 id='2009-06-30'><a href='/blog/2009/06/30/'>Converted to HTML 5</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2009-06-28'><a href='/blog/2009/06/28/'>Browser URL Mangling</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2009-06-23'><a href='/blog/2009/06/23/'>The Emacs Calculator</a></h1><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-06-23T00:00:00Z'>Tue, 23 Jun 2009 00:00:00 UTC</time><div class='body'><p><br>Oops, I forgot to include errors and intervals!<br></p></div></div><div class='comment'><div class='author'>anonymous</div><time datetime='2009-06-23T00:00:00Z'>Tue, 23 Jun 2009 00:00:00 UTC</time><div class='body'><p><br>wow, thanks, i've only used calc for very basic stuff apparently; that unit conversion stuff and the symbolic forms are great :)</p></div></div><div class='comment'><div class='author'>Guest</div><time datetime='2011-11-11T15:56:28Z'>Fri, 11 Nov 2011 15:56:28 UTC</time><div class='body'><p>Actually, as early as 1994 I used Emacs calc for probability density function calculations for queueing theory. I made a small extension to Emacs to do Laplace transforms, and it worked beautifully. It's a wonderful tool.</p></div></div><div class='comment'><div class='author'>Penguin Pete Trbovich</div><time datetime='2013-09-13T17:34:05Z'>Fri, 13 Sep 2013 17:34:05 UTC</time><div class='body'><p>Although I've known about this for a while, this was an awesome tutorial to help explain Emacs calculator mode to my kids.</p></div></div><div class='comment'><div class='author'>Roy Schiramael</div><time datetime='2013-12-31T18:22:39Z'>Tue, 31 Dec 2013 18:22:39 UTC</time><div class='body'><p>Here is a bunch of helpful tips from the Google + Emacs community: <a href="https://plus.google.com/communities/114815898697665598016/s/Calc" rel="nofollow noopener" title="https://plus.google.com/communities/114815898697665598016/s/Calc">https://plus.google.com/com...</a></p><p>Also see this guide : <a href="http://blog.everythingtastesbetterwithchilli.com/2013/12/07/andrew-hyatts-emacs-calc-tutorials" rel="nofollow noopener" title="http://blog.everythingtastesbetterwithchilli.com/2013/12/07/andrew-hyatts-emacs-calc-tutorials">http://blog.everythingtaste...</a></p></div></div></div><hr/><div class='thread'><h1 id='2009-06-21'><a href='/blog/2009/06/21/'>United States Hamiltonian Paths</a></h1><div class='comment'><div class='author'>Kelsey Wellons</div><time datetime='2009-06-21T00:00:00Z'>Sun, 21 Jun 2009 00:00:00 UTC</time><div class='body'><p><br>I found a path by hand in a minute!</p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-06-21T00:00:00Z'>Sun, 21 Jun 2009 00:00:00 UTC</time><div class='body'><p><br>I accidentally posted this earlier today after I only wrote the title, which some RSS readers may have picked up on. This is the real deal now.<br></p></div></div></div><hr/><div class='thread'><h1 id='2009-06-09'><a href='/blog/2009/06/09/'>Javascript Distributed Computing</a></h1><div class='comment'><div class='author'>Gavin Black</div><time datetime='2009-06-09T00:00:00Z'>Tue, 09 Jun 2009 00:00:00 UTC</time><div class='body'><p><br>Oops I forgot a zero: Mn - a*x &lt;= 0</p></div></div><div class='comment'><div class='author'>Gavin Black</div><time datetime='2009-06-09T00:00:00Z'>Tue, 09 Jun 2009 00:00:00 UTC</time><div class='body'><p><br>Okay, so I've been thinking about this.  I have an idea but it takes a ton of space on the host's side.<br><br><br><br>1. Give the user an offset number(x) and have an offset constant(a)<br><br>2. Have the user check if any of the numbers [Mn - a*x, Mn - (a-1)*x ) are divisors of Mn.<br><br>3. If a divisor is found return back x and the location found, else return x and something like -1 meaning no divisors in that set.<br><br>4. If a divisor is found by foo distant IP addresses the host tries the next number.<br><br>5. If you get to the point where Mn - a*x is &lt;= then it is prime<br><br><br><br>The main issue is the host is required to store foo*(Mn/a) database entries for each test, which would be quite large. <br><br><br><br>P.S. the ol, ul tags don't work in comments.  Not sure if you want them to</p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-06-09T00:00:00Z'>Tue, 09 Jun 2009 00:00:00 UTC</time><div class='body'><p><br>If Mn - a*x &lt;= 0, then a and x together are about the same size or larger, in terms of computer storage, as Mn. I think can prove that. But they won't have the nice small form to represent them. Both a and x have to be sent to the node.<br></p><p><br>I also think it would be so computationally costly such that testing even a single number couldn't be completed by all the browsers in the world in any reasonable amount of time. These are gigantic numbers are are talking about. 13 million base-10 <i>digits</i>.<br></p><p><br>And wouldn't Mn/a database entries probably require more storage than the whole universe could provide? Unless a is extremely large (and therefore can't be reasonably transferred to a node or iterated over).<br></p><p><br>Maybe I am misunderstanding your idea.<br></p><p><br>P.S. If you notice the note above the comment box, <code>ol</code> and <code>ul</code> (and therefore <code>li</code>) tags aren't in the approved list. I guess I could add them sometime (they are a bit more special than some other tags).<br></p></div></div><div class='comment'><div class='author'>Alix Axel</div><time datetime='2009-06-09T00:00:00Z'>Tue, 09 Jun 2009 00:00:00 UTC</time><div class='body'><p><br>Well finding Mersenne primes with the Lucas-Lehmer test will never be appropriate for a distributed computing JavaScript environment, there are only two problems that I'm aware of that are suitable for JSDC:<br></p><p><br>1) Factoring Composite Numbers<br>2) Testing the Collatz Conjecture aka "3n + 1 Problem"<br>3) Generating Rainbow Tables</p></div></div><div class='comment'><div class='author'>Gavin Black</div><time datetime='2009-06-09T00:00:00Z'>Tue, 09 Jun 2009 00:00:00 UTC</time><div class='body'><p><br>I didn't explain myself very well the first time, and I may not again today due to lack of sleep, but here goes an example.<br></p><p><br>I want to test the number <b>2^6969 - 1</b> this shall henceforth be known as <b>M</b><br>I have in my database <b>c</b> entries where c is some constant number<br>Now assume c is something that has a small representation, for this example let <b>c = 2^6919</b><br>So <b>(2^6969 - 1)/(2^6919) ~= 10^15</b>, and this is what the user gets. <br></p><p><br>But anyway you give to the user an offset value(<b>s</b>) between <b>[0,10^15]</b> and <b>M</b> and have them step through each number(<b>n</b>)<br><b>(M - c*s)</b> to <b>(M - c*s + s)</b> and return back if it found an <b>n s.t. n | M</b><br></p><p><br>So the transfer between the user and server is pretty small, but the space requirements for the server are horrendous.  Also the computationally time would be awful.  Except that I would think, but have absolutely no proof, most numbers that aren't prime wouldn't take too long to find a divisor if you start from small numbers, and you could maybe do a better local test once you've narrowed down a probable number.<br></p><p><br>These were just thoughts, not saying they are at all feasible...but it does cut down on the communication between the server and the client.     </p></div></div><div class='comment'><div class='author'>Alex</div><time datetime='2016-11-07T20:47:19Z'>Mon, 07 Nov 2016 20:47:19 UTC</time><div class='body'><p>There is one project about distributed javascript calculations.</p><p><a href="https://zlelik.blogspot.com/2016/11/unified-field-theory-with-javascript-distributed-computing-or-gravity-electromagnetism-relation.html" rel="nofollow noopener" title="https://zlelik.blogspot.com/2016/11/unified-field-theory-with-javascript-distributed-computing-or-gravity-electromagnetism-relation.html">https://zlelik.blogspot.com...</a></p></div></div></div><hr/><div class='thread'><h1 id='2009-06-02'><a href='/blog/2009/06/02/'>E-mail Obfuscater Perl One-liner</a></h1><div class='comment'><div class='author'>Kelsey Wellons</div><time datetime='2009-06-02T00:00:00Z'>Tue, 02 Jun 2009 00:00:00 UTC</time><div class='body'><p><br>Here's a good one-liner: Those that forget the pasta are doomed to reheat it. </p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-06-02T00:00:00Z'>Tue, 02 Jun 2009 00:00:00 UTC</time><div class='body'><p><br>What about <a href="http://us3.php.net/array_map" rel="nofollow noopener" title="http://us3.php.net/array_map"><code>array_map()</code></a>? This actually seems like it would actually be even longer, because you would have to use <a href="http://us3.php.net/manual/en/function.create-function.php" rel="nofollow noopener" title="http://us3.php.net/manual/en/function.create-function.php"><code>create_function()</code></a>. And I thought "lambda" was a long keyword/function name (the language Arc calls it <code>fn</code> to be nice and short).<br></p><p><br>Wow, look at <code>create_function()</code>! It takes in two strings which have to be parsed and compiled at run time. And being in strings it messes up working with the code. Yuck! Good luck making anything but a trivial anonymous function with that.<br></p><p><br>Luckily you PHP people get <a href="http://docs.php.net/functions.anonymous" rel="nofollow noopener" title="http://docs.php.net/functions.anonymous">real anonymous functions</a>, with closures to boot, when 5.3.0 eventually comes out. Until then you have to make due with functions in strings. I didn't realize how bad PHP programmers had it. :-P<br></p></div></div></div><hr/><div class='thread'><h1 id='2009-05-29'><a href='/blog/2009/05/29/'>Elisp Wishlist</a></h1><div class='comment'><div class='author'>Anonymous Coward</div><time datetime='2009-05-29T00:00:00Z'>Fri, 29 May 2009 00:00:00 UTC</time><div class='body'><p><br>See Doug Hoyte's "Let Over Lambda" for an implementation of some of your regexp-related wishes in Common Lisp.</p></div></div></div><hr/><div class='thread'><h1 id='2009-05-25'><a href='/blog/2009/05/25/'>Doing Comment Previews the Right Way</a></h1><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-05-25T00:00:00Z'>Mon, 25 May 2009 00:00:00 UTC</time><div class='body'><p><br>Fixed the margin thing: it's all CSS now.<br></p></div></div><div class='comment'><div class='author'>Gavin Black</div><time datetime='2009-05-25T00:00:00Z'>Mon, 25 May 2009 00:00:00 UTC</time><div class='body'><p><br>main()<br><br>{<br><br>   Indented_Code_line(1);<br><br>   Indented_Code_line(2);<br><br>}<br><br></p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-05-25T00:00:00Z'>Mon, 25 May 2009 00:00:00 UTC</time><div class='body'><p><br>Incidentally, the short URL for this post is "cows".<br></p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-05-25T00:00:00Z'>Mon, 25 May 2009 00:00:00 UTC</time><div class='body'><p><br>That last comment would be my wife <b>messing with me</b>. :-D<br></p></div></div><div class='comment'><div class='author'>Gavin Black</div><time datetime='2009-05-25T00:00:00Z'>Mon, 25 May 2009 00:00:00 UTC</time><div class='body'><p><br>Preview seems to be working pretty good...except I can now blow your margins, not sure if you care since your comments are in a different location than the actual story.  Although it makes it irritating because even legitimate text like this long paragraph will go off screen and require using the horizontal scrollbar to see.   <br></p><p><br></p><pre>BlooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooownMaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaargins<br></pre><p><br></p><p></p><p><br><br><br>Also it seems like there isn't an automagic newline to BR.<br></p><p><br></p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-05-25T00:00:00Z'>Mon, 25 May 2009 00:00:00 UTC</time><div class='body'><p><br>I don't want to ban long lines because someone might drop some long code inside a set of <code>pre</code> tags, but I also don't want normal paragraphs to not wrap either, like that is happening above. The problem is that pollxn puts the comments in a table, and your long line stretches the cell out. I need to fix pollxn again.<br></p><p><br>I won't write a sophisticated engine for detecting abuse because it will never be complete. I can just manually remove posts that are abusive (like ones that post a whole bunch of <code>&lt;br&gt;</code> in a row to create giant gaps).<br></p><p><br>I don't <i>quite</i> want automagic <code>\n</code> -&gt; <code>br</code> because I want this to be as close to HTML as possible, but still permit someone unfamiliar with HTML to separate their paragraphs. If you look at the code, it separates paragraphs by putting <code>&lt;p&gt;&lt;/p&gt;</code> in place of two newlines ("\n\n"). This allows a regular person to easily make paragraphs. You might not have seen this because I actually broke that by accident during the time you made your post. It is fixed now.<br></p><p><br>If you really needed a <code>br</code> you can drop one in yourself. It is one of the allowed tags.<br></p></div></div><div class='comment'><div class='author'>anonymous</div><time datetime='2009-05-25T00:00:00Z'>Mon, 25 May 2009 00:00:00 UTC</time><div class='body'><p><br><b> <i> It looks good. I am actually writing a block of code similar to this for my blog.  I was having trouble, but after seeing your code, I realized what I had been doing wrong. </i></b></p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-05-25T00:00:00Z'>Mon, 25 May 2009 00:00:00 UTC</time><div class='body'><p><br>As I said, I want it to be almost like HTML, so here you use <code>&lt;pre&gt;</code>. But you already knew that. The only way I want to depart from HTML is with the paragraph thing.<br></p><p><br></p><pre>main()<br>  {<br>    Indented_Code_line(1);<br>    Indented_Code_line(2);<br>  }<br></pre><p><br></p><p></p><p><br>Closed: NOT A BUG :-P<br></p></div></div></div><hr/><div class='thread'><h1 id='2009-05-24'><a href='/blog/2009/05/24/'>Unquoted Let</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2009-05-23'><a href='/blog/2009/05/23/'>Getting Lisp</a></h1><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-05-23T00:00:00Z'>Sat, 23 May 2009 00:00:00 UTC</time><div class='body'><p><br>Yeah, I know, this post is a bit lame, but I <i>really</i> like that code! To make up for it I have two interesting posts queued up for the next two days. (I only post one per day at most.)<br></p></div></div></div><hr/><div class='thread'><h1 id='2009-05-20'><a href='/blog/2009/05/20/'>Another Perl One-liner -- Byte Order</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2009-05-17'><a href='/blog/2009/05/17/'>Emacs Web Server</a></h1><div class='comment'><div class='author'>Gavin</div><time datetime='2009-05-17T00:00:00Z'>Sun, 17 May 2009 00:00:00 UTC</time><div class='body'><p>I just found this project <a href="http://elserv.sourceforge.net/" rel="nofollow noopener" title="http://elserv.sourceforge.net/">http://elserv.sourceforge.net/</a> which looks similar, but my $DIETY that page is hard to read.</p></div></div><div class='comment'><div class='author'>Luke Maciak</div><time datetime='2009-05-17T00:00:00Z'>Sun, 17 May 2009 00:00:00 UTC</time><div class='body'><p>Is there anything Emacs can't do? LOL</p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-05-17T00:00:00Z'>Sun, 17 May 2009 00:00:00 UTC</time><div class='body'><p>Yeah, I also came across that before I started my own version. That was written before Emacs had a sockets API (added around Dec. 2003?), so it's a whole different, more complicated beast.</p><p>I haven't found another one that makes use of the Emacs 22 make-network-process function yet.</p></div></div><div class='comment'><div class='author'>DaveLoyall</div><time datetime='2013-07-03T20:19:04Z'>Wed, 03 Jul 2013 20:19:04 UTC</time><div class='body'><p><a href="http://www.emacswiki.org/emacs/Elnode" rel="nofollow noopener" title="http://www.emacswiki.org/emacs/Elnode">http://www.emacswiki.org/em...</a></p></div></div></div><hr/><div class='thread'><h1 id='2009-05-12'><a href='/blog/2009/05/12/'>I Finally Have Comments</a></h1><div class='comment'><div class='author'>anonymous</div><time datetime='2009-05-12T00:00:00Z'>Tue, 12 May 2009 00:00:00 UTC</time><div class='body'><p><br>This is a test. -Chris<br></p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-05-12T00:00:00Z'>Tue, 12 May 2009 00:00:00 UTC</time><div class='body'><p>So you built up your own from scratch? Nice.</p><p>Why no comments? Don't want people to be able comment, or you don't think anyone would be interested?</p></div></div><div class='comment'><div class='author'>JKirchartz</div><time datetime='2009-05-12T00:00:00Z'>Tue, 12 May 2009 00:00:00 UTC</time><div class='body'><p>HUZZAH!! I recently developed a blogging system for work, but since it's for car dealerships I'll never have to worry about coding comments...</p></div></div></div><hr/><div class='thread'><h1 id='2009-05-05'><a href='/blog/2009/05/05/'>Greasemonkey User Scripts</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2009-05-01'><a href='/blog/2009/05/01/'>Wikipedia Flu Time-lapse</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2009-04-28'><a href='/blog/2009/04/28/'>Clay Klein Bottle</a></h1><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-04-28T00:00:00Z'>Tue, 28 Apr 2009 00:00:00 UTC</time><div class='body'><p>Yes, it's to the left of the text.</p></div></div><div class='comment'><div class='author'>Gavin</div><time datetime='2009-04-28T00:00:00Z'>Tue, 28 Apr 2009 00:00:00 UTC</time><div class='body'><p>Shouldn't it have an opening on the bottom?</p></div></div><div class='comment'><div class='author'>Gavin Black</div><time datetime='2009-04-28T00:00:00Z'>Tue, 28 Apr 2009 00:00:00 UTC</time><div class='body'><p>Ohh, my bad.  Since it's all white it looked like it was a hole that had been covered.  That and I was mainly posting any random thing to play with the commenting system :p</p></div></div></div><hr/><div class='thread'><h1 id='2009-04-26'><a href='/blog/2009/04/26/'>Arcfour and CipherSaber in Emacs Lisp</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2009-04-24'><a href='/blog/2009/04/24/'>CipherSaber</a></h1><div class='comment'><div class='author'>neigy</div><time datetime='2013-11-21T14:18:48Z'>Thu, 21 Nov 2013 14:18:48 UTC</time><div class='body'><p>Superb, except I know nothing bout programming. All this stuff even the most simplest programming is beyond me right now.</p></div></div></div><hr/><div class='thread'><h1 id='2009-04-23'><a href='/blog/2009/04/23/'>Emacs Htmlize and Highlighted Source Code</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2009-04-22'><a href='/blog/2009/04/22/'>Custom Webcomic RSS Feeds</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2009-04-20'><a href='/blog/2009/04/20/'>A Not So Stupid C Mistake</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2009-04-18'><a href='/blog/2009/04/18/'>SWF Decompression Perl One-liner</a></h1><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-04-18T00:00:00Z'>Sat, 18 Apr 2009 00:00:00 UTC</time><div class='body'><p><br>Ah, I see. I didn't notice it before. Thanks for pointing it out. Glad you found your way to the non-damaged version!<br></p></div></div><div class='comment'><div class='author'>Ozgur</div><time datetime='2009-04-18T00:00:00Z'>Sat, 18 Apr 2009 00:00:00 UTC</time><div class='body'><p><br>This is a pretty neat trick, especially if one (has Perl already available and) doesn't want to (or even can't in a particular set up) install utilities to this job.<br></p><p><br>I found your page from the comment you posted on that Java program's page initially. The problem there however was that the less-than/greater-than symbols were lost in that page's comment system (as HTML tag delimiters I guess), and the one-liner displayed there doesn't work "as is" of course. You may want to drop another comment there so that your neat one-liner there doesn't frustrate people who can't fix it right away! :)<br></p><p><br>Thanks,<br></p><p><br> Ozgur</p></div></div></div><hr/><div class='thread'><h1 id='2009-04-16'><a href='/blog/2009/04/16/'>URL Shortening</a></h1><div class='comment'><div class='author'>Gavin Black</div><time datetime='2009-04-16T00:00:00Z'>Thu, 16 Apr 2009 00:00:00 UTC</time><div class='body'><p><br>Looks like some spam finally got through you're captcha :) <br></p><p><br><br><br>Unless you have some weird(er) friends :p</p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-04-16T00:00:00Z'>Thu, 16 Apr 2009 00:00:00 UTC</time><div class='body'><p><br>They also posted junk on the IRC RNG post, which I just caught before the feed picked it up (it's cached). If you noticed before I deleted it, the link had a <code>rel="nofollow"</code> attribute set, so their spam wouldn't have accomplished much. All comment links get this.<br></p><p><br>Also, seeing that they never got the captcha wrong (according to my logs) they were manually entered. No way to stop that kind of spam, but it's expensive for spammers to do.<br></p><p><br>If my captcha did seem to be broken updating it would be pretty easy to do.<br></p></div></div></div><hr/><div class='thread'><h1 id='2009-04-14'><a href='/blog/2009/04/14/'>Hashapass Password Management</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2009-04-12'><a href='/blog/2009/04/12/'>Brainfuck Halting Problem</a></h1><div class='comment'><div class='author'>Andrew</div><time datetime='2016-07-22T23:16:22Z'>Fri, 22 Jul 2016 23:16:22 UTC</time><div class='body'><p>The halting problem is unsolvable, but that doesn't mean that it's useless to ask questions about halting. Most usefully, there are algorithms with bounded running time that only return true for programs that halt, but return false for all programs that don't halt and some programs that do. An obvious example would be to simply run the program for N time steps and record whether it halted by that time, but there are others. The point being, your idea isn't completely torpedoed as an optimization; it's just an optimization that won't work every time.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-07-23T01:17:03Z'>Sat, 23 Jul 2016 01:17:03 UTC</time><div class='body'><p>That's a very good point. That's essentially Firefox's approach to detecting scripts that may not halt. Though, unfortunately, Firefox measures by wall clock time rather than something like CPU ticks or VM cycles (which I imagine is hard to nail down once JIT is involved), meaning when Firefox is suspended for awhile and woken back up, it complains about any scripts that happened to be running when it got suspended.</p></div></div></div></div><hr/><div class='thread'><h1 id='2009-04-10'><a href='/blog/2009/04/10/'>The Lazy Fibonacci List</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2009-04-08'><a href='/blog/2009/04/08/'>Apartment Balcony Gardening</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2009-04-03'><a href='/blog/2009/04/03/'>Vimperator Firefox Add-on</a></h1><div class='comment'><div class='author'>leeleblanc</div><time datetime='2009-04-03T00:00:00Z'>Fri, 03 Apr 2009 00:00:00 UTC</time><div class='body'><p><br>Will attempt macros now; believe it or not I nearly completely forgot about them. I've spent a lot time building a custom _vimperatorrc -which once gets set makes vimperator even more addictive.</p></div></div></div><hr/><div class='thread'><h1 id='2009-03-22'><a href='/blog/2009/03/22/'>Avoid Zip Archives</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2009-03-16'><a href='/blog/2009/03/16/'>LZMA Tarballs Are Coming</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2009-03-05'><a href='/blog/2009/03/05/'>GNU Screen</a></h1><div class='comment'><div class='author'>Michal Zuber</div><time datetime='2014-12-05T05:19:11Z'>Fri, 05 Dec 2014 05:19:11 UTC</time><div class='body'><p>I use it, too. Could you provide link to your settings, other usage workflow? How do you copy/paste, have dynamic window naming, terminal title naming?</p></div></div></div><hr/><div class='thread'><h1 id='2009-02-14'><a href='/blog/2009/02/14/'>Distributed Issue Tracking</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2009-02-10'><a href='/blog/2009/02/10/'>Creating Simple Dice with GIMP</a></h1><div class='comment'><div class='author'>Daniel Doc</div><time datetime='2012-12-18T21:54:03Z'>Tue, 18 Dec 2012 21:54:03 UTC</time><div class='body'><p>Such an old tutorial and no comment?<br>What a pitty, because this is simply great and very easy to follow!<br>Thanks so much!</p></div></div><div class='comment'><div class='author'>Pavo real</div><time datetime='2016-02-04T18:23:56Z'>Thu, 04 Feb 2016 18:23:56 UTC</time><div class='body'><p>Exactly what I was looking for, thank you!</p></div></div></div><hr/><div class='thread'><h1 id='2009-02-07'><a href='/blog/2009/02/07/'>Diceware Passphrases</a></h1><div class='comment'><div class='author'>Neigy</div><time datetime='2014-01-19T04:47:05Z'>Sun, 19 Jan 2014 04:47:05 UTC</time><div class='body'><p>brilliant! Now if I only knew how to create my own Cipher. Its difficult for being so new in with all of this. Thank you for your post by the way.</p></div></div></div><hr/><div class='thread'><h1 id='2009-01-30'><a href='/blog/2009/01/30/'>Shamus Young&#39;s Twenty Sided Tale</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2009-01-16'><a href='/blog/2009/01/16/'>AES Random Number Generator</a></h1><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2009-01-16T00:00:00Z'>Fri, 16 Jan 2009 00:00:00 UTC</time><div class='body'><p><br>Sorry, somehow I missed your post.<br></p><p><br>I'm using libgcrypt, so that would only happen if libgcrypt supported AES-NI, <a href="http://git.gnupg.org/cgi-bin/gitweb.cgi?p=libgcrypt.git;a=commit;h=a39539afdf39fe525ed7512aafb92733d2fe358c" rel="nofollow noopener" title="http://git.gnupg.org/cgi-bin/gitweb.cgi?p=libgcrypt.git;a=commit;h=a39539afdf39fe525ed7512aafb92733d2fe358c">which it does as of two weeks ago</a>. So if you're using a libgcrypt fresh from the repository, yes.<br></p></div></div><div class='comment'><div class='author'>Alex Fihman</div><time datetime='2009-01-16T00:00:00Z'>Fri, 16 Jan 2009 00:00:00 UTC</time><div class='body'><p><br>Do you have version that supports new Intel instruction set AES-NI?<br></p></div></div><div class='comment'><div class='author'>udc</div><time datetime='2013-06-16T14:15:34Z'>Sun, 16 Jun 2013 14:15:34 UTC</time><div class='body'><p>Well, if you think about it, what is really so great about this? What is really so random? All what this PRNG does is that it takes a perfectly linear incremental sequence of 128 bit numbers (like 1, 2, 3...) and encrypts it with AES using 256 bit key and 128 bit IV.</p><p>So the original data (its format) is pretty much known, the algorithm generating such "random" data from it is also pretty much known, the only thing that is somewhat random here is the first number of the whole linear sequence and the AES key and IV. In other words, no matter how much "random" data you are generating this way (be it 100 MB, 100 GB or 100 TB), of all that amount of data only 64 bytes of random numbers were really used, all the rest was just mathematically calculated. Would you dare to call something like that even a pseudo-random generator?</p><p>Now, what the Gibson's website says?<br>"The deterministic binary noise generated by my server, which is then <br>converted into various displayable formats, is derived from the highest <br>quality mathematical pseudo-random algorithms known. In other words, <br>these password strings are as random as anything non-random can be."</p><p>Not only this is quite ridiculous stretch (if not a pure lie) but it doesn't even make any sense. The guy was probably trying to impress everybody so hard that he got it backwards. A noise can't be derived from an algorithm, that's a logical nonsense. What he might have meant was that mathematical algorithms were using the binary noise, only he forgot to mention how much of that noise was actually used and how much was merely calculated. But Gibson is known for making overkill statements so this is not really a surprise.</p><p>But let's just think about this idea a little bit more. Libgcrypt has several functions to generate random data with the fastest one called gcry_create_nonce(). Yet this function is described in the documentation as generating "unpredictable" numbers. Now if we look in the source code we find that this function generates random numbers by creating 16 bytes timestamps and then encrypting them with AES. In fact, this procedure is standardized in the document called “NIST-Recommended Random Number Generator Based on ANSI X9.31 Appendix A.2.4 Using the 3-Key Triple DES and AES Algorithms”.</p><p>This tells us three things:<br>1) generating random numbers by encrypting some sequence of numbers (a timestamp series sounds like a sequence, right?) by AES is obviously not such a bad idea,<br>2) no, Gibson definitely didn't invent any of this,<br>3) Gibson's version is clearly inferior to libgcrypt's gcry_create_nonce().</p><p>Why is Gibson's version inferior? Because a timestamp, whatever that is, is definitely less linear (if enough precision is used) than a series of incremental numbers. Actually, anything would be less linear than 1,2,3...</p><p>But that's not all. In libgcrypt the 128 bits timestamp actually consists of seconds and microseconds using gettimeofday() and 3 counters, all that mixed together in a way that makes the resulting timestamp not linear at all. Compared to that, Gibson's 1,2,3... is not only inferior but is actually a total garbage.</p><p>In other words, if you remove everything from your code and simply generate random data using gcry_create_nonce() you will get much higher quality of random data than imitating Gibson's nonsense.</p><p>Once more again from Gibson's website:<br>"In other words, these password strings are as random as anything non-random can be."</p><p>Now talk about the credibility of that person..</p><p>By the way, if you use 256 bit key and thus AES256 then you should specify the cipher name as GCRY_CIPHER_AES256, not GCRY_CIPHER_AES which is an alias for AES128. Currently it does work anyway because libgcrypt doesn't care about the names and takes the keylen as the decisive parameter to set rounds, but the documentation clearly states that the keylen must match the required length of the algorithm so it would be wise to stick with it as they may fix it anytime. Also you shouldn't use atoi() in connection with filesize.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-06-16T17:07:31Z'>Sun, 16 Jun 2013 17:07:31 UTC</time><div class='body'><blockquote><br>Would you dare to call something like that even a pseudo-random generator?<br></blockquote><p></p><p>That's the very definition of a PRNG: it's seeded with an initial state and generates lowly-correlated numbers deterministically. It's very fast and the output is indistinguishable from a true RNG using known tests, so I think it's a valuable one. Besides this, repeatability is required for some applications, so determinism is an essential feature of PRNGs.</p><p></p><blockquote><br>Now if we look in the source code we find that this function generates <br>random numbers by creating 16 bytes timestamps and then encrypting them with AES. In fact, this procedure is standardized<br></blockquote><p></p><p>Using Gibson's generator, I can accomplish the same thing if I just mix in a <code>struct timeval</code> on each iteration. Doing a quick test now, I see this slows down the generator by about 3x. It would be worse if I had hardware AES support. This may or may not be worth the trade-off, depending on the application. If I was using this generator for a Monte Carlo analysis, I wouldn't mix in the timestamp.</p><p></p><blockquote><br>By the way, if you use 256 bit key and thus AES256 then you should <br>specify the cipher name as GCRY_CIPHER_AES256, not GCRY_CIPHER_AES which<br> is an alias for AES128.<br></blockquote><p></p><p>Gibson's generator uses AES128 and I wanted to copy their exact algorithm. I don't know why they use a 256-bit key.</p><p></p><blockquote><br>Also you shouldn't use atoi() in connection with filesize.<br><br></blockquote><p></p><p>Good point. At the time I wrote this article this would have overflowed after 2 minutes. Using atoll() would take 20,000 years to overflow.</p></div></div></div><div class='comment'><div class='author'>John</div><time datetime='2013-09-14T02:40:46Z'>Sat, 14 Sep 2013 02:40:46 UTC</time><div class='body'><p>Great tip! I got similar results with Ent on a C# version.. thanks!</p></div></div></div><hr/><div class='thread'><h1 id='2009-01-04'><a href='/blog/2009/01/04/'>Fantasy Name Generator -- Request for Patterns</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2008-12-24'><a href='/blog/2008/12/24/'>Don&#39;t Write Your Own E-mail Validator</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2008-12-22'><a href='/blog/2008/12/22/'>The Fire Gem</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2008-12-16'><a href='/blog/2008/12/16/'>Controlling a Minefield</a></h1><div class='comment'><div class='author'>Ron</div><time datetime='2012-08-07T07:17:56Z'>Tue, 07 Aug 2012 07:17:56 UTC</time><div class='body'><p>It should be noted that MD5 is broken today, but cool post backlinked from before I followed  </p></div></div></div><hr/><div class='thread'><h1 id='2008-09-17'><a href='/blog/2008/09/17/'>Play NetHack</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2008-08-29'><a href='/blog/2008/08/29/'>A GNU Octave Feature</a></h1><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2008-08-29T00:00:00Z'>Fri, 29 Aug 2008 00:00:00 UTC</time><div class='body'><p><br>It's nice to meet another Chris Wellons! I've actually never met another Wellons to whom I wasn't related. Are you originally from Colorado? All of my extended Wellons family is from the south east, around Georgia and Florida. I was the first one, inside the last several generations anyway, to be born north of the Mason-Dixon line -- as far as I know.<br></p><p><br>You may have noticed that it wouldn't let you use "Chris Wellons" (capitalized) as a comment name here, as it's specifically reserved for me. :-)<br></p></div></div><div class='comment'><div class='author'>chris wellons</div><time datetime='2008-08-29T00:00:00Z'>Fri, 29 Aug 2008 00:00:00 UTC</time><div class='body'><p><br>Interesting, did a background check on myself and found another chris wellons who is a computer engineer. To top it all off my senior design project is a matlab data analysis program for smart grid systems at university of denver.</p></div></div><div class='comment'><div class='author'>Ahmed Fasih</div><time datetime='2013-06-12T17:26:26Z'>Wed, 12 Jun 2013 17:26:26 UTC</time><div class='body'><p>&lt;sad panda=""&gt;: as of 2013a:</p><p>&gt;&gt; magic(4)(2:3,2:3)<br>Error: ()-indexing must appear last in an index expression.</p></div></div></div><hr/><div class='thread'><h1 id='2008-08-09'><a href='/blog/2008/08/09/'>The Arcfour Stream Cipher</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2008-07-25'><a href='/blog/2008/07/25/'>Two-Man Double Blind Coke vs. Pepsi Taste Test</a></h1><div class='comment'><div class='author'>Covarr</div><time datetime='2019-03-01T03:58:02Z'>Fri, 01 Mar 2019 03:58:02 UTC</time><div class='body'><p>I'm really glad somebody did a double-blind Pepsi Challenge; this has a lot less potential for bias than the usual single-blind challenge as performed by Pepsi representatives and most home copycats.</p><p>Sadly, I don't know that a sample size of two participants can produce meaningful results, unless the goal is simply to learn about the individual participants. Two people isn't enough to extrapolate to a larger population.</p><p>Still, an entertaining read, even a decade after it was written :)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-03-01T16:47:51Z'>Fri, 01 Mar 2019 16:47:51 UTC</time><div class='body'><p>Blast from the past! Yeah, this is less about the actual result and more about how happy I was figuring how out how to do the double-blind test with only two participants. I haven't actually drank a non-diet soda like this since 2009, so the result was soon irrelevant to me anyway.</p></div></div></div></div><hr/><div class='thread'><h1 id='2008-07-20'><a href='/blog/2008/07/20/'>Sudoku Solver</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2008-07-18'><a href='/blog/2008/07/18/'>Variable Declarations and the C Call Stack</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2008-07-15'><a href='/blog/2008/07/15/'>A One-Time Pad Mistake</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2008-07-11'><a href='/blog/2008/07/11/'>One-Time Pads and Plausible Deniability</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2008-07-08'><a href='/blog/2008/07/08/'>One-Time Pads</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2008-06-26'><a href='/blog/2008/06/26/'>Up is Down</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2008-03-25'><a href='/blog/2008/03/25/'>Memoization</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2008-03-15'><a href='/blog/2008/03/15/'>Lisp Number Representations</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2008-02-24'><a href='/blog/2008/02/24/'>Simple Hash Table Correction</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2008-02-22'><a href='/blog/2008/02/22/'>Linear Spatial Filters with GNU Octave</a></h1><div class='comment'><div class='author'>Safy Saeed</div><time datetime='2008-02-22T00:00:00Z'>Fri, 22 Feb 2008 00:00:00 UTC</time><div class='body'><p><br>Hello,<br></p><p><br>this is a very nice explanation for applying Mask Filter in spatial domain, <br></p><p><br>i am making a same program for applying average filter(blur)<br>but i am using 2 FOR loops to apply the mask pixel by pixel.<br>i am having a problem in zero padding, i am using 3x3 mask, when the mask tries to convolve outside the boundry of input image then matlab gives error that "Subscript Indices Must Either Be Real Positive Integers Or Logicals'<br></p><p><br>i wuould be very thankfull if u help me with this or send me coding of a working sample program <br></p><p><br>Regards,<br>Sh.Safy</p></div></div><div class='comment'><div class='author'>Safy Saeed</div><time datetime='2008-02-22T00:00:00Z'>Fri, 22 Feb 2008 00:00:00 UTC</time><div class='body'><p><br>Thnx for the reply<br></p><p><br>i will work on it</p></div></div><div class='comment'><div class='author'>Philip Lacombe</div><time datetime='2008-02-22T00:00:00Z'>Fri, 22 Feb 2008 00:00:00 UTC</time><div class='body'><p><br>Very clear.  Helped me a lot.<br>Thanks a bunch.</p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2008-02-22T00:00:00Z'>Fri, 22 Feb 2008 00:00:00 UTC</time><div class='body'><p><br>Glad you enjoyed it.<br></p><p><br>Octave/Matlab won't magically pad your array for you when you're indexing it. You have to check, in your loops, if the index is outside the bounds of the array, and if so, substitute 0 (for zero padding). Or you could modify the array to add the padding beforehand, and only convolve on the middle; the <code>padarray</code> function I had mentioned can do this for you.<br></p></div></div><div class='comment'><div class='author'>bbalaraj</div><time datetime='2012-02-17T18:13:55Z'>Fri, 17 Feb 2012 18:13:55 UTC</time><div class='body'><p>Thanks a lot</p></div></div><div class='comment'><div class='author'>Marcos</div><time datetime='2012-04-20T21:46:54Z'>Fri, 20 Apr 2012 21:46:54 UTC</time><div class='body'><p>thank you, that was helpful!</p></div></div></div><hr/><div class='thread'><h1 id='2008-02-04'><a href='/blog/2008/02/04/'>My Team Won the Robot Competition</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2008-01-29'><a href='/blog/2008/01/29/'>The 3n + 1 Conjecture</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2008-01-20'><a href='/blog/2008/01/20/'>Optimizing, Multi-threading Brainfuck to C Converter</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2008-01-08'><a href='/blog/2008/01/08/'>Some News</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2007-12-30'><a href='/blog/2007/12/30/'>Movie Montage Poster</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2007-12-19'><a href='/blog/2007/12/19/'>Unsharp Masking</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2007-12-06'><a href='/blog/2007/12/06/'>A Faster Montage</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2007-12-14'><a href='/blog/2007/12/14/'>Simple Hash Table in C</a></h1><div class='comment'><div class='author'>skleroza</div><time datetime='2015-01-20T11:42:20Z'>Tue, 20 Jan 2015 11:42:20 UTC</time><div class='body'><p>interesting but why not stored size of objects into blob?</p><p></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-01-21T14:51:25Z'>Wed, 21 Jan 2015 14:51:25 UTC</time><div class='body'><p>The blob size *is* stored, but there's no way to retrieve it via the interface. It's up to the caller to keep track of its size, which is almost always the case anyway. The hash table only needs to know because it makes a local copy (which it also probably shouldn't be doing).</p><p>I originally wrote this library 8 years ago as a student. I've learned a whole lot more since then, and I could easily whip up something much better in like 30 minutes, one better tailored to the situation. So, honestly, this hash table really isn't useful for much. There are lots of undesirable issues with it.</p></div></div></div></div><hr/><div class='thread'><h1 id='2007-12-11'><a href='/blog/2007/12/11/'>Movie DNA</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2007-12-05'><a href='/blog/2007/12/05/'>South Park Downloader</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2007-11-30'><a href='/blog/2007/11/30/'>Traveling Salesman Problem by Genetic Algorithm</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2007-11-20'><a href='/blog/2007/11/20/'>Noise Fractals and Clouds</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2007-11-06'><a href='/blog/2007/11/06/'>Iterated Prisoner&#39;s Dilemma</a></h1><div class='comment'><div class='author'>Gavin Black</div><time datetime='2007-11-06T00:00:00Z'>Tue, 06 Nov 2007 00:00:00 UTC</time><div class='body'><p><br>Very cool! I haven't looked through your old posts before, looks like there is alot of neat code. After the semester is over I'll have to try to run some of these :)</p></div></div></div><hr/><div class='thread'><h1 id='2007-10-30'><a href='/blog/2007/10/30/'>Polynomial Interpolation</a></h1><div class='comment'><div class='author'>Ruben</div><time datetime='2017-09-19T14:44:39Z'>Tue, 19 Sep 2017 14:44:39 UTC</time><div class='body'><p>This is indeed a neat trick. You can also use Newton divided differences or Lagrange polynomials for polynomial interpolation to avoid having to solve a linear system to find the coefficients. However, polynomials don't work very well for interpolation. Piecewise polynomials or splines have much better interpolation behavior. If you have a function instead of just some points, L2 projection is also an interesting technique. If you do have n points and want to find a polynomial of degree m &lt; n - 1 that almost interpolates these points (formally, it minimizes the norm ||Ax - b||), you can still generate the linear system Ax = b, which you gave. It is not square, but you can solve the normal equations transpose(A) * A * x = transpose(A) * b and this will give x for which ||Ax - b|| is minimal.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-09-19T15:29:07Z'>Tue, 19 Sep 2017 15:29:07 UTC</time><div class='body'><p>I agree with you about splines, and these days I'd just use splines for this sort of interpolation. Ten years ago when I wrote this article I didn't know any better. ;-)</p></div></div></div></div><hr/><div class='thread'><h1 id='2007-10-16'><a href='/blog/2007/10/16/'>Robot Version 1</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2007-10-08'><a href='/blog/2007/10/08/'>Java Animated Maze Generator and Solver</a></h1><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2007-10-08T00:00:00Z'>Mon, 08 Oct 2007 00:00:00 UTC</time><div class='body'><p><br>Just updated some stuff here to be more reasonable (and so I look slightly less foolish). Man, I really sounded like a weenie back then! :-P<br></p><p><br>In two years will I look back at now and still call myself a weenie? Perhaps.<br></p></div></div><div class='comment'><div class='author'>Gavin Black</div><time datetime='2007-10-08T00:00:00Z'>Mon, 08 Oct 2007 00:00:00 UTC</time><div class='body'><p><br>Ha ha, I used to think the same thing about Java.  And I too now use it for most of my work projects :p  <br><br><br><br>Ohh well, it will still be a cold day in hell before I touch Ruby!<br></p><p><br></p></div></div><div class='comment'><div class='author'>Narendra</div><time datetime='2017-08-30T12:28:44Z'>Wed, 30 Aug 2017 12:28:44 UTC</time><div class='body'><p>Hey, how do you use Emacs with Java?</p><p>I am just about to switch to Intellij for Java Programming at work.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-08-30T13:01:54Z'>Wed, 30 Aug 2017 13:01:54 UTC</time><div class='body'><p>I haven't programmed in Java for a few years now, and I intend to avoid it as much as possible. However, I did write two packages to make Java less annoying: javadoc-lookup and ant-project-mode.</p><p><a href="https://github.com/skeeto/javadoc-lookup" rel="nofollow noopener" title="https://github.com/skeeto/javadoc-lookup">https://github.com/skeeto/j...</a> <a href="https://github.com/skeeto/ant-project-mode" rel="nofollow noopener" title="https://github.com/skeeto/ant-project-mode">https://github.com/skeeto/a...</a></p><p>The former lets you quickly access package documentation, and it can even do some import management since it's aware of packages. The latter supports a very opinionated workflow oriented around Ant.</p><p>None of this gives you anything close to intelligent completion. If you want something more elaborate, I've heard good things about IDEE, but I've never used it.</p></div></div></div></div><hr/><div class='thread'><h1 id='2007-10-01'><a href='/blog/2007/10/01/'>Mandelbrot Set on a Cluster</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2007-09-23'><a href='/blog/2007/09/23/'>Converting MediaWiki Markup to LaTeX</a></h1><div class='comment'><div class='author'>Hunniger</div><time datetime='2012-06-12T11:55:58Z'>Tue, 12 Jun 2012 11:55:58 UTC</time><div class='body'><p>Actually I made a complete solution for this problem</p><p> <a href="http://de.wikibooks.org/wiki/Benutzer:Dirk_Huenniger/wb2pdf" rel="nofollow noopener" title="http://de.wikibooks.org/wiki/Benutzer:Dirk_Huenniger/wb2pdf">http://de.wikibooks.org/wik...</a></p></div></div></div><hr/><div class='thread'><h1 id='2007-09-25'><a href='/blog/2007/09/25/'>Walk Text Adventure Game (Perl and MATLAB)</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2007-09-14'><a href='/blog/2007/09/14/'>Memory Allocation Pool</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2007-09-08'><a href='/blog/2007/09/08/'>PNG Archiver - Share Files Within Images</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2007-09-05'><a href='/blog/2007/09/05/'>YouTube with Free Software</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2007-09-02'><a href='/blog/2007/09/02/'>Mandelbrot with GNU Octave</a></h1><div class='comment'><div class='author'>A. Jorge Garcia</div><time datetime='2007-09-02T00:00:00Z'>Sun, 02 Sep 2007 00:00:00 UTC</time><div class='body'><p><br>Yeah, my school has IE and I can do nothing about that except in my Linux lab!  Thanx for the prompt reply.  <br></p><p><br>You may want to look at the Pelican HPC site (just google it)  in addition to the MPITB site.  I recall you did a lot with fork() and pipe() but I thought that was under openMOSIX?<br></p><p><br>BTW, you inspired me to start up my own blog about my students' experience clustering and some other topics relating to teaching and learning with technology.  If you are interested, just visit my website:<br></p><p><br><a href="http://calcpage.tripod.com" rel="nofollow noopener" title="http://calcpage.tripod.com">http://calcpage.tripod.com</a><br></p><p><br>and you will find a new link near the top of my home page for the blog.  Its called "Shadowfax Cluster Rant!"<br></p><p><br>Enjoy,<br>AJG</p></div></div><div class='comment'><div class='author'>A. Jorge Garcia</div><time datetime='2007-09-02T00:00:00Z'>Sun, 02 Sep 2007 00:00:00 UTC</time><div class='body'><p><br>BTW, my email address is calcpage@aol.com - sorry it looks mangled on the comments page....<br></p><p><br>TIA,<br>AJG</p></div></div><div class='comment'><div class='author'>Adam</div><time datetime='2007-09-02T00:00:00Z'>Sun, 02 Sep 2007 00:00:00 UTC</time><div class='body'><p><br>Hi,<br>Thx for code. I have made links to wikiboks:<br><a href="http://en.wikibooks.org/wiki/Fractals/Iterations_in_the_complex_plane/Mandelbrot_set#More_tutorials_and_code" rel="nofollow noopener" title="http://en.wikibooks.org/wiki/Fractals/Iterations_in_the_complex_plane/Mandelbrot_set#More_tutorials_and_code">http://en.wikibooks.org/wiki/Fractals/Iterations_in_the_complex_plane/Mandelbrot_set#More_tutorials_and_code</a><br></p><p></p><p>and <br></p><p><br><a href="http://en.wikibooks.org/wiki/Octave_Programming_Tutorial/Loops_and_conditions" rel="nofollow noopener" title="http://en.wikibooks.org/wiki/Octave_Programming_Tutorial/Loops_and_conditions">http://en.wikibooks.org/wiki/Octave_Programming_Tutorial/Loops_and_conditions</a><br></p><p><br>Regards<br></p><p><br>Adam</p></div></div><div class='comment'><div class='author'>A. Jorge Garcia</div><time datetime='2007-09-02T00:00:00Z'>Sun, 02 Sep 2007 00:00:00 UTC</time><div class='body'><p><br>Hi!<br></p><p><br>I hope you get notified whenever you get a comment as this comment will otherwise be buried in your archives!<br></p><p><br>Anyway, I don't know if you remember me, but you helped me and my students come up with some fractal code for a cluster programming project a couple of years ago.  Thanx so much!<br></p><p><br>So, I have a new question for you.  My current cluster team wants to try MPI (we've been using openMOSIX for a while but that project has ended).  We found a booatble CD that sets up MPI to work with Octave.  I'm wondering if you've had any experience with this.  There's a library called MPITB (MPI ToolBox) for Octave that's included.  The CD is available at the old parallelKnoppix website which is now called Pelican HPC.<br></p><p><br>TIA,<br>AJG</p></div></div><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2007-09-02T00:00:00Z'>Sun, 02 Sep 2007 00:00:00 UTC</time><div class='body'><p><br>Yup, I remember you. Welcome back!<br></p><p><br>I've never used MPI in Octave, or in any other language, so I don't think I can't really help you. I was always working on a cluster, so <code>fork()</code> and <code>pipe()</code> did everything I needed. One thing you'll have to work out is setting up a process to fire off a process on each machine, each with the appropriate configuration. The Octave MPITB page seems to be down right now so I can't take a look at it.<br></p><p><br>Good luck, though!<br></p><p><br>P.S. There's a comments RSS feed I set up and follow so I know when any comments have been posted anywhere. Oh, and your e-mail address appears mangled because you are probably using Internet Explorer which has CSS issues/bugs and can't display this page correctly.<br></p></div></div></div><hr/><div class='thread'><h1 id='2007-09-01'><a href='/blog/2007/09/01/'>null program is Alive</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2011-08-05'><a href='/blog/2011/08/05/'>null program</a></h1><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2011-08-06T12:57:08Z'>Sat, 06 Aug 2011 12:57:08 UTC</time><div class='body'><p>There were some DNS issues during the transition, with DNS reporting both the old and new addresses. You may have seen half of the old site and half of the new site on the same load. It was also completely unavailable for a couple hours while other changes were propagating. Everything should be fine now.<br></p></div></div><div class='comment'><div class='author'>Luke</div><time datetime='2011-08-22T14:55:34Z'>Mon, 22 Aug 2011 14:55:34 UTC</time><div class='body'><p>Oh wow... This is actually pretty cool. I used the github pages before for some of my projects, but I was mostly sticking to single static pages and keeping it simple. It's nice to see you can actually run an entire blog like this. </p></div></div><div class='comment'><div class='author'>Marco Gualtieri</div><time datetime='2011-10-10T17:38:26Z'>Mon, 10 Oct 2011 17:38:26 UTC</time><div class='body'><p>do your comments get saved into plain text files as well?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2011-10-10T17:54:02Z'>Mon, 10 Oct 2011 17:54:02 UTC</time><div class='body'><p>The comments go into some Disqus database offsite, completely independent of GitHub or any version control. I *can* export them from Disqus into XML if I needed to.<br></p></div></div></div><div class='comment'><div class='author'>Diego Sevilla</div><time datetime='2011-11-02T23:40:44Z'>Wed, 02 Nov 2011 23:40:44 UTC</time><div class='body'><p>This is a neat selection of tools and hosting. I went to a similar route myself. To learn Common Lisp and Emacs-Lisp, I wrote my own static blog generation engine, also used Disqus for comments, and generated HTML "conformant" with Wordpress, so that I could use nice Wordpress templates (that are mostly CSS). The last thing left is to host it via github. I wasn't sure, you know, my code, my posts, etc. But then I thought anyway people can download it completely! Now I see you also opted that route, I think I'm going for it.</p></div></div></div><hr/><div class='thread'><h1 id='2011-06-13'><a href='/blog/2011/06/13/'>Infinite Parallax Starfield</a></h1><div class='comment'><div class='author'>Brian</div><time datetime='2012-10-06T13:44:06Z'>Sat, 06 Oct 2012 13:44:06 UTC</time><div class='body'><p>Just watched this video again: Hypernova was really cool visually and internally. It would be neat to take it to the next level.</p></div></div><div class='comment'><div class='author'>ambethia</div><time datetime='2012-12-29T02:09:21Z'>Sat, 29 Dec 2012 02:09:21 UTC</time><div class='body'><p>Hey, could could embed a soft-synth and still have the sounds be rendered from MIDI. Thanks for the tutorial.</p></div></div><div class='comment'><div class='author'>arrogant.gamer</div><time datetime='2014-11-21T22:38:17Z'>Fri, 21 Nov 2014 22:38:17 UTC</time><div class='body'><p>Thanks so much for this awesome technique! I'm still workking out a few bugs in my implementation, which is in lua (using the fabulous LOVE2d framework).</p><p>In my initial attempt, the stars jumped around inconsistently. They would always be in the same places if I returned somewhere, but instead of drifting away when you move they would vanish and be replaced with different stars as though I was hopping vast distances.</p><p>I solved this with the following change:</p><p>hash = mix(STAR_SEED, i - xoff, j - yoff)</p><p>This gives me nice slow drifting stars. Since I'm not sure what xoff and yoff were in your original implementation, I can't be sure I am passing the right things in as those variables: I'm using the player's offset from origin.</p><p>Here is a gist: <a href="https://gist.github.com/variousauthors/61b7202d4aff016746f1" rel="nofollow noopener" title="https://gist.github.com/variousauthors/61b7202d4aff016746f1">https://gist.github.com/var...</a></p></div><div class='comment'><div class='author'>arrogant.gamer</div><time datetime='2014-11-21T22:51:01Z'>Fri, 21 Nov 2014 22:51:01 UTC</time><div class='body'><p>I think I may have spoken too soon!</p></div></div></div><div class='comment'><div class='author'>Graham Toal</div><time datetime='2019-09-04T01:55:32Z'>Wed, 04 Sep 2019 01:55:32 UTC</time><div class='body'><p>If you finish the game and release source, we'd be interested in porting it to the "PiTrex" when it is ready for release.  That's a pi-based add-on processor for the Vectrex vector console.  Potential ports will be listed here: <a href="http://computernerdkev.heliohost.org/pitrex/wiki/index.php?wiki=Software_Ports" rel="nofollow noopener" title="http://computernerdkev.heliohost.org/pitrex/wiki/index.php?wiki=Software_Ports">http://computernerdkev.heli...</a> (I found your pages when looking for starfield code, quite a few things here of interest)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-09-04T02:07:15Z'>Wed, 04 Sep 2019 02:07:15 UTC</time><div class='body'><p>Here's the source: <a href="https://github.com/skeeto/Hypernova" rel="nofollow noopener" title="https://github.com/skeeto/Hypernova">https://github.com/skeeto/H...</a></p><p>I never finished it, and at this point I never will. PiTrex is a pretty interesting project, so thanks for sharing.</p></div><div class='comment'><div class='author'>Graham Toal</div><time datetime='2019-09-04T02:36:46Z'>Wed, 04 Sep 2019 02:36:46 UTC</time><div class='body'><p>Appreciate the link, thanks!  Even if it isn't playable or portable to our system, exposing the vector programming community to more source code is always a good thing.  There may well be parts of your code we can reuse in some way. Thanks.</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2011-03-06'><a href='/blog/2011/03/06/'>Movie Montage Comparison</a></h1><div class='comment'><div class='author'>possiblywrong</div><time datetime='2011-03-06T00:00:00Z'>Sun, 06 Mar 2011 00:00:00 UTC</time><div class='body'><p><br>This is cool-- interesting timing, too, since I just saw <i>TRON: Legacy</i> last night.<br></p><p><br>After reading the title label of one of these images, I can generally recognize the trends in color.  I wonder if this ever works the other way around; that is, are there movies so distinctive that their "redux" images are identifiable (with some high probability) even without their label?  (Or at least, a set of movies that you might be able to match with their corresponding set of labels.)<br></p></div></div></div><hr/><div class='thread'><h1 id='2011-01-12'><a href='/blog/2011/01/12/'>The Great Tab Mistake</a></h1><div class='comment'><div class='author'>Chris Wellons</div><time datetime='2011-01-12T00:00:00Z'>Wed, 12 Jan 2011 00:00:00 UTC</time><div class='body'><p><br>"You must learn to respect our differences."<br></p><p><br>I drifted away from tiling window managers because I still had to frequently to switch out to normal windows to do certain things, such as making a video recording or run something particularly graphical. They also lose some usefulness on smaller displays. My laptop -- which is 7 years old and will not be replaced it until it is completely dead -- only goes to 1024x768. That's just a little too skinny for side-by-side anything, so overlapping windows are still useful for me.<br></p><p><br>One day when I've upgraded to larger resolution screens perhaps I'll take a look at tiling window managers again.<br></p><p><br>Now, you assume that I'm using the mouse to perform all this navigation, but this is untrue. Outside of initial positioning, I don't use the mouse. I don't think I've actually clicked to focus a Fluxbox tab yet. I bound C-tab and C-S-tab to move between tabs. 99% of my navigating between windows is done by keyboard. In fact, this grouping has made keyboard navigation for effective for me, because the usual M-tab only switches between groups of windows, skipping over tabs. One current flaw for Fluxbox is that the mouse <i>is</i> required to combine two windows into a tabbed window -- and the default binding is especially clumsy for laptops. I would like to see this corrected someday.<br></p><p><br>I also rarely use the mouse to move between tabs in Firefox. With Pentadactyl I have the w and e keys bound to this, as well as its Emacs-style buffer switching (typing out part of the tab name). I'd also love to see that buffer-style switching in Fluxbox.<br></p><p><br>You are right that I don't often need tabbed windows. Currently I'm only using the Fluxbox tabs to combine 2-4 xterms, usually with one <code>ssh</code>ed off somewhere. If we relied on the WM for tabs, this is also how I would be using Firefox. If Emacs didn't have its divine buffer interface I might be using tabs there. In the future, I should attempt some more creative tab uses, such as combining Emacs and Firefox when using my java-docs extension.<br></p></div></div><div class='comment'><div class='author'>Matt Stine</div><time datetime='2011-01-12T00:00:00Z'>Wed, 12 Jan 2011 00:00:00 UTC</time><div class='body'><p><br>The window manager-level tabbing was always my favorite feature of Fluxbox, other than the fact that it was the only modern window manager to run reasonably well on my IBM T20.<br></p><p><br>I don't have any experience with Chromium yet, but the appropriately-inclusive tab content seems to be a move in the right direction for browsers.<br></p><p><br></p></div></div><div class='comment'><div class='author'>Gavin Black</div><time datetime='2011-01-12T00:00:00Z'>Wed, 12 Jan 2011 00:00:00 UTC</time><div class='body'><p><br>I'm sorry that you've fallen under the sway of a heathen WM, hopefully you'll adopt the Tiling civic again.  To me it's just moving the "Start" bar of most WMs from the bottom (The ones that group at least). Since I started with raw VTs, I'd make 8 desktops and treat each desktop as my way to organize content (1-IM, 2-Internet, 3/4-Development, 5-Usenet/Filesharing, ...), which seems less clunky than visually grepping for the right window, dragging the mouse down the list, and clicking the intended victim tab. Thankfully XMonad lets me re-enforce the memorized groupings I've used since high school, deftly avoiding UI natural selection (Replying on Meta-2 now ;) <br></p><p><br>Also if you haven't heard of it there is Ion which is a tabbed tiling WM, although I know the tabbing is not why you originally switched.<br></p><p><br>Besides the browser (Which I'd argue needs a stack of some sort more than tabs) how often do you have dozens of windows open that you are actively using? You can pipe any sort of status to a common /dev/pts.  I'm probably just being an old fogy though, enjoy your new fangled mouse interactive WMs, I shan't be needing them &gt;:|<br></p><p><br></p></div></div></div><hr/><div class='thread'><h1 id='2011-05-01'><a href='/blog/2011/05/01/'>Feedback Loop Applet</a></h1><div class='comment'><div class='author'>possiblywrong</div><time datetime='2011-05-01T00:00:00Z'>Sun, 01 May 2011 00:00:00 UTC</time><div class='body'><p><br>This is pretty addictive to play with.  I'm not sure I understand where (at least on my display) the "five-ness" comes from in the applet?  That is, the mouse input seems to result in five equally spaced copies of stuff.<br></p><p><br>You might like Hofstadter's <a href="http://amzn.com/0465030793" rel="nofollow noopener" title="http://amzn.com/0465030793">"I Am A Strange Loop,"</a> where in one section he describes some interesting experiments and perspectives on video feedback.  (Even after GEB, this is a pretty interesting book.  He is fun to read even if I don't quite agree with all of his ideas.)<br></p></div></div></div><hr/><div class='thread'><h1 id='2011-01-30'><a href='/blog/2011/01/30/'>BrianScheme Update: Bootstrapping and Images</a></h1><div class='comment'><div class='author'>Gavin Black</div><time datetime='2011-01-30T00:00:00Z'>Sun, 30 Jan 2011 00:00:00 UTC</time><div class='body'><p><br>Really cool so far.<br>I think the acronym makes it sound like a government project though :P  <br></p><p><br>Hopefully you can get the FFI going at a reasonable speed, would be neat to see GD/SDL or whatever bindings so that it can do some graphics.</p></div></div><div class='comment'><div class='author'>Matt Stine</div><time datetime='2011-01-30T00:00:00Z'>Sun, 30 Jan 2011 00:00:00 UTC</time><div class='body'><p><br>Nice work.  I've taken a look at the project's Github page, and impressed to see the rate of generating new, substantial commits.<br></p><p><br>Now if I were only familiar with Scheme so that I could play around with what you are creating.  :)</p></div></div></div><hr/><div class='thread'><h1 id='2007-10-24'><a href='/blog/2007/10/24/'>Chess AI Idea</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2011-08-18'><a href='/blog/2011/08/18/'>Fake Emacs Namespaces</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2011-02-19'><a href='/blog/2011/02/19/'>Torrent File Strip</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2010-03-09'><a href='/blog/2010/03/09/'>A Fractran Short Story</a></h1><div class='comment'><div class='author'>Anon</div><time datetime='2011-12-13T04:09:00Z'>Tue, 13 Dec 2011 04:09:00 UTC</time><div class='body'><p>The empty list is the identity function in fractran.</p></div></div><div class='comment'><div class='author'>Weux</div><time datetime='2013-07-31T14:02:43Z'>Wed, 31 Jul 2013 14:02:43 UTC</time><div class='body'><p>Fractran programs care more about the exponents of the primes in the factorization than anything else, that is where the Turing-completeness lies.  So the program you are looking for would be something that takes input 2^n and produces the prime factorization of n encoded in the exponents.  Also, the identity function can be implemented as the null list (as someone else said (it is quite an elegant solution)) or as the (1/3) with an input coded 2^n.  Since the input is not divisible by any denominator on the list, it becomes the output.</p></div></div></div><hr/><div class='thread'><h1 id='2011-01-11'><a href='/blog/2011/01/11/'>BrianScheme</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2010-04-23'><a href='/blog/2010/04/23/'>The Problem with String Stored Regex</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2011-04-09'><a href='/blog/2011/04/09/'>October&#39;s Chess Engine Gets Some Attention</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2007-09-17'><a href='/blog/2007/09/17/'>BCCD Clusters</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2011-08-24'><a href='/blog/2011/08/24/'>October Chess Engine Updates</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2010-07-20'><a href='/blog/2010/07/20/'>Pen and Paper RPG Wishlist</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2011-08-30'><a href='/blog/2011/08/30/'>Java Hot Code Replacement</a></h1><div class='comment'><div class='author'>John Doe</div><time datetime='2014-12-29T14:06:21Z'>Mon, 29 Dec 2014 14:06:21 UTC</time><div class='body'><p>Ever heard of Objectweb ASM or BCEL. You can instrument bytecode on the fly.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-12-30T13:10:34Z'>Tue, 30 Dec 2014 13:10:34 UTC</time><div class='body'><p>I've heard of both, and I've used BCEL indirectly for static code analysis (FindBugs), but otherwise I don't know too much about them. I haven't coded in Java for a couple of years now, but next time I do I'll have to give these a look.</p></div></div></div></div><hr/><div class='thread'><h1 id='2009-02-20'><a href='/blog/2009/02/20/'>Readline Wrap</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2007-12-26'><a href='/blog/2007/12/26/'>A Faster Montage</a></h1><div class='comment'><div class='author'>Kavinda Jayasinghege Don</div><time datetime='2015-05-22T21:53:21Z'>Fri, 22 May 2015 21:53:21 UTC</time><div class='body'><p>Hey Chris,</p><p>I know that this is an old post but do you still have the script? Could you fix the link for us?</p><p>Thanks!</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-05-23T00:49:51Z'>Sat, 23 May 2015 00:49:51 UTC</time><div class='body'><p>Thanks for pointing out the problem! Apparently the script was lost when I changed hosts four years ago, but no one seems to have noticed until now. I just wrote a much-improved replacement (Perl sucks!) in C that does the same job in a mere 50ms. It's now linked at the top of the artice. It should work in Windows too (untested), if that's your thing. See the program's header for usage info.</p><p>Apparently ImageMagick's montage is a whole lot more reasonable than it was back in 2007. It can do the same montage in only 24 seconds on my current machine, so a custom script is no longer necessary. I originally wrote my script because I was tired of having to wait overnight for results.</p></div><div class='comment'><div class='author'>Kavinda Jayasinghege Don</div><time datetime='2015-05-23T11:07:55Z'>Sat, 23 May 2015 11:07:55 UTC</time><div class='body'><p>Thanks Chris!</p><p>      I'm using Windows but I'm having to wait ages (nearly 2 hours) for ImageMagick to form a montage of 34 images consisting of 110 tiles pieced together into a vertical strip. IM can produce a montage very quickly when you process images vertically but not horizontally for me!</p><p>Thanks again for updating the link!</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2009-02-12'><a href='/blog/2009/02/12/'>Git is Better</a></h1><div class='comment'><div class='author'>Miroslav</div><time datetime='2015-08-24T05:53:47Z'>Mon, 24 Aug 2015 05:53:47 UTC</time><div class='body'><p>Maybe by skiping Fossil you didn't realize how good it is compared to Git.</p></div></div></div><hr/><div class='thread'><h1 id='2011-10-13'><a href='/blog/2011/10/13/'>Halftone</a></h1><div class='comment'><div class='author'>jfrio</div><time datetime='2011-10-14T09:09:24Z'>Fri, 14 Oct 2011 09:09:24 UTC</time><div class='body'><p>Very cool... I work in R&amp;D for a major printer manufacturer, so it's close to true that I do halftoning algorithms for a living, mostly FM, not AM, though. If you ever want to give it a try, drop me a line and I can point you to freely available information.</p></div></div><div class='comment'><div class='author'>Brian</div><time datetime='2011-10-15T15:11:15Z'>Sat, 15 Oct 2011 15:11:15 UTC</time><div class='body'><p>Wow. Nice result for not-a-lot of code.</p></div></div></div><hr/><div class='thread'><h1 id='2011-10-19'><a href='/blog/2011/10/19/'>Emacs Configuration Repository</a></h1><div class='comment'><div class='author'>Brian</div><time datetime='2012-02-18T04:10:34Z'>Sat, 18 Feb 2012 04:10:34 UTC</time><div class='body'><p>I'm now a happy user of your configuration. It was a really good starting point. I just added clojure-mode and a few other things. <a href="http://github.com/netguy204/.emacs.d" rel="nofollow noopener" title="http://github.com/netguy204/.emacs.d">http://github.com/netguy204...</a></p><p>Thanks!</p></div></div><div class='comment'><div class='author'>heliofrota</div><time datetime='2012-09-19T13:51:33Z'>Wed, 19 Sep 2012 13:51:33 UTC</time><div class='body'><p>Thanks !</p><p>I'm now another happy user of your configuration.<br></p></div></div><div class='comment'><div class='author'>Deric Bytes</div><time datetime='2013-01-07T13:32:31Z'>Mon, 07 Jan 2013 13:32:31 UTC</time><div class='body'><p>Thanks, got some helpful tips</p></div></div></div><hr/><div class='thread'><h1 id='2011-11-03'><a href='/blog/2011/11/03/'>Some Cool Shell Aliases</a></h1><div class='comment'><div class='author'>Chris2048</div><time datetime='2011-11-06T13:24:57Z'>Sun, 06 Nov 2011 13:24:57 UTC</time><div class='body'><p>Have you tried 'tmux'? I much prefer it over screen now.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2011-11-07T15:31:36Z'>Mon, 07 Nov 2011 15:31:36 UTC</time><div class='body'><p>Hmmm, `tmux` does seem to be more capable than `screen`. I'll start using it and see if it sticks. Thanks!<br></p></div></div></div><div class='comment'><div class='author'>Michal Zuber</div><time datetime='2014-12-05T05:25:11Z'>Fri, 05 Dec 2014 05:25:11 UTC</time><div class='body'><p>Tried he 'httpd' alias, but was interfering with apache so needed to change to 'webshare' :)</p></div></div><div class='comment'><div class='author'>deathbullet</div><time datetime='2017-09-01T09:23:39Z'>Fri, 01 Sep 2017 09:23:39 UTC</time><div class='body'><p>Ah, the good old days when you used to bash vi!<br>Sad to see you like it more than Emacs now!</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-09-02T02:29:41Z'>Sat, 02 Sep 2017 02:29:41 UTC</time><div class='body'><p>When it comes to text editor bindings, you could say I've seen the light. ;-) Now that I've used both, I can confidently say the Vim/vi's text editing model is definitely superior to Emacs' defaults.</p><p>I'm now using both Emacs and Vim regularly, and I expect to keep using both like this indefinitely. Initially I could switch between Emacs bindings and Vim bindings with ease, but my Emacs muscle memory has totally atrophied at this point. When I'm running short tests in an unconfigured Emacs instance (package testing, foreign machine, etc.), I switch on Viper since otherwise I'd go nuts. It's no Evil, but it works in a pinch.</p><p>Emacs is a whole lot more flexible and extensible than Vim, and so I actually don't do much to customize Vim. Instead I bend Emacs to be more like Vim.</p></div></div></div></div><hr/><div class='thread'><h1 id='2011-11-06'><a href='/blog/2011/11/06/'>Introducing NativeGuide</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2007-09-19'><a href='/blog/2007/09/19/'>Proposal for a Free Musical</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2011-11-19'><a href='/blog/2011/11/19/'>Try Out My Java With Emacs Workflow Within Minutes</a></h1><div class='comment'><div class='author'>Jocimar Lopes</div><time datetime='2012-04-22T03:34:45Z'>Sun, 22 Apr 2012 03:34:45 UTC</time><div class='body'><p>GREAT!!! Thank you, very much for all the time you spent sharing this. </p></div></div><div class='comment'><div class='author'>fistofsenn</div><time datetime='2012-10-14T20:13:30Z'>Sun, 14 Oct 2012 20:13:30 UTC</time><div class='body'><p>just found this article. I created an emacs package to integrate Eclipse with Emacs. If you are interested you can find more details here: <a href="http://blog.senny.ch/blog/2012/10/13/emacs-and-java-journey-of-a-hard-friendship/" rel="nofollow noopener" title="http://blog.senny.ch/blog/2012/10/13/emacs-and-java-journey-of-a-hard-friendship/">http://blog.senny.ch/blog/2...</a></p></div></div><div class='comment'><div class='author'>Albert</div><time datetime='2012-11-07T23:45:35Z'>Wed, 07 Nov 2012 23:45:35 UTC</time><div class='body'><p>Thanks for this I still like java but am only wanting to use emacs more and more and it looks like youve developed a best practice with emacs here using other leading edge stuff like magit.</p></div></div><div class='comment'><div class='author'>Wagner Marques</div><time datetime='2012-12-28T20:21:13Z'>Fri, 28 Dec 2012 20:21:13 UTC</time><div class='body'><p>many many thanks...<br> </p></div></div><div class='comment'><div class='author'>Sugi. </div><time datetime='2013-01-07T03:54:21Z'>Mon, 07 Jan 2013 03:54:21 UTC</time><div class='body'><p>I really thank you. I spent so many hours in setting up emacs for Java. Your help helped me lot of time. Thanks a lot for your kind heart in sharing such a time cosuming work for others. Thanks again.  </p></div></div><div class='comment'><div class='author'>emacsgeek</div><time datetime='2013-11-11T23:15:06Z'>Mon, 11 Nov 2013 23:15:06 UTC</time><div class='body'><p>i love you!</p></div></div></div><hr/><div class='thread'><h1 id='2011-11-28'><a href='/blog/2011/11/28/'>Poor Man&#39;s Video Editing</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2008-03-14'><a href='/blog/2008/03/14/'>Rumors of My Death Have Been Greatly Exaggerated</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2011-12-16'><a href='/blog/2011/12/16/'>CSS Variables with Jekyll and Liquid</a></h1><div class='comment'><div class='author'>legendlee</div><time datetime='2013-02-25T03:02:31Z'>Mon, 25 Feb 2013 03:02:31 UTC</time><div class='body'><p>surprised to see this! </p></div></div></div><hr/><div class='thread'><h1 id='2012-01-19'><a href='/blog/2012/01/19/'>Silky Smooth Perlin Noise Surface</a></h1><div class='comment'><div class='author'>Brian</div><time datetime='2012-01-19T22:00:20Z'>Thu, 19 Jan 2012 22:00:20 UTC</time><div class='body'><p>Pretty!</p></div></div></div><hr/><div class='thread'><h1 id='2012-02-03'><a href='/blog/2012/02/03/'>Cartoonish Liquid Simulation</a></h1><div class='comment'><div class='author'>DucLoi</div><time datetime='2014-07-21T08:45:13Z'>Mon, 21 Jul 2014 08:45:13 UTC</time><div class='body'><p>can you port to android?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-07-21T12:23:18Z'>Mon, 21 Jul 2014 12:23:18 UTC</time><div class='body'><p>The Java version wouldn't run well as-is on Android. Blurring is done using the CPU, which will be far too slow on a mobile device. It would need to be ported to OpenGL ES to get decent performance on typical Android devices. And that's exactly what I ended up doing: at the top of the article is a link to my WebGL port. Android supports WebGL, so you should be able to run that one in your browser. Firefox works best by far because I'm using asm.js for the physics simulation, and Firefox runs that much faster than any other browser.</p></div></div></div><div class='comment'><div class='author'>Ruben</div><time datetime='2017-10-28T11:27:34Z'>Sat, 28 Oct 2017 11:27:34 UTC</time><div class='body'><p>I remember doing something similar in QBASIC years and years ago. That program used a 320x200 resolution and used the CPU to loop over all pixels. I don't remember the details, but the trick was to have black pixels (background/empty), white pixels (foreground/object), and blue pixels (water). Then you could update the pixels in the screenbuffer by moving the blue pixels down one pixel at a time, plus a random horizontal offset (but of course the pixel should only be moved if the target position is free). This is not fantastic (for example, the water falls with a fixed speed and looks weird if you eyeball individual pixels), but I remember it working remarkably well for such a simple 'algorithm'.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-10-30T17:24:50Z'>Mon, 30 Oct 2017 17:24:50 UTC</time><div class='body'><p>If you ever figure out exactly what you did in that old QBASIC program, I'd be interested in seeing the effect and hearing how it worked.</p></div><div class='comment'><div class='author'>Ruben</div><time datetime='2017-11-01T12:57:56Z'>Wed, 01 Nov 2017 12:57:56 UTC</time><div class='body'><p>Basically it's just a simplified particle engine where you use an array to store the type of pixel at that pixel location. So you do something like "if (buffer[particle.x, particle.y + 1] == free) { particle.y++; }. Combining that with a small chance to move sideways (if that pixel is free) yields an OK water simulation. I thought it was possible to do this in screen space as well (and it probably is), but when I tried yesterday I got an asymmetric simulation due to the order of processing of the pixels. I tried to circumvent this with some tricks but couldn't find an easy solution. Maybe updating the pixels in a semi-random way would work, but this would kind of defeat the purpose of doing the 'simulation' in screen space.</p><p>Anyway, for some (QBASIC - should be easy to read) source you can see <a href="http://www.qb45.org/rate.php?file=957" rel="nofollow noopener" title="http://www.qb45.org/rate.php?file=957">http://www.qb45.org/rate.ph...</a>. Since this program is written in QBASIC (it probably won't work in newer versions without porting, since it uses VGA). You can set it up in DOSBox, but for you to get an impression I captured and uploaded a run with 150 particles here: <a href="https://youtu.be/ZVmBFQgLT0I" rel="nofollow noopener" title="https://youtu.be/ZVmBFQgLT0I">https://youtu.be/ZVmBFQgLT0I</a></p><p>I now realize this would not work well on higher resolutions without hardware acceleration (but I'm not sure how this would work).</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2012-02-08'><a href='/blog/2012/02/08/'>Lisp Let in GNU Octave</a></h1><div class='comment'><div class='author'>possiblywrong</div><time datetime='2012-02-10T02:29:16Z'>Fri, 10 Feb 2012 02:29:16 UTC</time><div class='body'><p>Thanks, I learned something today.  I had to stare at your code for a while to convince myself that it generates random unit vectors that are indeed uniformly distributed on the sphere.  I'm used to seeing a slightly different "trick" for this, that is relatively simple to describe thinking in spherical coordinates, but isn't as compact in Octave code: pick a "longitude" uniformly at random, then instead of picking a "latitude" (which doesn't work, as you point out), pick a *z-coordinate* uniformly at random.<br></p></div></div><div class='comment'><div class='author'>Ahmed Fasih</div><time datetime='2014-05-24T18:26:07Z'>Sat, 24 May 2014 18:26:07 UTC</time><div class='body'><p>I almost always prefer `bsxfun` to `repmat`, i.e., `@(v) v ./ repmat(sqrt(sum(abs(v) .^ 2, 2))` becomes `@(v) bsxfun(@times, v, 1 ./ sqrt(sum(abs(v) .^ 2, 2))` (and I use `times` there only because I can never remember the proper difference between `rdivide` and `ldivide`). Note that Numpy and R and other sane environments don't have an explicit function like Matlab/Octave's `bsxfun` because they do array broadcasting automatically!</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-05-24T19:03:50Z'>Sat, 24 May 2014 19:03:50 UTC</time><div class='body'><p>I wasn't aware of bsxfun() until now. Looks useful! Looking back at <br>my original expression now, I don't know why I put the abs() in there. <br>I'm wondering if there was a particular reason.</p><p>After seeing your comment, I just came up with another one today:</p><p>p = (@(v) v ./ cellfun(@norm, num2cell(v, 2)))(randn(n, 3));</p></div></div></div></div><hr/><div class='thread'><h1 id='2012-03-09'><a href='/blog/2012/03/09/'>Rumor Simulation</a></h1><div class='comment'><div class='author'>possiblywrong</div><time datetime='2012-03-14T00:23:02Z'>Wed, 14 Mar 2012 00:23:02 UTC</time><div class='body'><p>Neat problem, I'll have to stash this in my bag of "cool exercises" :).  I have to imagine that the intended solutions were supposed to be observed simulation results and not exact derivations, because the solutions here are, well, not exactly nice (and only about 40 years old).</p><p>There is a closed form solution, though-- sort of.  The model is similar to the SIR model of the spread of disease in epidemics; the ignorants are "S"usceptible to the disease, the spreaders are the "I"nfected, and the stiflers are "R"ecovered and do not continue to pass along the disease.  Analysis in that context is usually "continuous" (i.e., differential equations), so I didn't expect a nice solution in this discrete model, but I poked around with it anyway for way too long :).</p><p>There is a nice recent summary of results about this and similar models here:<br><a href="http://arxiv.org/pdf/1003.4995.pdf" rel="nofollow noopener" title="http://arxiv.org/pdf/1003.4995.pdf">http://arxiv.org/pdf/1003.4...</a> </p><p>Short version: the fraction of the population that hears the rumor is, in convenient Mathematica notation, 1+ProductLog[-2*E^-2]/2, or 0.7968121300200199, where ProductLog[z] is the solution to the equation z == w*E^w.<br></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2012-03-14T13:10:55Z'>Wed, 14 Mar 2012 13:10:55 UTC</time><div class='body'><p>I figured this one would tickle your curiosity.</p><p>Seeing that paper makes me feel better about not having figured anything out. The solution is a lot more complicated than I imagined.<br></p></div></div></div><div class='comment'><div class='author'>Luke</div><time datetime='2012-03-17T01:36:53Z'>Sat, 17 Mar 2012 01:36:53 UTC</time><div class='body'><p>Are you allowing for repeated meetings, or are pairs that already met exuded from the next selection.</p><p>It would also be interesting to try to re-factor this problem as cellular automata. I vaguely remember the fish and sharks model in which you had cells randomly moving on the grid that could be adopted to this. After all spatial factors play a huge part in rumor spreading.<br></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2012-03-17T04:56:00Z'>Sat, 17 Mar 2012 04:56:00 UTC</time><div class='body'><p>Following the problem description strictly, yes, repeated meetings are allowed. So A could tell B the rumor, then immediately attempt to tell B again turning them both into stiflers.</p><p>I never heard of the fish and sharks model, but I just looked it up. It sounds neat, so I'll give it a shot.</p></div></div></div></div><hr/><div class='thread'><h1 id='2012-04-10'><a href='/blog/2012/04/10/'>Making Your Own GIF Image Macros</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2012-04-23'><a href='/blog/2012/04/23/'>Pseudo-terminals</a></h1><div class='comment'><div class='author'>possiblywrong</div><time datetime='2012-04-27T13:14:34Z'>Fri, 27 Apr 2012 13:14:34 UTC</time><div class='body'><p>This actually came up at work for me as well-- and it was during a field test, so we needed it *quick* :).  There is actually a decent open-source solution for Windows, called com0com (link below).  With it, you can create (pairs of) virtual ports, and there is also a handy add-on tool called com2tcp that adapts a serial connection to a TCP socket.</p><p>The original project was for Win32, but I did get things working on Win7 as well, after some device driver signing issues that I would have to check my notes to remember :).</p><p><a href="http://com0com.sourceforge.net/" rel="nofollow noopener" title="http://com0com.sourceforge.net/">http://com0com.sourceforge....</a><br></p></div></div><div class='comment'><div class='author'>Ron</div><time datetime='2012-06-04T07:16:48Z'>Mon, 04 Jun 2012 07:16:48 UTC</time><div class='body'><p>Could something like an LD_PRELOAD hack work as well, does LD_PRELOAD work on a Windows machine?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2012-06-04T12:07:58Z'>Mon, 04 Jun 2012 12:07:58 UTC</time><div class='body'><p>I had to look it up and it seems that <a href="http://en.wikipedia.org/wiki/DLL_injection" rel="nofollow noopener" title="http://en.wikipedia.org/wiki/DLL_injection">DLL injection</a> is the Windows equivalent. I'm not sure if it can be used to override the serial port functions. It's something to try out. If it <i>is</i> possible, then this would be another solution, so good idea!<br></p></div></div></div><div class='comment'><div class='author'>Michael_mhr</div><time datetime='2016-09-25T21:33:42Z'>Sun, 25 Sep 2016 21:33:42 UTC</time><div class='body'><p>How can I use this functions to read the data from the serial port, modify it and then send it to a virtual serial port?<br>I'm very new to C and Serial ports. I need it for a school project and I don't know how to do it.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-09-25T22:43:16Z'>Sun, 25 Sep 2016 22:43:16 UTC</time><div class='body'><p>If the devices already exist under /dev, you should open(2) each, read(2) from one, make your changes, and write(2) to the other.</p></div></div></div></div><hr/><div class='thread'><h1 id='2012-04-29'><a href='/blog/2012/04/29/'>Why Do Developers Prefer Certain Kinds of Tools?</a></h1><div class='comment'><div class='author'>Gavin Black</div><time datetime='2012-04-30T15:50:31Z'>Mon, 30 Apr 2012 15:50:31 UTC</time><div class='body'><p>I think you are describing a very certain type of programmer.  There are lots of developers who rarely use a shell and are comfortable letting huge IDEs manage everything for them (Netbeans, Visual Studio, Eclipse), and using WYSIWYG layout tools. I have even seen console level git diffs confuse developers used to fancier tools.</p><p>I actually feel the difference comes down to people who are comfortable (And probably learned to program) in a *nix environment and those who are aren't. That might be an unfair bias, but I've never seen someone who both prefers to use Linux for development and likes to have everything hidden by them in their IDE.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2012-04-30T16:06:14Z'>Mon, 30 Apr 2012 16:06:14 UTC</time><div class='body'><p>I'm talking about <i>true</i> programmers, of course! : -)</p></div></div></div><div class='comment'><div class='author'>Ron</div><time datetime='2012-05-03T07:56:19Z'>Thu, 03 May 2012 07:56:19 UTC</time><div class='body'><p>For images if been experimenting with keeping an original, and doing the transforms via scripts, can be a little annoying if the watermark needs to be changed on some images</p></div></div></div><hr/><div class='thread'><h1 id='2012-04-30'><a href='/blog/2012/04/30/'>Presentations with Jekyll and deck.js</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2012-05-19'><a href='/blog/2012/05/19/'>SSH Honeypots</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2012-06-03'><a href='/blog/2012/06/03/'>Perlin Noise With Octave, Java, and OpenCL</a></h1><div class='comment'><div class='author'>Mopzar</div><time datetime='2014-03-25T14:21:35Z'>Tue, 25 Mar 2014 14:21:35 UTC</time><div class='body'><p>Hi,</p><p>Nice script OpenCL script!</p><p>I think you are not using OpenCL in the right way though, check this link to see how to use the parallelism properly ;)</p><p><a href="http://www.drdobbs.com/parallel/a-gentle-introduction-to-opencl/231002854" rel="nofollow noopener" title="http://www.drdobbs.com/parallel/a-gentle-introduction-to-opencl/231002854">http://www.drdobbs.com/para...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-03-25T14:57:44Z'>Tue, 25 Mar 2014 14:57:44 UTC</time><div class='body'><p>Thanks for the link. I must have gotten *something* right, though, since it's much faster than any CPU-only implementation.</p></div></div></div></div><hr/><div class='thread'><h1 id='2012-06-08'><a href='/blog/2012/06/08/'>SSH and GPG Agents</a></h1><div class='comment'><div class='author'>Fergus</div><time datetime='2013-07-23T08:41:17Z'>Tue, 23 Jul 2013 08:41:17 UTC</time><div class='body'><p>nice post - thx!<br>for those with security concerns, you could add the --clear flag, which would keep the daemon running but assume each new login is an intruder requiring validation.</p></div></div></div><hr/><div class='thread'><h1 id='2012-06-23'><a href='/blog/2012/06/23/'>Versioning Personal Configuration Dotfiles</a></h1><div class='comment'><div class='author'>Ron</div><time datetime='2012-06-24T01:48:21Z'>Sun, 24 Jun 2012 01:48:21 UTC</time><div class='body'><p>And if your OS is not too stupid, it will actually implement fsync() (looking at you OSX). The POSIX spec, allows (not implies, it explicit) null implementations of fsync().</p><p>int fsync(int fd){<br>return 0;<br>}</p><p>Is valid</p></div></div><div class='comment'><div class='author'>Samask</div><time datetime='2013-12-31T23:31:56Z'>Tue, 31 Dec 2013 23:31:56 UTC</time><div class='body'><p>I use 'dotfiles': <a href="https://github.com/jbernard/dotfiles" rel="nofollow noopener" title="https://github.com/jbernard/dotfiles">https://github.com/jbernard...</a></p></div></div><div class='comment'><div class='author'>jasonkarns</div><time datetime='2014-08-04T15:39:31Z'>Mon, 04 Aug 2014 15:39:31 UTC</time><div class='body'><p>One of the drawbacks for versioning the entire home directory has a workaround, that you mentioned. You noted `$GIT_DIR`. However, you can also use a file in the repo named `.git` that contains the path to the the git directory. I have said file named `git` (note the lack of the leading '.') While the file is named `git`, the home directory is not considered a git repo. I simply change the filename to `.git` when I need to do any git operations; which is almost never thanks to the following...</p><p>I have my actual git_dir cloned as ~/dotfiles. Within dotfiles, I have the core.worktree set to `../../`. Thus the repo is ~/dotfiles, but the dot-files themselves are checked out to $HOME. This allows me to avoid the problems you mentioned above. My $HOME is not considered a git repo, so no inadvertent git commands are possible. (Git commands must be executed under ~/dotfiles to apply to the repo). The only two scenarios that don't handle the worktree setting are  the Mac gui tool GitX and the use of the git-submodule command. (The only submodule is vundle for bootstrapping my vim plugins.) In order to run either of these two commands, I simply rename ~/git to ~/.git (as described above) and presto.</p><p>While it's a bit more tedious, I enjoy the fact that any changes or *new* files in my home directory are picked up by my dotfiles repo.</p></div></div><div class='comment'><div class='author'>Patrick</div><time datetime='2019-02-19T02:42:56Z'>Tue, 19 Feb 2019 02:42:56 UTC</time><div class='body'><p>I found gnu-stow to be the perfect program for managing the symlinking of dotfiles from a repo...</p></div></div></div><hr/><div class='thread'><h1 id='2012-06-24'><a href='/blog/2012/06/24/'>Publishing My Private Keys</a></h1><div class='comment'><div class='author'>Philip Jägenstedt</div><time datetime='2013-07-25T13:41:44Z'>Thu, 25 Jul 2013 13:41:44 UTC</time><div class='body'><p>Very interesting. In the year since you wrote this, have you had any reason to reconsider?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-07-25T15:02:22Z'>Thu, 25 Jul 2013 15:02:22 UTC</time><div class='body'><p>Over the last year having my signing key available whenever I need it has been very convenient. Being part of my dotfiles repo, it's <a href="http://nullprogram.com/blog/2013/06/17/" rel="nofollow noopener" title="http://nullprogram.com/blog/2013/06/17/">automatically present in my live system</a>, which is probably <i>the</i> safest place for me to use my key -- a fresh, read-only, throwaway system that doesn't write to any permanent storage.</p><p>Security-wise, nothing has changed. Brute-forcing my passphrase is still <i>much</i> more expensive than other possible attacks, like compromising one of my computers with a software or hardware keylogger. Occasionally someone opens up an issue on GitHub to warn me that my private keys have been committed, but I just redirect them here.</p></div><div class='comment'><div class='author'>Philip Jägenstedt</div><time datetime='2013-07-25T16:11:59Z'>Thu, 25 Jul 2013 16:11:59 UTC</time><div class='body'><p>Cool. I found this while trying to find sane ways to store secret information publicly accessible, but reckon that unless I need the GnuPG part (haven't used it in years) then just encrypting it using AES256 will be simpler... although I suppose the --s2k-count makes your solution more expensive to brute force.</p></div></div></div></div><div class='comment'><div class='author'>Krishna</div><time datetime='2014-03-26T15:31:40Z'>Wed, 26 Mar 2014 15:31:40 UTC</time><div class='body'><p>Hello. Thank you for this article. I followed it and I ran this command  over my 4096 bit RSA key.<br>gpg --s2k-cipher-algo AES256 --s2k-digest-algo SHA512 --s2k-mode 3 --s2k-count 65000000 --edit-key keyid and I entered 'passwd' for a new passphrase, then quit the prompt with 'quit', I gave 'y' to save changes.</p><p>However, --list-packets option's output doesn't show "SHA512 protection", it is still "SHA1 protection", can you please tell me where I'm going wrong?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-03-26T17:57:55Z'>Wed, 26 Mar 2014 17:57:55 UTC</time><div class='body'><p>I *think* "SHA1 protection" is some kind of integrity check. It's not part of key derivation. The important part is the "hash: 10" describing the key derivation algorithm. This means it used algorithm number 10, which is listed as SHA512 in RFC4880 (section 9.4). Before you edited the key, this was probably "hash: 2".</p><p><a href="https://tools.ietf.org/html/rfc4880#section-9.4" rel="nofollow noopener" title="https://tools.ietf.org/html/rfc4880#section-9.4">https://tools.ietf.org/html...</a></p><p>The "algo: 9" part refers to "AES with 256-bit key" (section 9.2), the algorithm encrypting your private key.</p></div><div class='comment'><div class='author'>Krishna</div><time datetime='2014-03-27T02:53:44Z'>Thu, 27 Mar 2014 02:53:44 UTC</time><div class='body'><p>Thanks, output has Hash:10 and Algo:9.</p><p>I have another question, did this method also change settings for both my signing and encrypting keys, or just for the encrypting key alone?  <br>Thank you!</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-03-27T15:27:12Z'>Thu, 27 Mar 2014 15:27:12 UTC</time><div class='body'><p>That's something I'm not sure about. I think it does both, but you'll need to inspect --list-packets closely to be sure.</p></div><div class='comment'><div class='author'>Krishna</div><time datetime='2014-03-28T14:58:49Z'>Fri, 28 Mar 2014 14:58:49 UTC</time><div class='body'><p>Hi, I tried inspecting list-packets, but I couldn't figure out yet. Since you published your secring.gpg, I think it is not safe until you know if both keys go under the same....</p></div></div></div></div></div></div><div class='comment'><div class='author'>simonszu</div><time datetime='2014-11-10T22:07:33Z'>Mon, 10 Nov 2014 22:07:33 UTC</time><div class='body'><p>Hi,</p><p>i have stumbled over this post while searching for a convenient way to sync my GnuPG details. Since the .gpg files are encrypted, git treats them as binary files, so whenever i have merge conflicts, i cannot properly merge them. I thought you would have the same problem, and maybe have a solution for this. I only came over "pushing and pulling the repository consequently when you start or leave a session at a certain computer", but maybe there is something better?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-11-10T23:04:39Z'>Mon, 10 Nov 2014 23:04:39 UTC</time><div class='body'><p>Sorry, I don't have any solution for this. I just don't check in any changes to my keyring. One, because it's a pain to merge as you're finding. Two, it makes it a little harder for others to get a list of my contacts. I doubt GnuPG will ever make a version-control-friendly keyring format because they really don't want people using it this way. <br>The good news is that, for better or worse, the web of trust captures the most important information in my keyring, outside of my private key, that is. If I trust a key, I sign it and publish my signature to a keyserver. Later on when I need to validate that key again (on another machine, etc.), I can fetch back my own signature. The WoT is my cloud backup.</p></div></div></div><div class='comment'><div class='author'>Pablo Olmos de A. C.</div><time datetime='2014-12-27T22:19:20Z'>Sat, 27 Dec 2014 22:19:20 UTC</time><div class='body'><p>Since gnupg 2.1[1], there's no `secring.gpg`. How can I achieve somewhat, the same results?</p><p>[1]: <a href="https://www.gnupg.org/faq/whats-new-in-2.1.html" rel="nofollow noopener" title="https://www.gnupg.org/faq/whats-new-in-2.1.html">https://www.gnupg.org/faq/w...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-12-28T19:31:41Z'>Sun, 28 Dec 2014 19:31:41 UTC</time><div class='body'><p>I haven't had to deal with this yet, but I believe everything here should work the same. When GPG does the one-time update to the files in your .gnupg/ directory, you will need to inform Git about the change. The constraints on things like number of iterations and hash algorithm selection is set by the OpenPGP format, not by GnuPG's internal format. <br>However, unless I'm missing something, I don't think this issue applies to GnuPG "classic" (i.e. 1.4.x)? I couldn't find much information about it. My own use of GnuPG is limited to the "classic" version.</p></div><div class='comment'><div class='author'>Pablo Olmos de A. C.</div><time datetime='2014-12-30T02:11:56Z'>Tue, 30 Dec 2014 02:11:56 UTC</time><div class='body'><p>Hm, I don't think so. The edit key parameters looks like are being ignored. Since the keys now live in private-keys-v1.d directory. After doing this and changing the passphrase, the "key" in that directory, have the same checksum (which makes me believe the key hasn't changed at all) and it's exactly the same file as before, right? Afaik, if the key it's encrypted itself, the key file should along with the passphrase?</p><p>Also, list-packets doesn't work with those files, so I don't know which algorithm was used.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-12-30T15:21:39Z'>Tue, 30 Dec 2014 15:21:39 UTC</time><div class='body'><p>Ok, so I just grabbed the latest "modern" version of GnuPG (2.1.1) to have a look at what changed. I'm not entirely happy with what I'm seeing.</p><p>To inspect your secret keys regardless of how GnuPG is storing them internally, export them (--export-secret-keys) and run list-packets on the output. That will put the keys into the OpenPGP format for list-packets. On 2.1.1 you'll have to enter your passphrase to do this because the keys are decrypted and re-encrypted on the way out.</p><p>Second, there's a bug in the latest release of GnuPG 2 that's causing it to ignore all of the --s2k* options, even when exporting keys. This is pretty serious, so I'll report it upstream. Perhaps these options are now meant to apply to GnuPG's internal encryption only, but I'm not seeing evidence of this. Either way this is bad.</p><p>When I use edit-key all the files under private-keys-v1.d/ are changing as expected, so I don't know why yours aren't changing. Even with the s2k parameters are untouched, the salt changes anytime the passphrase is changed with passwd, even (especially!) when the same passphrase is entered again.</p><p>The good news is that 2.1.1 uses AES-128 for s2k-cipher-algo and a high number of s2k iterations by default! Neither is the strongest available, but it's good enough. The real problem is that the default choice of s2k-digest-algo is still SHA1 and the user can no longer change it. If you're using GnuPG like I do, I'd stay away from GnuPG "modern" (2.1.1) until this is fixed.</p></div><div class='comment'><div class='author'>Pablo Olmos de A. C.</div><time datetime='2015-01-06T14:36:11Z'>Tue, 06 Jan 2015 14:36:11 UTC</time><div class='body'><p>Ok, sorry, you are right, the checksums actually change, even with the same passphrase, I don't know why it was different before. When I was testing I had more than one directory.</p><p>You are right about list-packets, it works in a exported armored key:</p><p>iter+salt S2K, algo: 7, SHA1 protection, hash: 2, salt: xxxx</p><p>But the pass was changed after the sk2* options, so you are right that they are being ignored. Can you tell me where did you reported this so I can follow it?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-01-06T15:18:13Z'>Tue, 06 Jan 2015 15:18:13 UTC</time><div class='body'><p>Sorry, I should have linked this when I created it:</p><p><a href="https://bugs.g10code.com/gnupg/issue1800" rel="nofollow noopener" title="https://bugs.g10code.com/gnupg/issue1800">https://bugs.g10code.com/gn...</a></p></div><div class='comment'><div class='author'>cryptoluks</div><time datetime='2015-03-31T12:29:46Z'>Tue, 31 Mar 2015 12:29:46 UTC</time><div class='body'><p>any updates on this? Is there a way to force the agent to change the s2k export options?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-04-01T13:26:51Z'>Wed, 01 Apr 2015 13:26:51 UTC</time><div class='body'><p>Nothing new as far as I know. However, the "legacy" version of GnuPG, which is what Debian and its derivates still use for /usr/bin/gpg, works correctly with these s2k options. So if you stick with that version everything here will still work as intended.</p></div></div></div></div></div></div></div></div></div></div><hr/><div class='thread'><h1 id='2012-06-25'><a href='/blog/2012/06/25/'>Moving to Openbox</a></h1><div class='comment'><div class='author'>Andrew Stine</div><time datetime='2012-07-11T17:11:16Z'>Wed, 11 Jul 2012 17:11:16 UTC</time><div class='body'><p>Neat. I should try that trick with feh.<br> </p></div></div><div class='comment'><div class='author'>wet sock</div><time datetime='2014-11-28T13:46:37Z'>Fri, 28 Nov 2014 13:46:37 UTC</time><div class='body'><p>I guess If I had been a KDE user I would have tried XFCE as a lighter alternative. I have never used either of them though. I myself went to Open box as a lighter desktop but then decided it was a bit heavy too and tried DWM and Snapwm. DWM was great but Snapwm is just a tad lighter and that is what I use now.</p></div></div></div><hr/><div class='thread'><h1 id='2012-07-17'><a href='/blog/2012/07/17/'>Literal Arrays and Vectors in Lisp</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2012-07-30'><a href='/blog/2012/07/30/'>A Few Tricky C Questions</a></h1><div class='comment'><div class='author'>J B</div><time datetime='2012-08-06T17:29:55Z'>Mon, 06 Aug 2012 17:29:55 UTC</time><div class='body'><p>The people most skilled in the use of a system are the ones that know every obscure way to break it. </p></div></div><div class='comment'><div class='author'>Nidhy</div><time datetime='2012-12-10T03:56:55Z'>Mon, 10 Dec 2012 03:56:55 UTC</time><div class='body'><p>The result of the program related register variable depends on compiler used. Some compiler is produce warning only<br></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2012-12-10T15:19:58Z'>Mon, 10 Dec 2012 15:19:58 UTC</time><div class='body'><p>According to the spec this should be an error because this situation is not permitted.</p><p>"[W]hether or not addressable storage is actually used, the address of any part of an object declared with storage-class specifier register may not be computed"</p><p>"The operand of the unary &amp; operator shall be either a function designator or an lvalue that designates an object that is not a bit-field and is not declared with the register storage-class specifier."</p><p><a href="http://flash-gordon.me.uk/ansi.c.txt" rel="nofollow noopener" title="http://flash-gordon.me.uk/ansi.c.txt">http://flash-gordon.me.uk/a...</a></p></div></div></div><div class='comment'><div class='author'>aswanth b</div><time datetime='2014-10-31T11:44:17Z'>Fri, 31 Oct 2014 11:44:17 UTC</time><div class='body'><p>Thank you.......<br>And please add more like this.......</p></div></div><div class='comment'><div class='author'>aman punj</div><time datetime='2016-06-21T16:50:28Z'>Tue, 21 Jun 2016 16:50:28 UTC</time><div class='body'><p>i want to print the whole array but to print i call a function with an 2 parametes i.e. pointer and an int size <br>but instead of passing base addres in pointer  i  pass the address of any element in the array  <br>how to print the whole aray ???<br>will you please helpme with this</p></div></div><div class='comment'><div class='author'>Mazhar MIK</div><time datetime='2016-11-11T05:21:31Z'>Fri, 11 Nov 2016 05:21:31 UTC</time><div class='body'><p>Good collection</p></div></div></div><hr/><div class='thread'><h1 id='2012-08-01'><a href='/blog/2012/08/01/'>Viewing Java Class Files in Emacs</a></h1><div class='comment'><div class='author'>Andrew Hyatt</div><time datetime='2012-08-03T00:43:10Z'>Fri, 03 Aug 2012 00:43:10 UTC</time><div class='body'><p>FYI, I wrote a java decompiler as part of the JDEE project awhile ago: <a href="http://jdee.svn.sourceforge.net/viewvc/jdee/trunk/jdee/lisp/jde-parse-class.el?revision=200&amp;view=markup" rel="nofollow noopener" title="http://jdee.svn.sourceforge.net/viewvc/jdee/trunk/jdee/lisp/jde-parse-class.el?revision=200&amp;view=markup">http://jdee.svn.sourceforge...</a>. </p><p>Very slow compared to what you can do in Java, but it does work.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2012-08-03T13:47:30Z'>Fri, 03 Aug 2012 13:47:30 UTC</time><div class='body'><p>Wow, impressive disassembler. Is that how JDEE learns semantic information about classes? This could be really handy. Currently my java-mode extension scans Javadoc output to learn about the classes rather than parse the class files themselves.<br></p></div><div class='comment'><div class='author'>Andrew Hyatt</div><time datetime='2012-08-04T02:12:29Z'>Sat, 04 Aug 2012 02:12:29 UTC</time><div class='body'><p>This particular class was replaced with a Java-based disassembler, so I don't think it is currently used for anything right now.</p></div></div></div></div><div class='comment'><div class='author'>Oleksandr Gavenko</div><time datetime='2015-01-08T00:28:44Z'>Thu, 08 Jan 2015 00:28:44 UTC</time><div class='body'><p>Here is <a href="https://github.com/hiredman/javap-mode/blob/master/javap-mode.el" rel="nofollow noopener" title="https://github.com/hiredman/javap-mode/blob/master/javap-mode.el">https://github.com/hiredman...</a> and <a href="http://www.bytopia.org/2015/01/02/my-javaclojure-bytecode-inspection/" rel="nofollow noopener" title="http://www.bytopia.org/2015/01/02/my-javaclojure-bytecode-inspection/">http://www.bytopia.org/2015...</a></p><p> Both uses find-file-hook. file-name-handler-alist much steeper ))</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-01-08T22:08:14Z'>Thu, 08 Jan 2015 22:08:14 UTC</time><div class='body'><p>Thanks for the link!</p></div></div></div><div class='comment'><div class='author'>Jonathan Gibbons</div><time datetime='2015-10-10T18:38:19Z'>Sat, 10 Oct 2015 18:38:19 UTC</time><div class='body'><p>If it helps, javap will accept a jar: URL to a .class file in a .jar archive.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-10-15T01:24:46Z'>Thu, 15 Oct 2015 01:24:46 UTC</time><div class='body'><p>Oh, good thinking. If I ever revisit this problem I'll keep that in mind.</p></div></div></div></div><hr/><div class='thread'><h1 id='2012-08-02'><a href='/blog/2012/08/02/'>Programmatically Setting Lisp Docstrings</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2012-08-06'><a href='/blog/2012/08/06/'>The Physical Analog for Encryption is the Hyperdrive</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2012-08-12'><a href='/blog/2012/08/12/'>Switching to the Emacs Lisp Package Archive</a></h1><div class='comment'><div class='author'>Andrew Stine</div><time datetime='2012-08-20T13:48:18Z'>Mon, 20 Aug 2012 13:48:18 UTC</time><div class='body'><p>The MELPA "link s-exp" setup reminds me of the old Common Lisp package "manager" ASDF-Install, where links to repos were inserted into a publicly editable wiki. There were issues with that approach, needless to say. This one seems to at least be a little more secure, so I might look into swapping Marmalade with it in my Emacs setup.</p></div></div></div><hr/><div class='thread'><h1 id='2012-08-15'><a href='/blog/2012/08/15/'>Elisp Unit Testing with ERT</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2012-08-20'><a href='/blog/2012/08/20/'>simple-httpd and impatient-mode</a></h1><div class='comment'><div class='author'>caoyuanqi</div><time datetime='2017-03-26T11:56:35Z'>Sun, 26 Mar 2017 11:56:35 UTC</time><div class='body'><p>I think this mode is amazing, I used that a lot. But recently I found that it can not recognise the change of css file change any more. I started the httpd-start , enabled the impatient mode in both css file and html buffers. When I change the content of html it runs ok. when I change the css file it won't work. I could open some url like http://localhost:8181/imp/live/style.css/, it will refresh but not for the linked html file.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-04-01T01:23:41Z'>Sat, 01 Apr 2017 01:23:41 UTC</time><div class='body'><p>I wonder if it's a caching issue. My memory is really rusty on how this stuff works in impatient-mode, but I remember there being an imp-related-files buffer-local variable that's supposed to keep track of this. If you're willing to get your hands dirty to figure this out, in the CSS buffer check if this variable lists the HTML file. If it's not, then somehow it failed to detect that these buffers are related. If it is, then it's some caching issue.</p></div></div></div></div><hr/><div class='thread'><h1 id='2012-09-04'><a href='/blog/2012/09/04/'>Implemented Is Simple Data Compression</a></h1><div class='comment'><div class='author'>Gavin Black</div><time datetime='2012-09-05T09:39:52Z'>Wed, 05 Sep 2012 09:39:52 UTC</time><div class='body'><p>Blog get hacked? Failed AI experiment? Late onset schizophrenia? Either I've finally lost the remainder of my sanity or this post makes absolutely no sense :P </p></div></div></div><hr/><div class='thread'><h1 id='2012-09-05'><a href='/blog/2012/09/05/'>Markov Chain Text Generation</a></h1><div class='comment'><div class='author'>JKIrchartz</div><time datetime='2012-09-17T02:45:38Z'>Mon, 17 Sep 2012 02:45:38 UTC</time><div class='body'><p>Markov is fun! I was going to make a twitter bot, that generated random text from wikiquotes, based off my @yinzbot code...</p></div><div class='comment'><div class='author'>csar</div><time datetime='2013-05-30T19:05:32Z'>Thu, 30 May 2013 19:05:32 UTC</time><div class='body'><p>Yes it is fun :) I forked the git repo for some modifications. Now you can provide your own "random" function (this is for using a seeded random generator, so you can reproduce the results). And i'll add a feature to generate not sentences from words, but words from letters (like name generation). It is available at <a href="https://github.com/csarn/markov-text" rel="nofollow noopener" title="https://github.com/csarn/markov-text">https://github.com/csarn/ma...</a>.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-05-31T20:23:05Z'>Fri, 31 May 2013 20:23:05 UTC</time><div class='body'><p>This is a good idea. If all you're interested in is selecting a seed, you can easily seed Emacs PRNG by passing it a string.</p><p></p><pre>(progn<br>  (random "my seed")<br>  (markov-text-generate 10))<br></pre><p></p><p>On my 32-bit laptop running Emacs 24.3 I get this string: <br><code>"Cards, I glanced at Sola, who had already raised the skirts<br> of Mr. Jaggers's"</code></p></div></div></div></div></div><hr/><div class='thread'><h1 id='2012-09-14'><a href='/blog/2012/09/14/'>Fractal Rendering in Emacs</a></h1><div class='comment'><div class='author'>Davef</div><time datetime='2012-09-27T23:19:59Z'>Thu, 27 Sep 2012 23:19:59 UTC</time><div class='body'><p>cool</p></div></div><div class='comment'><div class='author'>Bojohan</div><time datetime='2012-09-28T17:29:16Z'>Fri, 28 Sep 2012 17:29:16 UTC</time><div class='body'><p>There's an "svg-clock" package in ELPA.<br></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2012-09-28T17:40:43Z'>Fri, 28 Sep 2012 17:40:43 UTC</time><div class='body'><p> Wow, that's great! Someone's already way ahead of me.</p></div></div></div><div class='comment'><div class='author'>bin</div><time datetime='2012-10-03T15:09:11Z'>Wed, 03 Oct 2012 15:09:11 UTC</time><div class='body'><p>awesome! </p></div></div><div class='comment'><div class='author'>emacsomancer</div><time datetime='2012-10-04T02:20:56Z'>Thu, 04 Oct 2012 02:20:56 UTC</time><div class='body'><p>I want Penrose tiles in Emacs.</p></div></div></div><hr/><div class='thread'><h1 id='2012-09-19'><a href='/blog/2012/09/19/'>Revisiting an N-body Simulator</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2012-09-20'><a href='/blog/2012/09/20/'>Elisp Recursive Descent Parser (rdp)</a></h1><div class='comment'><div class='author'>csar</div><time datetime='2012-09-28T21:41:07Z'>Fri, 28 Sep 2012 21:41:07 UTC</time><div class='body'><p>Wow nice work! I'm still a bit hesitant to implement a parser on my own, so i think i am going to use this :) Anyway, you can add another "fix typo" commit to the repo, in the comment of rdp.el you call the functions "rpd-parse" and "rpd-parse-string".<br></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2012-09-28T22:21:59Z'>Fri, 28 Sep 2012 22:21:59 UTC</time><div class='body'><p>Thanks, I just fixed the typos. I kept making that mistake. If you can show me I'd like to see what you make with it!</p></div><div class='comment'><div class='author'>csar</div><time datetime='2012-10-01T16:52:28Z'>Mon, 01 Oct 2012 16:52:28 UTC</time><div class='body'><p> I'm writing a program to simplify logical expressions. I started in common lisp, but hopefully it will be easy to port to elisp. So far i have the simplification part, which needs a lot of refactoring before i can show any of it in the public. But it should be able to parse those expressions out of strings, thats where your rdp might help.</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2012-09-21'><a href='/blog/2012/09/21/'>Programs as Elisp Macros</a></h1><div class='comment'><div class='author'>jonnay</div><time datetime='2016-09-13T12:48:33Z'>Tue, 13 Sep 2016 12:48:33 UTC</time><div class='body'><p>This is super cool!   What about syntax like (git :checkout branch) or (ls :-l file)?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-09-13T22:36:13Z'>Tue, 13 Sep 2016 22:36:13 UTC</time><div class='body'><p>Yeah, keywords would make for a good API. However, if you want an argument that starts with a colon, you need some way to express it. For example, deleting remote branches with Git requires an argument starting with a colon.</p></div></div></div><div class='comment'><div class='author'>Klaus</div><time datetime='2018-04-05T11:20:52Z'>Thu, 05 Apr 2018 11:20:52 UTC</time><div class='body'><p>Somewhat offtopic: <br>The definition of make-shell-macro is a nice example of why I find the default indentation rules abhorrent...</p><p>Any idea how that can be improved? Using `-*- lisp-indent-offset:2 -*-' works out of the box, but it again results in unfavorable situations such as weird indentation of `let' bindings.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-04-06T15:49:49Z'>Fri, 06 Apr 2018 15:49:49 UTC</time><div class='body'><p>Yeah, it moves towards the right pretty quickly. Sorry, I don't know a good way to deal with this other than to restructure the code to avoid it. I've certainly restructured functions just to work around indentation issues, and if I were to rewrite make-shell-macro today (i.e. 6 years later), I'd structure it differently for this reason.</p><p>An especially annoying case is call-process-shell-command. When indenting arguments, the next level of indentation is based on the length of the function name, so long function names exacerbate the issue. On top of that, this function's arguments also tend to be long, and so I always seem to run out out horizontal space.</p><p>But the most annoying at all is the behavior of square brackets (vectors) with emacs-lisp-mode's indentation. These indent like lists of code (e.g. function calls, etc.), but vectors (should) only hold data, not code, so this is inappropriate. It makes formatting s-expression data structures containing vectors annoying.</p></div></div></div></div><hr/><div class='thread'><h1 id='2012-09-28'><a href='/blog/2012/09/28/'>Emacs Abnormal Termination</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2012-09-29'><a href='/blog/2012/09/29/'>Emacs visual-indentation-mode</a></h1><div class='comment'><div class='author'>Ahmed Fasih</div><time datetime='2013-05-03T13:05:36Z'>Fri, 03 May 2013 13:05:36 UTC</time><div class='body'><p>Huge noob question (sorry). I cloned your .emacs.d repo and then added your visual-indentation-mode as a submodule into it. I see that ~/.emacs.d/visual-indentation-mode is in my emacs load-path, and visual-indentation-mode shows up and is correctly identified via M-x locate-library, but as I type "M-x visual-indentation-mode" emacs says "[No match]" and can't find it unless I explicitly load-file its .el file. Is this a subtle git issue or a not-so-subtle emacs issue? Many thanks for this and the excellent .emacs.d repo, I'm enjoying both.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-05-03T18:17:50Z'>Fri, 03 May 2013 18:17:50 UTC</time><div class='body'><p>Yeah, this is one of the confusing things beginners have to overcome once they start manually configuring packages. The behavior you desire is called autoloading.</p><p>The load-path is where <code>require</code> looks when asked to load a package. Being in the load-path by itself is not enough to make a file's functions available. It still needs to actually be loaded.</p><p>At this point you have a couple of options. One is to simply have your configuration load the package at startup. You'd add this to init.el.</p><p></p><pre>(require 'visual-indentation-mode)<br></pre><p></p><p>Or, if you're concerned with keeping the Emacs start time minimal, set up an autoload. Nothing is actually loaded until you attempt to enable visual-indentation-mode.</p><p></p><pre>(autoload 'visual-indentation-mode "visual-indentation-mode" nil t)<br></pre><p></p><p>When you install a package through <code>package</code> and ELPA, an autoloads file is set up and loaded automatically. If visual-indentation-mode was installed this way, you wouldn't have to do either of the above. You can manually create an autoloads file (just once),</p><p></p><pre>(package-generate-autoloads<br> "visual-indentation-mode" "~/.emacs.d/visual-indentation-mode/")<br></pre><p></p><p>But in order to use it you would need to load the autoloads file yourself anyway, so there's not much advantage to doing this -- at least not for this particular package.</p><p></p><pre>(require 'visual-indentation-mode-autoloads)<br></pre><p></p><p>I hope that helps.</p></div></div></div></div><hr/><div class='thread'><h1 id='2012-10-15'><a href='/blog/2012/10/15/'>Debian Bugtracker Data</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2012-10-31'><a href='/blog/2012/10/31/'>Skewer: Emacs Live Browser Interaction</a></h1><div class='comment'><div class='author'>Marco Paolo Valerio Vezzoli</div><time datetime='2012-11-02T06:20:34Z'>Fri, 02 Nov 2012 06:20:34 UTC</time><div class='body'><p>truly awesome!<br>Next time I have to develop something with a web interface I will check it!</p></div></div><div class='comment'><div class='author'>boothead</div><time datetime='2013-02-05T13:36:55Z'>Tue, 05 Feb 2013 13:36:55 UTC</time><div class='body'><p>Would there be an easy way to hook this up over a WebSocket?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-02-05T15:12:41Z'>Tue, 05 Feb 2013 15:12:41 UTC</time><div class='body'><p>WebSockets are a possible future for skewer-mode. Someone's <a href="https://github.com/ahyatt/emacs-websocket" rel="nofollow noopener" title="https://github.com/ahyatt/emacs-websocket">already written a library for it</a> so half the work is done. Personally I'm still waiting for the dust to settle before I rely on WebSockets for anything: better browser and proxy support. Right now skewer-mode works with any browser that supports XHR, and I'm unaware of a browser that supports JavaScript but not XHR.</p><p>Since skewer-mode is really only intended for local use, the overhead from the XHR long polls are negligible. There doesn't seem to be any advantage for WebSockets in this case.</p><p></p></div><div class='comment'><div class='author'>boothead</div><time datetime='2013-02-05T15:34:18Z'>Tue, 05 Feb 2013 15:34:18 UTC</time><div class='body'><p>I was thinking of the ability to do bi-directional stuff, but long polling fills this requirement too I guess.</p><p>BTW, how do you actually use skewer? I looked at your boids example, but I couldn't see where the skewer.js is being included or the connection to emacs being opened?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-02-05T15:56:40Z'>Tue, 05 Feb 2013 15:56:40 UTC</time><div class='body'><p>Skewer is a servlet for one of my other Emacs packages: <a href="https://github.com/skeeto/emacs-http-server" rel="nofollow noopener" title="https://github.com/skeeto/emacs-http-server">simple-httpd</a>. That takes care of all of the network connections for Skewer.</p><p>None of Skewer's files are served directly. The file skewer.js is served by the servlet installed at <code>/skewer</code>. There's a hook for injecting extra code in here, for use by extensions to Skewer, so the file isn't necessarily served literally. The file example.html is served by <code>/skewer/demo</code>, which will automatically be visited by <code>M-x run-skewer</code>.</p><p>The boids repository doesn't actually pull in Skewer on its own. You'll need to either add the script tag yourself or use the userscript to inject it.<br></p></div><div class='comment'><div class='author'>quasi</div><time datetime='2014-01-02T09:50:53Z'>Thu, 02 Jan 2014 09:50:53 UTC</time><div class='body'><p>could you elaborate ? Or simply, could you possibly have a small tutorial on using skewer on your own files (or setting up of the boids demo). I could not really understand how to use it  except the REPL.</p></div><div class='comment'><div class='author'>quasi</div><time datetime='2014-01-02T10:29:58Z'>Thu, 02 Jan 2014 10:29:58 UTC</time><div class='body'><p>never mind :) got it. I had to mount the web root of the httpd server and lo behold I was done. haha. thanks for this awesome thing. SLIME is the best and I shall miss it less with this mode.</p></div></div></div></div></div></div></div><div class='comment'><div class='author'>VincentToups</div><time datetime='2013-02-06T13:55:13Z'>Wed, 06 Feb 2013 13:55:13 UTC</time><div class='body'><p>Sweet!  I'm going to use this to enable interactive development with Gazelle! (<a href="https://github.com/VincentToups/gazelle)" rel="nofollow noopener" title="https://github.com/VincentToups/gazelle)">https://github.com/VincentT...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-02-06T15:19:45Z'>Wed, 06 Feb 2013 15:19:45 UTC</time><div class='body'><p>Definitely interested in seeing this. I found out about Gazelle when you posted it in r/lisp in December. I thought it would be really quick to hook up to Skewer, but I only saw functions for compiling files, nothing for compiling from strings or s-expressions.</p><p>Note: Disqus included the closing paren on your link, so it's broken.<br></p></div></div></div><div class='comment'><div class='author'>jasonm23github</div><time datetime='2013-03-13T22:19:56Z'>Wed, 13 Mar 2013 22:19:56 UTC</time><div class='body'><p>Great work Christopher,  just one point, the httpd processes aren't linked to buffers, (closing *httpd* (or is it *http*)) doesn't affect the process, same goes for skewer-repl. </p><p>Seems like a stupid question, but how do we quit?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-03-14T00:02:09Z'>Thu, 14 Mar 2013 00:02:09 UTC</time><div class='body'><p>Good idea. Perhaps I should associate the server process with the <code>*httpd*</code> buffer. Right now you can stop the server with <code>M-x httpd-stop</code>, being the opposite of <code>httpd-start</code>.</p><p>There is no single process for skewer-repl to be associated with. That buffer is just a receiver of messages from various short-lived TCP connection processes. Because of long-polling and HTTP keep-alive, even after shutting down simple-httpd you may have lingering access to the browser with skewer until that particular TCP connection dies. You won't be able to connect any new pages to Emacs with the server down.<br></p></div><div class='comment'><div class='author'>jasonm23github</div><time datetime='2013-03-14T00:10:39Z'>Thu, 14 Mar 2013 00:10:39 UTC</time><div class='body'><p>Oh, when I did M-x list-processes  skewer-repl shows as  an orphan (buffer-less) process. (the repl buffer was already killed)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-03-14T00:20:01Z'>Thu, 14 Mar 2013 00:20:01 UTC</time><div class='body'><p>That's a consequence of building on top of comint-mode. It requires <i>some</i> process to exist, so I create a dummy pty process for that task. IELM does the same thing, but it uses hexl.</p><p>However, it looks like skewer-repl doesn't properly clean up when the buffer is killed. I'll have to investigate that. Thanks!<br></p></div><div class='comment'><div class='author'>jasonm23github</div><time datetime='2013-03-14T00:20:47Z'>Thu, 14 Mar 2013 00:20:47 UTC</time><div class='body'><p>cheers, hth</p></div></div></div></div></div></div><div class='comment'><div class='author'>Piotr Pałek</div><time datetime='2013-03-31T17:17:30Z'>Sun, 31 Mar 2013 17:17:30 UTC</time><div class='body'><p>Hey, maybe i'm a little late with my comment, but do you think it would be possible to develop ExtJs apps with skewer? I mean something like change a panel and only reload the code necessary, so you don't have to reload the whole page to see the changes. Would probably need a lot of integration with the framework's code huh?<br>ps. I also was thinking about developing for ExtJS but with the new MVC model</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-03-31T19:07:53Z'>Sun, 31 Mar 2013 19:07:53 UTC</time><div class='body'><p>As far as I know, ExtJs can do AJAX just the same, so it should work fine with Skewer. See the CORS/bookmarlet section of the Skewer README. You just need to add a script element with a src pointing to Emacs.</p></div></div></div><div class='comment'><div class='author'>Murph</div><time datetime='2013-06-26T13:22:04Z'>Wed, 26 Jun 2013 13:22:04 UTC</time><div class='body'><p>Is there some reason that skewer-mode wouldn't work with Emacs 24.3.1? When I do M-x package-install ENTER skewer-mode, I only get the following output to the minibuffer: Package `emacs-24.1'  is unavailable.</p><p>I put an issue on the Github page as well, in case this is better dealt with there.</p></div></div><div class='comment'><div class='author'>shevchuk</div><time datetime='2014-04-07T08:09:49Z'>Mon, 07 Apr 2014 08:09:49 UTC</time><div class='body'><p>Does skewer-repl support popping previous / next inputs (like slime-repl-previous-input) ?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-04-07T15:08:50Z'>Mon, 07 Apr 2014 15:08:50 UTC</time><div class='body'><p>Yes, skewer-repl is derived from comint, so just use the comint commands (comint-previous-input, comint-next-input, etc). I've mapped these to the arrow keys in my config for all comint modes.</p></div><div class='comment'><div class='author'>shevchuk</div><time datetime='2014-04-07T15:22:40Z'>Mon, 07 Apr 2014 15:22:40 UTC</time><div class='body'><p>great, thanks a lot!</p></div></div></div></div><div class='comment'><div class='author'>shevchuk</div><time datetime='2014-04-07T15:22:56Z'>Mon, 07 Apr 2014 15:22:56 UTC</time><div class='body'><p>Is there any chance to see an auto-complete in skewer repl ?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-04-07T15:42:21Z'>Mon, 07 Apr 2014 15:42:21 UTC</time><div class='body'><p>The closest thing Skewer has to autocomplete is ScottyB's ac-js2, but it doesn't work in the REPL. The main obstacle for this is probably the "js&gt;" prompt. js2-mode wants to parse the entire buffer as JavaScript, but those prompts get in the way. The easiest thing to do would probably be to change this to some sort of valid JS, but since this isn't an itch for me, I haven't spent any time looking into it.</p></div></div></div></div><hr/><div class='thread'><h1 id='2012-11-14'><a href='/blog/2012/11/14/'>JavaScript&#39;s Quirky eval</a></h1><div class='comment'><div class='author'>anonymous</div><time datetime='2012-11-20T19:28:29Z'>Tue, 20 Nov 2012 19:28:29 UTC</time><div class='body'><p>The perl example isn't properly quoted. If you escape the dollar, bar is set to 5 as expected.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2012-11-20T19:53:20Z'>Tue, 20 Nov 2012 19:53:20 UTC</time><div class='body'><p>You're right! It's been a couple of years since I've touched Perl so I completely forgot about string interpolation. This behavior makes a lot more sense. I just fixed the post. Thanks!</p></div><div class='comment'><div class='author'>anonymous</div><time datetime='2012-11-21T18:39:41Z'>Wed, 21 Nov 2012 18:39:41 UTC</time><div class='body'><p>Sorry, that's not what I meant...</p><p>sub foo {    my $bar = 10;    eval "\$bar = 5";    return "$bar";}print foo();</p><p>That prints 5 for me. So from my understanding (I didn't read the perl docs), eval *does* allow me to set (albeit not declare) variables...</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2012-11-15'><a href='/blog/2012/11/15/'>JavaScript Strings as Arrays</a></h1><div class='comment'><div class='author'>Gavin Black</div><time datetime='2012-11-16T16:48:06Z'>Fri, 16 Nov 2012 16:48:06 UTC</time><div class='body'><p>You'd love typeclasses then :) All the generalization, without crossing your fingers that a function doesn't do anything that ruins it.  </p></div></div><div class='comment'><div class='author'>Luke</div><time datetime='2012-11-25T02:28:46Z'>Sun, 25 Nov 2012 02:28:46 UTC</time><div class='body'><p>Heh, I was about to say you could "inject" these methods into the String prototype, but yes - it is something that will make future maintainers cranky. :)<br> </p></div></div></div><hr/><div class='thread'><h1 id='2012-11-19'><a href='/blog/2012/11/19/'>JavaScript Debugging Challenge</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2012-11-20'><a href='/blog/2012/11/20/'>Raising the Dead with JavaScript</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2012-11-28'><a href='/blog/2012/11/28/'>JavaScript Truthiness Quiz</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2012-12-06'><a href='/blog/2012/12/06/'>A Use For Macrolet</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2012-12-17'><a href='/blog/2012/12/17/'>Elisp Weak References</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2012-12-18'><a href='/blog/2012/12/18/'>How a simple-httpd Vulnerability Slipped In</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2012-12-29'><a href='/blog/2012/12/29/'>An Emacs Pastebin</a></h1><div class='comment'><div class='author'>Lorenz</div><time datetime='2012-12-30T12:53:26Z'>Sun, 30 Dec 2012 12:53:26 UTC</time><div class='body'><p>Cool</p></div></div><div class='comment'><div class='author'>Luke</div><time datetime='2012-12-30T21:23:19Z'>Sun, 30 Dec 2012 21:23:19 UTC</time><div class='body'><p>Thanks for the link. The series ain't over yet though. There are at least two more parts to it. I just took a break as not to inundate people with PHP. :)</p><p>Btw, I never cease to be amazed at the flexibility of Emacs. I think Steve Yegge once described it as an ELisp interpreter which coincidentally also happens to be pretty good at editing text. :P</p></div></div></div><hr/><div class='thread'><h1 id='2013-01-02'><a href='/blog/2013/01/02/'></a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2013-01-07'><a href='/blog/2013/01/07/'>Clojure and Emacs for Lispers</a></h1><div class='comment'><div class='author'>Lorenz</div><time datetime='2013-01-08T21:11:44Z'>Tue, 08 Jan 2013 21:11:44 UTC</time><div class='body'><p>Thanks</p></div></div><div class='comment'><div class='author'>Ahmed Fasih</div><time datetime='2013-05-05T22:10:56Z'>Sun, 05 May 2013 22:10:56 UTC</time><div class='body'><p>Christopher, when I open a .clj file with your current .emacs.d (from Github), its parens and brackets are all white, until I do "M-x clojure-mode", i.e.,  paren-face seems to not recolor parens and brackets upon clojure-mode first initializing. This doesn't seem to be an issue with elisp files---their parens are grayed out as soon as they open.</p><p>(PS. Thanks for the autoload tip!)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-05-06T02:43:36Z'>Mon, 06 May 2013 02:43:36 UTC</time><div class='body'><p>That's just a small parenface bug. The first time the mode runs, parenface adds the new highlighting rules to the mode's syntax table. Emacs unfortunately doesn't make use of the new rules until the next time the mode is activated. It hasn't bothered me enough to invest time in fixing it. I run Emacs for weeks at a time (--daemon), so it's a fairly rare annoyance.</p></div></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-05-16T22:51:38Z'>Thu, 16 May 2013 22:51:38 UTC</time><div class='body'><p>Ahmed, could you e-mail me at my home e-mail address? I just realized I don't have your home e-mail address and I have something to show you.</p></div></div></div></div><hr/><div class='thread'><h1 id='2013-01-13'><a href='/blog/2013/01/13/'>Flu Trends Timeline</a></h1><div class='comment'><div class='author'>Guitreize</div><time datetime='2013-01-14T08:55:19Z'>Mon, 14 Jan 2013 08:55:19 UTC</time><div class='body'><p>Could you explain what colors mean what?<br>Because as far as I'm concerned, I could be looking at a US map colored at random.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-01-14T13:24:52Z'>Mon, 14 Jan 2013 13:24:52 UTC</time><div class='body'><p>As far as I can tell, the exact meaning of trend numbers are a secret that Google holds closely. It's some normalized count of queries on the flu. So take the coloring as relative to other states and dates. Also, note that the color is scaled by logarithm of the raw data.</p><p>For example, for last week the value for NY, a state of 20 million people, was 12k. If that's the number of total flu queries it seems like a low-ish number, but maybe not. That's an entire order of magnitude more queries than one year ago. Strangely, 11k of those were from NYC itself, so its as if the rest of the state barely uses Google.<br></p></div></div></div></div><hr/><div class='thread'><h1 id='2013-01-14'><a href='/blog/2013/01/14/'>Turning Asynchronous into Synchronous in Elisp</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2013-01-20'><a href='/blog/2013/01/20/'>Parameter Lists in Common Lisp and Clojure</a></h1><div class='comment'><div class='author'>Foo</div><time datetime='2013-01-23T10:48:38Z'>Wed, 23 Jan 2013 10:48:38 UTC</time><div class='body'><p>(defn make-name<br>  ([first last]<br>     {:first first, :last last})<br>  ([[first] [last]]<br>     {:first first, :last last}))</p><p>Above already fails. The patterns are different, but we are not allowed to use the same arity. Huh? </p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-01-23T13:02:09Z'>Wed, 23 Jan 2013 13:02:09 UTC</time><div class='body'><p>Yup, overloading is by arity only, not by pattern. When I was first learning Clojure I had hoped I could do this, too. It would be neat to dispatch Haskell-style, like <code>x:xs</code>. I can understand why this sort of thing isn't provided so it doesn't bother me.<br></p></div></div><div class='comment'><div class='author'>Gonzih</div><time datetime='2013-09-09T17:32:01Z'>Mon, 09 Sep 2013 17:32:01 UTC</time><div class='body'><p>It's not pattern matching, it is destructuring. Overloading is done by arity only. If you looking for pattern matching - core.match.</p></div></div></div><div class='comment'><div class='author'>Anders</div><time datetime='2014-09-01T19:37:28Z'>Mon, 01 Sep 2014 19:37:28 UTC</time><div class='body'><p>Hi, I'd be really grateful if you could explain the syntax of the height parameter in the sample that you gave:<br>(defn height-opinion [name &amp; {height :height}]</p><p>I don't understand how this function can be called like (height-opinion "Chris" :height 6.25). I would expect (height-opinion "Chris" {6.25 height}).</p></div><div class='comment'><div class='author'>Anders</div><time datetime='2014-09-01T19:40:56Z'>Mon, 01 Sep 2014 19:40:56 UTC</time><div class='body'><p>Sorry, (height-opinion "Chris" {6.25 :height}).</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-09-01T19:50:12Z'>Mon, 01 Sep 2014 19:50:12 UTC</time><div class='body'><p>The ampersand in the parameter list says to treat all of the remaining arguments as "rest" arguments, to be passed to the function as a collection. In this case that collection will be a map, but normally it will be a sequence of some sort. The parameter that accepts the "rest" arguments is a map destructuring bind specification, which will disassemble the "rest" collection as though it was map.</p></div></div></div></div><div class='comment'><div class='author'>z0ltan</div><time datetime='2016-06-27T05:15:26Z'>Mon, 27 Jun 2016 05:15:26 UTC</time><div class='body'><p>Short and sweet. Well done, my good man!</p></div></div></div><hr/><div class='thread'><h1 id='2013-01-22'><a href='/blog/2013/01/22/'>The Limits of Emacs Advice</a></h1><div class='comment'><div class='author'>Hero Workshipper</div><time datetime='2013-01-23T12:20:37Z'>Wed, 23 Jan 2013 12:20:37 UTC</time><div class='body'><p>"I'll figure something out."</p><p>So brave! A real hero!<br></p></div></div><div class='comment'><div class='author'>Jason Aeschliman</div><time datetime='2013-01-23T16:45:44Z'>Wed, 23 Jan 2013 16:45:44 UTC</time><div class='body'><p>use an idle-timer</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-01-25T21:32:59Z'>Fri, 25 Jan 2013 21:32:59 UTC</time><div class='body'><p>Yeah, that's another possibility but it's kind of messy. I need to worry about cleaning up the timer when the buffer is killed and it would need to poll frequently in order to be useful. I prefer to avoid polling when I can.</p></div></div></div><div class='comment'><div class='author'>yuriko</div><time datetime='2014-10-22T11:26:09Z'>Wed, 22 Oct 2014 11:26:09 UTC</time><div class='body'><p>it does help me</p></div></div><div class='comment'><div class='author'>yuriko</div><time datetime='2014-10-22T11:32:47Z'>Wed, 22 Oct 2014 11:32:47 UTC</time><div class='body'><p>could you teach me more about other types of advice, such as around advice? or introduce a little more about advice system please?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-10-22T18:36:11Z'>Wed, 22 Oct 2014 18:36:11 UTC</time><div class='body'><p>The "Advising Emacs Lisp Functions" section of the Emacs Lisp Reference Manual covers most of what there is to know about advice. The manual comes with Emacs (M-x info). It explains how advice works and provides examples to get you started. Note that, as of this week with the release of Emacs 24.4, the defadvice macro is considered nearly obsolete, replaced by the very similar advice-add function.</p></div></div></div><div class='comment'><div class='author'>PythonNut</div><time datetime='2016-03-09T21:09:38Z'>Wed, 09 Mar 2016 21:09:38 UTC</time><div class='body'><p>What about the atomic sledgehammer known as post-command-hook?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-03-14T19:57:05Z'>Mon, 14 Mar 2016 19:57:05 UTC</time><div class='body'><p>I don't remember if I tried it at the time, but it looks like post-command-hook isn't invoked by narrow-to-region or widen.</p></div></div></div></div><hr/><div class='thread'><h1 id='2013-01-24'><a href='/blog/2013/01/24/'>Live CSS Interaction with Skewer</a></h1><div class='comment'><div class='author'>top essay writing services</div><time datetime='2017-02-13T08:34:30Z'>Mon, 13 Feb 2017 08:34:30 UTC</time><div class='body'><p>Learning the advanced methods of computer programs with the use of the CSS is really useful to us web developers. This helps us to do different platforms in computers that make our designs to be more responsive when it comes to computer designs and coding.</p></div></div></div><hr/><div class='thread'><h1 id='2013-01-26'><a href='/blog/2013/01/26/'>Web Distributed Computing Revisited</a></h1><div class='comment'><div class='author'>Gavin Black</div><time datetime='2013-01-31T16:40:46Z'>Thu, 31 Jan 2013 16:40:46 UTC</time><div class='body'><p>Very cool, I remember doing those initial setTimeout experiments and how lackluster they were. Now we can have purely browser based botnets ;)</p></div></div><div class='comment'><div class='author'>Ahmed Fasih</div><time datetime='2013-02-06T15:16:50Z'>Wed, 06 Feb 2013 15:16:50 UTC</time><div class='body'><p>This is a really neat use of browsers, but did you tag this as 'emacs' because you attached the V8 engine to emacs?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-02-06T15:29:51Z'>Wed, 06 Feb 2013 15:29:51 UTC</time><div class='body'><p>Oops, well at least this tells me people really do pay attention to tags! I added those tags before I started writing the post, and I was originally intending to compare and contrast with <a href="http://nullprogram.com/blog/2010/08/07/" rel="nofollow noopener" title="http://nullprogram.com/blog/2010/08/07/">this old Emacs post</a> in addition to the other JavaScript post. Thanks, I just removed the "emacs" tag.<br></p></div><div class='comment'><div class='author'>Ahmed Fasih</div><time datetime='2013-02-07T15:48:00Z'>Thu, 07 Feb 2013 15:48:00 UTC</time><div class='body'><p>I came looking for ars emacsica but your enthusiasm for Javascript, so generous in this post, is infectious. Thank you!</p></div></div></div></div><div class='comment'><div class='author'>Ahmed Fasih</div><time datetime='2013-02-20T15:43:37Z'>Wed, 20 Feb 2013 15:43:37 UTC</time><div class='body'><p>Could someone have undermined you by editing the Javascript before running it to send back false results (either obviously false or subtly incorrect)?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-02-21T12:54:07Z'>Thu, 21 Feb 2013 12:54:07 UTC</time><div class='body'><p>That's a general concern for this type of system, but it wasn't a problem here. When the client found a higher-scoring key, it only reported the key itself, not evening bothering to report the score. Upon receiving a key, Emacs would check for validity (contains each letter of the alphabet exactly once), compute its score, and then decide what to do with it. So, conveniently, this problem was impossible to cheat this way.</p><p>In my last experiment this was an issue. I had clients doing primality tests and there was no way to verify any result without repeating the computation.</p><p></p></div></div></div><div class='comment'><div class='author'>Ciurmy</div><time datetime='2015-12-07T11:27:41Z'>Mon, 07 Dec 2015 11:27:41 UTC</time><div class='body'><p>Hi, a solution to the problem has been implemented in the Ciurmy platform.</p><p>If you have interested about the JavaScript distributed computing, look at <a href="http://www.ciurmy.com" rel="nofollow noopener" title="www.ciurmy.com">www.ciurmy.com</a>, where the users can sell the computing power of your devices, using the browser for the calculation.<br>We are searching javascript coders for implementing algorithms in js language for the analysts and makers that need computing power.</p><p>Gianluca Conti</p></div></div><div class='comment'><div class='author'>Alex</div><time datetime='2016-11-07T20:43:11Z'>Mon, 07 Nov 2016 20:43:11 UTC</time><div class='body'><p>There is one project where everyone can participate to make a one step to Unified Field Theory, which Einstein tried to find.<br><a href="https://zlelik.blogspot.com/2016/11/unified-field-theory-with-javascript-distributed-computing-or-gravity-electromagnetism-relation.html" rel="nofollow noopener" title="https://zlelik.blogspot.com/2016/11/unified-field-theory-with-javascript-distributed-computing-or-gravity-electromagnetism-relation.html">https://zlelik.blogspot.com...</a></p></div></div></div><hr/><div class='thread'><h1 id='2013-01-30'><a href='/blog/2013/01/30/'>Emacs Javadoc Lookups Get a Facelift</a></h1><div class='comment'><div class='author'>Brian</div><time datetime='2013-02-02T21:51:07Z'>Sat, 02 Feb 2013 21:51:07 UTC</time><div class='body'><p>Nice work. This really makes Javadoc way more accessible from Emacs. </p></div></div></div><hr/><div class='thread'><h1 id='2013-02-06'><a href='/blog/2013/02/06/'>How to Make an Emacs Minor Mode</a></h1><div class='comment'><div class='author'>Dan Doherty</div><time datetime='2013-03-25T17:30:12Z'>Mon, 25 Mar 2013 17:30:12 UTC</time><div class='body'><p>Christopher,</p><p>Thanks for this nicely done tutorial.  Just what I needed.  Nice formatting too.</p><p>Regards,</p></div></div><div class='comment'><div class='author'>psachin</div><time datetime='2013-10-15T11:34:06Z'>Tue, 15 Oct 2013 11:34:06 UTC</time><div class='body'><p>Hi Christopher,</p><p>Indeed a nice tutorial which I got to read when I needed it. I wrote a network status elisp code which appends up/down arrow in the mode line depending on network connection. You can browse my code at <a href="https://github.com/psachin/network-status" rel="nofollow noopener" title="https://github.com/psachin/network-status">https://github.com/psachin/...</a>. I want to make this feature as a minor mode. My code uses 'make-network-process' to check the network connection and every time I have to kill the process so that it there won't be any queue of processes. Now my question is how can I kill the process if the mode is disabled(toggled)?. So far it just removes the ':lighter' string from the mode line but does not stops the process. Any pointer will be of great help.</p><p>Thanx.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-10-15T23:26:05Z'>Tue, 15 Oct 2013 23:26:05 UTC</time><div class='body'><p>The body of your minor mode definition is run both when the mode is toggled on and off. In that body you want to check if your mode is being disabled: the variable of the same name as the mode with be nil. If so, kill the network process at that time. If it's being enabled, this is where you start the network process.</p><p>I'm guessing you're intending this to be a global minor mode rather than buffer local, so that's all you really need to worry about. If your mode was buffer local, you'd also want to put a cleanup function in the buffer local kill-buffer-hook. Minor modes are *not* toggled off before the buffer is killed (this was probably a design mistake), so you would need an action to perform cleanup. But, again, if it's a global mode then this step isn't needed.</p><p>If you're really worried about correctness, you'll also want to support unloading. You'll want to kill the network process if your feature is unloaded, probably using a _feature_-unload-function.<br> <a href="http://www.gnu.org/software/emacs/manual/html_node/elisp/Unloading.html" rel="nofollow noopener" title="http://www.gnu.org/software/emacs/manual/html_node/elisp/Unloading.html">http://www.gnu.org/software...</a> <br>Honestly, though, I don't think anyone really uses feature unloading, so I wouldn't worry about this detail unless it sounds interesting.</p></div><div class='comment'><div class='author'>psachin</div><time datetime='2013-10-17T18:34:11Z'>Thu, 17 Oct 2013 18:34:11 UTC</time><div class='body'><p>I was able to implement my script in to a minor mode.</p><p>Thanx Christopher.</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2013-02-07'><a href='/blog/2013/02/07/'>JavaScript &#34;Map With This&#34;</a></h1><div class='comment'><div class='author'>mgsk</div><time datetime='2013-02-08T08:11:45Z'>Fri, 08 Feb 2013 08:11:45 UTC</time><div class='body'><p>"However, I sometimes find myself wishing there was a map-like function that used the element as the context of the function. Then I could apply a method to each of the elements in the array rather than be limited to functions."</p><p>Could you clarify this? What do you mean by context?<br> </p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-02-08T21:42:17Z'>Fri, 08 Feb 2013 21:42:17 UTC</time><div class='body'><p>When a JavaScript function is invoked, all of its <i>explicit</i> parameters are bound to values (the provided arguments) and then the function's body is evaluated. There's also an <i>implicit</i> parameter, <code>this</code>, sometimes called the <i>context</i> of the function. Under normal function invocation, the context is the global object (<code>window</code>) or <code>undefined</code> (in strict mode). When a function is called as a method -- that is, it's called as the property of an object -- it is automatically bound to that object during the evaluation of the function's body. This happens even for "static" methods like <code>JSON.parse()</code> because JavaScript is a prototype-based language.</p><p>The first argument to the Function methods <code>call()</code> and <code>apply()</code> are the context to use for that function call. This context can be locked in for a function permanently, no matter how the function is called, using the <code>bind()</code> method.</p><p></p><pre>function foo(x) { return this + x; }<br>foo.call(10, 2);  // =&gt; 12<br>var bar = foo.bind(4);<br>bar(2);  // =&gt; 6<br></pre><p></p><p>What I was saying was that I wanted a map method that bound <code>this</code> to each element rather than the first explicit parameter.</p></div></div></div></div><hr/><div class='thread'><h1 id='2013-02-08'><a href='/blog/2013/02/08/'>Memory Leaks with XMLHttpRequest Objects</a></h1><div class='comment'><div class='author'>Brian</div><time datetime='2013-02-09T16:20:06Z'>Sat, 09 Feb 2013 16:20:06 UTC</time><div class='body'><p>Great explanation. Thanks for doing this. Now I have somewhere to send people when this question comes up!</p></div></div><div class='comment'><div class='author'>Ben</div><time datetime='2013-02-19T21:20:09Z'>Tue, 19 Feb 2013 21:20:09 UTC</time><div class='body'><p>This post is very speculative. I can't get this to show ... at least in Chrome.  Theoretically, if what you're saying is true, I should be able to go into the developer console and enter this: </p><p>(function () { for(var i = 1000000; i--;) { new XMLHttpRequest(); } })();</p><p>And see my memory footprint spike and well... stay spiked.  It goes up, for just about as long as the function takes to execute.</p><p>I think what you're saying *might* be true, but only on a browser per browser basis... and so far I haven't seen anything non-anecdotal supporting your theory.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-02-19T21:49:02Z'>Tue, 19 Feb 2013 21:49:02 UTC</time><div class='body'><p>Yeah, instead of actually digging into browser source code I'm speculating and treating it like a black box. It's lazy but a lot more fun. :-) I was able to demonstrate the XHR specialty, so it proved to be useful anyway.</p><p>The memory spike itself is the artifact I was demonstrating. Substitute a different type, like my Point prototype above, and you won't see any spike in Chrome. The heap never needs to grow like it does with the long-living XHRs. I almost crashed my computer again just trying to double-check this with XHRs.<br></p></div></div></div><div class='comment'><div class='author'>Roland</div><time datetime='2013-02-19T22:13:04Z'>Tue, 19 Feb 2013 22:13:04 UTC</time><div class='body'><p>I believe that if you remove the load event handler or delete xhr.onload just after calling the callback you'll allow everything to be garbage collected. This will allow the garbage collector to remove the event handler function thus allowing it to clean up the xhr reference.</p></div></div><div class='comment'><div class='author'>Greg Reimer</div><time datetime='2013-02-20T04:36:04Z'>Wed, 20 Feb 2013 04:36:04 UTC</time><div class='body'><p>Couldn't it be that `xhr.onload` is a setter, and the function assigned to it is simply stored in some asynchronous queue, thus preventing GC since it can reach `xhr`? As a trivial example:<br>function Foo(){<br>    this.__defineSetter__('onload', function(f){<br>        setTimeout(f, 1000);<br>    });<br>}</p><p>(function(){<br>    x = new Foo();<br>    x.onload = function(){...}<br>})();</p><p>// x still lives!!</p></div></div><div class='comment'><div class='author'>king</div><time datetime='2014-09-04T02:56:42Z'>Thu, 04 Sep 2014 02:56:42 UTC</time><div class='body'><p>Great!思路不错</p></div></div><div class='comment'><div class='author'>Timothy</div><time datetime='2014-10-25T09:55:35Z'>Sat, 25 Oct 2014 09:55:35 UTC</time><div class='body'><p>Finally someone can explain this bug. But I'd love to see a more detailed explanation of your pooling solution.</p></div></div><div class='comment'><div class='author'>Ross</div><time datetime='2014-10-30T17:28:36Z'>Thu, 30 Oct 2014 17:28:36 UTC</time><div class='body'><p>Is the memory leak on this page intentional? :)</p></div></div><div class='comment'><div class='author'>Barney Carroll</div><time datetime='2015-01-09T18:51:18Z'>Fri, 09 Jan 2015 18:51:18 UTC</time><div class='body'><p>Fantastic insights. This only became a problem for me recently when we did a lot of work on caching for huge time series databases. Despite far-future expiry cache control headers and a UI which otherwise did its best to destroy obsolete references, I noticed (thanks again, chrome dev tools) *colossal* garbage collection operations on XHR invocation – and even then memory usage continues to grow until the process dies. The network tab confirms that no new requests are being made.</p><p>So do you think this is something XHR API wrappers should take care of? I'm wondering if judicious memoization could work… The only way of doing it right would be to effectively replicate the browser's internal logic as to cache control headers, which is not a task I particularly relish… But this problem is critical, so even this conceptually ugly chore might be worth considering.</p></div></div><div class='comment'><div class='author'>Bugsy</div><time datetime='2015-07-14T10:33:42Z'>Tue, 14 Jul 2015 10:33:42 UTC</time><div class='body'><p>So what you are suggesting is keeping a say, array of already used XHR objects, and when a new request is to be made, use one of those existing objects instead of creating a new one?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-07-14T12:47:54Z'>Tue, 14 Jul 2015 12:47:54 UTC</time><div class='body'><p>Basically yes, or use a library that does this for you. However, this issue is becoming less and less relevant as older browsers are gradually phased out, so it may not be worth the trouble in new applications. (Example: IE7 doesn't work for the biggest parts of the Internet anymore, so there's no reason to bother supporting it and all its bugs.)</p></div><div class='comment'><div class='author'>Srinu</div><time datetime='2015-08-21T09:23:53Z'>Fri, 21 Aug 2015 09:23:53 UTC</time><div class='body'><p>Looks like this issue is still there in the modern browsers like IE 10 &amp; 11. We are encountering a memory leak in both of these browsers, not in chrome and firefox. The memory snapshots (IE) do not show any memory leaks but the IE process memory simply increases and eventually  it crashes after 3 to 4 times of ajax calls.</p></div><div class='comment'><div class='author'>Hervé Stern</div><time datetime='2016-02-13T07:52:41Z'>Sat, 13 Feb 2016 07:52:41 UTC</time><div class='body'><p>I am facing the same problem.<br>Did you find any workarounds?<br>Thx</p></div></div></div></div><div class='comment'><div class='author'>Barney Carroll</div><time datetime='2015-07-19T15:27:50Z'>Sun, 19 Jul 2015 15:27:50 UTC</time><div class='body'><p>I encountered this problem when making dozens of XHR requests synchronously. The most modern browsers would intermittently freeze as sudden spikes occurred. The solution that worked for me was to wrap my XHR calls in a function which took count of the number of currently active requests. When that number exceeded 50, I would return a promise, and only bind that promise to a new XHR request once the concurrent requests had diminished (running a check whenever a request resolved ).</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-07-19T15:34:35Z'>Sun, 19 Jul 2015 15:34:35 UTC</time><div class='body'><p>Were you making this requests to different domains? By default, browsers will limit the number of parallel connections per server to between 2 and 8 (the HTTP/1.1 spec explicitly says 2; adjustable in Firefox in about:config; and hardcoded to 6 in Chrome). After that limit they *should* get queued internally and even pipelined within individual HTTP/1.1 connections. If yours were all to the same domain and the browser was still choking, then I guess that's more evidence that XHR is a weird object!</p></div><div class='comment'><div class='author'>Barney Carroll</div><time datetime='2015-07-19T15:51:47Z'>Sun, 19 Jul 2015 15:51:47 UTC</time><div class='body'><p>No, all same domain. The HTTP throttling was happening under the hood, but simply initializing any significant number of XHR objects (and this is with latest Chrome &amp; Firefox) causes huge memory consumption.</p></div></div></div></div></div><div class='comment'><div class='author'>CM</div><time datetime='2016-04-23T23:53:05Z'>Sat, 23 Apr 2016 23:53:05 UTC</time><div class='body'><p>When you created your instances with makeMany, they were all not yet opened, which according to the spec about XHR garbage collection, means they should get garbage collected, but maybe the browsers only implemented the XHR GC to occur *after* the request is completed? However, the usual use case is that you're only actually doing a few requests at a time, which means it would be more effective to see how long they stay around after completing. (It could be smart enough to notice that open was never called, hence waiting for the request to complete is pointless, but perhaps that's an optimization the browser doesn't make?)</p><p>What I'm getting at is that your makeMany test is not really representative of how XHRs are typically used, so maybe garbage collection works fine when you use them "normally" (i.e. creating a few at a time, having them completed, creating more).</p><p>All that said, thank you - your insight and testing was very useful, and you're a good writer.</p><p>Spec here: <a href="https://xhr.spec.whatwg.org/#garbage-collection" rel="nofollow noopener" title="https://xhr.spec.whatwg.org/#garbage-collection">https://xhr.spec.whatwg.org...</a></p></div></div><div class='comment'><div class='author'>peter</div><time datetime='2016-05-16T18:44:40Z'>Mon, 16 May 2016 18:44:40 UTC</time><div class='body'><p>Thanks for posting this. It was the only article I came across mentioning this strange behaviour. It has helped me to better understand why my program continued to work even though I had forgotten to retain a reference to my xhr object. The trick of removing the onreadystate handler on completion seems to make things a bit better - as can be demonstrated by removing the handler before completion say when readyState is only 2 or 3, the callback for readyState 4 never happens so I am guessing the object is at that point up for GC</p></div></div></div><hr/><div class='thread'><h1 id='2013-02-25'><a href='/blog/2013/02/25/'>Fast Monte Carlo Method with JavaScript</a></h1><div class='comment'><div class='author'>Foo</div><time datetime='2013-02-27T09:37:17Z'>Wed, 27 Feb 2013 09:37:17 UTC</time><div class='body'><p>Mostly you are testing the speed of the random number generator.</p></div></div><div class='comment'><div class='author'>possiblywrong</div><time datetime='2013-02-27T21:41:22Z'>Wed, 27 Feb 2013 21:41:22 UTC</time><div class='body'><p>I don't think the "programmer route" is lazy at all, particularly since in this case the referenced description of the "mathematical" solution is rather spectacularly wrong.  (That is, the final answer is right, but the derivation of it is essentially nonsense.)  Which is unfortunate, since this is a really nice problem.</p><p>The blog author doesn't even ask the question correctly, referring to draws of "random numbers [distributed] exponentially between [0, 1];" an exponential distribution isn't confined to the unit interval.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-02-27T22:02:18Z'>Wed, 27 Feb 2013 22:02:18 UTC</time><div class='body'><p>Interesting. This is where I originally came across the problem and it was called out on reddit by a few people as well,</p><p><a href="http://www.reddit.com/r/math/comments/1953ui/how_many_times_should_you_draw_a_random_number/" rel="nofollow noopener" title="http://www.reddit.com/r/math/comments/1953ui/how_many_times_should_you_draw_a_random_number/">http://www.reddit.com/r/mat...</a><br></p></div><div class='comment'><div class='author'>possiblywrong</div><time datetime='2013-02-28T14:28:11Z'>Thu, 28 Feb 2013 14:28:11 UTC</time><div class='body'><p>Cool.  The top commenter's "volume of cube minus simplex" solution is how I remember approaching this problem... but I really like the internet_poster's elegant/short/simple functional equation solution.  Thanks for pointing this out!<br></p></div></div></div></div><div class='comment'><div class='author'>Brian</div><time datetime='2013-03-03T19:42:54Z'>Sun, 03 Mar 2013 19:42:54 UTC</time><div class='body'><p>Try marking the trial function in C inline. I'd hope -O3 would see the inlining opportunity on its own but maybe it didn't.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-03-03T20:09:24Z'>Sun, 03 Mar 2013 20:09:24 UTC</time><div class='body'><p>I'm seeing no difference with or without the explicit inline. I'm also running this on a different computer now -- Intel Pentium Dual CPU T3200 -- same exact software except that it's 32-bit, and C is 3x slower than JavaScript here!<br></p></div></div></div><div class='comment'><div class='author'>Helio Frota</div><time datetime='2013-03-21T13:25:24Z'>Thu, 21 Mar 2013 13:25:24 UTC</time><div class='body'><p>Hi cool post !</p><p>I test with java and i got 11 seconds:</p><p>public class MC {</p><p>    static double trial() {<br>        double count = 0d;<br>        double sum = 0d;<br>        while(sum &lt;= 1) {<br>            sum = sum + java.lang.Math.random();<br>            count = count + 1;<br>        }<br>        return count;<br>    }</p><p>    static double monteCarlo(int n) {<br>        double total = 0;<br>        for(int i = 0; i &lt; n; i++) {<br>            total = total + trial();<br>        }<br>        return (total / n);<br>    }</p><p>    public static void main(String args[]) {<br>        long start = System.currentTimeMillis();<br>        monteCarlo(100000000);<br>        System.out.println(System.currentTimeMillis() - start);<br>    }<br>}</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-03-21T14:32:07Z'>Thu, 21 Mar 2013 14:32:07 UTC</time><div class='body'><p>For the record, on the same machine that I ran the other programs I'm getting 6.3 seconds for your program. Faster than SBCL and slower than C, which is where I would expect it to be.</p></div></div></div><div class='comment'><div class='author'>Jon</div><time datetime='2015-03-26T09:36:54Z'>Thu, 26 Mar 2015 09:36:54 UTC</time><div class='body'><p>The difference is that in the 'C' you have put  "/ (double) RAND_MAX" in the trial function so you are doing an extra 100 million divisions, which is expensive</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-03-26T15:53:26Z'>Thu, 26 Mar 2015 15:53:26 UTC</time><div class='body'><p>Great point! I assumed GCC would optimize this into a multiplication by the inverse, but that's not so. I just checked it now by disassembling the output of GCC 4.9.2 and it's doing a division. If I turn on -ffast-math it becomes a multiplication, shaving 8% off the running time. This makes sense because multiplying by the inverse is less accurate, due to the inverse being an extra intermediate value.</p></div></div></div><div class='comment'><div class='author'>Paul Canning</div><time datetime='2017-05-19T09:09:23Z'>Fri, 19 May 2017 09:09:23 UTC</time><div class='body'><p>I'm struggling to understand exactly what this does? What I can see is that it is adding random numbers together to get a result that is greater then 1, then giving the average number (over x number of runs) as a final result? so the number at the end can't be seconds?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-05-19T11:31:12Z'>Fri, 19 May 2017 11:31:12 UTC</time><div class='body'><p>This is one of my worst articles, and I should probably put a disclaimer at the top about it, so don't put too much thought into it. I didn't do the benchmark right. The 2.7185 (i.e. close to e) you're seeing is the result of the calculation, not the running time. However the JavaScript version just happened to complete in 2.7 seconds.</p></div></div></div></div><hr/><div class='thread'><h1 id='2013-03-11'><a href='/blog/2013/03/11/'>Serializing JavaScript Objects</a></h1><div class='comment'><div class='author'>Markus Roth</div><time datetime='2014-08-06T10:49:16Z'>Wed, 06 Aug 2014 10:49:16 UTC</time><div class='body'><p>This post answered the question I had in my head when I started searching the web perfectly. Thanks a lot for posting it!</p></div></div></div><hr/><div class='thread'><h1 id='2013-03-17'><a href='/blog/2013/03/17/'>7DRL 2013 Complete</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2013-03-24'><a href='/blog/2013/03/24/'>Applying Constructors in JavaScript</a></h1><div class='comment'><div class='author'>Terrence Watson</div><time datetime='2014-07-07T23:05:23Z'>Mon, 07 Jul 2014 23:05:23 UTC</time><div class='body'><p>Thanks. This was exactly what I was looking for.</p></div></div><div class='comment'><div class='author'>Ray Foss</div><time datetime='2016-05-13T14:09:07Z'>Fri, 13 May 2016 14:09:07 UTC</time><div class='body'><p>Genius way to contain the ugly of "new" and now "class" without having to resort to a full blown overhaul.</p></div></div></div><hr/><div class='thread'><h1 id='2013-03-25'><a href='/blog/2013/03/25/'>A Seedable JavaScript PRNG Sampling Several Distributions</a></h1><div class='comment'><div class='author'>JOE SIXPACK</div><time datetime='2013-05-14T17:18:59Z'>Tue, 14 May 2013 17:18:59 UTC</time><div class='body'><p>Thanks :)</p></div></div></div><hr/><div class='thread'><h1 id='2013-03-27'><a href='/blog/2013/03/27/'>JavaScript Fantasy Name Generator</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2013-03-28'><a href='/blog/2013/03/28/'>Precise JavaScript Serialization with ResurrectJS</a></h1><div class='comment'><div class='author'>bora</div><time datetime='2014-12-26T19:06:55Z'>Fri, 26 Dec 2014 19:06:55 UTC</time><div class='body'><p>how do you handle a nested object tree? can the tree be fully resurrected?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-12-28T19:19:32Z'>Sun, 28 Dec 2014 19:19:32 UTC</time><div class='body'><p>Yup, it will handle trees just fine. Arbitrarily nested objects is one of the primary use cases. This includes the situation where the same branch or leaves is referenced from multiple places in the tree, even circularly, since identity is maintained.</p></div></div></div></div><hr/><div class='thread'><h1 id='2013-04-07'><a href='/blog/2013/04/07/'>Prototype-based Elisp Objects with @</a></h1><div class='comment'><div class='author'>Eduardo Hao</div><time datetime='2015-09-04T19:23:42Z'>Fri, 04 Sep 2015 19:23:42 UTC</time><div class='body'><p>Heya! Just found this post although i have been lurking your blog. It contains a lot of helpful info.</p><p>I've looked for but found nothing, by any chance do you know if operators can be overriden? Ex:<br></p><pre><code><br>(setf vector (@extend :_x :_y))<br>(setf v1 (@! @vector :new))<br>(setf v2 (@! @vector :new))<br>(setf v3 (+ v1 v2))<br></code></pre><p></p><p>Thanks in advance</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-09-05T01:01:54Z'>Sat, 05 Sep 2015 01:01:54 UTC</time><div class='body'><p>Currently Emacs Lisp doesn't allow you to override functions for <br>different types, neither with compile-time nor run-time polymorphism. It<br> *does* support single-dispatch through the CLOS-like library, EIEIO. <br>However, very few functions are written to support this. For the sake of<br> performance, it's highly unlikely math primitives like + will ever be <br>generic.</p><p>Instead you could define your own + operator as a method<br> within @. There are a number of problems with your small example code, <br>like the first like being "vector" instead of "@vector". Hopefully the <br>following displays correctly:</p><p></p><pre><code><br>(defvar @vector (@extend :x 0 :y 0))<br><br>;; constructor, called via :new<br>(def@ @vector :init (x y)<br>  (@^:init)<br>  (setf @:x x @:y y))<br><br>;; addition operator, mutates "this"<br>(def@ @vector :+ (v1)<br>  (prog1 @@<br>    (cl-incf @:x (@ v1 :x))<br>    (cl-incf @:y (@ v1 :y))))<br><br>;; export to Elisp vector<br>(def@ @vector :export ()<br>  (vector @:x @:y))<br><br>(let ((v1 (@! @vector :new 1 2))  ;; (:x 1 :y 2)<br>      (v2 (@! @vector :new 3 4))) ;; (:x 3 :y 4)<br>  (@! (@! v1 :+ v2) :export))<br>;; =&gt; [4 6]<br></code></pre></div><div class='comment'><div class='author'>Eduardo Hao</div><time datetime='2015-09-09T01:34:05Z'>Wed, 09 Sep 2015 01:34:05 UTC</time><div class='body'><p>Corrected vector to @vector</p><p>It seems like i missed the setters when reading, that's why i was using underscored variables (":_x :_y" ) believing it wasn't dynamic so i actually ended up doing something like</p><p></p><pre><code><br>(def@ @fasor :x (&amp;optional x)<br>  (when x<br>    (progn (setf @:_x x)<br>           (setf @:_magnitud (sqrt (+ (* @:_x @:_x) (* @:_y @:_y))))<br>           (setf @:_radianes (atan @:_y @:_x))<br>           (setf @:_grados (rad2grad @:_radianes))))<br>  @:_x)<br></code></pre><p></p><p>^It had to update other variables based on the new value</p><p>I am making an object called phasor [1] that is used on electronics to represent currents and voltages, it eases my calculations because you dont have to manually be converting rectangular to polar coordinates and viceversa to perform addition and multiplication.</p><p>Here's my full code:<br><a href="https://github.com/LaloHao/elisp-circuitos/blob/master/fasor.el" rel="nofollow noopener" title="https://github.com/LaloHao/elisp-circuitos/blob/master/fasor.el">https://github.com/LaloHao/...</a></p><p>I will however update it to use :set instead, since it can do all i (wrongly) scripted right?</p><p>[1] <a href="https://en.wikipedia.org/wiki/Phasor_%28sine_waves%29" rel="nofollow noopener" title="https://en.wikipedia.org/wiki/Phasor_%28sine_waves%29">https://en.wikipedia.org/wi...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-09-10T21:25:06Z'>Thu, 10 Sep 2015 21:25:06 UTC</time><div class='body'><p>Here are my notes, from top to bottom:</p><p>* The performance of @ is absolutely terrible, so only use it if this isn't important and you like the @ API. :-)</p><p>* Don't use load-file. The require function will already use it if needed.</p><p>* You should prefix your global definitions with a package prefix. For example: fasor-grad2rad, fasor-rad2grad. For a @ value, @fasor is already an appropriately prefixed name, though some Elisp "linter" tools might find it confusing.</p><p>* You don't need to use progn with "when". You would if you used "if" but that's what "when" is there for anyway.</p><p>* Don't make fasor-temporal a global variable. Use a local let binding. Also, don't use setf at the top level in a package: Use defvar instead.</p><p>Otherwise you've got the right idea about how to use @! Very cool.</p></div></div></div></div></div><div class='comment'><div class='author'>edcrypt</div><time datetime='2016-09-19T23:35:14Z'>Mon, 19 Sep 2016 23:35:14 UTC</time><div class='body'><p>Have you considered using Self-like "maps", as described by the PyPy folks here: <a href="https://morepypy.blogspot.com.br/2010/11/efficiently-implementing-python-objects.html" rel="nofollow noopener" title="https://morepypy.blogspot.com.br/2010/11/efficiently-implementing-python-objects.html">https://morepypy.blogspot.c...</a> ?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-09-21T15:50:04Z'>Wed, 21 Sep 2016 15:50:04 UTC</time><div class='body'><p>That's a neat technique. I don't remember if I mention it in my article, but with @ I did experiment with caching fields/methods as to cut down on the costs of dynamic lookups. It actually made performance even worse. I think Elisp is just too high a level for the serious performance issues of @ be solved within it. Though ... perhaps the new Emacs 25 dynamic modules could be used to power something better.</p><p>I've used this map technique in another context (C, with dynamic structs) and had huge gains.</p></div></div></div></div><hr/><div class='thread'><h1 id='2013-04-27'><a href='/blog/2013/04/27/'>Tracking Mobile Device Orientation with Emacs</a></h1><div class='comment'><div class='author'>Marco Paolo Valerio Vezzoli</div><time datetime='2013-04-30T05:12:06Z'>Tue, 30 Apr 2013 05:12:06 UTC</time><div class='body'><p>nice! to me this looks interesting for video games mainly (even if someone used a wiimote to plot a chart of the holes in the street while using a bike).</p></div></div></div><hr/><div class='thread'><h1 id='2013-04-28'><a href='/blog/2013/04/28/'>Userspace Threading in JavaScript</a></h1><div class='comment'><div class='author'>faruzzy</div><time datetime='2013-05-10T21:16:53Z'>Fri, 10 May 2013 21:16:53 UTC</time><div class='body'><p>This is pretty slick! I'll try to recode it myself based on your work! Great work!</p></div></div></div><hr/><div class='thread'><h1 id='2013-05-01'><a href='/blog/2013/05/01/'>Disc RL in the Media</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2013-05-11'><a href='/blog/2013/05/11/'>Inventing a Datetime Web Service</a></h1><div class='comment'><div class='author'>Marco Paolo Valerio Vezzoli</div><time datetime='2013-05-13T06:07:28Z'>Mon, 13 May 2013 06:07:28 UTC</time><div class='body'><p>:)</p></div></div><div class='comment'><div class='author'>Brian</div><time datetime='2013-05-13T21:03:27Z'>Mon, 13 May 2013 21:03:27 UTC</time><div class='body'><p>Awesome hack!</p></div></div><div class='comment'><div class='author'>Ray</div><time datetime='2013-09-05T21:23:11Z'>Thu, 05 Sep 2013 21:23:11 UTC</time><div class='body'><p>So, if your single page app makes alot of xhr requests, you could concievably hook into the xhr object and update the server time with every request.  Awesome</p></div></div></div><hr/><div class='thread'><h1 id='2013-05-14'><a href='/blog/2013/05/14/'>JavaScript Function Statements versus Expressions</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2013-05-18'><a href='/blog/2013/05/18/'>Load Libraries in Skewer with Bower</a></h1><div class='comment'><div class='author'>Sindre Sorhus</div><time datetime='2013-05-21T23:57:08Z'>Tue, 21 May 2013 23:57:08 UTC</time><div class='body'><p>Thanks for the article. Just wanted to clear up some points.</p><p>&gt; 113 (5%) of them have unreachable or unresponsive repositories. About half of these are due to invalid repository URLs.</p><p>That's mostly because of missing validation which is a high priority.</p><p>If you have a way to come up with a list of these it could potentially be fixed: <a href="https://github.com/bower/bower/issues/120" rel="nofollow noopener" title="https://github.com/bower/bower/issues/120">https://github.com/bower/bo...</a></p><p>&gt; 1,830 (83%) have no bower.json metadata file. This means the client has to guess at the metadata.</p><p>Bower recently renamed the metadata file from `component.json` to `bower.json` make sure your stats also account for the `component.json` file. In addition a metadata file is only required when a lib has dependencies otherwise it will use the git tag version, which ultimately makes this percentage useless.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-05-22T01:30:40Z'>Wed, 22 May 2013 01:30:40 UTC</time><div class='body'><p>Good idea, I'll post a list all of those invalid URL packages in that issue.</p><p>Interesting, I had no idea it used to be component.json. The note about this was added to the Bower README just hours after I made this post, so I didn't realize this when gathering statistics. Looking at component.json is actually one of the ways my tool guesses at metadata.</p><p>The README says, "You must create a JSON file -- bower.json by default -- in your project's<br>root," so that's why I'm assuming bower.json is required. I really wish the libraries that had reasonable endpoints would specify them in their bower.json. It's essential information for my particular situation.</p></div></div></div></div><hr/><div class='thread'><h1 id='2013-05-23'><a href='/blog/2013/05/23/'>Should Emacs Packages Self Configure?</a></h1><div class='comment'><div class='author'>Steve Purcell</div><time datetime='2013-05-25T18:57:35Z'>Sat, 25 May 2013 18:57:35 UTC</time><div class='body'><p>A possible solution in the case of skewer might be to provide either a "skewer-setup.el" file, or an autoloaded "skewer-setup" function, which users could optionally use to perform a bunch of standard set-up. If that setup code doesn't quite work for them, they could then make their own version of it.</p></div></div></div><hr/><div class='thread'><h1 id='2013-06-01'><a href='/blog/2013/06/01/'>Skewer Gets HTML Interaction</a></h1><div class='comment'><div class='author'>Ahmed Fasih</div><time datetime='2013-06-02T00:54:13Z'>Sun, 02 Jun 2013 00:54:13 UTC</time><div class='body'><p>The selector mechanism reminds me of enlive!: <a href="https://github.com/swannodette/enlive-tutorial/blob/master/readme.textile" rel="nofollow noopener" title="https://github.com/swannodette/enlive-tutorial/blob/master/readme.textile">https://github.com/swannode...</a></p></div></div></div><hr/><div class='thread'><h1 id='2013-06-02'><a href='/blog/2013/06/02/'>A Handy Emacs Package Configuration Macro</a></h1><div class='comment'><div class='author'>Meatball</div><time datetime='2013-10-08T21:55:34Z'>Tue, 08 Oct 2013 21:55:34 UTC</time><div class='body'><p>Nice post, only thing is that the package-helper.el link is broken.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-10-08T22:14:41Z'>Tue, 08 Oct 2013 22:14:41 UTC</time><div class='body'><p>Thanks for the warning. The link was originally correct, but I had since moved that file within the repository. It's fixed now.</p></div></div></div><div class='comment'><div class='author'>耀华 王</div><time datetime='2013-10-12T14:27:00Z'>Sat, 12 Oct 2013 14:27:00 UTC</time><div class='body'><p>Seems really cool...BTW, what color theme are you using, it's so beautiful :)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-10-12T19:58:43Z'>Sat, 12 Oct 2013 19:58:43 UTC</time><div class='body'><p>That's the wombat theme and it comes with Emacs. I have a slight eye problem that makes reading light-on-dark a lot easier than dark-on-light, so I always prefer darker themes.</p></div><div class='comment'><div class='author'>耀华 王</div><time datetime='2013-10-13T01:02:33Z'>Sun, 13 Oct 2013 01:02:33 UTC</time><div class='body'><p>well, thanks for your reply, i was hanging around in your blog, and i found it's quite a good place to learn something emacs, nice work :)</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2013-06-07'><a href='/blog/2013/06/07/'>Emacs Mouse Slider Mode for Numbers</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2013-06-10'><a href='/blog/2013/06/10/'>Long Live WebGL</a></h1><div class='comment'><div class='author'>Guest</div><time datetime='2013-09-05T01:21:26Z'>Thu, 05 Sep 2013 01:21:26 UTC</time><div class='body'><p>Chris,</p><p>This is fantastic work! I was psyched to see this uploaded on melpa, can't wait to play with it. I already have a question, even though I haven't dug into the source yet, because I'm impatient:</p><p>- Have you considered integrating the storage format with org-mode at all? You could leverage org-feeds (a part of org core now) to store feed data, and org-sync (currently a separate library) to facilitate syncing between machines via git or dropbox.</p><p>I'm working elfeed into my .emacs this evening, I'll let you know how I fare.</p><p>Thanks for sharing this with us,<br>Chaz</p></div></div><div class='comment'><div class='author'>tuxflo</div><time datetime='2013-10-26T15:51:09Z'>Sat, 26 Oct 2013 15:51:09 UTC</time><div class='body'><p>Hey! Thanks a lot for that article! I searched a lot to find out why it is not possible to use the fixed pipeline stuff (they theach us at the university) in WebGL. Now I understand things better and I will focus on learning the new API and forget about the old stuff.<br>Greetings,<br>tuxflo</p></div></div><div class='comment'><div class='author'>Yobi3D</div><time datetime='2015-10-14T10:19:25Z'>Wed, 14 Oct 2015 10:19:25 UTC</time><div class='body'><p>Thanks to WebGL.  We are able to make our 3D search engine fast and interactive.</p><p><a href="https://www.yobi3d.com" rel="nofollow noopener" title="https://www.yobi3d.com">https://www.yobi3d.com</a></p></div></div><div class='comment'><div class='author'>Haben Girmay</div><time datetime='2015-12-30T07:36:42Z'>Wed, 30 Dec 2015 07:36:42 UTC</time><div class='body'><p>would please give me some hints or links for the earthquake using shaking table..thank you</p></div></div><div class='comment'><div class='author'>hi</div><time datetime='2016-11-16T22:48:51Z'>Wed, 16 Nov 2016 22:48:51 UTC</time><div class='body'><p>Totally agree about low-level understanding being important! This mozilla post might be useful to others too: <a href="https://hacks.mozilla.org/2013/04/the-concepts-of-webgl/" rel="nofollow noopener" title="https://hacks.mozilla.org/2013/04/the-concepts-of-webgl/">https://hacks.mozilla.org/2...</a></p></div></div></div><hr/><div class='thread'><h1 id='2013-06-13'><a href='/blog/2013/06/13/'>Life Beyond Google Reader</a></h1><div class='comment'><div class='author'>Josh Gunderson</div><time datetime='2013-06-13T22:55:33Z'>Thu, 13 Jun 2013 22:55:33 UTC</time><div class='body'><p>I initially dug NewsBlur and paid $12 for a year (must've raised the price since then), then I grabbed a Digital Ocean sub and installed tt-RSS, which is decent, but within the past couple of weeks I've found InoReader, which is nearly perfect for me.</p><p>I've tried dozens of others, nothing else really stands out as being a replacement for me. Feedly is decent once you whip it into shape with Greasemonkey. And their Android app is really nice. The two-way sync with Reader is worth A LOT of points.</p><p>I'll continue to use Google Reader as my main reader until the day it dies, then take a final snapshot through TakeOut and move to InoReader probably.</p></div></div></div><hr/><div class='thread'><h1 id='2013-06-16'><a href='/blog/2013/06/16/'>Small HTML5 Canvas Design Pattern</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2013-06-17'><a href='/blog/2013/06/17/'>Personal OS Configuration Live System</a></h1><div class='comment'><div class='author'>cal</div><time datetime='2013-06-29T04:53:45Z'>Sat, 29 Jun 2013 04:53:45 UTC</time><div class='body'><p>Regarding your Firefox configuration annoyance, the user preferences file 'user.js' loads early enough to accomplish what you want.</p><p>As an example, you can prevent the Adblock first run tab with the following in 'user.js':</p><p><code>user_pref("extensions.adblockplus.currentVersion", "2.1");</code></p><p>For a 'Live OS' environment, it's a workable solution.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-06-29T15:42:06Z'>Sat, 29 Jun 2013 15:42:06 UTC</time><div class='body'><p>Thanks for this idea. However, this still won't work due to Firefox's outdated profile concept. The user.js has to be placed in the user's profile directory. This has two issues:</p><p>The profile directory is a randomly generated directory name: it's unpredictable. I don't know where to put the user.js until *after* I've already run Firefox, which is too late.</p><p>Providing my own profiles.ini allows me to specify the profile direcotry. Unfortunately a directory isn't actually a real profile directory until Firefox has initialized it. As before, this means I still have to run Firefox once before I can make use of a user.js. This is, again, too late to stop the initial extension popups.</p></div><div class='comment'><div class='author'>cal</div><time datetime='2013-06-30T04:41:19Z'>Sun, 30 Jun 2013 04:41:19 UTC</time><div class='body'><p>In my experience, Firefox will use a preexisting profile folder for an uninitialized profile.</p><p>What<br> I mean by that is, one could create the necessary directory structure <br>and populate it with the customized files (e.g. <br>~/.mozilla/firefox/profiles.ini, <br>~/.mozilla/firefox/$DIRECTORY-SPECIFIED-IN-CUSTOMIZED-PROFILES.INI/user.js) <br>presumably from the '/etc/rc.local' script.  When FF runs the first <br>time, it will simply add the other config files and miscellany to that <br>folder which already exists.  Since user.js is not one of those files it<br> doesn't get clobbered.</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2013-06-26'><a href='/blog/2013/06/26/'>Liquid Simulaton in WebGL</a></h1><div class='comment'><div class='author'>Ahmed Fasih</div><time datetime='2013-06-28T01:04:44Z'>Fri, 28 Jun 2013 01:04:44 UTC</time><div class='body'><p>If Nvidia CUDA performance for 2D convolution is any guide to WebGL's capabilities, your underwhelming GPU throughput makes sense. [1] is one of the early CUDA SDK white papers, and the code ships with the CUDA installer. It helps explain how memory latency and architectural limitations such as the maximum number of threads per GPU multiprocessor combine to make 2D convolution, even when separable, a hard problem (I assume you used separable kernels in your code). I wish the white paper included a CPU comparison, but the code sample [2] (also included in the CUDA installer) will include a CPU version that could be tried. This CPU implementation will be used only for testing the GPU's output for correctness and is probably not as optimized as it could be, but might give you a responsible comparison for the window sizes you're looking at.</p><p>In the past I spent some time squeezing performance out of GPUs for general purpose computing, and it's hard! One of my personal goals is to understand how much of CUDA intuition applies to WebGL on CUDA-capable hardware, and what the differences are for non-CUDA-capable hardware like your tablet.</p><p>[1] <a href="http://docs.nvidia.com/cuda/samples/3_Imaging/convolutionSeparable/doc/convolutionSeparable.pdf" rel="nofollow noopener" title="http://docs.nvidia.com/cuda/samples/3_Imaging/convolutionSeparable/doc/convolutionSeparable.pdf">http://docs.nvidia.com/cuda...</a><br>[2] <a href="http://docs.nvidia.com/cuda/cuda-samples/index.html#cuda-separable-convolution" rel="nofollow noopener" title="http://docs.nvidia.com/cuda/cuda-samples/index.html#cuda-separable-convolution">http://docs.nvidia.com/cuda...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-06-29T15:05:06Z'>Sat, 29 Jun 2013 15:05:06 UTC</time><div class='body'><p>I'm glad my conclusion makes sense. Thanks for the links. Also, congratulations, you're now my local GPU expert when I have questions! :-)</p></div><div class='comment'><div class='author'>Ahmed Fasih</div><time datetime='2013-07-10T01:01:14Z'>Wed, 10 Jul 2013 01:01:14 UTC</time><div class='body'><p>I also just read this detailed article on the difficulties of memory management on Android (and other mobile devices) that reminded me of this post: <a href="http://sealedabstract.com/rants/why-mobile-web-apps-are-slow/" rel="nofollow noopener" title="http://sealedabstract.com/rants/why-mobile-web-apps-are-slow/">http://sealedabstract.com/r...</a> (via John Carmack's Twitter feed).</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2013-07-31'><a href='/blog/2013/07/31/'>Live Systems are Handy</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2013-08-16'><a href='/blog/2013/08/16/'>Coining Autoism</a></h1><div class='comment'><div class='author'>Jay Dugger</div><time datetime='2013-08-17T05:42:27Z'>Sat, 17 Aug 2013 05:42:27 UTC</time><div class='body'><p>This idea had a long discussion in an early Clifford Pickover book, Mazes of the Mind, perhaps?</p></div></div></div><hr/><div class='thread'><h1 id='2013-08-17'><a href='/blog/2013/08/17/'>JavaScript Function Metaprogramming</a></h1><div class='comment'><div class='author'>Ivan</div><time datetime='2013-08-19T12:57:50Z'>Mon, 19 Aug 2013 12:57:50 UTC</time><div class='body'><p>Hi, you can also use this form of the Function constructor:<br>var f1 = new Function('x,y', 'return x + y');<br>f1(1, 2);</p><p>var f1 = new Function ('x,y', 'return x + y')<br>f1(1,2)<br>var f1 = new Function ('x,y', 'return x + y')<br>f1(1,2)</p><p>var f1 = new Function ('x,y', 'return x + y')<br>f1(1,2)</p></div><div class='comment'><div class='author'>Ivan</div><time datetime='2013-08-19T12:59:41Z'>Mon, 19 Aug 2013 12:59:41 UTC</time><div class='body'><p>Oops, sorry for the mess, this disqus thing is a strange beast when pasting. You can edit/remove the post if you like.</p></div></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-08-19T20:28:56Z'>Mon, 19 Aug 2013 20:28:56 UTC</time><div class='body'><p>Very interesting. I took a look at <a href="http://www.ecma-international.org/publications/standards/Ecma-262.htm" rel="nofollow noopener" title="http://www.ecma-international.org/publications/standards/Ecma-262.htm">the spec</a> for this just to double check. Section 15.3.2.1 describes how the arguments are collected into a string. Not only does the spec allow this to happen pretty much by accident, but it even makes an explicit note that this is allowed. Extra whitespace is therefore valid, too:</p><p> <code>new Function('x\n', 'y', 'return x + y')</code></p><p><code>new Function('  x  ', '  y\t', 'return x + y')</code></p><p>Cool trick.</p><p>It would also seem that my pure JavaScript implementation of Function is more valid than I thought. If I switched to a global eval it would be 100% correct.</p></div></div></div></div><hr/><div class='thread'><h1 id='2013-09-03'><a href='/blog/2013/09/03/'>Leaving Gmail Behind</a></h1><div class='comment'><div class='author'>Samask</div><time datetime='2013-12-31T22:45:28Z'>Tue, 31 Dec 2013 22:45:28 UTC</time><div class='body'><p>Re: notmuch vs mu4e</p><p>Notmuch use a very robust thread algorithm, while mu4e has a nicer emacs interface. The former is developed by quite a few developers, while the latter is mainly the work of one. How I wish I could use the more advanced core of notmuch with the ncier interface of mu4e! Ah, choices, choices...</p></div></div><div class='comment'><div class='author'>andschwa</div><time datetime='2014-05-02T06:00:34Z'>Fri, 02 May 2014 06:00:34 UTC</time><div class='body'><p>You've inspired me to finally move to hosting my own mail, but with it all managed via Puppet. I've looked into it several times, and did move from Gmail to Namecheap to Zoho for hosting, but I really want to run my own. I already have my server on Digital Ocean, and it has more than enough juice to spare to be an email server as well.</p><p>Is there any way to live-test my email server without switching all my MX records? I don't want to risk losing email if I don't get it running right the first time.</p></div></div><div class='comment'><div class='author'>NicolasPetton</div><time datetime='2014-08-20T20:19:29Z'>Wed, 20 Aug 2014 20:19:29 UTC</time><div class='body'><p>This looks like  a very nice setup!</p><p>One question though: what about your gmail contacts?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-08-20T20:31:03Z'>Wed, 20 Aug 2014 20:31:03 UTC</time><div class='body'><p>I've been using it nearly a year now and e-mail has never been better! To address your question, follow through to the "Hacker's Guide" article I linked and look at the address lookup section. Daniel provides a addrlookup.c program that provides notmuch with a list of addresses harvested from my very own email archives. I never had to export contacts or anything like that since this makes it automatic.</p></div></div></div><div class='comment'><div class='author'>w</div><time datetime='2014-11-23T20:32:38Z'>Sun, 23 Nov 2014 20:32:38 UTC</time><div class='body'><p>One suggestion for your email address needs with your DO account would be to use your cell phone provider's email-&gt;sms gateway feature.  e.g. use 9195554312@vtext.com if you have verizon.  Most of the time these are receive-only email accounts and don't require anything from you.  They're also usually not publicly available.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-11-23T21:29:11Z'>Sun, 23 Nov 2014 21:29:11 UTC</time><div class='body'><p>That's not a bad idea, thanks! I've used the AT&amp;T SMS/email gateway a bit, enough to have found and reported a security issue, but it never occurred to me to use it as a backup email address.</p></div></div></div><div class='comment'><div class='author'>larryw</div><time datetime='2014-11-23T21:22:40Z'>Sun, 23 Nov 2014 21:22:40 UTC</time><div class='body'><p>Glad its working for you. I felt the same way about Google and privacy the reality is that a lot of the people I communicate with are still on Gmail. I did setup my own email server as well and had to immediately bulk-up security (fail2ban and other tools) to combat the increased hacking attempts and STILL got hacked by a script that managed to hijack the mail server to send spam. At that point realized this was becoming a time sync and opened up a PAID email account with mykolab. So far its nearly a year and NO complaints from me and a couple of folks that I communicate with have now also switched out from gmail. Note I did NOT drop gmail its just used for anything that's non sensitive or potential for becoming crapware (sorry).</p></div></div></div><hr/><div class='thread'><h1 id='2013-09-04'><a href='/blog/2013/09/04/'>Introducing Elfeed, an Emacs Web Feed Reader</a></h1><div class='comment'><div class='author'>chazu</div><time datetime='2013-09-05T01:24:41Z'>Thu, 05 Sep 2013 01:24:41 UTC</time><div class='body'><p>Poopsticks, I seem to have accidentally put my comment containing glowing praise of your work into another article on your blog. Nevertheless, bravo!</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-09-05T02:32:42Z'>Thu, 05 Sep 2013 02:32:42 UTC</time><div class='body'><p>I presume you're talking about <a href="http://nullprogram.com/blog/2013/06/10/#comment-1030359486" rel="nofollow noopener" title="http://nullprogram.com/blog/2013/06/10/#comment-1030359486">this comment</a>.</p><p>Thanks! I was actually completely unaware of org-feed. Taking a look at it now I think Elfeed could integrate with some of it. For example, if elfeed-feeds is empty it would use the feeds listed in org-feed-alist. It could could also pass entries over to org-feed or hook into it recieve entries from it.</p><p>However I wouldn't want to share database storage with org-feed. Its format is definitely written for human consumption rather than performance. One of the goals of Elfeed is to be performant with large numbers of feeds (targeting hundreds at a time). I'll write about the Elfeed database in a future post soon but, in short, it's very much oriented around fast filtering, saving, and loading. I want it feel instantaneous even with hundreds of thousands of entries at once, which is where Elfeed is at right now. What I could do instead is provide an export/import to/from the org-feed format. That could possibly cover syncing the Elfeed database between machines, assuming I could get the tag metadata in there.</p><p>You said you were psyched to see it in Melpa. Does this mean you were aware of it before I got it added to Melpa?</p><p>I'm glad to hear I have another user. I think you're the third one now, if it works out for you. Look in my .emacs.d/etc/feed-setup.el to see my current config.</p></div></div></div><div class='comment'><div class='author'>Samrat Man Singh</div><time datetime='2013-09-06T16:08:52Z'>Fri, 06 Sep 2013 16:08:52 UTC</time><div class='body'><p>Looks great. I am getting this error when running `elfeed-web-start`: <a href="https://www.refheap.com/18394" rel="nofollow noopener" title="https://www.refheap.com/18394">https://www.refheap.com/18394</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-09-06T20:10:36Z'>Fri, 06 Sep 2013 20:10:36 UTC</time><div class='body'><p>I added a few things to simple-httpd that makes writing things like the Elfeed web interface much easier. You just need to update simple-httpd.</p></div></div></div><div class='comment'><div class='author'>next-user-here</div><time datetime='2013-11-23T16:11:17Z'>Sat, 23 Nov 2013 16:11:17 UTC</time><div class='body'><p>Hey Christoph,<br>I am daily user of org user since 2006.<br>I 've used opera 12 for feed reading, since opera has abandoned the<br>reader in their new version I 've looked for a replacement.<br>Have tried out the Emacs build-in 'newsticker', but it wasn't<br>customizable (filtering) enough for me.<br>Using your elfeed package for 5 days now and I'm very pleased.<br>Thanks a lot!</p><p>P1: Please make the view size of the feed title customizable (or better dynamically growing depending on title size)<br>P2: Please add also the time to the showing date<br>Q1: I 'd like to change the showing feed name 'Hacker News' to HN,<br>how?<br>Q2: Can I remove feeds older than 2 day automatically from the<br>database?</p><p>Thanks again<br>Greets<br>NUH</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-11-23T18:29:09Z'>Sat, 23 Nov 2013 18:29:09 UTC</time><div class='body'><p>Thanks! To generally answer your questions/proposals first: I intentionally designed Elfeed to be cleanly extensible, so ideally all these things you're asking can already be done without requiring changes to Elfeed itself, and your extensions today should work forever.</p><p>&gt; P1: Please make the view size of the feed title customizable (or<br>&gt; better dynamically growing depending on title size)</p><p>There are the variables elfeed-search-title-max-width, elfeed-search-title-min-width, elfeed-search-trailing-width. I just noticed that they were not declared as defcustom making them harder to find. Does setting these accomplish what you want?</p><p>Keep in mind you will need to clear the display cache after you set these values in order for the display to really start using them. It's as simple as evaling this code:</p><p></p><pre>(clrhash elfeed-search-cache)<br></pre><p></p><p>&gt; P2: Please add also the time to the showing date</p><p>You can redefine/advise elfeed-search-format-date to display whatever you like and I *think* this will Just Work. For example:</p><p></p><pre>(defun elfeed-search-format-date (date)<br>  (format-time-string "%Y-%m-%d %H:%M" (seconds-to-time date)))<br></pre><p></p><p>&gt; Q1: I 'd like to change the showing feed name 'Hacker News' to HN,<br>&gt; how?</p><p>This one's a little trickier since Elfeed tries to keep the feed title in sync with the feed itself. You can set it yourself at any time by grabbing the feed's struct with elfeed-db-get-feed and setting the title on it.</p><p></p><pre>(let ((feed (elfeed-db-get-feed "https://news.ycombinator.com/rss")))<br>  (setf (elfeed-feed-title feed) "HN"))<br></pre><p></p><p>The main problem is making this change stick after updates. Probably the best way is to add this as "after" advice to elfeed-update (defadvice).</p><p>&gt; Q2: Can I remove feeds older than 2 day automatically from the<br>&gt; database?</p><p>An important concept is that Elfeed must never forget about entries. It needs to keep track of them -- remembering that it's seen them -- so that they don't appear to be new entries next time it's parsing its parent feed. To accomplish what you want you should just put "@2-days" in your default search filter.</p><p></p><pre>(setq-default elfeed-search-filter "@2-days +unread")<br></pre><p></p><p>You can also set up a tagger to mark older entries as read. (This tagger only applies to newly-discovered entries, not known entries.)</p><p></p><pre>(add-hook 'elfeed-new-entry-hook<br>          (elfeed-make-tagger :before "2 days ago"<br>                              :remove 'unread))<br></pre><p></p><p>If you know Elisp well enough you should be able to make Elfeed do pretty much anything you need.<br></p></div><div class='comment'><div class='author'>next-user-here</div><time datetime='2013-11-23T22:55:52Z'>Sat, 23 Nov 2013 22:55:52 UTC</time><div class='body'><p>Wow that fast a response, merci.<br>- than[x] P1<br>- than[x] P2<br>- Q1: didn't work I'am an elisp-novice so I 've tried:<br>(defadvice ad-elfeed-update (after elfeed-update activate)<br>  (let ((feed (elfeed-db-get-feed "<a href="https://news.ycombinator.com/rss" rel="nofollow noopener" title="https://news.ycombinator.com/rss">https://news.ycombinator.co...</a>")))<br>    (setf (elfeed-feed-title feed) "HN"))<br>)<br>- Q2: I want to use elfeed for years, with many many feeds, but I don't want to keep such a huge amount data. An ability to delete entries on time criteria would be nice for me.<br>- Q3: (a new one ;-) is it possible avoid image downloading fo specific feed sources (advertising)?</p><p>Thanx for your support!</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-11-24T02:33:47Z'>Sun, 24 Nov 2013 02:33:47 UTC</time><div class='body'><p>The name right after the defadvice is the name of the function being advised, not a name you make up yourself (i.e. "ad-elfeed-update"). Also, I forgot that elfeed-update is asynchronous, so advising it won't work. Instead, try putting the advice on elfeed-search-update as "before" advice, so the name is set properly just before displaying it. You might need to use that clrhash expression before you'll see it working. Also, make sure the URL you use with elfeed-db-get-feed is *exactly* the same as listed in elfeed-feeds.</p><p>This worked for me to rename the title of my blog in Elfeed:</p><p></p><pre>(clrhash elfeed-search-cache) ;; clear display cache first<br><br>(defadvice elfeed-search-update (before nullprogram activate)<br>(let ((feed (elfeed-db-get-feed "http://nullprogram.com/feed/"))) (setf (elfeed-feed-title feed) "NP")))<br><br>;; then go to the elfeed buffer and hit "g" to refresh the view<br></pre><p></p><p>The size of the database should be rather small. I have 6,000 entries in my database right now and the index file is only 3.5 MB. The content database after garbage collection, which is the data/ directory under ~/.elfeed/, with these 6k entries is 17MB. When I run M-x elfeed-db-compact (experimental!) it drops down to 1.8MB. That's less than 1 kB per entry in the DB. It's also less than my personal Liferea database of roughly the same amount of content (~15MB) before I wrote Elfeed.</p><p>If your concern is DB performance, the DB is very efficient at filtering entries by date. As long as you keep a date filter ("@2-days") in your search filter, filtering should be speedy even for extremely large databases. In fact, I can run Elfeed on my Raspberry Pi with very little interface latency. The slowest part is by far parsing all the XML during updates, which is something I can't optimize.</p><p>If this really becomes a demonstrable issue, in the future I may add a function for deleting entries. You would use it in your own with-elfeed-db-visit form to clear out entries matching whatever criteria you wish.</p><p>Images are actually downloaded by the Emacs HTML rendering engine, shr, when you view the post. You could try blocking these with your system's hosts file. Or you could try writing an elfeed-new-entry-hook function that filters the HTML content of newly-discovered entries to block advertising. That's a whole project of its own, so you're on your own for that one.</p></div><div class='comment'><div class='author'>next-user-here</div><time datetime='2013-11-24T12:18:09Z'>Sun, 24 Nov 2013 12:18:09 UTC</time><div class='body'><p>Hi Christopher,<br>- than[x] Q1<br>- Q2: I see, there is no delete functionality in the db implementation.<br>  If things get slow, I 'll just remove ~/.elfeed/ after reading feeds and start<br>  a fresh db, that should be a work around<br>- Q3: Do you have a quick elisp skeleton for "an elfeed-new-entry-hook function <br>  that filters  the HTML content of newly-discovered entries" solution, for a<br>  bloody elisp novice like me, please</p><p>Thanks you indeed<br>Have a nice Sunday<br>NUH</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-11-26T03:15:42Z'>Tue, 26 Nov 2013 03:15:42 UTC</time><div class='body'><p>I've turned our conversation into a tips and tricks post: <a href="http://nullprogram.com/blog/2013/11/26/" rel="nofollow noopener" title="http://nullprogram.com/blog/2013/11/26/">Elfeed Tips and Tricks</a>. That has some examples you might find useful.</p></div></div></div></div></div></div></div><div class='comment'><div class='author'>csantosb</div><time datetime='2013-12-07T19:41:06Z'>Sat, 07 Dec 2013 19:41:06 UTC</time><div class='body'><p>I just discovered elfeed and I'm quite confident about its utility as it may easily be adapted to any workflow. Now, I am wondering, first, what is the advangtage on using elfeed instead of newsbeuter, for example; second, do you think there might be anytime soon a way to ge tin sync with feedly, for example ? by now i'm using beyond pod on a tablet, wich syncs with feedly, it would be great to use elfeed as a desktop rss reader provided it is aware of already read posts. Thanks anyway for all this work, very good job !</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-12-08T19:12:31Z'>Sun, 08 Dec 2013 19:12:31 UTC</time><div class='body'><p>The primary advantage over other readers is extensibility. Elfeed is written entirely in Elisp, so any part can be changed on the fly, and all configuration is done through Elisp. You can add custom interface actions, custom filters, tagging tricks, etc. See the <a href="http://nullprogram.com/blog/2013/11/26/" rel="nofollow noopener" title="http://nullprogram.com/blog/2013/11/26/">tips and tricks post</a>.</p><p>Syncing with other readers, including other Elfeed databases, is something I've been interested in adding since the beginning. I just haven't personally had a need for it yet. In the case of Feedly, someone would need to write an extension that hooks into <a href="http://developer.feedly.com/" rel="nofollow noopener" title="http://developer.feedly.com/">the Feedly API</a> and performs the synchronization.</p><p>A sort-of alternative to syncing that I had started but didn't complete yet is a web interface to Elfeed. The web interface exists -- you can install it from MELPA -- but it's strictly read-only at the moment. The idea is that you could visit your desktop client from your mobile devices through this interface, so they're all using a single client.<br></p></div><div class='comment'><div class='author'>csantosb</div><time datetime='2013-12-09T13:21:24Z'>Mon, 09 Dec 2013 13:21:24 UTC</time><div class='body'><p>You're right, I am using it now with<br>(run-with-timer 0 120 'elfeed-update)<br>to auto-update the db as a possible extension to the base functionality.<br>Additionally, the :callback in 'elfeed-make-tagger allows calling external elisp code or anything else with <br>'start-proces. Currently I have custom desktop alert messages when a given condition is met, but possibilities are endless. Very good job. Looking forward for a feedly interface. Thanks again,</p><p>c.</p></div></div></div></div><div class='comment'><div class='author'>andschwa</div><time datetime='2014-04-30T06:37:27Z'>Wed, 30 Apr 2014 06:37:27 UTC</time><div class='body'><p>Thanks for Elfeed Chris! I've been using an instance of [Stringer](<a href="https://github.com/swanson/stringer/)" rel="nofollow noopener" title="https://github.com/swanson/stringer/)">https://github.com/swanson/...</a> hosted on Heroku, but it's just been too slow and out-of-the-way. I came across Elfeed a while ago at work, but stopped using it after I left.</p><p>Do you have any advice on making Elfeed usable from multiple computers? I'm thinking I could keep `~/.elfeed` stored on my server, using sshfs perhaps. The configuration (i.e. `elfeed-feeds`) isn't a problem using git, but keeping the database either synced or used remotely... well I'm just not sure how I'll go about it yet.</p></div><div class='comment'><div class='author'>andschwa</div><time datetime='2014-04-30T06:37:52Z'>Wed, 30 Apr 2014 06:37:52 UTC</time><div class='body'><p>Dang. I wish Disqus supported Markdown.</p></div><div class='comment'><div class='author'>Shackra Seaslug</div><time datetime='2015-05-09T07:41:47Z'>Sat, 09 May 2015 07:41:47 UTC</time><div class='body'><p>it supports HTML tags like <code>&lt;a&gt;&lt;/a&gt;</code> and <code>&lt;pre&gt;&lt;code&gt;&lt;/code&gt;&lt;/pre&gt;</code></p></div><div class='comment'><div class='author'>andschwa</div><time datetime='2015-05-09T07:43:46Z'>Sat, 09 May 2015 07:43:46 UTC</time><div class='body'><p>Markdown exists so I don't have to type all those brackets :)</p></div><div class='comment'><div class='author'>Shackra Seaslug</div><time datetime='2015-05-09T08:11:00Z'>Sat, 09 May 2015 08:11:00 UTC</time><div class='body'><p>Then, Disqus will make your life harder...</p></div></div></div></div></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-04-30T17:03:48Z'>Wed, 30 Apr 2014 17:03:48 UTC</time><div class='body'><p>The multiple computer thing is something I've been wanting to resolve, but I haven't sorted out a way to do it yet. You could try sharing the database directory via NFS, Sambda, or sshfs. Keep in mind that accessing it from multiple instances of Emacs at the same time will clobber each other when saving (there's no locking), though, fortunately, it will never actually corrupt the database.</p><p>You could use rsync on the database directory, or copy just the index file manually. The content database isn't very important, so you could probably tolerate not synchronizing it. The content will mostly be filled in on the next update anyway.</p><p>I've got a *partially* working EmacSQL branch that would provide a safe, shared datbase solution via SQLite. I'm not sure if I'll ever get this into a working state, though.</p><p>If you ever have any ideas, please share.</p></div><div class='comment'><div class='author'>andschwa</div><time datetime='2014-05-02T06:01:44Z'>Fri, 02 May 2014 06:01:44 UTC</time><div class='body'><p>All right, I may give it a try when the need arises, and I'll let you know how it goes.</p></div></div></div></div><div class='comment'><div class='author'>Guest</div><time datetime='2015-02-01T04:09:32Z'>Sun, 01 Feb 2015 04:09:32 UTC</time><div class='body'><p>Hello Chris! <br>I need some help. I have added a few blogs to my elfeed using elfeed-add-feed which I don't need anymore. Is it possible to unlink these blogs? Where is the database of the added feeds are stored?</p></div></div><div class='comment'><div class='author'>Paul James Harper</div><time datetime='2015-12-28T06:57:59Z'>Mon, 28 Dec 2015 06:57:59 UTC</time><div class='body'><p>Thanks for this wonderful tool. Combined with Remy Honig's elfeed-org it is unbeatable for reading RSS feed. <a href="https://github.com/remyhonig/elfeed-org" rel="nofollow noopener" title="https://github.com/remyhonig/elfeed-org">https://github.com/remyhoni...</a></p></div></div></div><hr/><div class='thread'><h1 id='2013-09-09'><a href='/blog/2013/09/09/'>The Elfeed Database</a></h1><div class='comment'><div class='author'>alexbenjm</div><time datetime='2014-01-13T21:07:41Z'>Mon, 13 Jan 2014 21:07:41 UTC</time><div class='body'><p>Would sqllite be a viable solution? It's a self-contained serverless engine. Just drop a file in a directory and access it via some suitable Emacs package. A quick look shows several possible Emacs interfaces to Sqllite. It looks like it may solve your issue of finding an external database program not requiring excessive setup on user's part.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-01-14T00:33:27Z'>Tue, 14 Jan 2014 00:33:27 UTC</time><div class='body'><p>I actually attempted to drive SQLite from Emacs about a year ago when I <a href="http://nullprogram.com/blog/2012/12/29/" rel="nofollow noopener" title="http://nullprogram.com/blog/2012/12/29/">wrote an Emacs pastebin</a>. My conclusion was that SQLite's command line output is definitely not intended to be consumed by software. By default the output is ambiguous, but asking for CSV output resolves this. To do it properly I figured I would need a native helper program to access SQLite and send well-formed output to Emacs.</p><p>I did recently discover esqlite (via MELPA) but I still need to spend some time investigating it as an option.</p></div></div></div></div><hr/><div class='thread'><h1 id='2013-09-22'><a href='/blog/2013/09/22/'>Atom vs RSS</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2013-09-23'><a href='/blog/2013/09/23/'>Atom vs. RSS</a></h1><div class='comment'><div class='author'>Dr. Azrael Tod</div><time datetime='2013-09-23T09:05:51Z'>Mon, 23 Sep 2013 09:05:51 UTC</time><div class='body'><p>i couldn't agree more…<br>sadly currently we seem to have more the problem "there is no feed" then we have "there is a broken feed" :-/</p></div></div><div class='comment'><div class='author'>isofarro</div><time datetime='2013-09-23T18:44:13Z'>Mon, 23 Sep 2013 18:44:13 UTC</time><div class='body'><p>Atom's design goal was to fix the problems developers were seeing in RSS 2.0 but proved incredibly difficult to fix. So better specified was a prime requirement.</p><p>RSS2.0 was an evolution from RSS 0.94 (Pity Mark Pilgrim's article "The Myth of RSS compatibility" / "9 versions of RSS", which identifies a number of compatibility issues of RSS over the years).</p><p>RSS 1.0 is a different kettle of fish, one where a community decided to improve the existing RSS with Semantic Web approach. The original version of RSS introduced by Netscape was based on RDF syntax (Resource Description Framework, a new W3C recommendation). Versions driven by Dave Winer preferred simpler and more logical constructs.</p><p>RSS 1.0 (RDF Site Syndication) brought RDF back, and introduced namespaced element (notably Dublin Core, which brings in some very useful metadata elements, like publish dates, titles, descriptions). That's why it looks so drastically different to previous RSS versions. I guess the Web wasn't ready for automated generation of RSS feeds. On the bright side, it did push RSS 2.0 to allow for namespaced elements, and the use of Dublin core became more mainstream.</p><p>I know your pain for parsing RSS and Atom feeds. I wrote my own parser in PHP4 and it's SAX XML processor, trying to support namespaces in a modular way. Nowhere near production capable, but a useful exercise at the time: <a href="https://github.com/isofarro/php5-feed-parser-and-normaliser" rel="nofollow noopener" title="https://github.com/isofarro/php5-feed-parser-and-normaliser">https://github.com/isofarro...</a></p><p>Have you looked at Mark Pilgrim's Feed Parser <a href="http://code.google.com/p/feedparser/" rel="nofollow noopener" title="http://code.google.com/p/feedparser/">http://code.google.com/p/fe...</a> -- even if you are not using a Python stack, it's well worth seeing if you can reuse the extensive unit tests, they capture a lot of the issues you are seeing in dealing with RSS feeds.</p><p>Also, are you using Feed Validator <a href="http://feedvalidator.org" rel="nofollow noopener" title="http://feedvalidator.org">http://feedvalidator.org</a> to sanity check RSS and Atom feeds? That's at least a stick you can potentially use to get others to fix their feeds. But understandably, human endeavours open up human error, and a lot of RSS issues are human error driven.</p><p>There did use to be a few proxy sites that converted RSS 2.0 feeds to Atom, but that does run into the issue of that proxy having to do the disambiguation, and covering gaps like producing a valid/non-changing ids.</p></div></div><div class='comment'><div class='author'>Mads Fog</div><time datetime='2015-01-19T20:21:17Z'>Mon, 19 Jan 2015 20:21:17 UTC</time><div class='body'><p>Hi Chris</p><p>Would it be possible for you to share your Jekyll Atom template?</p><p>I am specifically interested in the &lt;id&gt; part.</p><p>Thanks in advance.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-01-19T23:55:36Z'>Mon, 19 Jan 2015 23:55:36 UTC</time><div class='body'><p>My entire site's original sources can be found on GitHub, so you can inspect any part you like any time. The specific template you're looking for is here:<br> <a href="https://github.com/skeeto/skeeto.github.com/blob/master/feed/index.xml" rel="nofollow noopener" title="https://github.com/skeeto/skeeto.github.com/blob/master/feed/index.xml">https://github.com/skeeto/s...</a> <br>The most complex part is getting the dates right. GitHub's (read: Rackspace's) servers are in the PDT timezone and I live in EDT. If you let Jekyll use the server's own timezone as it wants to do by default (bad default!), you'll run into date mismatches that can break your site when posting articles whose date changes when pushed out onto a PDT server (e.g. the date baked into the filename doesn't match the date that the timestamp falls in for that particular timezone). The _config.yml at the repository root sets the timezone to "GMT" (though this should probably be "UTC" instead?), which is required for this template to work properly, since it's got thr hard-coded Z in the timestamp.</p><p>I see Jekyll now supports ISO 8601 dates (required by Atom) directly. At the time I wrote this template, that wasn't supported yet, so I had to hardcode UTC to work around the omission. I think the workaround is still required for my particular use case.</p><p><a href="http://jekyllrb.com/docs/templates/" rel="nofollow noopener" title="http://jekyllrb.com/docs/templates/">http://jekyllrb.com/docs/te...</a></p></div></div></div><div class='comment'><div class='author'>Mehdi Sadeghi</div><time datetime='2015-05-31T08:52:29Z'>Sun, 31 May 2015 08:52:29 UTC</time><div class='body'><p>Thanks Chris for your insights. I was in the process of updating my websites feed and now for sure I go for Atom over RSS!</p><p>As a person who writes his language in RTL format I have to play with the feed specs to see how could I achieve such layout. So far I did not find any specs for it. Moreover I compile my website locally because I come from the only country in the world which uses an official calendar rather than Julian calendar! So the ruby calendar library is not supported by Github and I go for local compile and then I push to gh-pages branch (for each post I hard-code the publish date in yaml header).</p></div></div><div class='comment'><div class='author'>A Nonny Mouse</div><time datetime='2017-02-03T12:39:34Z'>Fri, 03 Feb 2017 12:39:34 UTC</time><div class='body'><p>“Unlike the other RSS versions, the top level element is rdf:RFD. That’s not a typo.” I'm inclined to disagree here: shouldn't it be rdf:RDF?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-02-03T12:50:13Z'>Fri, 03 Feb 2017 12:50:13 UTC</time><div class='body'><p>Whoops, you're right! I was referring to "rdf:RDF" being such a weird root element for RSS, and that was an unfortunate coincidence with an actual typo. I've fixed it.</p></div></div></div></div><hr/><div class='thread'><h1 id='2013-10-12'><a href='/blog/2013/10/12/'>My Grading Process</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2013-10-13'><a href='/blog/2013/10/13/'>My Grading Process</a></h1><div class='comment'><div class='author'>possiblywrong</div><time datetime='2013-10-13T14:00:18Z'>Sun, 13 Oct 2013 14:00:18 UTC</time><div class='body'><p>I remember (sometimes fondly, sometimes not so much :)) that bi-modal distribution of the time needed to grade a student's math homework/exams/etc.  Usually, when a student has even a modest grasp of the material, grading his/her work is easy and quick, even if there are mistakes... because they are "sensible" mistakes.  But when a student is clearly lost, then it's difficult to know where to even begin "correcting."</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-10-13T17:00:58Z'>Sun, 13 Oct 2013 17:00:58 UTC</time><div class='body'><p>Bi-modal is definitely the right word for this.</p></div><div class='comment'><div class='author'>Ahmed Fasih</div><time datetime='2013-10-28T19:17:24Z'>Mon, 28 Oct 2013 19:17:24 UTC</time><div class='body'><p>A thought: I've graded a class, and have had graders (obviously); I've also submitted papers to journals, i.e., wrangled with reviewers' responses, and been a reviewer for a couple of papers. The two tasks seem like they share a common goal, viz., judging quality, but whereas quantifying the badness of a homework "paper" in points is time-consuming, I think the binary response of an editor is often easier. First, you would need to replace points for homework with a binary accept/reject. And second, with a terrible submission, you would say "Here are the first three-odd things that are wrong with your submission, out of many more. Fix at least these and come back." (Unfortunately I guess you can't flat reject a homework submission like you can with a paper...)</p><p>(NB: I know some paper reviewers who do the same thing as you with bad submissions: exhaustively catalog all the things wrong with it, which is awfully timeconsuming and depressing. I am a fan of the more brutal approach, i.e., listing a subset of the major problems, and rejecting if it seems unsalvageable.)</p><p>(NB 2: I never got a single paper accepted by an archival-grade journal, so feel free to ignore me completely :)</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2013-11-26'><a href='/blog/2013/11/26/'>Elfeed Tips and Tricks</a></h1><div class='comment'><div class='author'>happyelffeduser</div><time datetime='2013-11-26T22:48:46Z'>Tue, 26 Nov 2013 22:48:46 UTC</time><div class='body'><p>Great post with great tips.<br>I have two question about improvements to my 5min code:</p><p>1. cycling filters</p><p>(defvar my-elfeed-counter 0)<br>    (defun elfeed-search-filter-toggle ()<br>      (interactive)<br>      (let ((filters<br>             '("@4-weeks-ago -junk +unread -video -yt -musicvideo"<br>               "@4-weeks-ago -junk +unread -youtube +fast"<br>               "@4-weeks-ago -junk +unread +spam"<br>               "@4-weeks-ago -junk +unread +humor"<br>               "@4-weeks-ago -junk +unread +musicvideo"<br>               "@4-weeks-ago -junk +unread +video"<br>               "@4-weeks-ago -junk +unread +youtube"<br>               "@4-weeks-ago -junk +unread")))<br>        (setq current-counter (+ my-elfeed-counter 1))<br>        (setq my-elfeed-counter (mod current-counter (length filters)))<br>        (elfeed-search-set-filter (nth my-elfeed-counter filters))))</p><p>    (define-key elfeed-search-mode-map "c" 'elfeed-search-filter-toggle)</p><p>2. yanking</p><p>I changed 'PRIMARY to 'CLIPBOARD in elfeed-search-yank,<br>because PRIMARY has not effect for me.<br>(Arch Linux without Desktop Env., only XMonad) <br>Maybe some defcustom for this?</p><p>Thank you for elfeed.<br>Currently I'm using it for my 1k feeds :) and I'm extremely <br>happy that I can filter out entries with buzzwords like agile, nosql, php, ... ;P<br>or things like "X things that"... <a href="http://xkcd.com/1283/" rel="nofollow noopener" title="http://xkcd.com/1283/">http://xkcd.com/1283/</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-11-26T23:56:55Z'>Tue, 26 Nov 2013 23:56:55 UTC</time><div class='body'><p>1000 feeds! Wow! That's the most I'm aware of at the moment for a single user.</p><p>Very good point about the clipboard selection. I just assumed PRIMARY would work for everyone. I just added the customization variable elfeed-search-clipboard-type since there's no clean way to set it otherwise. It will show up in MELPA on the next update.</p><p>I really like your elfeed-search-filter-toggle command. That's creative and clever! Be careful with current-counter because that's a global variable with the way you've written it. Declare it in that let.</p></div></div></div><div class='comment'><div class='author'>next-user-here</div><time datetime='2013-12-01T13:43:29Z'>Sun, 01 Dec 2013 13:43:29 UTC</time><div class='body'><p>Hi Christopher,</p><p>after two weeks using elfeed I'm very happy with your package, great work man!<br>Thanks a lot, also for your tips.<br>- than[x] Q2<br>- than[x] Q3</p><p>I love the way I can customize every thing I want.<br>Here some examples:</p><p>;----<br>; Ad killer</p><p>(defun my-elfeed-no-ads (entry)<br>  (let ((entry-feed-id (elfeed-entry-feed-id entry)))<br>    (cond<br>                                        ; heise &amp; golem<br>     ((or (string= entry-feed-id "<a href="http://www.heise.de/newsticker/heise.rdf" rel="nofollow noopener" title="http://www.heise.de/newsticker/heise.rdf">http://www.heise.de/newstic...</a>" )<br>          (string= entry-feed-id "<a href="http://www.golem.de/rss.php?feed=RSS1.0" rel="nofollow noopener" title="http://www.golem.de/rss.php?feed=RSS1.0">http://www.golem.de/rss.php...</a>" ))<br>      (let* ((original (elfeed-deref (elfeed-entry-content entry)))<br>             (replace (replace-regexp-in-string "&lt;img.*" ""="" original)))="" (message="" (elfeed-entry-link="" entry))="" (setf="" (elfeed-entry-content="" entry)="" (elfeed-ref="" replace))))="" )))="" (add-hook="" 'elfeed-new-entry-hook="" #'my-elfeed-no-ads)="" ;----="" ;="" read="" all="" key="" (define-key="" elfeed-search-mode-map="" "r"="" '(lambda="" ()="" (interactive)="" (save-excursion="" (mark-whole-buffer)="" (elfeed-search-untag-all-unread)="" )))="" ;----="" ;="" comment="" links="" in="" hacker="" news="" (defun="" my-elfeed-browse-hn-comment="" ()="" "in="" an="" hn="" entry,="" open="" comments="" link"="" (interactive)="" (search-forward="" "comments")="" (backward-char)="" (execute-kbd-macro="" [="" return="" ?q="" ]))="" (define-key="" elfeed-search-mode-map="" "v"="" '(lambda="" ()="" (interactive)="" (beginning-of-line)="" (let="" ((hn?="" (re-search-forward="" "[(,]hn\\b"="" (line-end-position)="" t)))="" ;="" is="" it="" an="" hn="" entry?="" (call-interactively="" 'elfeed-search-show-entry)="" (if="" hn?="" ;="" yes,="" open="" comments="" link="" (my-elfeed-browse-hn-comment)="" ))="" (define-key="" elfeed-show-mode-map="" "c"="" 'my-elfeed-browse-hn-comment)="" ;----="" ;="" handle="" pods="" via="" emms="" (defun="" my-elfeed-play-pod="" ()="" "play="" selected="" feed="" item="" (should="" be="" pod)="" via="" emms"="" (interactive)="" (elfeed-show-yank)="" (let="" ((mp3-url="" (x-get-selection="" 'primary)))="" (if="" (string-match="" "[mm][pp]3$"="" mp3-url)="" (emms-play-url="" mp3-url)="" ;="" not="" an="" mp3="" link,="" search="" for="" it="" (re-search-forward="" "enclosure:[^h]+http")="" (setq="" mp3-url="" (get-text-property="" (point)="" 'shr-url))="" (if="" (numberp="" (string-match="" "[mm][pp]3$"="" mp3-url))="" (emms-play-url="" mp3-url)="" (message="" "no="" mp3="" link="" found!")="" ))))="" (define-key="" elfeed-search-mode-map="" "m"="" '(lambda="" ()="" (interactive)="" (call-interactively="" 'elfeed-search-show-entry)="" (my-elfeed-play-pod)))="" (define-key="" elfeed-show-mode-map="" "m"="" 'my-elfeed-play-pod)="" one="" more="" question="" ;-)="" -="" q4:="" i="" want="" to="" learn="" elisp="" better,="" any="" tips="" beside="" +="" introduction="" to="" programming="" in="" emacs="" lisp="" +="" emacs="" lisp="" reference="" manual="" greetings,="" nuh=""&gt;</p></div><div class='comment'><div class='author'>next-user-here</div><time datetime='2013-12-01T13:54:02Z'>Sun, 01 Dec 2013 13:54:02 UTC</time><div class='body'><p>something went wrong with the code snippets, sorry for that<br>I've pasted it here:<br><a href="https://gist.github.com/anonymous/7733901#file-nuh-elfeed-custom" rel="nofollow noopener" title="https://gist.github.com/anonymous/7733901#file-nuh-elfeed-custom">https://gist.github.com/ano...</a></p><p>One more question ;-)<br>- Q4: I want to learn elisp better, any tips beside<br>  + Introduction to Programming in Emacs Lisp<br>  + Emacs Lisp Reference Manual</p><p>Greetings,<br>NUH</p></div></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2013-12-08T19:25:34Z'>Sun, 08 Dec 2013 19:25:34 UTC</time><div class='body'><p>I like your EMMS trick. That's a good one.</p><p>Sorry, I didn't notice you had a question at the bottom until now. Those two manuals are definitely the place to start. Any Common Lisp material is also good because Elisp is very similar, especially with cl/cl-lib. If you want another free resource to check out, look at <a href="http://www.gigamonkeys.com/book/" rel="nofollow noopener" title="http://www.gigamonkeys.com/book/">Practical Common Lisp</a>. <br>This one's not free but "Object-Oriented Programming in Common Lisp" by Keene is a surprising gem of a book. While Elisp has a CLOS-like object system called "eieio," the lessons don't transfer to Elisp as much as other Lisp resources, but it's still a really good example of Lisp in action. <br>Other than that, read other people's Elisp code and don't hesitate to play around with ideas in your scratch buffer. I've written tons of throwaway experiments that way.</p></div></div></div><div class='comment'><div class='author'>next-user-here</div><time datetime='2013-12-01T15:26:51Z'>Sun, 01 Dec 2013 15:26:51 UTC</time><div class='body'><p>something went wron with the code snippets, so I've put them here:<br><a href="https://gist.github.com/anonymous/7733901#file-nuh-elfeed-custom" rel="nofollow noopener" title="https://gist.github.com/anonymous/7733901#file-nuh-elfeed-custom">https://gist.github.com/ano...</a></p><p>One more question ;-)<br>- Q4: I want to learn elisp better, any tips beside<br>  + Introduction to Programming in Emacs Lisp<br>  + Emacs Lisp Reference Manual</p><p>Greetings,<br>NUH</p></div></div><div class='comment'><div class='author'>next-user-here2</div><time datetime='2013-12-01T16:34:43Z'>Sun, 01 Dec 2013 16:34:43 UTC</time><div class='body'><p>strange the code snippets didn't upload, I've paste them here<br><a href="https://gist.github.com/anonymous/7733901#file-nuh-elfeed-custom" rel="nofollow noopener" title="https://gist.github.com/anonymous/7733901#file-nuh-elfeed-custom">https://gist.github.com/ano...</a></p><p>One more question ;-)<br>- Q4: I want to learn elisp better, any tips beside<br>  + Introduction to Programming in Emacs Lisp<br>  + Emacs Lisp Reference Manual</p><p>Greetings,<br>NUH</p></div></div><div class='comment'><div class='author'>Yukang</div><time datetime='2014-01-05T13:13:31Z'>Sun, 05 Jan 2014 13:13:31 UTC</time><div class='body'><p>Hi nice work, I have a question, do we need to manually press "G" to fetch the new contents? or it will do it automatically backend? IF it do fetching backend , do we have a option to control the time gap?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-01-05T16:57:41Z'>Sun, 05 Jan 2014 16:57:41 UTC</time><div class='body'><p>Right now you have to manually trigger the update. Automatic updating is a sort-of long term goal, but I see it being done more as a separate extension to Elfeed. I recently added metadata to Elfeed structs (the setf-able elfeed-meta function) that would help support updating. It could be used to track the last time a particular feed was updated, or log extra information about a feed's update frequency.</p><p>Two things hold me back. One, I haven't really worked out how often and when feeds should update. I need to read more on this topic. Ideally it should adjust based on the feed's history: update frequency, typical update times, etc. That's why I see it as being a separate extension. If the update logic is elaborate, the complexity is kept separate from Elfeed. Two, updating can be very disruptive. Parsing the XML of a single large feed can lock up Emacs for as long as two seconds. It would probably be annoying to have that happen while you're working.</p><p>Now that I think about it, over the last 4.5 months I've accumulated a sizable Elfeed database. I could use that as a base for an update frequency algorithm, to see if it can use the first half of the database to accurately predict the second, later half.</p></div><div class='comment'><div class='author'>Yukang</div><time datetime='2014-01-06T14:40:45Z'>Mon, 06 Jan 2014 14:40:45 UTC</time><div class='body'><p>Hi Christopher, thanks for your response.</p><p> yes, if Emacs automatically updating the feed, I may lock up Emacs some time, even the time is short, it will be annoying if users can feel it. A good update frequency algorithm may save some time, but I can not solve the problem totally.</p><p>I suggest you could implement it as a separated daemon process(even could be implemented in another language, python/ruby etc), this process response to fetching feeds on time and put it into DB file, and Emacs just response to reading the DB file and show it.</p><p></p></div></div></div></div><div class='comment'><div class='author'>Jean-Michel</div><time datetime='2014-02-27T23:14:09Z'>Thu, 27 Feb 2014 23:14:09 UTC</time><div class='body'><p>very usefull - I'm coming from liferea, but much prefer an emacs integrated approach !</p><p>A question :<br>I have feeds with entries refering to an mp3 file, like this :<br>"Enclosure: <a href="http://podcast.rcf.fr/sit" rel="nofollow noopener" title="http://podcast.rcf.fr/sit">http://podcast.rcf.fr/sit</a>[...]PRISOIR_20140227_1915.mp3"</p><p>I'd like to automatically download the mp3 files, which would turn elfeed into a kind of podcaster. Ideally, I'd like to be able to choose if I download the mp3 files in the elfeed database or somewhere else.</p><p>Is that feasible ?</p><p>Thks</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-02-28T01:16:39Z'>Fri, 28 Feb 2014 01:16:39 UTC</time><div class='body'><p>There are a couple of ways to do this and they'll each take a bit of work to get right.</p><p>One, you can accomplish this with a elfeed-new-entry-hook. I'd just run wget or curl on each of the entry's enclosures since Emacs doesn't really have a clean way to download files on its own. An enclosure is actually a list -- laziness, sorry, should have made it a defstruct! -- (url, type, length).</p><p>I didn't actually test this, but it should look something like the following. You can use elfeed-make-tagger's other key arguments to filter to what sort of entries you act on.</p><p>(add-hook 'elfeed-new-entry-hook<br>(elfeed-make-tagger<br>:callback (lambda (entry)<br>(dolist (e (elfeed-entry-enclosures entry))<br>(start-process "wget" nil "wget" (car e))))))</p><p>The second, and my preferred method, is to initiate the download from the entries listing, or when viewing the entry, with a key binding (i.e. "d" for download). I do this with YouTube entries and youtube-dl. Take a look at it my config:</p><p><a href="https://github.com/skeeto/.emacs.d/blob/master/etc/feed-setup.el" rel="nofollow noopener" title="https://github.com/skeeto/.emacs.d/blob/master/etc/feed-setup.el">https://github.com/skeeto/....</a><br> <a href="https://github.com/skeeto/.emacs.d/blob/master/lisp/youtube-dl-mode.el" rel="nofollow noopener" title="https://github.com/skeeto/.emacs.d/blob/master/lisp/youtube-dl-mode.el">https://github.com/skeeto/....</a> <br>It's complicated by process management stuff, but it's all not strictly necessary.</p></div></div></div><div class='comment'><div class='author'>sgtpep</div><time datetime='2014-05-10T17:47:49Z'>Sat, 10 May 2014 17:47:49 UTC</time><div class='body'><p>A snippet for periodic update for feeds (3 mins since Emacs start, then every half hour):<br>(run-at-time 180 1800 (lambda () (unless elfeed-waiting (elfeed-update))))</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-05-10T17:53:07Z'>Sat, 10 May 2014 17:53:07 UTC</time><div class='body'><p>Good one! One of my long-term goals is to make an extension to Elfeed that does smart, automatic feed updates -- i.e. feeds that update frequently get checked more frequently.</p></div><div class='comment'><div class='author'>sgtpep</div><time datetime='2014-05-11T20:02:44Z'>Sun, 11 May 2014 20:02:44 UTC</time><div class='body'><p>That could be awesome! Especially on Emacses that have no proper gnutls integration.</p></div></div></div></div><div class='comment'><div class='author'>Clément</div><time datetime='2014-11-03T17:05:53Z'>Mon, 03 Nov 2014 17:05:53 UTC</time><div class='body'><p>Hi,</p><p>I just started using elfeed to replace the complicated scheme I had setup with rss2email, and this made me realise that many feeds do not use a proper pubDate tag, when they have one at all. In those cases it seems that elfeed changes the date with every update, instead of keeping the date of the first update. Is that expected behaviour ? Or am I doing something wrong ?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-11-04T16:17:02Z'>Tue, 04 Nov 2014 16:17:02 UTC</time><div class='body'><p>Do you happen to be using the version in Marmalade (1.1.0)? What you're describing is how Elfeed used to work, but that was fixed in May this year (09349d6). However, the version in Marmalade doesn't have this fix yet because I forgot to update it.</p></div><div class='comment'><div class='author'>Clément</div><time datetime='2014-11-04T18:14:54Z'>Tue, 04 Nov 2014 18:14:54 UTC</time><div class='body'><p>I got the package from melpa, which I believe is the last one (it's <br>tagged 20141005.730). I dug a little, and it seems that the feeds with no pubDate at all get the correct time, but the ones with a faulty</p><p>pubDate (i.e not respecting RFC-822) are modified with every update.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-11-04T19:35:30Z'>Tue, 04 Nov 2014 19:35:30 UTC</time><div class='body'><p>Interesting. Could you give me examples (URLs) of a couple of feeds with a broken dates? I want to see just how broken they get, possibly using them as test cases.</p></div><div class='comment'><div class='author'>Clément</div><time datetime='2014-11-04T21:41:21Z'>Tue, 04 Nov 2014 21:41:21 UTC</time><div class='body'><p>Sure. I have just emailed them to you (with subject elfeed: broken RSS feeds).</p></div></div></div></div></div></div><div class='comment'><div class='author'>Dan LaManna</div><time datetime='2015-01-19T06:58:42Z'>Mon, 19 Jan 2015 06:58:42 UTC</time><div class='body'><p>Thanks for the great article - just discovered elfeed and it's been a huge help!</p><p>I understand "deleting" entries isn't viable, but ignoring/hiding certainly is. I've used the new entry hook for example to :add 'junk and :remove 'unread for any entries containing certain strings.</p><p>What I'm uncertain how to accomplish however is ignoring *duplicate* entries, for example a news site has news and politics as 2 separate RSS feeds, but occasionally have overlapping articles, so I'll end up with 2 identical title/url/content entries which in addition have different tagsets.</p><p>I don't particularly care too much about tagsets - but having 40 unread entries with 10 duplicates is frustrating - any thoughts on how to handle such a situation?</p><p>Thanks again!</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-01-20T00:05:32Z'>Tue, 20 Jan 2015 00:05:32 UTC</time><div class='body'><p>The duplicate entries thing is due to an early design decision now that I regret. I was worried about RSS's shortcomings (non-unique entry IDs) and chose to be prepared for that situation rather than gracefully merge identical entries from different feeds. In short, an entry is keyed by a tuple of feed URL and entry ID. If it was just keyed by entry ID, you wouldn't see duplicates.</p><p>Unless I'm mistaken, this also can't be fixed by a new entry hook (tagger), because by the time the hook is called Elfeed has already decided the entry is new and unique, so you can't fixup the entry key. <br>Here's an untested idea: in a new entry hook, search for a duplicate from the other feed already in the database. If it's there already mark it as read/junk.</p><p>Sorry about this! It's turned out that RSS feeds in the wild aren't quite as broken as I had feared and Atom's feed merging capabilities come up more frequently (including my own blog) than I expected.</p></div></div></div><div class='comment'><div class='author'>Noorul Islam Kamal Malmiyoda</div><time datetime='2015-02-24T09:11:14Z'>Tue, 24 Feb 2015 09:11:14 UTC</time><div class='body'><p>I am trying out elfeed and I see that it is not displaying entire content. Currently I am using feedly. For the same entry feedly displays everything.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-02-27T23:59:43Z'>Fri, 27 Feb 2015 23:59:43 UTC</time><div class='body'><p>This is because the feed author is truncting the content in their feed, and that's what Elfeed displays. I'm guessing Feedly uses the entry URL to go fetch the actual entry content. You can get the same effect by using eww (Emacs' built-in browser) as your browser (see "browse-url-browser-function").</p></div></div></div><div class='comment'><div class='author'>surfingandlaughin</div><time datetime='2015-04-05T20:46:18Z'>Sun, 05 Apr 2015 20:46:18 UTC</time><div class='body'><p>Elfeed &lt;3</p><p>Hello Christopher,<br>I must be very dumb as I can't find how to set:<br>elfeed-search-title-max-width<br>elfeed-search-title-min-width<br>elfeed-search-trailing-width</p><p>I'm using elfeed 20150404.545 (melpa) on Emacs 24.1<br>Regards!</p></div></div><div class='comment'><div class='author'>David Feest</div><time datetime='2015-11-03T13:41:40Z'>Tue, 03 Nov 2015 13:41:40 UTC</time><div class='body'><p>First of all: Thanks for this great package! I especially love the endless possibilities to configure it. Still, I'm really an amateur with elisp. Therefore my question is rather simple. Since I am using instapaper, I have integrated it into elfeed using the package instapaper.el:</p><p>(require 'instapaper)</p><p>(defun url2instapaper (message)<br>  (call-process "url2instapaper" nil nil nil message))</p><p>(defun elfeed-url2instapaper ()<br>  (interactive)<br>  (let ((entry (elfeed-search-selected :single)))<br>    (instapaper-add (elfeed-entry-link entry)))<br>  )</p><p>(define-key elfeed-search-mode-map "i" #'elfeed-url2instapaper)</p><p>This works perfectly. But is there a possibility to have the tag changed from "unread" to "instapaper" within the same defun? I tried using "elfeed-make-tagger" but I don't know how to use it on just one entry.</p><p>Thanks in advance!</p><p>Greetings,</p><p>David</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-11-04T01:36:26Z'>Wed, 04 Nov 2015 01:36:26 UTC</time><div class='body'><p>You're off to a good start! Note that elfeed-make-tagger is for tagging entries as they're discovered, not for changing the tags later interactively. The functions you're looking for are elfeed-tag and elfeed-untag. Call them right after instapaper-add, so that if it fails the tags won't change.</p></div><div class='comment'><div class='author'>David Feest</div><time datetime='2015-11-04T09:16:03Z'>Wed, 04 Nov 2015 09:16:03 UTC</time><div class='body'><p>Hi Christopher,</p><p>thanks for the super fast answer! And sorry about my elisp illiteracy! I added:</p><p>    (elfeed-untag entry 'unread))<br>    (elfeed-tag entry 'instapaper)</p><p>to my defun, making it:</p><p>(defun elfeed-url2instapaper ()<br>  (interactive)<br>  (let ((entry (elfeed-search-selected :single)))<br>    (instapaper-add (elfeed-entry-link entry))<br>    (elfeed-untag entry 'unread)<br>    (elfeed-tag entry 'instapaper)))</p><p>Yet, the tag does not change, although I don't get an error message. I must be missing something very obvious, but what is it?</p><p>Best wishes,</p><p>David</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-11-04T14:27:25Z'>Wed, 04 Nov 2015 14:27:25 UTC</time><div class='body'><p>I believe the tag is being correctly applied, you're just seeing a stale display. Add either an elfeed-search-update-line or elfeed-search-update-entry call after updating the tags. This makes the display redraw the line (elfeed-tag and elfeed-untag are low level database functions and are unaware of the entry listing).</p><p>I also like to add (forward-line) as the last action to these sorts of functions so that it automatically advances to the next entry. For example, when you hit "r" or "u" to mark read/unread, it moves to the next line so that you can make a decision about the next entry.</p><p>Also take a look at elfeed-search-tag-all and elfeed-search-untag-all, which are like elfeed-tag and elfeed-untag but are higher level and aware of the entry listing. Perhaps these are what I should have recommended to you in the first place.</p><p>Sorry, this is probably more complicated than it should be!</p></div><div class='comment'><div class='author'>David Feest</div><time datetime='2015-11-04T14:57:54Z'>Wed, 04 Nov 2015 14:57:54 UTC</time><div class='body'><p>Thanks a lot, I made the adjustments and the defun works great now! And don't worry, this is  only complicated for a newbie like me! And I got more than I bargained for anyhow! Actually, I was only looking for a RSS-feed client for Emacs that would simply do its work. Now I have even integrated Instapaper and so many more possibilities! Thanks again for your help and for this great package!</p></div></div></div></div></div></div><div class='comment'><div class='author'>Daniele Giglio</div><time datetime='2016-11-11T16:48:25Z'>Fri, 11 Nov 2016 16:48:25 UTC</time><div class='body'><p>Hi, I'm playing with this awesome program in order to find an effective replacement for Feedly. <br>I've noticed that some feeds, like <a href="http://www.notebookcheck.net/RSS-Feed-Notebook-Reviews.8156.0.html" rel="nofollow noopener" title="http://www.notebookcheck.net/RSS-Feed-Notebook-Reviews.8156.0.html">http://www.notebookcheck.ne...</a> , bring an enclosure tag for images. These are shown in the article buffer as links to the remote files. Is there a way to automatically show them into the buffer?<br>Thanks in advance.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-11-11T19:16:10Z'>Fri, 11 Nov 2016 19:16:10 UTC</time><div class='body'><p>There's no quick-and-easy way to get this right now, but you can do it without mucking with Elfeed directly (e.g. it would work well in your configuration). There's a variable elfeed-show-refresh-function that decides how an entry gets displayed. You could define your own refresh function to wrap the default refresh function such that it inserts the image somewhere in the buffer after the default function has rendered the content.</p></div></div></div><div class='comment'><div class='author'>JohnKitchin</div><time datetime='2017-01-05T01:58:28Z'>Thu, 05 Jan 2017 01:58:28 UTC</time><div class='body'><p>Has anyone tried implementing some kind of scoring method for entries? or conditional tags, e.g. to add tags to entries by a particular person, or on titles that contain particular words?</p></div><div class='comment'><div class='author'>JohnKitchin</div><time datetime='2017-01-05T16:43:16Z'>Thu, 05 Jan 2017 16:43:16 UTC</time><div class='body'><p>To answer my own question: I tried it here <a href="http://kitchingroup.cheme.cmu.edu/blog/2017/01/05/Scoring-elfeed-articles/" rel="nofollow noopener" title="http://kitchingroup.cheme.cmu.edu/blog/2017/01/05/Scoring-elfeed-articles/">http://kitchingroup.cheme.c...</a> in case anyone else is interested in trying it.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-01-07T17:53:20Z'>Sat, 07 Jan 2017 17:53:20 UTC</time><div class='body'><p>Interesting approach, thanks for sharing! I added a link to your article to the Elfeed README.</p></div><div class='comment'><div class='author'>JohnKitchin</div><time datetime='2017-01-07T18:35:25Z'>Sat, 07 Jan 2017 18:35:25 UTC</time><div class='body'><p>Thanks. Elfeed is a great application, thanks for making it!</p></div></div></div></div></div></div><hr/><div class='thread'><h1 id='2013-11-28'><a href='/blog/2013/11/28/'>Thanksgiving and Hanukkah</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2013-12-16'><a href='/blog/2013/12/16/'>Emacs Lisp Reddit API Wrapper</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2013-12-18'><a href='/blog/2013/12/18/'>Clojure-style Multimethods in Emacs Lisp</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2013-12-30'><a href='/blog/2013/12/30/'>Emacs Lisp Printable Closures</a></h1><div class='comment'><div class='author'>Marcin Cieslik</div><time datetime='2014-01-02T10:42:37Z'>Thu, 02 Jan 2014 10:42:37 UTC</time><div class='body'><p>R shares the printable-closure property as well:</p><p>&gt; a = function(x) {x*2}<br>&gt; b = eval(print.function(a))<br>function(x) {x*2}<br>&gt; a(1)<br>[1] 2<br>&gt; b(1)<br>[1] 2</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-01-02T15:58:01Z'>Thu, 02 Jan 2014 15:58:01 UTC</time><div class='body'><p>R doesn't quite do it either. It's in the same bucket as JavaScript where the function body is printed but the lexical environment is not. If you actually close over a variable in your closure you'll get an unreadable memory reference.</p><p><code><br>&gt; myIdentity = function(x) { function() { x } }<br>&gt; myIdentity(1)<br>function() { x }<br>&lt;environment: 0x20feb18&gt;<br></code></p></div><div class='comment'><div class='author'>Marcin Cieslik</div><time datetime='2014-01-03T14:09:50Z'>Fri, 03 Jan 2014 14:09:50 UTC</time><div class='body'><p>Thanks, I see your point now.</p></div></div></div></div><div class='comment'><div class='author'>Constantine</div><time datetime='2014-01-05T18:22:18Z'>Sun, 05 Jan 2014 18:22:18 UTC</time><div class='body'><p>Interesting stuff! Thanks for sharing.</p><p>Note that "It takes on two forms depending on weather the closure is compiled or not." should read as "It takes on two forms depending on whether the closure is compiled or not." ("whether" instead of "weather").</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-01-05T18:27:38Z'>Sun, 05 Jan 2014 18:27:38 UTC</time><div class='body'><p>Oops, thanks for pointing out the typo. Fixed.</p></div></div></div><div class='comment'><div class='author'>ascii</div><time datetime='2015-12-04T00:26:54Z'>Fri, 04 Dec 2015 00:26:54 UTC</time><div class='body'><p>I think also erlang shares this property of serialized closures. Its similar</p><p>&gt; X = 10<br>&gt; F = fun(Y) -&gt; Y + X end.<br>&gt; Serialized = erlang:term_to_binary(F).</p><p>... you can save Serialized to disk, send it across the network to another running program, etc, and then you can get your F back again:</p><p>&gt; Deserialized = erlang:binary_to_term(Serialized).<br>&gt; Deserialized(5).<br>15</p><p>Pretty cool.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-12-04T14:50:43Z'>Fri, 04 Dec 2015 14:50:43 UTC</time><div class='body'><p>Oh, interesting. In that case it's now two languages I know about with serializable closures.</p></div></div></div><div class='comment'><div class='author'>Wilfred Hughes</div><time datetime='2017-01-10T17:45:56Z'>Tue, 10 Jan 2017 17:45:56 UTC</time><div class='body'><p>Fascinating! If I'm not mistaken, a smarter byte-compiler could actually remove the temp-buffer variable, as it's not used in the body of the closure. Is that correct?</p><p>(The problem would still exist, I think, if the closure body contained a reference to the closed-over variable.)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-01-10T18:36:46Z'>Tue, 10 Jan 2017 18:36:46 UTC</time><div class='body'><p>Actually, the byte compiler is already smart enough to eliminate unreferenced variables, including temp-buffer. This is only a problem in the interpreted code, where that sort of analysis isn't (and can't reasonably be) done. I elaborate more on this in a later article:</p><p><a href="http://nullprogram.com/blog/2016/12/22/#accidental-closures" rel="nofollow noopener" title="http://nullprogram.com/blog/2016/12/22/#accidental-closures">http://nullprogram.com/blog...</a></p></div></div></div></div><hr/><div class='thread'><h1 id='2014-01-04'><a href='/blog/2014/01/04/'>Emacs Byte-Code Internals</a></h1><div class='comment'><div class='author'>rgiar</div><time datetime='2014-01-05T15:13:19Z'>Sun, 05 Jan 2014 15:13:19 UTC</time><div class='body'><p>Great stuff, thanks, I've always wanted to trace through the bytecode interpreter -- after your article, I'm ready to skip forward a step and start thinking big :)</p></div></div><div class='comment'><div class='author'>Lars Brinkhoff</div><time datetime='2014-01-07T11:45:05Z'>Tue, 07 Jan 2014 11:45:05 UTC</time><div class='body'><p>My current Common Lisp compiler emits Emacs Lisp.  I plan to write a new one that generates lapcode instead.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-01-07T17:55:06Z'>Tue, 07 Jan 2014 17:55:06 UTC</time><div class='body'><p>You should have linked your project because it's very interesting! I'll do it for you:</p><p><a href="https://github.com/larsbrinkhoff/emacs-cl" rel="nofollow noopener" title="https://github.com/larsbrinkhoff/emacs-cl">https://github.com/larsbrin...</a></p><p>What do you think the advantages of targeting lapcode would be? So far I think the Elisp compiler does a great job already and using Elisp as a target language takes full advantage of it. Do you think you could beat it, or would it just be for purity or fun?</p></div><div class='comment'><div class='author'>Lars Brinkhoff</div><time datetime='2015-10-23T08:52:32Z'>Fri, 23 Oct 2015 08:52:32 UTC</time><div class='body'><p>Sorry, didn't see your answer until now.</p><p>The translation of Common Lisp -&gt; Emacs Lisp -&gt; bytecode isn't very good.  There seem to be a lot of redundancies.  I imagine having full access to every low-level detail of the bytecode virtual machine will make it possible to generate much better code.</p><p>I guess most higher-level languages will be more restrictive than a low-level assembly language.  E.g. there are things you can do in machine code that you just can't do in C, even though C is touted as a high-level assembly language.</p></div></div></div></div><div class='comment'><div class='author'>Vladimir Kazanov</div><time datetime='2015-05-20T14:19:35Z'>Wed, 20 May 2015 14:19:35 UTC</time><div class='body'><p>Thank you for the article. Aren't too many docs on the Emacs VM out there, apart from the bytecomp.el code itself.</p><p>As for the project ideas of mine: a) implement a small Python-like language on top of the VM; or b) try out a few interesting IR-lang compiling techniques (think "Compiling with continuations").</p></div></div><div class='comment'><div class='author'>Rocky Bernstein</div><time datetime='2017-12-19T13:09:25Z'>Tue, 19 Dec 2017 13:09:25 UTC</time><div class='body'><p>A couple of things. First, I've started a bytecode decompiler. See <a href="https://github.com/rocky/elisp-decompile" rel="nofollow noopener" title="https://github.com/rocky/elisp-decompile">https://github.com/rocky/el...</a></p><p>The other thing is that I think it's about time a full reference manual for bytecode be written. Python for example does a pretty good (but not great) job of this for example. So I've started that as well  See <a href="https://github.com/rocky/elisp-lap" rel="nofollow noopener" title="https://github.com/rocky/elisp-lap">https://github.com/rocky/el...</a>  When that doc is more fully completed, I hope to get this incorporated into the Emacs Lisp Reference. So please contribute.</p><p>Also, it would be great if relevant parts of this were added to that. Is that okay?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-12-19T14:47:16Z'>Tue, 19 Dec 2017 14:47:16 UTC</time><div class='body'><p>Those are interesting and ambitious projects. I look forward to seeing where they go. At the footer of my blog is a public domain dedication, so all of my articles are in the public domain by default (with certain specially-marked exceptions when I've used other peoples' images). You're free to use my article and transform it however you like, for any purpose, including your byte-code document. No strings attached.</p><p>I believe part of the reason Emacs' byte-code hasn't been formally documented is so that it's not locked down to any particular semantics. It's not part of Emacs' formal API, so interfacing with it is perilous. It's already the case that byte-code isn't compatible across releases, allowing the Emacs devs change things as needed and without warning. And they do take advantage of this fact. For example, the byte-code generated for throw/catch changed significantly in Emacs 24.5 with addition of a new "pushcatch" opcode. This was only documented in source code comments.</p></div><div class='comment'><div class='author'>Rocky Bernstein</div><time datetime='2017-12-20T02:20:24Z'>Wed, 20 Dec 2017 02:20:24 UTC</time><div class='body'><p>Many thanks. Will make sure to give credit where credit is due. The situation in Emacs is no different than say Python. In fact, Python is probably worse as the bytecode changes every year, and sometimes very drastically.</p><p>But note,a couple of things. First, in contrast to LAP, Python does document the bytecode for each release and indicates when a bytecode got added, or removed or changed semantics. To see what has changed between say Python 3.5 and Python 3.6 see <a href="https://github.com/rocky/python-xdis/blob/35c038853ea94b84e0409c72fbb4683a5655cce1/xdis/opcodes/opcode_35.py#L23-L46" rel="nofollow noopener" title="https://github.com/rocky/python-xdis/blob/35c038853ea94b84e0409c72fbb4683a5655cce1/xdis/opcodes/opcode_35.py#L23-L46">https://github.com/rocky/py...</a></p><p>Second, I've still been able to write a decompiler for the 20 or so releases and variants.</p><p>I do intend in this document to indicate when bytecodes enter, leave, or change. I have a query out already in emacs-lisp for this. See <a href="https://lists.gnu.org/archive/html/emacs-devel/2017-12/msg00686.html" rel="nofollow noopener" title="https://lists.gnu.org/archive/html/emacs-devel/2017-12/msg00686.html">https://lists.gnu.org/archi...</a></p><p>But I know someone will have to do a bit of digging to get this information. Some of it is in <a href="https://www.emacswiki.org/emacs/ByteCodeEngineering" rel="nofollow noopener" title="https://www.emacswiki.org/emacs/ByteCodeEngineering">https://www.emacswiki.org/e...</a> for very old stuff.</p><p>But if you know of other changes, please let me know as this will save time.</p><p>Again, thanks</p></div></div></div></div><div class='comment'><div class='author'>Klaus</div><time datetime='2018-05-02T14:53:10Z'>Wed, 02 May 2018 14:53:10 UTC</time><div class='body'><p>Another nice detail which I wasn't aware of before experimenting based on this article: Lexical variables that are captured by closures are encapsuled into cons cells, and accessed through a "car-safe" or "setcar" operation, with the reference to the cons cell being stored in the constants-vector.</p><p>I wonder if the possible optimization of using also the CDR of the cons was omitted purely because of the added complexity for the byte-compiler (vs presumably small gains)?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-05-02T16:21:19Z'>Wed, 02 May 2018 16:21:19 UTC</time><div class='body'><p>Yup, I talked about that aspect of closures in this later article:</p><p>What's in an Emacs Lambda<br><a href="http://nullprogram.com/blog/2017/12/14/" rel="nofollow noopener" title="http://nullprogram.com/blog/2017/12/14/">http://nullprogram.com/blog...</a></p><p>In closures, the cons cell is being used to "box" the value so that different function objects can share and set the same variable by sharing this cons cell. The CDR just serve any purpose in this case.</p></div></div></div></div><hr/><div class='thread'><h1 id='2014-01-25'><a href='/blog/2014/01/25/'>Measure Elisp Object Memory Usage with Calipers</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2014-01-26'><a href='/blog/2014/01/26/'>Measure Elisp Object Memory Usage with Calipers</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2014-01-27'><a href='/blog/2014/01/27/'>Emacs Lisp Object Finalizers</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2014-02-06'><a href='/blog/2014/02/06/'>Introducing EmacSQL</a></h1><div class='comment'><div class='author'>abo-abo</div><time datetime='2014-03-27T11:21:25Z'>Thu, 27 Mar 2014 11:21:25 UTC</time><div class='body'><p>Hi,</p><p>What's your indent setup for Elisp? How did you make vectors indent properly?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-03-27T15:24:31Z'>Thu, 27 Mar 2014 15:24:31 UTC</time><div class='body'><p>That had been annoying me so much that I added an interactive function, emacsql-fix-vector-indentation, to fix it. It's described in the README (link below). I haven't sorted out all the edge cases, so it's still not exactly right, but it should help a lot for now.</p><p><a href="https://github.com/skeeto/emacsql#emacs-lisp-indentation-annoyance" rel="nofollow noopener" title="https://github.com/skeeto/emacsql#emacs-lisp-indentation-annoyance">https://github.com/skeeto/e...</a></p><p>Not many people write vector literals in Elisp so it's one of those broken things in emacs-lisp-mode.</p></div><div class='comment'><div class='author'>abo-abo</div><time datetime='2014-03-27T15:42:32Z'>Thu, 27 Mar 2014 15:42:32 UTC</time><div class='body'><p>Thanks, defadvice makes sense now. I patched `calculate-lisp-indent` instead and was thinking if there's a chance it could be accepted upstream.</p><p>Anyway, I want to select stuff from the db with a regex, like here: <a href="http://stackoverflow.com/a/8338515/1350992" rel="nofollow noopener" title="http://stackoverflow.com/a/8338515/1350992">http://stackoverflow.com/a/...</a>. It seems that emacsql doesn't support this. So I've tried to open the db created with emacsql from the shell, but it says "Unable to open database "semantic.db": file is encrypted or is not a database". Any thoughts on this?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-03-27T16:03:36Z'>Thu, 27 Mar 2014 16:03:36 UTC</time><div class='body'><p>EmacSQL comes with a custom build of SQLite, so whatever you install on your system doesn't matter. I didn't want to also embed a regex library, so it's disabled in the EmacSQL build. The full-text search is enabled, though, which should generally be more useful.</p><p>As for the issue of opening the database, I don't know what would cause that. EmacSQL comes with SQLite 3.8.2. If your system's SQLite shell program is old enough, perhaps it can't read the file produced by EmacSQL. With FTS4 turned on, I think there should be backwards compatability problems with older SQLite builds.</p></div></div></div></div></div><div class='comment'><div class='author'>maxxcan</div><time datetime='2016-03-02T16:47:51Z'>Wed, 02 Mar 2016 16:47:51 UTC</time><div class='body'><p>Hi,</p><p>I'm learning Elisp and I started programming a simple form with widget library and emacsql but I don't  finish to understand how implement this in a elisp function with variables.</p><p>May you write any examples??</p><p>Thank you very much for this and for all your work with Emacs, editor that I love. I hope soon translate the documentation of your emacs package to my own language.</p></div></div></div><hr/><div class='thread'><h1 id='2014-02-15'><a href='/blog/2014/02/15/'>Reimaging a VM from the inside with Debian</a></h1><div class='comment'><div class='author'>Gavin Black</div><time datetime='2014-02-17T02:31:24Z'>Mon, 17 Feb 2014 02:31:24 UTC</time><div class='body'><p>This is almost exactly how you install Gentoo, except instead of <br>debootstrap you just unpack a stage tarball...that and compiling <br>everything at each step :P Also on the makedev step could you not just <br>replace it with "mount --rbind /dev /chrootDir/dev" and "mount --rbind <br>/dev /chrootDir/sys" before chrooting?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-02-17T02:39:10Z'>Mon, 17 Feb 2014 02:39:10 UTC</time><div class='body'><p>Oh yeah, I kind of remember Gentoo's stage tarballs.</p><p>The linked Debian manual appendix says this about bind mounting /dev:</p><p></p><blockquote>note that the postinst scripts of some packages may try to create device files, so this option should only be used with care</blockquote><p> <br>So I just followed the recommended procedure to avoid any issues.</p></div></div></div><div class='comment'><div class='author'>Deepti</div><time datetime='2017-03-10T09:15:25Z'>Fri, 10 Mar 2017 09:15:25 UTC</time><div class='body'><p>Nice Post !! <br>I have debian whezzy vm on ubuntu .I want to convert vm to usb bootable live cd (persistent) or bootable iso so that it can be easily distributed.<br>Can you please guide on above issue ?<br>I have tried but either the created iso is read-only or  boot  with errors.</p></div></div></div><hr/><div class='thread'><h1 id='2014-03-06'><a href='/blog/2014/03/06/'>The Julia Programming Language</a></h1><div class='comment'><div class='author'>PuercoPop</div><time datetime='2014-03-07T05:24:39Z'>Fri, 07 Mar 2014 05:24:39 UTC</time><div class='body'><p>Nice overview of Julia. One question I'm left with, how do generic functions interact with keywords and optional parameters? Do they exist in Julia?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-03-07T17:36:37Z'>Fri, 07 Mar 2014 17:36:37 UTC</time><div class='body'><p>Julia has keyword arguments,<br> <a href="http://julia.readthedocs.org/en/latest/manual/functions/#keyword-arguments" rel="nofollow noopener" title="http://julia.readthedocs.org/en/latest/manual/functions/#keyword-arguments">http://julia.readthedocs.or...</a> <br>The manual doesn't say how this interacts with generic dispatch so I experimented. It looks like it doesn't use keyword arguments when dispatching. I defined two methods with different keyword types and the function had only one method, meaning it overwrote the first definition. <br>Optional arguments is one of those things Julia does especially elegantly and I should have mentioned it in my post. Optional arguments are actually syntactic sugar for multiple method definitions. A separate method is defined per optional argument. Done this way, optional arguments aren't a special feature but rather a side effect of multimethods. This also means that optional arguments' types are considered in generic dispatch, though only when supplied.</p></div></div></div><div class='comment'><div class='author'>Johan Sigfrids</div><time datetime='2014-03-09T23:46:28Z'>Sun, 09 Mar 2014 23:46:28 UTC</time><div class='body'><p>Regarding strings I believe both Go and Rust behave the same way. A char/rune is a 32 bit integer and indexing strings gives you a byte, not a character. I don't know why it was designed this way, but if the designers of three separate, modern languages have reached the same design, I would assume there is a compelling reason. </p></div><div class='comment'><div class='author'>Matt B</div><time datetime='2014-03-11T16:59:51Z'>Tue, 11 Mar 2014 16:59:51 UTC</time><div class='body'><p>There's a very compelling reason: algorithmic complexity!</p><p>Indexing is generally thought to be an O(1) operation, but with UTF8/UTF16 it's O(n). What's cool, though, is that Julia's iteration protocol jumps from valid character to valid character. So `for char in str` only gives you valid characters. If you really just want the nth character, you can just ask for `str[chr2ind(n)]`. It's easy to use an O(1) algorithm in the development of more complicated functions… but were it O(n) by default you'd have to be careful how many times you index into the string. If you naively iterated over all the characters like this from `str[1]` to `str[end]`, you suddenly have O(.5*n*(n-1)). Julia's solution to use next with external state is very simple and lightweight. For a performance-driven language, their choice is a no-brainer.</p></div></div></div><div class='comment'><div class='author'>Ahmed Fasih</div><time datetime='2014-03-19T15:12:08Z'>Wed, 19 Mar 2014 15:12:08 UTC</time><div class='body'><p>Eeek, anytime I read '"Matlab done right"' I think of Linus Torvalds' scathing comment on Subversion ('Subversion used to say CVS done right: with that slogan there is nowhere you can go. There is no way to do CVS right.' 2007). It looks like Julia went back further than Matlab to start doing things right :)</p><p>The sealing of modules is a roadblock only to interactive development of modules, right? Using modules to prototype algorithms interactively or just do calculations isn't impaired by it?</p><p>I'm now going to go look at its C++ interop.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-03-19T16:06:40Z'>Wed, 19 Mar 2014 16:06:40 UTC</time><div class='body'><p>It's only a problem when you want to modify the module without destroying your program's running state. If changes are made, the entire module has to be reloaded, obsoleting any instances of types made from the previous module definition even if the type's definition didn't change.</p></div><div class='comment'><div class='author'>Ahmed Fasih</div><time datetime='2014-03-19T17:46:51Z'>Wed, 19 Mar 2014 17:46:51 UTC</time><div class='body'><p>I should probably know the answer but how does Python deal with this? I often use the 'autoreload' plugin with Ipython where it reimports all imported modules precisely for situations where I'm editing the modules as I'm experimenting interactively.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-03-20T17:32:46Z'>Thu, 20 Mar 2014 17:32:46 UTC</time><div class='body'><p>I only know a little bit about Python, so there might be something I'm unaware of. To try to answer this -- since I was really curious, too -- I did some research and asked around. It looks to me that the Python situation is slightly better.</p><p>In Python there's no way to switch namespaces into a module to modify it at run time. Reloading a module has the same effect as reloading a Julia module: all types (classes) are overwritten such that old instances are obsoleted. Since Python doesn't have multimethods, this part isn't so bad. Only methods are effected by the class update (old instances still call old methods) and functions will continue to work without surprises (functions applied to old objects run the new version of the function). <br>Something curious I noticed is that I couldn't find anyone anywhere asking how to switch the "current" module in the manner of Clojure (in-ns) or Common Lisp (in-package). It seems no one using Python cares about this.</p><p>The autoreload documentation suggests that reloading modules is a messy process, and they have some hacks in place to make it nicer:</p><p>"Reloading Python modules in a reliable way is in general difficult, and unexpected things may occur. %autoreload tries to work around common pitfalls by replacing function code objects and parts of classes previously in the module with new versions."</p><p>Where Python has a distinct advantage over Julia is that you're actually allowed to redefine a class. This way you can still live-develop a single module per Python instance, where the current "global" namespace is implicitly your module.</p><p>In Julia, the only way to redefine a type is to reload the module it came from. If it wasn't from a module then it's permanent for the remainder of the program. It makes for a lot of restarting, like writing in C, C++, or Java.</p></div></div></div></div></div><div class='comment'><div class='author'>slocklin</div><time datetime='2014-07-23T02:41:11Z'>Wed, 23 Jul 2014 02:41:11 UTC</time><div class='body'><p>I'm curious what you think octave did right that matlab didn't, other than giving it away for free. They seem to be interoperable to me. Even the modern octave IDE is starting to look like Matlab's.<br>You've definitely identified one of Julia's big problems with not being able to redefine things in modules. An even bigger (related) problem is, if you redefine things at the top level, and there are references to the named function elsewhere, those changes won't propagate through, and it won't tell you what just happened. That's pretty amateur hour for something which purports to be usable as an interpretor. Even makefiles prevent that sort of error in C. Try it and see:</p><p>g = function() {return 9}</p><p>f = function() {return g()}<br>g = function() {return 2}<br>f()</p><p>I said "rotsa ruck" when I saw that atrocity.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-07-23T04:41:16Z'>Wed, 23 Jul 2014 04:41:16 UTC</time><div class='body'><p>Matlab's parser is like PHP's parser. It's just an ad-hoc mess written by an amateur. I'm amazed they still ship it the way it is. Lots of expressions don't parse (throwing an error) that really should parse, particularly expressions involving compound matrix indexing. It's a regular source of annoyance for me. Here's my favorite example:</p><p><a href="http://nullprogram.com/blog/2008/08/29/" rel="nofollow noopener" title="http://nullprogram.com/blog/2008/08/29/">http://nullprogram.com/blog...</a></p><p>In contrast, the Octave folks have developed a proper grammar so that everything parses pretty reasonably. They took Mathwork's own language and implemented it far better -- something open source has always been far superior at doing. What Octave is missing is all the fancy toolkits, huge selection of functions (though they're gradually catching up), newbie-friendly IDE, and rich plotting API.</p></div></div></div><div class='comment'><div class='author'>Wilfred</div><time datetime='2014-08-22T17:37:19Z'>Fri, 22 Aug 2014 17:37:19 UTC</time><div class='body'><p>&gt; There's no opening the<br>module back up to define or redefine new functions or types.</p><p>Good news: eval() lets you add to a module! <a href="http://docs.julialang.org/en/release-0.3/stdlib/base/?highlight=eval#Base.eval" rel="nofollow noopener" title="http://docs.julialang.org/en/release-0.3/stdlib/base/?highlight=eval#Base.eval">http://docs.julialang.org/e...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-08-22T18:53:13Z'>Fri, 22 Aug 2014 18:53:13 UTC</time><div class='body'><p>Thanks for the info. I've since found out that Julia evolves so fast that my article is quickly becoming dated, especially with 0.3.0 now out. It leaves me excited for the future.</p></div></div></div></div><hr/><div class='thread'><h1 id='2014-03-19'><a href='/blog/2014/03/19/'>Emacs Lisp Defstruct Namespace Convention</a></h1><div class='comment'><div class='author'>Daniel Hackney</div><time datetime='2014-04-30T00:56:17Z'>Wed, 30 Apr 2014 00:56:17 UTC</time><div class='body'><p>This is exactly what I ended up doing in my "package.el" rewrite. It would've been nice if "cl-defstruct" did this by default, but the alternative isn't so bad.</p></div></div></div><hr/><div class='thread'><h1 id='2014-03-31'><a href='/blog/2014/03/31/'>Northbound 7DRL 2014</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2014-04-01'><a href='/blog/2014/04/01/'>Duck Typing vs. Type Erasure</a></h1><div class='comment'><div class='author'>Dawid Midura</div><time datetime='2014-09-29T03:04:56Z'>Mon, 29 Sep 2014 03:04:56 UTC</time><div class='body'><p>Very interesting. Seeing how the same concepts look in various languages is always entertaining.</p></div></div></div><hr/><div class='thread'><h1 id='2014-04-25'><a href='/blog/2014/04/25/'>Three Dimensions of Type Systems</a></h1><div class='comment'><div class='author'>someone</div><time datetime='2016-06-07T17:34:11Z'>Tue, 07 Jun 2016 17:34:11 UTC</time><div class='body'><p>scoping is by no means related to type systems</p></div></div></div><hr/><div class='thread'><h1 id='2014-04-26'><a href='/blog/2014/04/26/'>An Emacs Foreign Function Interface</a></h1><div class='comment'><div class='author'>Kototama</div><time datetime='2014-04-29T09:59:24Z'>Tue, 29 Apr 2014 09:59:24 UTC</time><div class='body'><p>Awesome. I think in general it could be useful if a programming language compiler support incremental compilation through a library? Or maybe for tools like cscope if they have a library? Or you could build an interface on top of libptrace :-). Many cools ideas will come...</p></div></div><div class='comment'><div class='author'>wasamasa</div><time datetime='2014-05-01T10:26:43Z'>Thu, 01 May 2014 10:26:43 UTC</time><div class='body'><p>I can only think of silly things. Like doing a MOD player/tracker by using any of the appropriate libraries. Maybe extend that to do a non-puzzle game with either SVG or XBM/XPM for graphics and let the FFI part do sound. Or do a NES emulator instead of the game. And while I'm at it enhance the display engine to use OpenGL.</p><p>For less silly things, I'd love to replace the approach of building a binary that uses Clang to analyze code with an Emacs Interface to libclang. And avoid baking in crypto libraries maybe.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-05-01T23:19:47Z'>Thu, 01 May 2014 23:19:47 UTC</time><div class='body'><p>Oh, crypto is a good idea.</p></div></div></div><div class='comment'><div class='author'>wasamasa</div><time datetime='2014-05-09T09:16:57Z'>Fri, 09 May 2014 09:16:57 UTC</time><div class='body'><p>Another thing that occurred me would be the creation of thumbnails. image-dired shells out to Imagemagick and creates its thumbnails in a temporary directory which is fine if it's just one or two, but slow for larger directories you want to preview. It would be cool if one could use FFI and imlib2 to just hand over the thumbnail directly to Emacs which should be both faster and avoid temporary files.</p></div></div><div class='comment'><div class='author'>x4da</div><time datetime='2014-08-13T00:28:18Z'>Wed, 13 Aug 2014 00:28:18 UTC</time><div class='body'><p>we desperately need C FFI for writing tox client for emacs. <a href="http://tox.im" rel="nofollow noopener" title="http://tox.im">http://tox.im</a><br>for now i can't see how to handle callbacks with your FFI. Is it possible?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-08-13T01:45:02Z'>Wed, 13 Aug 2014 01:45:02 UTC</time><div class='body'><p>I only got far enough for it to be a proof-of-concept, which didn't include callbacks. Callbacks are technically feasible, especially since I'm using libffi, but would require reworking the backend protocol a bit. Currently the FFI subprocess is a slave that can only respond to requests by Emacs and it cannot initiate any action.</p></div></div></div><div class='comment'><div class='author'>huix</div><time datetime='2016-04-22T15:33:29Z'>Fri, 22 Apr 2016 15:33:29 UTC</time><div class='body'><p>i use ffi-call,but it occur error that emacs minibuffer shows the error "(error "Process ffi not running")",how can i resolve this problem</p></div></div><div class='comment'><div class='author'>JohnKitchin</div><time datetime='2017-07-16T13:55:59Z'>Sun, 16 Jul 2017 13:55:59 UTC</time><div class='body'><p>I would use this to get zeromq bindings so emacs could talk to Jupiter kernels directly. Also to integrate bson and mongoc for native communication with MongoDB. Finally I would integrate something like the GSL to get numerical mthods into Emacs. Those are my current itches :)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-07-17T17:09:20Z'>Mon, 17 Jul 2017 17:09:20 UTC</time><div class='body'><p>I've read your articles on accessing GSL and ZeroMQ via dynamic modules / FFI. Interesting stuff. What you've already done with the other native interfaces will work way better than anything you could do with my little (incomplete) FFI toy here.</p></div><div class='comment'><div class='author'>JohnKitchin</div><time datetime='2017-07-18T00:39:43Z'>Tue, 18 Jul 2017 00:39:43 UTC</time><div class='body'><p>I have more or less come to that conclusion for all the ffi options available so far. i am leaning towards building up some C macros and helpers to make writing the modules easier for me. Thanks for confirming that!</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2014-05-14'><a href='/blog/2014/05/14/'>Digispark and Debian</a></h1><div class='comment'><div class='author'>Juan Manuel</div><time datetime='2017-08-11T02:04:23Z'>Fri, 11 Aug 2017 02:04:23 UTC</time><div class='body'><p>Excellent! Thank you very much, it helped. Juan.</p></div></div><div class='comment'><div class='author'>sdsds</div><time datetime='2018-09-30T06:44:54Z'>Sun, 30 Sep 2018 06:44:54 UTC</time><div class='body'><p>Yes, oh yes, thank you!</p><p>FWIW your blog entry is now number seven on the list when google is queried with "digispark micronucleus udev rules"! ;-)</p></div></div></div><hr/><div class='thread'><h1 id='2014-05-27'><a href='/blog/2014/05/27/'>Emacs Buffers as String Builders</a></h1><div class='comment'><div class='author'>Jon O.</div><time datetime='2014-05-27T07:43:14Z'>Tue, 27 May 2014 07:43:14 UTC</time><div class='body'><p>Nice post. It's not relevant to your main point, but you could also replace your first use of `with-temp-buffer` + `let` with the `with-output-to-string` macro.</p><p>IMO, one of the nicer things about (Emacs) Lisp is that although it's full of side-effects, it's generally easy to ensure that any side effects are contained strictly within a particular lexical scope using special forms / macros:  `save-excursion`, `save-match-data`, `save-restriction`, `with-current-buffer`, etc.  Just like `let` allows you to delimit a local scope (which I also miss in other languages), these forms give you something like a locally-limited scope of side-effects.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-05-27T13:32:21Z'>Tue, 27 May 2014 13:32:21 UTC</time><div class='body'><p>Huh, somehow I was unaware of with-output-to-string. I'll have to use it more often. I know I've looked for with-input-from-string before, which doesn't exist in Elisp.</p><p>All those with-* and save-* macros are definitely handy. I often provide my own package-specific with-* and save-* macros in my packages.</p></div></div></div><div class='comment'><div class='author'>Wilfred</div><time datetime='2014-08-22T17:31:54Z'>Fri, 22 Aug 2014 17:31:54 UTC</time><div class='body'><p>Really interesting post. Since strings are mutable in Emacs, what do I gain from using buffers instead of strings directly?</p><p>Your article suggests that some operations are more efficient with buffers, but I'd be really interested to know what operations.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-08-22T19:31:25Z'>Fri, 22 Aug 2014 19:31:25 UTC</time><div class='body'><p>Elisp strings are fixed length, so they don't support insertions or deletions. To get that you need to allocate a whole new string and copy the old contents. The one way they're mutable is that you can change the character at a specific position.</p><p>In contrast, buffers are implemented as gap buffers, which are really good at clustered insertions and deletions.</p></div></div></div><div class='comment'><div class='author'>Artur</div><time datetime='2014-08-23T14:50:46Z'>Sat, 23 Aug 2014 14:50:46 UTC</time><div class='body'><p>Good post. It's very easy to forget that temp buffers can be a lot more convenient than concat's and format's.<br>And apparently (point) is a valid place for setf? That's pretty cool. :-)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-08-23T15:11:28Z'>Sat, 23 Aug 2014 15:11:28 UTC</time><div class='body'><p>The cl-lib package defines setf for lots of things. It's one of the best features of Common Lisp to come to Elisp. It cuts the size of APIs almost in half because there doesn't need to be a setter paired to every getter. The cl manual has a list of other setf places:<br> <a href="http://www.gnu.org/software/emacs/manual/html_mono/cl.html#Generalized-Variables" rel="nofollow noopener" title="http://www.gnu.org/software/emacs/manual/html_mono/cl.html#Generalized-Variables">http://www.gnu.org/software...</a> <br>I strongly prefer to use setf over specialized setter functions, especially now that setf is a core part of Emacs (gv). Also, if you think this is cool, be sure to look up cl-letf!</p></div><div class='comment'><div class='author'>Artur</div><time datetime='2014-08-24T16:13:20Z'>Sun, 24 Aug 2014 16:13:20 UTC</time><div class='body'><p>Thanks for the link! I ended up writing about it.<br><a href="http://endlessparentheses.com/emacs-advanced-basics-the-ins-and-outs-of-setf.html" rel="nofollow noopener" title="http://endlessparentheses.com/emacs-advanced-basics-the-ins-and-outs-of-setf.html">http://endlessparentheses.c...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-08-24T16:49:18Z'>Sun, 24 Aug 2014 16:49:18 UTC</time><div class='body'><p>Cool, nice work!</p></div></div></div></div></div></div><hr/><div class='thread'><h1 id='2014-05-26'><a href='/blog/2014/05/26/'>Upcoming Emacs Chat with Sacha Chua</a></h1><div class='comment'><div class='author'>PuercoPop</div><time datetime='2014-05-27T03:02:16Z'>Tue, 27 May 2014 03:02:16 UTC</time><div class='body'><p>Nice, I hope you get to talk about skewer's innards!</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-05-27T03:09:10Z'>Tue, 27 May 2014 03:09:10 UTC</time><div class='body'><p>I'll try to remember to bring that up!</p></div><div class='comment'><div class='author'>sachac</div><time datetime='2014-05-30T18:44:13Z'>Fri, 30 May 2014 18:44:13 UTC</time><div class='body'><p>I'm definitely looking forward to asking you about skewer and impatient-mode, and probably a "*boggle* How does it... work?" =)</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2014-06-01'><a href='/blog/2014/06/01/'>A GPU Approach to Voronoi Diagrams</a></h1><div class='comment'><div class='author'>Rekkal</div><time datetime='2014-06-03T04:33:03Z'>Tue, 03 Jun 2014 04:33:03 UTC</time><div class='body'><p>Nice work. Kenny Hoff worked on something similar to this here (<a href="http://gamma.cs.unc.edu/VORONOI/)" rel="nofollow noopener" title="http://gamma.cs.unc.edu/VORONOI/)">http://gamma.cs.unc.edu/VOR...</a> back in the day. I think he was also able to extend it to three dimensions with slices. Very useful for fast motion planning.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-06-03T15:07:53Z'>Tue, 03 Jun 2014 15:07:53 UTC</time><div class='body'><p>His SIGGRAPH presentation is really interesting. It covers my entire article, and a lot more. He even used a very similar red/blue/green cone image and the same phrasing as me to describe the exact algorithms: "complex and difficult to implement."</p><p>Flipping the cones over to get "farthest" is mind-blowing. When I initially got things working, my depth buffer was inverted and I was seeing an inverted display, but it didn't occur to me that this was useful information.</p></div></div></div><div class='comment'><div class='author'>Oleg</div><time datetime='2014-06-03T05:06:36Z'>Tue, 03 Jun 2014 05:06:36 UTC</time><div class='body'><p>awesome</p></div></div><div class='comment'><div class='author'>Bertjan Broeksema</div><time datetime='2014-06-03T06:40:54Z'>Tue, 03 Jun 2014 06:40:54 UTC</time><div class='body'><p>Pretty much what I've been playing with lately. You should have a look at: <a href="http://www.cs.rug.nl/svcg/DataVisualizationBook/Sp3" rel="nofollow noopener" title="http://www.cs.rug.nl/svcg/DataVisualizationBook/Sp3">http://www.cs.rug.nl/svcg/D...</a> and the this paper as well: <a href="http://www.cs.rug.nl/~alext/PAPERS/VisSym01/paper.pdf" rel="nofollow noopener" title="http://www.cs.rug.nl/~alext/PAPERS/VisSym01/paper.pdf">http://www.cs.rug.nl/~alext...</a>. Telea actually describes the same approach as your cone-based one, but he uses a half-ball texture in stead to get somewhat nicer shading.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-06-03T14:51:28Z'>Tue, 03 Jun 2014 14:51:28 UTC</time><div class='body'><p>Interesting links. I do like the way the ball shading looks.</p></div></div></div><div class='comment'><div class='author'>simon</div><time datetime='2014-06-03T12:19:44Z'>Tue, 03 Jun 2014 12:19:44 UTC</time><div class='body'><p>The technique of drawing cones is mentioned in the original OpenGL red book:<br><a href="http://www.glprogramming.com/red/chapter14.html#name19" rel="nofollow noopener" title="http://www.glprogramming.com/red/chapter14.html#name19">http://www.glprogramming.co...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-06-03T14:50:17Z'>Tue, 03 Jun 2014 14:50:17 UTC</time><div class='body'><p>I really need to read a recent version of the red book sometime. Since writing the article, something I'm discovering is that *lots* of people have had this cone idea years before me.</p></div></div></div><div class='comment'><div class='author'>Rafael Martins</div><time datetime='2014-09-09T20:08:23Z'>Tue, 09 Sep 2014 20:08:23 UTC</time><div class='body'><p>You can also simulate the "cone" using only GL_POINTS and a big gl_PointSize. Set each fragment's depth to its distance from the center (0.5, 0.5) and only the closest fragments to each seed will be drawn. The only limit is that gl_PointSize has a hardware-dependent maximum value (on my relatively high-end rig it's 200). For me it's not really a problem because I'm also discarding points that are too far from any seed (which makes them look even more like cones). Nice article!</p></div><div class='comment'><div class='author'>Rafael Martins</div><time datetime='2014-09-09T20:21:13Z'>Tue, 09 Sep 2014 20:21:13 UTC</time><div class='body'><p>Well, come to think of it, if you need to overcome that limit you could probably just draw a quad around each seed and send the center as attribute to each vertex. This would mean just 2 triangles for each seed instead of 64.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-09-09T21:42:25Z'>Tue, 09 Sep 2014 21:42:25 UTC</time><div class='body'><p>In my experience a typical gl_PointSize limit is a mere 64. Even though you can kind of make it work, it's not really the right tool for the job. It also faces the same problem as your quad idea: in plain WebGL there's no gl_FragDepth. It's available as an optional extension, though.</p><p>When this article was discussed on reddit someone had an idea similar to this that involved two extensions, EXT_frag_depth and ARB_conservative_depth.</p><p><a href="http://redd.it/273vtq" rel="nofollow noopener" title="http://redd.it/273vtq">http://redd.it/273vtq</a></p><p>It would be faster because it would take better advantage of the fragment shader and depth testing.</p></div><div class='comment'><div class='author'>Rafael Martins</div><time datetime='2014-09-10T17:12:16Z'>Wed, 10 Sep 2014 17:12:16 UTC</time><div class='body'><p>Oh, right. Thanks for the clarification and the link. I was about to start porting my stuff to WebGL and now I can see I'll have some bumps -- I didn't know OpenGL ES 2.0 had no gl_FragDepth. Also I didn't know about conservative depth, pretty nice.</p></div></div></div></div></div><div class='comment'><div class='author'>Ryan Kaplan</div><time datetime='2016-03-22T06:24:27Z'>Tue, 22 Mar 2016 06:24:27 UTC</time><div class='body'><p>I enjoyed this article - thanks for writing it! I just wrote my own article on generating Voronoi diagrams on the GPU using a method called Jump Flooding. I thought you might find it interesting: <a href="http://rykap.com/graphics/skew/2016/02/25/voronoi-diagrams/" rel="nofollow noopener" title="http://rykap.com/graphics/skew/2016/02/25/voronoi-diagrams/">http://rykap.com/graphics/s...</a></p></div></div></div><hr/><div class='thread'><h1 id='2014-06-04'><a href='/blog/2014/06/04/'>Emacs Chat with Sacha Chua</a></h1><div class='comment'><div class='author'>Malyshev Artem</div><time datetime='2014-06-05T18:45:12Z'>Thu, 05 Jun 2014 18:45:12 UTC</time><div class='body'><p>Magnar Sveen chat discover many tips too</p></div></div><div class='comment'><div class='author'>Xah Lee</div><time datetime='2014-06-10T00:40:28Z'>Tue, 10 Jun 2014 00:40:28 UTC</time><div class='body'><p>hi Christopher. I'm doing the transcript for Sacha. There are few places I couldn't make out. Sacha indicated you might be interested in looking at it. Would you be?</p><p>btw, it was a fantastic emacs chat. Quite a lot very cool and heavy things there. I plan to play with i think all of them.</p></div></div></div><hr/><div class='thread'><h1 id='2014-06-06'><a href='/blog/2014/06/06/'>Per Loop vs. Per Iteration Bindings</a></h1><div class='comment'><div class='author'>sunny1304</div><time datetime='2014-09-04T01:02:59Z'>Thu, 04 Sep 2014 01:02:59 UTC</time><div class='body'><p>Nice article. Thanks.</p></div></div></div><hr/><div class='thread'><h1 id='2014-06-08'><a href='/blog/2014/06/08/'>Tag Feeds for null program</a></h1><div class='comment'><div class='author'>mvanderboom</div><time datetime='2014-06-10T20:59:57Z'>Tue, 10 Jun 2014 20:59:57 UTC</time><div class='body'><p>Are you planning on making elfeed 'a bit smarter' and use the atom UUIDs to avoid duplication?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-06-11T01:18:47Z'>Wed, 11 Jun 2014 01:18:47 UTC</time><div class='body'><p>Someday Elfeed will get a database makeover in a big 2.0.0 release. There were mistakes that I'd love to correct, mistakes I made in both the database design and in my feed modeling, but it would require breaking things. I consider breaking things a really big deal -- it forces all my users to spend time fixing and debugging their own extensions -- so it's not something I'll do lightly. To help with the transition, I'd make it play nice with the new MELPA stable: users should be able to keep using the older version for awhile until they're ready.</p><p>The database update might be EmacSQL, or it might be a similar solution but in pure Elisp (a pure Elisp RDBMS?). I'm still gauging how disruptive EmacSQL is to users with its native binary requirement. Updating it is currently a little annoying, having to compile SQLite from scratch every time. I already wrote half of an EmacSQL port for Elfeed (there's an emacsql branch in the Elfeed repository), but I need to spend time *really* making sure I get the database schema and API just right.</p></div><div class='comment'><div class='author'>mvanderboom</div><time datetime='2014-06-11T07:55:06Z'>Wed, 11 Jun 2014 07:55:06 UTC</time><div class='body'><p>Thanks for the explanation. I didn't realize it would be that big of an undertaking.</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2014-06-10'><a href='/blog/2014/06/10/'>A GPU Approach to Conway&#39;s Game of Life</a></h1><div class='comment'><div class='author'>Xah Lee</div><time datetime='2014-06-11T00:11:08Z'>Wed, 11 Jun 2014 00:11:08 UTC</time><div class='body'><p>are you on linux or Windows? I'm on linux now and i found that most js lib for WebGL doesn't work (but it does when i boot to Windows, same machine).</p><p>my machine is a plain $500 pc desktop of 2012, sans dedicated GPU.<br>Is this due to my machine, or mostly due to linux lacking gpu drivers?</p><p>btw, i've been doing Game Of Life heavily in 1990s. This post and many of your code are seriously interesting. (⁖ your atom vs rss post is right on the spot. The Elfeed i'd be seriously interested to look at (not so much with gnus). Your Skewer mode is also very interesting, and EmacSQL, which to me is quite non-trivial. In particular, seems you have a DSL there that map to SQL... i meant to ask did you invent that on the fly? (i haven't dug into them yet. They are very interesting to me both as usable tools and the elisp implemenation.))</p><p>Thank you.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-06-11T01:36:24Z'>Wed, 11 Jun 2014 01:36:24 UTC</time><div class='body'><p>I run Debian Sid (unstable), and both Iceweasel (Firefox) and Chromium support WebGL here. I believe these browsers also support WebGL in Wheezy (stable), but I'm not certain of that. This is despite me using only open source video drivers. It's not as fast as it could be, but, outside of performance, they work just as well as any proprietary drivers. If I were to guess why it's not working for you, it would be because your browser vesion is too old, WebGL is disabled (it's disabled by default in Chromium), or you don't have some important OpenGL library installed. In the very worst case where you had no real graphics card at all, you would be running pure software OpenGL with Mesa or something like that, so it would still work, just super slow.</p><p>In my last paragraph where I tested the performance, I used my wife's desktop, which runs Windows and has a GeForce GTX 760. (I drove the benchmark from my laptop via Skewer, so she didn't even have to step away from her machine for this. :-)</p><p>The EmacSQL DSL was a a series of trial and errors. It changed a whole lot over the month I was working on it, which the Git log reveals if you really dig into it. I was trying to follow the full SQL grammar very closely for awhile, but found this to be both tedious and messy because I was trying to normalize it across SQLite, MySQL, and PostgreSQL. I ended up falling back to a simple ruleset which seems to cover almost everything. In the worst case you can always pass a plain old string of SQL if the DSL doesn't do what's needed.</p></div></div></div><div class='comment'><div class='author'>jdashg</div><time datetime='2014-06-16T23:25:44Z'>Mon, 16 Jun 2014 23:25:44 UTC</time><div class='body'><p>"In OpenGL ES, and therefore WebGL, texture dimensions must be powers<br>of two, i.e. 512x512, 256x1024, etc."</p><p>This is not true. WebGL has full support for NPoT textures, but:<br>* NPoT textures must use either NEAREST or LINEAR for min and max filters. (default for min filter is NEAREST_MIPMAP_LINEAR)<br>* NPot textures must wrap with CLAMP_TO_EDGE.</p><p>If you do wrapping in the shader, and use a non-mipmap filter, your NPoT textures should work fine.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-06-17T00:00:24Z'>Tue, 17 Jun 2014 00:00:24 UTC</time><div class='body'><p>You're right, thanks! I just tweaked that statement to make it right. :-)</p></div></div></div><div class='comment'><div class='author'>Rikkert Koppes</div><time datetime='2015-10-06T06:18:22Z'>Tue, 06 Oct 2015 06:18:22 UTC</time><div class='body'><p>How would you arrive at 18.000 iterations per second? When I disable draw and reduce the interval to 0 in start(), I arrive at 200 fps max</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-10-08T01:08:09Z'>Thu, 08 Oct 2015 01:08:09 UTC</time><div class='body'><p>Don't limit yourself to one iteration per JavaScript interval. The JavaScript event loop will dominate the timing. Instead, put it inside a tight for/while loop within the same interval, and all inside a function (so you're not using global variable for your loop counter).</p><p>Ultimately it's going to depend a whole lot on your hardware and drivers. Plus I don't remember exactly how I got that result!</p></div></div></div></div><hr/><div class='thread'><h1 id='2014-06-13'><a href='/blog/2014/06/13/'>Emacs Unicode Pitfalls</a></h1><div class='comment'><div class='author'>Alan</div><time datetime='2014-06-15T10:32:57Z'>Sun, 15 Jun 2014 10:32:57 UTC</time><div class='body'><p>Regarding, "UTF-16 offers no practical advantages over UTF-8", many CJKV language characters in UTF-8 consume three or more bytes, while only two in UTF-16. <br>I'd consider that decrease in size to be a fairly practical advantage for many systems, especially embedded.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-06-15T19:14:34Z'>Sun, 15 Jun 2014 19:14:34 UTC</time><div class='body'><p>The FAQ (#9) in the linked UTF-8 Everywhere article addresses this point. Real world CJKV data is usually smaller as UTF-8 because the markup and protocol data typically surrounding the text (XML, HTTP, file system paths, etc.) is plain old ASCII. Even with the markup stripped, the gains are small (21% in Japanese Wikipedia's case). And if compression is applied, as it often is, it makes no difference anyway.</p></div></div></div><div class='comment'><div class='author'>anonymous</div><time datetime='2014-06-16T05:52:32Z'>Mon, 16 Jun 2014 05:52:32 UTC</time><div class='body'><p>Perhaps, you may confuse "combining character sequence" and "grapheme<br>cluster".</p><p>'&lt;base character=""&gt; + &lt;multiple combining="" characters=""&gt;' doesn't mean<br>anything. To be least, `&lt;base character=""&gt; + &lt;multiple marks="" (which="" is="" a="" superset="" of="" combining="" characters),="" zwjs="" or="" zwnjs=""&gt;` (combining character<br>sequence) is needed.  There are characters and glyphs which composed of<br>multiple base characters.</p><p>For example, try "M-x ucs-normalize-NFD-region" on "각" and see the<br>combining classes of decomposed characters with "C-u C-x =".</p><p>If you want 'reverse-string' to work with Emacs's cusror movement unit,<br>you may need to implement "extended grapheme cluster" algorithm<br>described in Unicode Text segmentation (UAX #29,<br><a href="http://www.unicode.org/reports/tr29/#Grapheme_Cluster_Boundaries)" rel="nofollow noopener" title="http://www.unicode.org/reports/tr29/#Grapheme_Cluster_Boundaries)">http://www.unicode.org/repo...</a>.</p><p>Perhaps, it is appropriate time to implement them in Emacs kernel, so<br>that C-f/C-b works with this unit, or M-f/M-b to work with word unit<br>described in this standards, too.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-06-16T20:21:22Z'>Mon, 16 Jun 2014 20:21:22 UTC</time><div class='body'><p>Yes, I was using "grapheme cluster" as a synonym for "combining character sequence," but I see now that that's outdated. I couldn't find in which version of the standard that extended grapheme clusters were introduced, but it must have been recently enough that the Unicode resources I was reading predate them.</p><p>Unfortunately, Emacs cursor movement doesn't always step by grapheme cluster boundaries, and the behavior even changes depending on the circumstances (i.e. interactive vs. non-interactive). I was going to mention it in my article, but I couldn't make sense of it. You're right that it would probably be best to fix it within Emacs itself, then lean on that for things like string reversal.</p></div></div></div></div><hr/><div class='thread'><h1 id='2014-06-20'><a href='/blog/2014/06/20/'>Feedback Applet Ported to WebGL</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2014-06-21'><a href='/blog/2014/06/21/'>Feedback Applet Ported to WebGL</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2014-06-22'><a href='/blog/2014/06/22/'>A GPU Approach to Path Finding</a></h1><div class='comment'><div class='author'>Tim</div><time datetime='2014-06-23T17:47:19Z'>Mon, 23 Jun 2014 17:47:19 UTC</time><div class='body'><p>Well this is pretty awesome.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-06-23T23:30:01Z'>Mon, 23 Jun 2014 23:30:01 UTC</time><div class='body'><p>Thanks!</p></div></div></div><div class='comment'><div class='author'>Jesse Himmelstein</div><time datetime='2014-06-23T19:08:31Z'>Mon, 23 Jun 2014 19:08:31 UTC</time><div class='body'><p>Fantastic work! The diagrams make it really clear how the algorithm works.</p><p>Quick question: how did you generate the GIFs? </p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-06-23T23:57:29Z'>Mon, 23 Jun 2014 23:57:29 UTC</time><div class='body'><p>I used gif.js to gather up all the frames into a single, convenient "download." Unfortunately gif.js doesn't produce very optimized GIFS, even on the highest quality setting. So after I save it to my filesystem, I explode it with Gifsicle and put it back together at a fraction of the size. I talked about some of the process here:</p><p><a href="http://nullprogram.com/blog/2012/04/10/" rel="nofollow noopener" title="http://nullprogram.com/blog/2012/04/10/">http://nullprogram.com/blog...</a></p><p>And here's the gif.js website:</p><p><a href="http://jnordberg.github.io/gif.js/" rel="nofollow noopener" title="http://jnordberg.github.io/gif.js/">http://jnordberg.github.io/...</a></p></div></div></div><div class='comment'><div class='author'>Steven Stewart-Gallus</div><time datetime='2014-06-23T19:44:20Z'>Mon, 23 Jun 2014 19:44:20 UTC</time><div class='body'><p>One annoyance with this approach is that it finds a shortest path according to taxicab geometry and not Euclidean geometry. Of course the problem is even more complicated because in the real world one might want to find the shortest path according to many different types of non-Euclidean geometries. Also, in a game one probably wouldn't want to find the shortest path according to Euclidean geometry but in the sort of weird approximation to Euclidean geometry based off a grid that most games use.</p></div><div class='comment'><div class='author'>Daniel Tebbutt</div><time datetime='2014-06-24T00:46:20Z'>Tue, 24 Jun 2014 00:46:20 UTC</time><div class='body'><p>I imagine you could do it on a hex grid pretty easily, because it still holds that each cell is equidistant to all its neighbors and it maps onto a square grid (just need to change the definition of 'neighbor').</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-06-24T01:53:21Z'>Tue, 24 Jun 2014 01:53:21 UTC</time><div class='body'><p>You're right. It could just use offset coordinates on a normal square grid to convert it into a hex grid:</p><p><a href="http://www.redblobgames.com/grids/hexagons/" rel="nofollow noopener" title="http://www.redblobgames.com/grids/hexagons/">http://www.redblobgames.com...</a></p></div></div></div></div><div class='comment'><div class='author'>anon</div><time datetime='2014-06-23T20:14:41Z'>Mon, 23 Jun 2014 20:14:41 UTC</time><div class='body'><p>Awesome job!</p></div></div><div class='comment'><div class='author'>Dan</div><time datetime='2014-06-23T21:42:24Z'>Mon, 23 Jun 2014 21:42:24 UTC</time><div class='body'><p>No heuristics? Without heuristics this is not useful.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-06-23T23:58:29Z'>Mon, 23 Jun 2014 23:58:29 UTC</time><div class='body'><p>What do you mean by heuristics?</p></div><div class='comment'><div class='author'>Alan Wolfe</div><time datetime='2016-08-16T22:12:33Z'>Tue, 16 Aug 2016 22:12:33 UTC</time><div class='body'><p>I think he means the feature of A* where you can give it some hints about better paths at branching, versus the brute force flood fill that is Djikstra's algorithm.  It's kind of odd though in this case to think of heuristics because you are running a program per pixel regardless, so you can't really "early out" based on heuristics as easily.  Maybe you could quit out the pixel shader more quickly and then open up shading units for (possibly) more useful pixels to run, but dunno.  Maybe the shortest path algorithm could try some heuristics? not sure if that'd work.  Anyways interesting read!  There's a decent amount of this stuff on <a href="http://shadertoy.com" rel="nofollow noopener" title="shadertoy.com">shadertoy.com</a> too btw.  Heck, for all I know you made those too though (:</p></div></div></div><div class='comment'><div class='author'>mattbaker</div><time datetime='2014-06-24T00:30:30Z'>Tue, 24 Jun 2014 00:30:30 UTC</time><div class='body'><p>I disagree, it's a great article on using the GPU to do computation in WebGL. If you're looking for path finding algorithms using heuristics I'm sure the author could point you in the right direction.</p></div><div class='comment'><div class='author'>Dan</div><time datetime='2014-06-24T15:06:46Z'>Tue, 24 Jun 2014 15:06:46 UTC</time><div class='body'><p>It's a good article on implementing an algorithm on the GPU, however I find the algorithm itself to be large useless in terms of pathfinding as the CPU will beat the GPU for large terrains. The algorithm here is nothing more than Djikstra's algorithm, which of course, can be useful too. I would have preferred the article focus on more practical applications of Djikstra's algorithm, like perhaps a harvester finding the actual closest resource to go and harvest. So long as the algorithm can halt when a resource is found, it should be very fast.</p></div></div></div></div><div class='comment'><div class='author'>mattbaker</div><time datetime='2014-06-24T00:33:44Z'>Tue, 24 Jun 2014 00:33:44 UTC</time><div class='body'><p>I've been struggling to figure out how to offload computation of a large number of particles to the GPU in WebGL. I understand the general problem of needing to pass state to successive render calls, but I would always get confused trying to deal with textures to store data.</p><p>Your GoL article as well as this one are a great resource. I have a renewed desire to chase this :) Thanks for providing source code.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-06-24T02:03:53Z'>Tue, 24 Jun 2014 02:03:53 UTC</time><div class='body'><p>Cool! I hope you figure it all out.</p><p>If you want to render the particles as you compute them, you'll run into that bottleneck again with WebGL. In OpenGL ES 2.0 and WebGL 1.0 there's no way to copy a texture directly into a vertex buffer. Fortunately, the upcoming WebGL 2.0, based on OpenGL ES 3.0, has this feature (pixel transfer).</p></div><div class='comment'><div class='author'>mattbaker</div><time datetime='2014-06-24T02:44:58Z'>Tue, 24 Jun 2014 02:44:58 UTC</time><div class='body'><p>All I need is to compute, store, and retrieve coordinates so I can process them. I can set the vertices of the particles in the vertex shader. My understanding is the only way to do that without transform feedback is to pass data through the texture? Either way, thanks for writing these things up :)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-06-24T02:59:35Z'>Tue, 24 Jun 2014 02:59:35 UTC</time><div class='body'><p>If you're just crunching numbers you don't need to do anything with vertices. You'll be running the fragment shader pixel-to-pixel between textures, so you just need a quad like I do with cellular automata.</p><p>Initially pass the particles in as a texture. Treat a single RGBA pixel as a 4D (or less) position vector for a single particle. If you want velocity, too, use a second texture as another per-entity 4D vector. Acceleration? Another texture, etc. You can really only write one texture per draw (though there's also depth and stencil to consider), so you'd need a separate draw to update each of position, velocity, acceleration, etc. When you're all done, pull them back out as as image data (glReadPixels) and parse it back into your own data structures.</p></div></div></div></div></div><div class='comment'><div class='author'>katopz</div><time datetime='2014-06-24T01:07:52Z'>Tue, 24 Jun 2014 01:07:52 UTC</time><div class='body'><p>Great article! Really have fun reading along the way! :D</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-06-24T01:51:27Z'>Tue, 24 Jun 2014 01:51:27 UTC</time><div class='body'><p>Thanks!</p></div></div></div><div class='comment'><div class='author'>Ahmed Fasih</div><time datetime='2014-06-24T14:21:00Z'>Tue, 24 Jun 2014 14:21:00 UTC</time><div class='body'><p>Really awesome!!! Is generating im/perfect mazes as computationally juicy as solving them, or is that step much easier?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-06-24T15:43:01Z'>Tue, 24 Jun 2014 15:43:01 UTC</time><div class='body'><p>Overall, solving a maze is probably about as difficult as generating one. In the case of a random depth-first search maze, it's the exact same process but with a slightly different halting state.</p><p>There's a cellular automation called Mazectric (B3/S1234) that generates patterns closely resembling mazes, but they're not perfect mazes. You can convert my Game of Life demo into a maze generator by changing one line of code in the fragment shader (the sum == 2 part). I haven't thought of any other way to generate mazes on a GPU.</p><p>The file maze.js in this project has three different maze generators: DF, Kruskal, and Prim. The generators don't know anything about the CPU or the cellular automation, so they could be re-used anywhere. They each produce different styles of maze, enough so that you could reconize them by watching the cellular automation run on them. You can try this yourself by cloning the repository and editing main.js to choose a different maze type. DFS mazes have long winding paths, so the flood fill is far less dramatic. Prim mazes are like swiss cheese (while still being perfect), with the flood search spreading evenly. Kruskal is in between these extremes.</p><p>There are algorithms that can generate infinite perfect mazes, only keeping track of two rows at a time. This was popular back when printer paper was attached continuously (perforated). The printer could keep going and going and going printing out an unbroken maze until it either ran out of ink or paper.</p></div></div></div><div class='comment'><div class='author'>ftfish</div><time datetime='2014-07-02T19:13:55Z'>Wed, 02 Jul 2014 19:13:55 UTC</time><div class='body'><p>Thank you for this interesting post! I'm trying to implement this in OpenCL :)<br>BTW, it is called a cellular automaton (pl. automata),  not automat*I*on.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-07-02T23:35:55Z'>Wed, 02 Jul 2014 23:35:55 UTC</time><div class='body'><p>Thanks! Somehow my whole life up until now I had always read it as cellular "automation" in my head without realizing it. I don't know how I messed that up so consistently all this time.</p><p>Another recent example of this for me is depreciated vs. deprecated. For a long time I didn't realize they were two different words.</p></div></div></div><div class='comment'><div class='author'>Mubbasir </div><time datetime='2014-08-06T17:35:31Z'>Wed, 06 Aug 2014 17:35:31 UTC</time><div class='body'><p>Excellent post!</p><p>Have you seen these two papers that tackle the problem in a similar fashion?</p><p>Dynamic Search on the GPU<br><a href="http://ieeexplore.ieee.org/xpls/abs_all.jsp?arnumber=6696830&amp;tag=1" rel="nofollow noopener" title="http://ieeexplore.ieee.org/xpls/abs_all.jsp?arnumber=6696830&amp;tag=1">http://ieeexplore.ieee.org/...</a></p><p>For adaptive resolution grids:<br><a href="http://people.inf.ethz.ch/kapadiam/projects-quad-gpu-search.html" rel="nofollow noopener" title="http://people.inf.ethz.ch/kapadiam/projects-quad-gpu-search.html">http://people.inf.ethz.ch/k...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-08-06T17:36:39Z'>Wed, 06 Aug 2014 17:36:39 UTC</time><div class='body'><p>I wasn't aware of these. So, thanks, I'll take a look at them!</p></div></div></div><div class='comment'><div class='author'>Gary Frost</div><time datetime='2017-07-07T22:27:19Z'>Fri, 07 Jul 2017 22:27:19 UTC</time><div class='body'><p>Very Cool.  I know this is old, but just came across it today. I was planning on writing a track layout app using GLSL compute shaders.  I never considered using a FSA.</p><p>i was involved in VLSI routing at one stage (when 3 level metal at 3 micron was 'state of the art' - so we are talking 1980s) and track/maze routing was solved using either Channel Routers or Flood Style routers.  The FSA  approach above looks like a specialization of Lee's routing algorithm (<a href="https://en.wikipedia.org/wiki/Lee_algorithm)" rel="nofollow noopener" title="https://en.wikipedia.org/wiki/Lee_algorithm)">https://en.wikipedia.org/wi...</a> which is a brute force Flood router.  With flood routers, one approach to halving the time taken was to flood from both ends.  I wonder home hard it would be modify your algorithm to do this.</p><p>Again a great read, and very well explained. Kudos.</p></div></div></div><hr/><div class='thread'><h1 id='2014-06-28'><a href='/blog/2014/06/28/'>A GPU Approach to Particle Physics</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2014-06-29'><a href='/blog/2014/06/29/'>A GPU Approach to Particle Physics</a></h1><div class='comment'><div class='author'>philogb</div><time datetime='2014-06-30T04:11:30Z'>Mon, 30 Jun 2014 04:11:30 UTC</time><div class='body'><p>Amazing article. Thanks so much for writing these! One question: have you considered using floating-point textures instead of "regular" ones? That way you don't need packing / unpacking.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-06-30T04:41:56Z'>Mon, 30 Jun 2014 04:41:56 UTC</time><div class='body'><p>Floating point textures would definitely be pretty handy for this sort of thing, but, unfortunately, WebGL doesn't support them. If I were to port this to desktop OpenGL, that's what I'd be using.</p></div><div class='comment'><div class='author'>philogb</div><time datetime='2014-06-30T04:50:05Z'>Mon, 30 Jun 2014 04:50:05 UTC</time><div class='body'><p>Oh they're supported as an extension: <a href="http://www.khronos.org/registry/webgl/extensions/OES_texture_float/" rel="nofollow noopener" title="http://www.khronos.org/registry/webgl/extensions/OES_texture_float/">http://www.khronos.org/regi...</a> and apparently 92% of people using WebGL has them: <a href="http://webglstats.com/" rel="nofollow noopener" title="http://webglstats.com/">http://webglstats.com/</a> (look for WebGL extensions) :)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-06-30T13:20:02Z'>Mon, 30 Jun 2014 13:20:02 UTC</time><div class='body'><p>This is perfect, thanks! I bet the 8% that doesn't support it overlaps almost entirely with the same devices that don't permit textures in vertex shaders, so that downside is moot.</p><p>So far my OpenGL learning has been entirely from the WebGL specification, the linked man pages, the OpenGL ES specification, and occasional questions for a fairly knowledgeable friend. (Google searches are generally fruitless because not many people are talking about WebGL yet.) None of these resources cover WebGL extensions, so I need to spend some time learning them.</p></div></div></div><div class='comment'><div class='author'>philogb</div><time datetime='2014-06-30T04:50:36Z'>Mon, 30 Jun 2014 04:50:36 UTC</time><div class='body'><p>One example here: <a href="http://philogb.github.io/philogl/PhiloGL/examples/particles" rel="nofollow noopener" title="http://philogb.github.io/philogl/PhiloGL/examples/particles">http://philogb.github.io/ph...</a></p></div></div></div></div><div class='comment'><div class='author'>philogb</div><time datetime='2014-06-30T04:16:09Z'>Mon, 30 Jun 2014 04:16:09 UTC</time><div class='body'><p>Also.. I wonder if there's an automated way to create the normals for the obstacles, using maybe some distance field generation? Would it be easy to automate that?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-06-30T04:45:42Z'>Mon, 30 Jun 2014 04:45:42 UTC</time><div class='body'><p>What do you mean by automated? Right now it's handled entirely by a really simple fragment shader (ocircle.frag), which is probably the most straightforward way to do it. It only runs when the obstacles change, so it doesn't need to be very fast.</p></div></div></div><div class='comment'><div class='author'>Fredrik Nordeng</div><time datetime='2015-05-21T15:08:47Z'>Thu, 21 May 2015 15:08:47 UTC</time><div class='body'><p>can you change every particle in to waves?</p></div></div></div><hr/><div class='thread'><h1 id='2014-07-23'><a href='/blog/2014/07/23/'>An RC4 Password Hashing Function</a></h1><div class='comment'><div class='author'>possiblywrong</div><time datetime='2014-07-25T20:03:36Z'>Fri, 25 Jul 2014 20:03:36 UTC</time><div class='body'><p>Very interesting read. A question occurred to me about the practice you mention of slowing down a hash by iterating a relatively fast hash function, viewed as mapping its output space S back into itself (i.e., f:S-&gt;S).  I wondered if, by doing this, there was any potential danger of making that hash space significantly smaller (thus making inverting easier), from the amount of "non-one-to-one-ness" of f.  And in practice, do we know how "non-one-to-one" are typical hash functions in common use?</p><p>After some poking around, I found what looks like an answer <a href="http://security.stackexchange.com/questions/10659/general-purpose-slow-unique-hash-routine-for-dup-checking-of-private-data-witho" rel="nofollow noopener" title="http://security.stackexchange.com/questions/10659/general-purpose-slow-unique-hash-routine-for-dup-checking-of-private-data-witho">here</a>, suggesting that this isn't a big deal... but I didn't quite understand some of the argument in the top answer, particularly the following:</p><p>"The lengths of both the “tail” (the values you get through before entering the cycle) and the “cycle” itself are, on average, 2^(n/2)."</p><p>This is an interesting general result, that didn't appear obvious to me.  After some more searching, I don't think it is :).  The following paper addresses just the cycle length (not the tail):</p><p><a href="http://www.ams.org/journals/tran/1968-133-02/S0002-9947-1968-0228032-3/S0002-9947-1968-0228032-3.pdf" rel="nofollow noopener" title="http://www.ams.org/journals/tran/1968-133-02/S0002-9947-1968-0228032-3/S0002-9947-1968-0228032-3.pdf">http://www.ams.org/journals/tran/1968-133-02/S0002-9947-1968-0228032-3/S0002-9947-1968-0228032-3.pdf</a></p></div></div><div class='comment'><div class='author'>Adr</div><time datetime='2015-10-02T08:31:07Z'>Fri, 02 Oct 2015 08:31:07 UTC</time><div class='body'><p>The way salt was added is very weak, basically salt is known and you shufle S in a predictible way, so not much added value, cryptanalysis will be similar.</p></div></div></div><hr/><div class='thread'><h1 id='2014-08-17'><a href='/blog/2014/08/17/'>C11 Lock-free Stack</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2014-08-29'><a href='/blog/2014/08/29/'>Making C Quicksort Stable</a></h1><div class='comment'><div class='author'>Russell Borogove</div><time datetime='2014-08-30T05:22:32Z'>Sat, 30 Aug 2014 05:22:32 UTC</time><div class='body'><p>The glibc suggestion of sorting on address as a fallback key works if you pass qsort an array of pointers rather than an array of structures; the pointers will be swapped in place, instead of the things they point to. The swaps themselves will be faster in the (common) case where the structure is larger than the platform pointer size as well.</p></div><div class='comment'><div class='author'>possiblywrong</div><time datetime='2014-08-30T12:16:03Z'>Sat, 30 Aug 2014 12:16:03 UTC</time><div class='body'><p>My attempt at markdown seemed to make a mess.  Let's try again:</p><p>But would this actually be stable in the desired practical sense?  You would need a[i]&lt;a[j], comparing="" memory="" addresses,="" for="" all="" i&lt;j,="" before="" even="" calling="" qsort().="" this="" would="" only="" be="" the="" case="" if="" you="" started="" with="" a="" contiguous="" array="" of="" structures,="" and="" added="" an="" extra="" level="" of="" indirection="" solely="" for="" the="" sorting.="" allocating="" your="" individual="" structures="" via="" individual="" malloc()="" calls,="" which="" seems="" more="" likely="" in="" this="" scenario,="" would="" make="" the="" resulting="" pointer="" comparisons="" not="" even="" defined.=""&gt;</p></div></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-08-30T15:05:19Z'>Sat, 30 Aug 2014 15:05:19 UTC</time><div class='body'><p>Disqus swallowed and barfed possiblywrong's comment making it hard to read, but he's right. It wouldn't work with malloc()-allocated structures for two reasons. 1) Because you'd be falling back on whatever order malloc() happened to put the structs in memory. 2) More importantly, as possiblywrong said, comparing pointers returned by malloc() is undefined behavior (C11 6.5.6, 6.5.8). Only pointers within the same array can be compared this way. As an example why pointer subtraction is tricky: the distance between two arbitrary pointers can easily be larger than any representable negative integer value.</p><p>Suppose your structs were allocated in an array and you create a secondary array of pointers to these structs for sorting. You're right that it  would probably be faster if the structs are large. However, when you're done with a sort, you need to move all the structs around in the original array to reflect the new pointer array order, which is basically another whole sort if you wanted to do it in-place. Ultimately you would be doing the same thing as my "order" field but storing it in a separate array in the form of pointers.</p></div></div></div><div class='comment'><div class='author'>Rob Thorpe</div><time datetime='2014-09-09T13:59:02Z'>Tue, 09 Sep 2014 13:59:02 UTC</time><div class='body'><p>I believe Glibc qsort documentation says this because it implements qsort using mergesort not quicksort. It's not an in-place sort, the input arrays stays where it is and an output array is built separately.</p><p>However, I seem to remember that it reverts to quicksort for large arrays, so it may still be wrong.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-09-09T14:18:14Z'>Tue, 09 Sep 2014 14:18:14 UTC</time><div class='body'><p>Yup, the quicksort fallback is what makes that not true even for glibc. Plus it's not a good idea to rely on glibc's particular implementation anyway. Using a GNU extension (e.g. qsort_r()) is different because it will be an obvious compile-time error when used with an incompatible libc, but subtly using qsort() incorrectly won't be so obvious.</p></div></div></div></div><hr/><div class='thread'><h1 id='2014-09-02'><a href='/blog/2014/09/02/'>C11 Lock-free Stack</a></h1><div class='comment'><div class='author'>Chris Ryland</div><time datetime='2014-09-04T01:10:42Z'>Thu, 04 Sep 2014 01:10:42 UTC</time><div class='body'><p>I'd think it would be clearer to use</p><p>lstack-&gt;node_buffer[i].next = &amp;lstack-&gt;node_buffer[i + 1];</p><p>than</p><p>lstack-&gt;node_buffer[i].next = lstack-&gt;node_buffer + i + 1;</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-09-04T23:51:11Z'>Thu, 04 Sep 2014 23:51:11 UTC</time><div class='body'><p>Eh, I don't have a strong opinion either way. My one (weak) argument against your version is that, conceptually, it dereferences then creates a reference.</p></div><div class='comment'><div class='author'>petiepooo</div><time datetime='2014-12-01T21:28:39Z'>Mon, 01 Dec 2014 21:28:39 UTC</time><div class='body'><p>The top version is imminently more readable, and they likely both compile to the exact same assembly.  While C supports pointer arithmetic, it smells bad to many, and is a barrier to comprehension, likely due to how infrequently it's used.</p></div></div></div></div><div class='comment'><div class='author'>Sergey</div><time datetime='2014-09-04T06:50:24Z'>Thu, 04 Sep 2014 06:50:24 UTC</time><div class='body'><p>In your description of ABA problem, it's not really clear why the head-&gt;node-&gt;next pointer would be "pointing somewhere completely new". If thread B did nothing but a single pop() and then a single push(), then it would be correct for thread A to succeed with its CAS upon waking up. I think at least one other pop() or push() operation should be performed to cause the problem. Do I understand correctly?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-09-05T00:00:36Z'>Fri, 05 Sep 2014 00:00:36 UTC</time><div class='body'><p>You're right. There would need to be at least one additional operation, either pop or push, before the node gets recycled for the ABA problem to truly show itself.</p><p>Example: say the top three nodes are A, B, C. Pop A, pop B, recycle-push A. One thread saw ABC but it's now AC and CAS still succeeds. Or, pop A, push X, recycle-push A. The thread saw ABC but now it's AXBC and CAS still succeeds.</p></div></div></div><div class='comment'><div class='author'>petiepooo</div><time datetime='2014-12-01T21:20:45Z'>Mon, 01 Dec 2014 21:20:45 UTC</time><div class='body'><p>I must be missing something.</p><p>In your pop primitive, you copy the contents pointed to by head into the orig and next structs before entering the do/while loop.  If the call to atomic_compare_exchange_weak(...) fails, and the loop repeats, would you not want to reload orig and next structs with fresh contents from a new call to atomic_load(head)?  Without that, assuming it's failing because another thread has successfully changed the contents of head, what you originally copied from head will never match, and the loop would repeat endlessly.  Right?</p><p>If I'm not missing something, I believe the same logic would apply to the push primitive as well.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-12-01T23:13:52Z'>Mon, 01 Dec 2014 23:13:52 UTC</time><div class='body'><p>The call to atomic_compare_exchange_weak() updates "orig" automatically as a side effect in the case of a failure. This is because any reasonable call to atomic_compare_exchange_weak() would need to do this anyway as part of retrying.</p></div></div></div><div class='comment'><div class='author'>Eugene</div><time datetime='2015-06-18T15:20:11Z'>Thu, 18 Jun 2015 15:20:11 UTC</time><div class='body'><p>I was thinking about using very basic bounded (preallocated) stack to keep track of my threads ids in correct LIFO order. so i was wondering if my implementation is thread safe to be called from multiple threads:</p><p>// we use maximum 8 workers<br>size_t idle_ids_stack[8];<br>std::atomic_uint_fast8_t idle_pos(0);</p><p>// this function is called by each thread when it is about to sleep<br>void register_idle(size_t thread_id) {<br>    std::atomic_thread_fence(std::memory_order_release);<br>    idle_ids_stack[idle_pos.fetch_add(1, std::memory_order_relaxed)] = thread_id;<br>}</p><p>// this function can be called from anywhere at anytime<br>void wakeup_one() {<br>uint_fast8_t oldStatus(idle_pos.load(std::memory_order_relaxed));<br>std::atomic_thread_fence(std::memory_order_acquire);<br>size_t id;<br>do<br>        {<br>    if(oldStatus == 0) return; // no idle threads in stack; exit;<br>    id = idle_ids_stack[oldStatus-1];<br>        }<br>while (! idle_pos.compare_exchange_weak(oldStatus, oldStatus-1, std::memory_order_acquire, std::memory_order_relaxed));<br>// if we got here means we can wake up the thread<br>    signal_thread(id);<br>}</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-06-19T16:49:33Z'>Fri, 19 Jun 2015 16:49:33 UTC</time><div class='body'><p>You have a race condition in register_idle(). You atomically grab a new index, but the write to the stack is done in a separate operation *and* without synchronization. What could happen is that you increment the stack pointer to "allocate" an index. Then, before you write the actual stack element, another thread pops off an element -- reading garbage, because you hadn't written the element yet. Then, to make matters worse, yet another thread goes to push, increments the stack counter, and writes its element. Finally the first thread writes its element, overwriting the newly pushed element.</p><p>This is the exact same fundamental problem faced by a theoretical many-writers, lock-free queue (imagine using a circular buffer). I'm not convinced there's an actual solution for this. I've never seen one.</p><p>Your idea could work if there was only a single writer and you change the operation order: write the new element first, then increment the stack pointer atomically+synchronously.</p></div></div></div><div class='comment'><div class='author'>hmijail</div><time datetime='2016-03-17T11:42:21Z'>Thu, 17 Mar 2016 11:42:21 UTC</time><div class='body'><p>Thank you for a very interesting post. But it has left me with some doubts that maybe you could answer.</p><p>You seem to imply that C11's atomic support will only link if the processor's ISA does provide the needed atomic instructions, like cmpxchg16 in x64.<br>However, cmpxchg16 is in fact not atomic by itself! (see the answers at <a href="https://stackoverflow.com/questions/7646018/sse-instructions-which-cpus-can-do-atomic-16b-memory-operations" rel="nofollow noopener" title="https://stackoverflow.com/questions/7646018/sse-instructions-which-cpus-can-do-atomic-16b-memory-operations">https://stackoverflow.com/q...</a> , which include warnings from Intel docs). The way to force the access to be atomic is by adding a LOCK prefix to the instruction - but of course then it's no longer lock-free.</p><p>So this would mean that C11 atomics are lock-free as far as the C abstract machine is involved, but the underlying implementation is free to actually use locks. And so, a platform incapable of natively doing atomic accesses of a given width, could just implement them through locks.</p><p>Is that right or am I missing something?</p><p>(Granted, this is mostly language lawyer territory, but still can be important when discussing the merits of different algorithms...)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-03-17T16:21:34Z'>Thu, 17 Mar 2016 16:21:34 UTC</time><div class='body'><p>You're right, it's not atomic on its own. However, this instruction has always supported the LOCK prefix (being its primary use case), so if you tell GCC cmpxchg16 is available, you're also indicating the atomic form is available.</p><p>The LOCK prefix doesn't take away its "lock-free" status. It's a simple overloading of terms and is a perfect example of why this technology has been misnamed. (This isn't mentioned in the article since I wasn't yet able to articulate it.) Lock-free would be much better named "wait-free." That is, progress always moves forward without waiting or blocking. The LOCK prefix isn't blocking until some specific event on another thread, it's just forcing the instruction to be atomic. It could have been named ATOMIC instead (though I'm not saying that would be more accurate).</p><p>Calling malloc() isn't wait-free because it may have to wait on another thread to release a mutex that locks the heap, or have to wait on the OS to allocate virtual memory for the process, which itself may involve swapping to disk, etc. If the thread holding the mutex dies, we will end up waiting forever. Compare that to a LOCK-prefixed cmpxchg, which will only loop to try again if another thread made progress in the same instant. It doesn't have to wait on anything.</p></div><div class='comment'><div class='author'>hmijail</div><time datetime='2016-03-17T16:52:32Z'>Thu, 17 Mar 2016 16:52:32 UTC</time><div class='body'><p>&gt;The LOCK prefix isn't blocking until some specific event on another thread,</p><p>&gt; [a LOCK-prefixed cmpxchg] ... will only loop to try again if another thread made progress in the same instant. It doesn't have to wait on anything.</p><p>Well, you *have* to wait until the other thread unlocks. And if there are N processors all trying to lock on the same region, you might end having to wait for the N-1 operations to end - or even more, if there is no protocol against livelock/starvation.</p><p>How is this not blocking or waiting?</p><p>Anyway, the overarching question would be: can you point to any concrete reference which says that C11's atomics have to be implemented lock-free? What I had read up to now is that it's not terribly well defined in the standard.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-03-17T17:08:25Z'>Thu, 17 Mar 2016 17:08:25 UTC</time><div class='body'><p>The hardware guarantees that you won't wait forever and progress will be made regardless of the activity of the other processors. It's definitely *not* the sort of lock that concerns lock-free programming. Lock-free programming is concerned with operations involving the OS scheduler (semaphore, mutex, read/write), which won't reschedule (i.e. block) a thread/process until another thread/process has completed some action.</p></div></div></div></div></div><div class='comment'><div class='author'>Jason</div><time datetime='2016-06-06T19:33:40Z'>Mon, 06 Jun 2016 19:33:40 UTC</time><div class='body'><p>Thank you for your post, it´s very helpful to me.<br>I would like to ask the concept, for example:<br>If usr1 wants to use Push() in stack, at the same time usr2, usr3... want to use Push() or Pop() in the same stack. Except usr1, others users have to wait until Push() finished.<br>How Lock-Free improve the performance of data structure Stack, if those users need to wait for each other operation finished?</p><p>Thanks in advance.</p></div></div><div class='comment'><div class='author'>liblfds admin</div><time datetime='2016-08-20T16:49:09Z'>Sat, 20 Aug 2016 16:49:09 UTC</time><div class='body'><p>The responsibility for memory allocation can be shifted to the caller, rather than being hard coded in the library itself.</p><p>Have the user pass in a pointer to a stack element structure, and operate on that.  The user is responsible for allocation, and for pre-allocation.  Typical expected use is to embed one such structure into the structure which is being pushed to the stack.</p><p>This is in fact vital, because with NUMA, an single contigious allocation of stack elements is not by any means guaranteed to be the correct choice.</p><p>One other note - backoff in the fact of contention is in fact *ESSENTIAL* to performance.  Backoff should vary, exponentially.  A random selection within the current backoff's maximum possible period is not necessary - it makes no difference to performance (prolly because the threads themselves are random enough in the first place).  Optimal backoff varies by the number of threads and load, so a fixed backoff period is not really a solution at all.  Without backoff, performance is no better than lock-based stacks.</p></div></div><div class='comment'><div class='author'>liblfds admin</div><time datetime='2016-08-20T16:51:13Z'>Sat, 20 Aug 2016 16:51:13 UTC</time><div class='body'><p>One other note - the use of a struct for the stack element is risky in that there is an assumption there will be no padding between the structure members.</p><p>Note also that ARM supports DWCAS.</p></div></div><div class='comment'><div class='author'>kk</div><time datetime='2016-09-23T06:24:49Z'>Fri, 23 Sep 2016 06:24:49 UTC</time><div class='body'><p>I think there is a problem with your pop() function. You should modify 'orig' again in the loop and IIUC 'orig' is set only once and hence if 'head' moves ahead as updates performed by other threads you would be doing wrong pop() settings. Please correct me if I am wrong</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-09-23T17:38:03Z'>Fri, 23 Sep 2016 17:38:03 UTC</time><div class='body'><p>That's a good observation, but atomic_compare_exchange_weak() handles this automatically. It's why the "expected" parameter is a pointer. This is what I meant by, "If not, it reports a failure and updates the expected value to the latest value."</p></div></div></div><div class='comment'><div class='author'>Bob</div><time datetime='2016-09-23T23:51:55Z'>Fri, 23 Sep 2016 23:51:55 UTC</time><div class='body'><p>Fascinating stuff.  I've been playing with your code and so far I have no problems when used with posix threads.   Currently I'm trying to figure out how to implement the lock-free queue.  Have you figured it out?  </p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-09-24T00:09:08Z'>Sat, 24 Sep 2016 00:09:08 UTC</time><div class='body'><p>I never figured out a general many-writer, many-reader lock-free queue, and I currently don't think it's possible with the currently-available primitives. But I did figure out a single-writer, many-reader lock-free queue, which is particularly useful as a work queue:</p><p><a href="https://github.com/skeeto/lqueue" rel="nofollow noopener" title="https://github.com/skeeto/lqueue">https://github.com/skeeto/l...</a></p></div><div class='comment'><div class='author'>Bob</div><time datetime='2016-12-15T19:48:40Z'>Thu, 15 Dec 2016 19:48:40 UTC</time><div class='body'><p>I was able to work out a many-writer / many-reader concurrent queue.  However it's not perfectly lock-free since I ended up designing a lock using atomics.  If you or anyone would like to take a look then shoot me a line w/ way to send the demo source over.  It would be good to thoroughly test it before using it in any place important.</p></div></div></div></div><div class='comment'><div class='author'>Paulo Torrens</div><time datetime='2016-10-08T18:50:44Z'>Sat, 08 Oct 2016 18:50:44 UTC</time><div class='body'><p>According to the C11 standard, §6.5.2.3-5, accessing a member of an atomic struct/union is undefined behavior, and you seem to do that on your lstack_init() function. Well, it's not reasonable that something wrong would happen there, but it's still possible nevertheless...</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-10-08T19:44:20Z'>Sat, 08 Oct 2016 19:44:20 UTC</time><div class='body'><p>Thanks, you're right. I've fixed the code to initialize without accessing individual members, though the resulting generated code is exactly identical anyway.</p></div></div></div></div><hr/><div class='thread'><h1 id='2014-09-17'><a href='/blog/2014/09/17/'>The Billion Pi Challenge</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2014-09-18'><a href='/blog/2014/09/18/'>The Billion Pi Challenge</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2014-10-12'><a href='/blog/2014/10/12/'>Global State: A Tale of Two Bad C APIs</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2014-10-19'><a href='/blog/2014/10/19/'>Emacs Autotetris Mode</a></h1><div class='comment'><div class='author'>woodrat</div><time datetime='2014-11-14T11:43:12Z'>Fri, 14 Nov 2014 11:43:12 UTC</time><div class='body'><p>emacs23 needs cl-lib to run it.. but it works well on emacs24</p></div></div><div class='comment'><div class='author'>Jordon Biondo</div><time datetime='2014-11-17T18:46:01Z'>Mon, 17 Nov 2014 18:46:01 UTC</time><div class='body'><p>Wow on its first run it beat my high score!</p></div></div></div><hr/><div class='thread'><h1 id='2014-10-21'><a href='/blog/2014/10/21/'>C Object Oriented Programming</a></h1><div class='comment'><div class='author'>Gavin Black</div><time datetime='2014-10-22T14:36:54Z'>Wed, 22 Oct 2014 14:36:54 UTC</time><div class='body'><p>Good write-up, and I'm curious if any of the *nix kernels do any OOP style in C nowadays?  The little bit of prodding I've had to do it doesn't look like it. Also I'm sure you've probably already hit upon the ooc project and semi-related book(<a href="http://www.cs.rit.edu/~ats/books/ooc.pdf)" rel="nofollow noopener" title="http://www.cs.rit.edu/~ats/books/ooc.pdf)">http://www.cs.rit.edu/~ats/...</a> as well.  They put almost everything in macros to enforce standards it seems.</p><p>Lately I've been tending to write my more complicated C-code in functional style using function pointers and then making small functions that behave like map/foldl.  Although that probably wouldn't be maintainable for big projects, I have had poor interns take over my code without too much problems...yet :P</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-10-22T20:26:16Z'>Wed, 22 Oct 2014 20:26:16 UTC</time><div class='body'><p>Linux uses this sort of thing all over. Here are a couple of articles, <br><a href="https://www.kernel.org/doc/Documentation/kref.txt" rel="nofollow noopener" title="https://www.kernel.org/doc/Documentation/kref.txt">https://www.kernel.org/doc/...</a> <a href="http://lwn.net/Articles/444910/" rel="nofollow noopener" title="http://lwn.net/Articles/444910/">http://lwn.net/Articles/444...</a></p><p>I actualy did read OOC recently and I was actually intending on linking to it, but forgot. It goes further than I think is reasonable, getting a little bit *too* fancy, but it's still interesting.</p><p>A good reference counter "class," like kref referenced above, is really useful for functional style code. You can use it to manage shared data structures, as is often the case for functional style. Objects will know how to free themselves when the counter hits 0.</p></div></div></div><div class='comment'><div class='author'>Michael Terry</div><time datetime='2014-10-23T17:45:48Z'>Thu, 23 Oct 2014 17:45:48 UTC</time><div class='body'><p>Great post. Don't know C, don't have a CS degree, so this shone light on some issues which had been hazy to me.</p></div></div><div class='comment'><div class='author'>manvscode</div><time datetime='2014-11-18T17:24:12Z'>Tue, 18 Nov 2014 17:24:12 UTC</time><div class='body'><p>Great post!</p></div></div><div class='comment'><div class='author'>kuangdash</div><time datetime='2014-11-21T06:13:08Z'>Fri, 21 Nov 2014 06:13:08 UTC</time><div class='body'><p>Great Post！+1</p></div></div><div class='comment'><div class='author'>Charles Lehner</div><time datetime='2015-02-18T04:14:16Z'>Wed, 18 Feb 2015 04:14:16 UTC</time><div class='body'><p>Great article. Here is another container_of macro that I have been using. It embeds a check that ptr is of the same type as (type)-&gt;member. I haven't checked if it compiles to the same object code as the one using offsetof, but it works and offers some more type safety.</p><p>    #define container_of(ptr, type, member) \<br>        ((type *)( ((ptr) - &amp;((type *)0)-&gt;member) * sizeof(*ptr) ))</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-02-19T21:36:41Z'>Thu, 19 Feb 2015 21:36:41 UTC</time><div class='body'><p>If I'm not mistaken, finding the offset using 0/NULL like that is undefined behavior. So while that will work fine on every compiler and platform I care about, it's *technically* not portable. That's why C99 blessed us with offsetof(). I do like the tiny bit of extra type safety in your version, though.</p></div></div></div></div><hr/><div class='thread'><h1 id='2014-11-22'><a href='/blog/2014/11/22/'>LZSS Quine Puzzle</a></h1><div class='comment'><div class='author'>Shalom</div><time datetime='2015-03-22T12:31:47Z'>Sun, 22 Mar 2015 12:31:47 UTC</time><div class='body'><p>Excellent article! well explained..</p></div></div><div class='comment'><div class='author'>Andrew</div><time datetime='2016-07-21T07:33:12Z'>Thu, 21 Jul 2016 07:33:12 UTC</time><div class='body'><p>If you ever encounter a copy of Games People Play, let me know! I also enjoyed it in my youth, but of course my copy of the CD is also long lost. I would love to get my hands on it again.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-07-21T23:26:58Z'>Thu, 21 Jul 2016 23:26:58 UTC</time><div class='body'><p>I managed to find a copy a few months back, and I created an ISO image. Here's a BitTorrent magnet link:</p><p>magnet:?xt=urn:btih:e3b64178dc6d8e551eb168a7abb03471b23baab1</p><p>Since this is all shareware and intended to be shared (though you probably couldn't order/register any of these games anymomre), it's a perfect example of a legal torrent.</p></div><div class='comment'><div class='author'>Andrew</div><time datetime='2016-07-22T04:27:06Z'>Fri, 22 Jul 2016 04:27:06 UTC</time><div class='body'><p>Thank you, that's wonderful! Unfortunately, my client doesn't seem to be having any luck finding the torrent using DHT.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-07-22T04:36:51Z'>Fri, 22 Jul 2016 04:36:51 UTC</time><div class='body'><p>Give this a shot:</p><p><a href="http://skeeto.s3.amazonaws.com/share/GamesPeoplePlayII.iso.torrent" rel="nofollow noopener" title="http://skeeto.s3.amazonaws.com/share/GamesPeoplePlayII.iso.torrent">http://skeeto.s3.amazonaws....</a></p><p>If that fails for you, too, I'll just put it directly on S3.</p></div><div class='comment'><div class='author'>Andrew</div><time datetime='2016-07-22T04:41:18Z'>Fri, 22 Jul 2016 04:41:18 UTC</time><div class='body'><p>That works nicely, thank you for going to the trouble. And good article, by the way. I've read and enjoyed a number of things on here over the years :)</p></div></div></div></div></div></div></div><hr/><div class='thread'><h1 id='2014-12-09'><a href='/blog/2014/12/09/'>How to build DOS COM files with GCC</a></h1><div class='comment'><div class='author'>possiblywrong</div><time datetime='2014-12-11T17:42:20Z'>Thu, 11 Dec 2014 17:42:20 UTC</time><div class='body'><p>Very interesting-- and nostalgic-- read.  I'll have to try playing this when I get home.</p></div></div><div class='comment'><div class='author'>Joe Jamison</div><time datetime='2015-05-03T23:06:38Z'>Sun, 03 May 2015 23:06:38 UTC</time><div class='body'><p>This method of tweaking gcc is perfect!  I wanted to do the same for a <br>similar project of my own, but I would like to use MinGW, and am having <br>trouble getting the linker to produce my binary.  I have tried some <br>tweaks, but can't seem to get a functioning executable to come out of <br>the toolchain.</p><p>You mentioned that you got it working in MinGW, "with an extra objdump step".  What exactly did you do here?  Thanks!</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-05-04T01:22:49Z'>Mon, 04 May 2015 01:22:49 UTC</time><div class='body'><p>Yeah, MinGW is a little wonky when it comes to this. Produce a normal executable by removing the OUTPUT_FORMAT directive from the linker script, and instead use "objcopy -O binary" to extract the contents into a headerless COM file (not objdump as I had originally stated). I tested it now with both MinGW and MinGW-w64 and it works fine for my game.</p></div><div class='comment'><div class='author'>Joe Jamison</div><time datetime='2015-05-04T01:32:12Z'>Mon, 04 May 2015 01:32:12 UTC</time><div class='body'><p>Awesome!  I ended up using this in conjunction with the --noinhibit-exec flag set on ld so I could compile &amp; run in one go.</p></div><div class='comment'><div class='author'>David E Jones</div><time datetime='2017-01-19T03:29:00Z'>Thu, 19 Jan 2017 03:29:00 UTC</time><div class='body'><p>I seem to be having a similar issue with mingw do you have the compile, link and objcopy commands that worked for you in the end?</p><p>EDIT:<br>Ah never mind I've got it now I think i was overcomplicating things. This is what worked for me on mingw32 if anyone else needs it <a href="https://gist.github.com/davidejones/233abdd393add4ff157c9b565c76821b" rel="nofollow noopener" title="https://gist.github.com/davidejones/233abdd393add4ff157c9b565c76821b">https://gist.github.com/dav...</a></p></div></div></div></div></div><div class='comment'><div class='author'>Zirias</div><time datetime='2015-08-02T03:01:31Z'>Sun, 02 Aug 2015 03:01:31 UTC</time><div class='body'><p>Very interesting read, gave me the idea to port a little curses-based snake game I wrote recently to DOS realmode. You might be interested that llvm/clang as well as gcc meanwhile know a "-m16" option that renders this a bit more convenient :) I had to resort to clang though because gcc dislikes clobbering of "ebp" which happens with buggy BIOSes when using int 10h 02h for scrolling ... if you're interested, here's my code so far: <a href="https://github.com/Zirias/clang-libdos/" rel="nofollow noopener" title="https://github.com/Zirias/clang-libdos/">https://github.com/Zirias/c...</a></p><p>So far, there do not seem to be any optimizer issues with clang. When optimizing changed behaviour, it was always something like accidentally counting on a register being 0 etc ...</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-08-02T14:58:29Z'>Sun, 02 Aug 2015 14:58:29 UTC</time><div class='body'><p>It's important to note that gcc's -m16 option doesn't do quite what one might reasonably expect it to do. GCC can't emit straight 16-bit 8086 code, instead using its ".code16gcc" hack to allow its 32-bit 80386 code to run in real mode.</p><p>Looks like it's a similar story for clang. Its -m16 option still uses some 32-bit registers and addresses, but, judging by the output, it does a *far* better job than gcc. Very interesting. I wonder how much the optimizer gets in the way (if at all?). That's a constant struggle with using GCC this way. When I originally wrote this article, I don't think this clang feature was available to me (running Debian Wheezy, with some 2012 version of LLVM/clang), so I hadn't considered it.</p><p>GCC breaking on ebp clobbering makes sense. That's an essential part of its expected calling convention.</p><p>Your libdos project is very interesting. It's got a surprising amount of stuff implemented! You should be aware that ELKS has a complete 16-bit standard C library (<a href="https://github.com/jbruchon/elks)" rel="nofollow noopener" title="https://github.com/jbruchon/elks)">https://github.com/jbruchon...</a>. There's a "Bruce's C compiler" (bcc) out there that can build pre-ANSI C programs and will link against it. I was poking around with these tools first before figuring out how to bend GCC to do the same job.</p></div><div class='comment'><div class='author'>Zirias</div><time datetime='2015-08-02T15:43:12Z'>Sun, 02 Aug 2015 15:43:12 UTC</time><div class='body'><p>Indeed, clang does the same thing using -m16: emitting 32bit code for real mode. So no way to have the clang-compiled binary run on anything prior to 80386. But who cares. If you look at this bugreport: <a href="https://gcc.gnu.org/bugzilla/show_bug.cgi?id=59672" rel="nofollow noopener" title="https://gcc.gnu.org/bugzilla/show_bug.cgi?id=59672">https://gcc.gnu.org/bugzill...</a> another reasoning for -m16 seems to be that the compiler should be aware of real mode and NOT doing optimizations that break when running in real mode. From what I tried so far, GCC gets it wrong sometimes, clang does a great job. Unfortunately it WILL introduce bugs, too, when attempting to compile one unit at a time, linking with <a href="http://ld.gold" rel="nofollow noopener" title="ld.gold">ld.gold</a> and -flto. So I was forced to change my Makefile to build the entire binary in a single compiler run -- linking without -flto would probably work, too, but given you have only 64K, it's unacceptable.</p><p>About the ebp clobbering: Not sure how clang handles this, I didn't bother to check the assembly because it "just worked", while GCC refused to compile.</p><p>Btw, thanks for the link. But what I'm trying to do here is just implementing enough runtime-stuff so my curses game will run (maybe plus a little extra when it's easy to implement, but minus curses, I'll just create an alternative I/O module using my custom conio interface). About bcc, I heard of it before -- well after reading your article, I didn't think it would be something I'd want to use :)</p><p>So, just thanks for this cool article that gave me the initial idea. It was a great starting point, too, and finding that clang seems to do a better job, I thought that was worth mentioning (it also does a nice job optimizing e.g. a whole lot of bit-shifting and masking C code to just 2 or 3 equivalent instructions -- I was amazed to see the assembly created with -Os for my dosversion() in core.c).</p></div></div><div class='comment'><div class='author'>Zirias</div><time datetime='2015-08-04T10:00:40Z'>Tue, 04 Aug 2015 10:00:40 UTC</time><div class='body'><p>As my project does some progress (I'm nearly there supporting my curses game, "just" a curses compatibility layer and an sqrt() implementation are missing) -- I wanted to let you know that I linked this blog post in my <a href="http://README.md" rel="nofollow noopener" title="README.md">README.md</a> for credit. I hope that's ok, if you're opposed please let me know.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-08-06T19:22:05Z'>Thu, 06 Aug 2015 19:22:05 UTC</time><div class='body'><p>Impressive work! I bet a bunch of small curses software (roguelikes, etc.) could be ported to real mode on top of your project.</p></div><div class='comment'><div class='author'>Zirias</div><time datetime='2015-08-08T23:55:04Z'>Sat, 08 Aug 2015 23:55:04 UTC</time><div class='body'><p>Thanks Christopher. Now I can finally say: I'm done (so far). My curses-based game (<a href="https://github.com/Zirias/cursedsnake)" rel="nofollow noopener" title="https://github.com/Zirias/cursedsnake)">https://github.com/Zirias/c...</a> compiles and runs as a DOS .COM file -- great :) There were quite some surprises on the way, the biggest one being: although clang seems to do a great job optimizing the code, it messes up at the assembly stage (see <a href="http://stackoverflow.com/questions/31865276" rel="nofollow noopener" title="http://stackoverflow.com/questions/31865276">http://stackoverflow.com/qu...</a> .. Not sure whether only the LEA instruction is messed up, but that's what I found ...). My workaround for now is let clang output just assembly source and handle the actual assembly using GNU as. I'll try to create a minimal example for a bugreport to clang soon. Nevertheless, it works, so thanks again for this great blog post that initially gave me the idea :) For porting other curses-software, well, so far my curses implementation is merely a "shim" providing just what my game needs....</p></div></div></div></div></div></div><div class='comment'><div class='author'>Zirias</div><time datetime='2015-08-04T20:30:45Z'>Tue, 04 Aug 2015 20:30:45 UTC</time><div class='body'><p>Posting one more comment because it could save your readers quite some though debugging: It appears the linker will not occupy *any* space for .bss (uninitialized variables of static storage in C) using the binary output format, but just assume .bss uses anything appearing directly after the file contents. EDIT: what I posted here before is NOT the solution! Still trying to figure out ...</p><p>FIXED IT: space occupation for .bss was ok, the problem was COMMON symbols didn't get any space in the output and so "competed" with .bss AND the heap, leading in all kinds of data corruption. Fixed linker script: <a href="https://github.com/Zirias/clang-libdos/blob/master/com.ld" rel="nofollow noopener" title="https://github.com/Zirias/clang-libdos/blob/master/com.ld">https://github.com/Zirias/c...</a></p></div><div class='comment'><div class='author'>bsa</div><time datetime='2017-04-27T08:39:08Z'>Thu, 27 Apr 2017 08:39:08 UTC</time><div class='body'><p>Link is broken :(</p></div></div></div><div class='comment'><div class='author'>Jan Minar</div><time datetime='2015-10-08T04:59:50Z'>Thu, 08 Oct 2015 04:59:50 UTC</time><div class='body'><p>s/DOS will so most of the setup/DOS will do most of the setup/</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-10-08T11:29:16Z'>Thu, 08 Oct 2015 11:29:16 UTC</time><div class='body'><p>Fixed, thanks!</p></div></div></div><div class='comment'><div class='author'>Андрей Иванов</div><time datetime='2015-11-10T13:34:30Z'>Tue, 10 Nov 2015 13:34:30 UTC</time><div class='body'><p>Very interesting reading, thanks :) And there is a little typo: "COM files are limited to 65,279 bytes in side." (side -&gt; size).</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-11-10T13:39:52Z'>Tue, 10 Nov 2015 13:39:52 UTC</time><div class='body'><p>Thanks! It's been corrected.</p></div></div></div><div class='comment'><div class='author'>Free bee</div><time datetime='2016-12-27T06:44:23Z'>Tue, 27 Dec 2016 06:44:23 UTC</time><div class='body'><p>gcc throw's an error :/tmp/ccjO1BhE.o: In function `boot_entry':<br>boot2.c:(.text+0xb): undefined reference to `_GLOBAL_OFFSET_TABLE_'</p><p>how to deal with this sir</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-12-28T01:04:46Z'>Wed, 28 Dec 2016 01:04:46 UTC</time><div class='body'><p>Looks like your C compiler produces position-independent code by default, which is definitely inappropriate here. Add "-fno-pic" to the build arguments and that should fix it. Are you compiling on a BSD system? I'm curious whose compiler does this by default.</p></div><div class='comment'><div class='author'>Ryan Reno</div><time datetime='2018-01-14T03:52:44Z'>Sun, 14 Jan 2018 03:52:44 UTC</time><div class='body'><p>I was recently following along with another person's blog writing a simple x86 bootloader that called C code.</p><p>In it I had to use the -fno-pic flag with both gcc 7.2.1 and clang 5.0.1 on linux 4.14. Looks like pic is enabled by default on the most recent versions of both compilers.</p><p>Thanks for this post by the way. It's really interesting how you worked around gcc doing its best to be clever.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-01-14T17:44:04Z'>Sun, 14 Jan 2018 17:44:04 UTC</time><div class='body'><p>Yeah, it looks like -fpic is the default these days. I just added -fno-pic to the build to avoid these issues, but I probably should have done this years ago.</p></div></div></div></div></div><div class='comment'><div class='author'>René Rebe</div><time datetime='2018-09-04T20:55:29Z'>Tue, 04 Sep 2018 20:55:29 UTC</time><div class='body'><p>After SoundBlaster DMA and such, I'm currently going more crazy w/ S3 2D graphic acceleration, and the next video tomorrow will even be S3/Virge hardware 3D accelerated triangles: <a href="https://www.youtube.com/watch?v=tjdyd3xcDVY" rel="nofollow noopener" title="https://www.youtube.com/watch?v=tjdyd3xcDVY">https://www.youtube.com/wat...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-09-20T23:30:31Z'>Thu, 20 Sep 2018 23:30:31 UTC</time><div class='body'><p>Thanks for keeping me updated, René. It's impressive how far you've taken this. I always enjoy having a really solid specification / reference like that s3d manual. Opens up so many possibilities.</p></div><div class='comment'><div class='author'>René Rebe</div><time datetime='2018-09-21T16:48:36Z'>Fri, 21 Sep 2018 16:48:36 UTC</time><div class='body'><p>Thank you for starting this great hack ;-) I mostly do this also for some general education and inspire people to work on low level / driver stuff as part of my YT channel. I just went further and implement hardware z-buffer for this S3/Virge acceleration <a href="https://www.instagram.com/p/Bn_sACghQgp/" rel="nofollow noopener" title="https://www.instagram.com/p/Bn_sACghQgp/">https://www.instagram.com/p...</a> and will make the usual  video about this z-buffering and 3d engine details in the next days ;-) PS: it only flickers because of double-buffering (Yet ;-)</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2014-12-23'><a href='/blog/2014/12/23/'>Hot Code Replacement in C</a></h1><div class='comment'><div class='author'>Arseny Kapoulkine</div><time datetime='2014-12-23T18:28:40Z'>Tue, 23 Dec 2014 18:28:40 UTC</time><div class='body'><p>&gt; Since we can't ask dlopen()about the inode of the library it opened, we can't know.</p><p>Of course you can. Just stat the file again - and repeat the reloading process if the inode changed (that'll trigger in some cases when dlopen already opened the new version but it's much better than missing updates).</p><p>Also note that file locking and updating inode are separate - e.g. you could dlopen the file even if the linker updated .so in place (and preserved the inode in the process). In fact you're relying on the exact details of linker behavior when doing the inode check as opposed to timestamp (granted, it's unlikely that a modern linker will write the file in-place).</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-12-23T20:08:21Z'>Tue, 23 Dec 2014 20:08:21 UTC</time><div class='body'><p>Since inodes are reused, the ABA problem is present and the race condition still exists. I'm pretty confident there's no way around it without either carefully writing to unique filenames or using some not-yet-existing extension to dlopen() to reveal more information about the loaded shared object file.</p><p>For example, start by loading version 1 with inode 1. Later version 2 is written to inode 2. The wrapper notices "<a href="http://libgame.so" rel="nofollow noopener" title="libgame.so">libgame.so</a>" now points to inode 2 so it unloads version 1 freeing inode 1, but, before loading, version 3 is written using inode 3, freeing inode 2 (it was unlinked and unopened). Next version 3 is loaded since that's the current file called "<a href="http://libgame.so" rel="nofollow noopener" title="libgame.so">libgame.so</a>", but before calling the second stat() to check the inode again, version 4 is written reusing inode 2. (Imagine we've got a *really* fast, unlucky programmer here!) Since stat() reports inode 2, it looks like we've got the latest version, but version 4 will never be loaded. Version 3 is loaded (inode 3) and the wrapper thinks it's got a hold on inode 2.</p><p>You're right that the linker could update in place via truncation, but I'm fine with relying on the to linker to not do that. I believe such behavior would be incompatible with dlopen() for this project anyway, as specified by POSIX. It says: "Only a single copy of an object file is brought into the address space, even if dlopen() is invoked multiple times in reference to the file, and even if different pathnames are used to reference the file." That suggests to me that a shared library modified in place (i.e. the same file) can never be loaded a second time with the modified contents. It depends on what exactly they mean by "file", though.</p></div><div class='comment'><div class='author'>jp</div><time datetime='2014-12-28T14:32:23Z'>Sun, 28 Dec 2014 14:32:23 UTC</time><div class='body'><p>To do this reliably you might want to use inotify, which has an event type for when a file opened for writing is closed, which is exactly what you want.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-12-28T19:45:15Z'>Sun, 28 Dec 2014 19:45:15 UTC</time><div class='body'><p>Not a bad idea. That would certainly eliminate polling and probably serve as a smarter, though more complex, solution. I've only used inotify a tiny bit, but couldn't inotify handling itself still be pre-empted by another file write/update?</p><p>The main disconnect in the API is that dlopen() takes a path (a filesystem link) rather than a file descriptor. That link can be updated/changed just before dlopen() reads it, and libdl won't tell us exactly what file (read: inode) actually opened/loaded.</p></div><div class='comment'><div class='author'>Miguel Lechón</div><time datetime='2015-01-06T10:44:54Z'>Tue, 06 Jan 2015 10:44:54 UTC</time><div class='body'><p>(thanks for the post)<br>My take on a simple version that avoids polling is to notify the binary of a rebuild by sending it a SIGUSR1 as the last step of the <a href="http://libgame.so" rel="nofollow noopener" title="libgame.so">libgame.so</a> Makefile target.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-01-06T15:20:32Z'>Tue, 06 Jan 2015 15:20:32 UTC</time><div class='body'><p>Oh, using a signal is a good idea! I think that's what I'll probably do when I use this for real.</p></div></div></div></div></div><div class='comment'><div class='author'>Arseny Kapoulkine</div><time datetime='2014-12-30T18:55:45Z'>Tue, 30 Dec 2014 18:55:45 UTC</time><div class='body'><p>Re: ABA - that's a good point, I haven't thought about that. This suggest that timestamps are possibly more reliable. The common case when timestamps fail to update is copying, so maybe timestamp+inode is a good combination...</p></div></div></div></div><div class='comment'><div class='author'>Michael Terry</div><time datetime='2014-12-25T00:59:37Z'>Thu, 25 Dec 2014 00:59:37 UTC</time><div class='body'><p>Great post.</p></div></div><div class='comment'><div class='author'>Mr Go</div><time datetime='2014-12-28T15:41:56Z'>Sun, 28 Dec 2014 15:41:56 UTC</time><div class='body'><p>Hehe, I'm wondering how this would look like in go (golang) as shared libraries are rather hard to use with go.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-12-28T19:48:41Z'>Sun, 28 Dec 2014 19:48:41 UTC</time><div class='body'><p>That's a good question. There's also the garbage collector to worry about.</p></div></div></div><div class='comment'><div class='author'>behemoth</div><time datetime='2014-12-28T16:53:26Z'>Sun, 28 Dec 2014 16:53:26 UTC</time><div class='body'><p>Interesting!</p></div></div><div class='comment'><div class='author'>anonymous</div><time datetime='2014-12-28T18:57:26Z'>Sun, 28 Dec 2014 18:57:26 UTC</time><div class='body'><p>&gt; Due to Windows' broken file locking behavior, the game DLL can't be replaced while it's being used.</p><p>I feel like there is not enough investigation done here. What dwShareMode does LoadLibrary end up using when it opens the DLL? What dwShareMode do you use when you try to replace it? Have you looked into using handle based APIs in ntdll instead of filename based functions kernel32? That will give you more control over sharing flags.</p><p>It's not enough to say you don't understand the semantics therefore they are broken and not workable.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-12-28T20:11:49Z'>Sun, 28 Dec 2014 20:11:49 UTC</time><div class='body'><p>Windows' default file locking behavior has wasted tens of hours of my time, for absolutely no benefit, and will continue to do so into the foreseeable future. It's the reason why Windows, even going on 2015, still has to reboot after every little trivial update. Perhaps there's *some* way to work around it sometimes using obscure system calls that only a handful of people know, but since no applications actually do this, it doesn't matter. I'm always tripping over unnecessary file locks in Windows. Most recent annoyance: at my workplace the mandated virus scanner (Symantec) locks my fresh builds for about 15 seconds for scanning, preventing me from rebuilding within that timeframe.</p><p>What makes it broken in this case is that it's locking the wrong thing. LoadLibrary() locks the link (the path) on the filesystem -- preventing deletion, and, in some cases, renaming -- when, if anything, it should be locking the file itself (as is the case on Linux). There's no technical reason for this. It's just a design mistake MS made a long time ago that they continue to do, I'm guessing, for the sake of backwards compatibility.</p></div><div class='comment'><div class='author'>win_is_not_a_monster</div><time datetime='2014-12-29T08:11:34Z'>Mon, 29 Dec 2014 08:11:34 UTC</time><div class='body'><p>What about something simpler? Move the DLL to temporary location, load if from there and monitor your original path for changes. When you catch an create&amp;delete, write or rename event on your DLL, you simply unload the old temp one, copy new it to new temp location and load it again. Then goto 1. Then if you have more time to invest in nice solution, you could invent nice solution that does not smell as a hack.</p></div></div><div class='comment'><div class='author'>possiblywrong</div><time datetime='2015-01-01T22:21:59Z'>Thu, 01 Jan 2015 22:21:59 UTC</time><div class='body'><p>Re the Symantec issue, we've also encountered this in closed environments, where it's configurable to keep Symantec out of designated folders.  On your desktop, though, I'm not sure if you have enough control over Symantec to do the same thing.  Agree that this is annoying :).</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-01-01T22:50:57Z'>Thu, 01 Jan 2015 22:50:57 UTC</time><div class='body'><p>You nailed it: this is happening to me in a closed environment. I had simply accepted it as an unavoidable annoyance of working on that platform, especially with the lock time being inconsistent. I'll have to ask about getting the configuration adjusted!</p></div></div></div></div></div><div class='comment'><div class='author'>celeron504</div><time datetime='2014-12-30T00:55:17Z'>Tue, 30 Dec 2014 00:55:17 UTC</time><div class='body'><p>Hello Christopher,</p><p>Love the post! Would like to get this working on my RHEL 6.2 system that has ncurses and ncurses-devel installed yet when I attempt to run make, it fails miserably. I see there is a ncurses.h included in game.c.</p><p>What am I missing?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2014-12-30T22:14:01Z'>Tue, 30 Dec 2014 22:14:01 UTC</time><div class='body'><p>Someone else mentioned having problems with it freezing when updating in Linux Mint, if that's what you're talking about. I've tested in Debian, CentOS 6.6, CentOS 7.0, and OpenBSD 5.6, but unfortunately I haven't been able to duplicate the issue so I don't really know how to debug it.</p></div><div class='comment'><div class='author'>celeron504</div><time datetime='2014-12-31T18:07:03Z'>Wed, 31 Dec 2014 18:07:03 UTC</time><div class='body'><p>Thanks for the reply! I cannot even get that far. When I attempt to build and run, the compiler spits out an error about -lncurses. Oh well, I will keep at it.</p></div></div></div></div><div class='comment'><div class='author'>Muhahah</div><time datetime='2014-12-30T11:47:44Z'>Tue, 30 Dec 2014 11:47:44 UTC</time><div class='body'><p>Windows allows dynamic load/reload of the DLL plus hotpatching of any PE image. Therefore, you just need to implement either of these two techniques.</p></div></div><div class='comment'><div class='author'>plops</div><time datetime='2015-01-07T14:13:51Z'>Wed, 07 Jan 2015 14:13:51 UTC</time><div class='body'><p>Thanks for this post. I just tried to create graphical output using libvncserver using this method and it works quite nicely -- even better than expected, really. I wrote a short description on <a href="http://fourierlisp.blogspot.de/2015/01/interactive-programming-with.html" rel="nofollow noopener" title="http://fourierlisp.blogspot.de/2015/01/interactive-programming-with.html">http://fourierlisp.blogspot...</a> and put the code on <a href="https://github.com/plops/arduino_due_lisp/tree/master/interactive-display-fft" rel="nofollow noopener" title="https://github.com/plops/arduino_due_lisp/tree/master/interactive-display-fft">https://github.com/plops/ar...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-01-20T00:18:23Z'>Tue, 20 Jan 2015 00:18:23 UTC</time><div class='body'><p>Interesting, thanks! It really is surprising how well it works.</p></div></div></div><div class='comment'><div class='author'>Ahmed Fasih</div><time datetime='2015-01-30T13:59:15Z'>Fri, 30 Jan 2015 13:59:15 UTC</time><div class='body'><p>If Python or Julia are interactive languages, this kind of approach is hyper-interactive: you can change values inside "the game loop" (one iteration of loading the shared library and updating your game state) and see the result right away. A "game loop" written in a standard interactive language wouldn't allow for this much granularity in changing values inside the loop at runtime.</p><p>Wow! What a neat idea!</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-01-30T18:09:29Z'>Fri, 30 Jan 2015 18:09:29 UTC</time><div class='body'><p>You're right about Python and Julia. It's why I prefer Lisp's packages, Clojure's namespaces, and JavaScript's nothing to Python and Julia style modules, which are locked away from runtime modification. Unless you intentionally break it yourself, the former three let you manipulate anything you want about the "game loop" while it's running, like the C version here.</p></div><div class='comment'><div class='author'>Ahmed Fasih</div><time datetime='2015-02-08T07:45:41Z'>Sun, 08 Feb 2015 07:45:41 UTC</time><div class='body'><p>Makes me want to learn erlang!</p></div></div></div></div><div class='comment'><div class='author'>Robin Hack</div><time datetime='2015-08-01T17:10:34Z'>Sat, 01 Aug 2015 17:10:34 UTC</time><div class='body'><p>I like this approach much. I see one another quirk. If you want to use threads, you must be careful.<br>What can happen is ilustrated here:<br><a href="https://github.com/marmolak/badass" rel="nofollow noopener" title="https://github.com/marmolak/badass">https://github.com/marmolak...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-08-02T13:43:55Z'>Sun, 02 Aug 2015 13:43:55 UTC</time><div class='body'><p>Yup, that's another tricky spot due to hidden global state. Since I wrote this article, multi-threading was added to Handmade Hero in the form of a work queue. The work queue is created by, and belongs to, the main program, not the game library. The game library is only swapped out when the work queue is empty, so it doesn't run into problems.</p><p>Playing around with your "badass" program, I can't figure it what specifically causes it to crash! I think it requires looking at the pthreads source. GDB is no help since the debugging info is removed along with dlclose(). I thought maybe it was similar to a problem I was having in my own example: ncurses was linked only with the game library not the main program, and swapping the game library would unload and load ncurses along with it, without properly tearing down ncurses in between. This lead to a crash and display issues on some systems. It could be fixed either by shutting down ncurses before unloading or by forcing (a smart linker might notice it's unused and not actually link it!) linking the main program with ncurses so that it doesn't unload. This doesn't solve the problem with your pthreads demo.</p></div><div class='comment'><div class='author'>Robin Hack</div><time datetime='2015-08-03T06:45:30Z'>Mon, 03 Aug 2015 06:45:30 UTC</time><div class='body'><p>What happes in "badass":<br>badass binary maps <a href="http://libbadass.so" rel="nofollow noopener" title="libbadass.so">libbadass.so</a> to own address space - you can check it via /proc/pid/maps.<br>Library have constructor which creates new thread. Thread (almost) immediately blocks on sleep() call (or long running I/O operation in real world).<br>Back to badass binary. Right after dlopen() and check I call dlclose().<br>Thread is still stuck with sleep(). dlclose() removes libbadass library from badass adress space and just take a nap via sleep(). And now fun begins. We have thread with unmapped address space :)! So.. thread will wakeup from sleep() and then try to write to x global variable... which are in unmapped area. Bang! :).<br>Actually I saw this in the wild with GLib and it's very hard to debug if you don't know that this can happen :).</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2015-01-11'><a href='/blog/2015/01/11/'>BBC site Age check</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2015-02-17'><a href='/blog/2015/02/17/'>Generic C Reference Counting</a></h1><div class='comment'><div class='author'>BruceDawson</div><time datetime='2015-02-17T22:04:07Z'>Tue, 17 Feb 2015 22:04:07 UTC</time><div class='body'><p>Be aware that snprintf is not supported in VC++ up to VC++ 2013. Some clever people 'fix' this with "#define snprintf _snprintf" but this is dangerously invalid because _snprintf does not guarantee null-termination. This horror show goes away with VC++ 2015.</p><p>But I'm still not a fan of snprintf. As my blog post says, it still suffers from the requirement that the programmer explicitly specify the size, and programmers have been shown to get that wrong in at least half-a-dozen different ways.</p><p>It looks like atomic_fetch_add does a full memory barrier which is expensive, especially on ARM and PowerPC. A full memory barrier should not be necessary for a reference count. An explicit barrier might be needed after the count hits zero and before the call to free in order to ensure that all writes from other threads are visible to the freeing thread.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-02-19T21:42:21Z'>Thu, 19 Feb 2015 21:42:21 UTC</time><div class='body'><p>I didn't realize until after writing this article that MSVCRT doesn't have snprintf(). I thought it did because MinGW does some tricks to provide a mostly-correct version (missing the same format flags as MSVCRT printf), despite linking against MSVCRT. That's the only Windows C compiler I ever use.</p><p>That's a good point about atomic_fetch_add(). I need to learn more about these low level atomic semantics.</p></div></div></div><div class='comment'><div class='author'>newguy</div><time datetime='2015-06-19T12:34:39Z'>Fri, 19 Jun 2015 12:34:39 UTC</time><div class='body'><p>Great post! I was using a simpler model for reference counting, this definitively beats it. I was wondering, why did you chose to use "static" for node_free?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-06-19T15:35:04Z'>Fri, 19 Jun 2015 15:35:04 UTC</time><div class='body'><p>Thanks! I made node_free() static because it's not part of the "node" public API -- it wouldn't be listed in its header file. Only its function pointer, not the name, escapes the translation unit via ref's free field. Users of node linked lists would never call node_free() directly, instead going through ref_dec(), which will call node_free() through the function pointer (and not by name).</p></div></div></div><div class='comment'><div class='author'>PerilousApricot</div><time datetime='2016-01-21T19:59:00Z'>Thu, 21 Jan 2016 19:59:00 UTC</time><div class='body'><p>Great article. One thing. Even with the atomics, this seems not thread-safe. While executing node_pop()...</p><p>if (*nodes)</p><p>    ref_inc(&amp;(*nodes)-&gt;refcount);</p><p>....another thread could ref_dec and then free (*nodes) between the if and the ref_inc. I've spent some time pondering, but I can't figure a way out of it...</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-01-21T20:37:39Z'>Thu, 21 Jan 2016 20:37:39 UTC</time><div class='body'><p>You're right. That's definitely not thread safe, and what you pointed out is just one several things that makes it not thread safe. However, I never intended it to be thread-safe, just an example of linked lists sharing tails with little friction. Since I put the example after talking about atomic reference counting I can see why that would be misleading.</p><p>A few months prior I *did* write about a thread-safe, atomic, linked list stack:</p><p><a href="http://nullprogram.com/blog/2014/09/02/" rel="nofollow noopener" title="http://nullprogram.com/blog/2014/09/02/">http://nullprogram.com/blog...</a></p><p>Getting it right can be pretty hairy.</p></div><div class='comment'><div class='author'>PerilousApricot</div><time datetime='2016-01-21T22:29:13Z'>Thu, 21 Jan 2016 22:29:13 UTC</time><div class='body'><p>I was using node_pop as an example of how the refcounting could get weird, but I can't actually think of a counterexample where concurrent use of this refcounting would work correctly.</p><p>Every "toy" usage I try to think of fails because you can't both change the reference count and dereference the pointer atomically, and I can't think of how to get around it except for hazard pointers (guh).</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-01-22T02:44:45Z'>Fri, 22 Jan 2016 02:44:45 UTC</time><div class='body'><p>Here's an example of how the atomic reference counters could be used safely. Suppose you construct two linked lists, X and Y, in thread A and you make these linked lists share a tail somewhere along their length. Then you spawn threads B and C, and for each you increment the counters of X and Y and pass them to B and C, respectively. These hreads are now partially sharing a data structure. Normally this would be tricky to clean up if we can't know when the other threads are done.</p><p>When using the atomic reference counters, any thread can safely free their linked list at any time without leaking. The first to call ref_free() will decrement the counter to 0, free any non-shared nodes, and will observe the first shared as still being held, and doing nothing more. The last to free the list will observe a decrement of all nodes to refcount 0 and free the remaining structure.</p></div><div class='comment'><div class='author'>PerilousApricot</div><time datetime='2016-01-22T18:49:29Z'>Fri, 22 Jan 2016 18:49:29 UTC</time><div class='body'><p>In your example, aren't there still windows where things can race? I guess this is the simplest test case I could think of:</p><p>obj * global_ptr = obj_new(); // ref initialized to 1<br>void thread_A() {<br>    // How can I be sure this will work?<br>    obj * local_ptr = global_ptr;<br>    if (local_ptr)<br>        ref_inc(&amp;local_ptr-&gt;ref);<br>}<br>void thread_B() {<br>    ref_dec(global_ptr);<br>}</p><p>What keeps the following chronological ordering from happening?</p><p>if (atomic_dec(ref) == 0) //from ref_dec, refcount is zero.<br>atomic_inc(ref); // from ref_inc<br>ref-&gt;free(ref); // from ref_dec</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-01-22T20:50:22Z'>Fri, 22 Jan 2016 20:50:22 UTC</time><div class='body'><p>A thread that doesn't have a reference can't get one on its own. As you pointed out, it would be a race condition. However, a thread can safely be given a pre-incremented reference from another thread that already has a valid reference. That way there's no possible sequence of operations that would allow it to reach 0 early.</p></div></div></div></div></div></div></div></div><hr/><div class='thread'><h1 id='2015-03-15'><a href='/blog/2015/03/15/'>Goblin-COM 7DRL 2015</a></h1><div class='comment'><div class='author'>possiblywrong</div><time datetime='2015-03-16T22:51:46Z'>Mon, 16 Mar 2015 22:51:46 UTC</time><div class='body'><p>This is very cool, particularly for its compactness!  I like the addition of your own directives to panel_printf(); I remember once using vsprintf() to route the already-expanded string output to an LCD in an embedded application, but it never occurred to me to poke around *inside* the format string.  Neat.</p><p>A question that might be more about the post than the program: how did you create the WebM video of the terminal?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-03-17T00:08:11Z'>Tue, 17 Mar 2015 00:08:11 UTC</time><div class='body'><p>Something I discovered through this project is that with GCC you can tag your own format functions with the __attribute__ ((format ...)). That way you still get all the regular print() compiler warnings. That was one of the main reasons I've hesitated to make vsprintf() passthroughs in the past, outside of simple macros.</p><p>As for recording the video, ffmpeg has a handy screen capture capability:</p><p><a href="https://trac.ffmpeg.org/wiki/Capture/Desktop" rel="nofollow noopener" title="https://trac.ffmpeg.org/wiki/Capture/Desktop">https://trac.ffmpeg.org/wik...</a></p><p>I prefer to capture it as Y4M (raw, uncompressed) so that I can pass it through vpxenc to encode the WebM, then separately through x264 for the h.264 MP4 version.</p></div></div></div></div><hr/><div class='thread'><h1 id='2015-03-19'><a href='/blog/2015/03/19/'>A Basic Just-In-Time Compiler</a></h1><div class='comment'><div class='author'>Tom Galvin</div><time datetime='2015-03-19T19:02:26Z'>Thu, 19 Mar 2015 19:02:26 UTC</time><div class='body'><p>Good read - interesting to see how you pulled off the solution!</p></div></div><div class='comment'><div class='author'>Louis L.</div><time datetime='2015-03-19T19:12:32Z'>Thu, 19 Mar 2015 19:12:32 UTC</time><div class='body'><p>Thank you very much. I tried few months ago to write a toy JIT, but I failed to solve the problem with executable memory. Your post is a very good point to start anew.</p></div></div><div class='comment'><div class='author'>none</div><time datetime='2015-03-20T00:06:30Z'>Fri, 20 Mar 2015 00:06:30 UTC</time><div class='body'><p>GNU lightning?</p><p><a href="https://www.gnu.org/software/lightning/" rel="nofollow noopener" title="https://www.gnu.org/software/lightning/">https://www.gnu.org/softwar...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-03-20T14:02:32Z'>Fri, 20 Mar 2015 14:02:32 UTC</time><div class='body'><p>I was going to mention GNU lightning at the end, but at this point I don't know why I'd use it instead of LLVM.</p></div></div></div><div class='comment'><div class='author'>Ahmed Fasih</div><time datetime='2015-03-25T18:39:52Z'>Wed, 25 Mar 2015 18:39:52 UTC</time><div class='body'><p>This reminds me that the best way to learn about a topic is sometimes (usually?) not to try and read about it directly but to see someone solve a real and readily-grasped problem using techniques from that topic. The whole "tell me, show me, let me" aphorism.</p><p>This really helped me understand what JITs (Julia, Matlab, JVM) do, but could you say a few words on the opposite: how do *interpreters* work? I'm trying to visualize what a small interpreter to solve this problem would look like: would it be a program that parsed the description and instead of producing assembly, running the appropriate arithmetic at each step? I don't think that's as enlightening an example to understand interpreters as your code is in understanding JIT compilers. (I ask as someone who has never implemented a Scheme interpreter.)</p><p>Serious gratitude!</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-03-27T04:16:55Z'>Fri, 27 Mar 2015 04:16:55 UTC</time><div class='body'><p>You're right, an example is worth a thousand words. When I'm reading a specification, an example up front provides so much important context for the rest of the document. A lot of the time, an example is all I need in order to get something Good Enough for my needs.</p><p>An interpreter is a lot simpler than a compiler, which is why you'd usually start with writing one of those before getting into compilers. An interpreter steps through a program and does what it says as it walks the code. For example, when it sees a plus sign (or the AST equivalent), it performs an addition operation right on the spot against the runtime state of the program. Few major language implementations, especially newer ones, actually have interpreters like this, instead compiling to at least some sort of simpler bytecode representation at the last minute (then interpreting that instead!).</p><p>A compiler outputs another program, usually in a lower level language (x86_64 machine code in this article), that executes the original input program's instructions. For example, when it sees a plus sign, it outputs code to perform an addition.</p></div></div></div></div><hr/><div class='thread'><h1 id='2015-04-19'><a href='/blog/2015/04/19/'>NASM x86 Assembly Major Mode for Emacs</a></h1><div class='comment'><div class='author'>invalid-id</div><time datetime='2015-06-04T15:52:21Z'>Thu, 04 Jun 2015 15:52:21 UTC</time><div class='body'><p>Hi,<br>I haven't been programming with nasm for years, but your nasm-mode sounds elaborate.</p><p>Have you considered publishing the link to your nasm-mode repository on "<a href="http://www.emacswiki.org/emacs/AssemblyProgramming" rel="nofollow noopener" title="http://www.emacswiki.org/emacs/AssemblyProgramming">http://www.emacswiki.org/em...</a>"?</p></div></div><div class='comment'><div class='author'>Nehal Patel</div><time datetime='2016-02-06T02:27:22Z'>Sat, 06 Feb 2016 02:27:22 UTC</time><div class='body'><p>Hi -- Your emacs package is nice.  Can you explain how to set the column location<br>for right hand comments (I want them to be a little further to the right).  Trying to look through your elisp code, I think it relies on (comment-indent) rather than having a column number set in your package, but I'm not totally sure how this all works.<br>Thanks</p></div></div><div class='comment'><div class='author'>Nehal Patel</div><time datetime='2016-02-06T02:51:31Z'>Sat, 06 Feb 2016 02:51:31 UTC</time><div class='body'><p>actually it was easy enough to figure out.  using: C-h f comment-indent<br>shows help, which has links that show how to set and save the column width.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-02-06T15:19:27Z'>Sat, 06 Feb 2016 15:19:27 UTC</time><div class='body'><p>Glad to hear you got it figured out so easily. This is a perfect example of why there's value in building extensions on top of existing Emacs features: the extension inherits the user's existing configuration and the user may already know how to configure it. Your new understanding of comment-indent will directly carry over to other modes that also use it.</p></div></div></div><div class='comment'><div class='author'>Ricardo</div><time datetime='2017-06-01T01:50:10Z'>Thu, 01 Jun 2017 01:50:10 UTC</time><div class='body'><p>Your arguments against GAS are misleading. It is possible to use intel syntax (-masm=intel) with it and you can write shellcodes perfectly without glibc (-nostdlib)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-06-01T02:23:36Z'>Thu, 01 Jun 2017 02:23:36 UTC</time><div class='body'><p>The GNU "-masm=intel" option produces/consumes assembly that looks like Intel syntax, but it's a second-class citizen. It's just a crummy version of Intel syntax with the wrong mnemonics. Also, it takes more than -nostdlib to write sophisticated shellcode. GAS doesn't allow for the necessary direct control over the assembly, particularly with addressing. It *really* wants to produce an object file to be consumed by a linker, leaving addressing details for the linker to work out. In order to get that sort of control, you need a custom linker script.</p><p>On the other hand, NASM handles all this stuff gracefully with a very comfortable flavor of Intel syntax. Its syntax is a bit too loose for automated code generation, and I wish it was a little stricter, but it's pretty great for hand-written assembly. Just beware of the GNU linker's braindead default of creating an executable stack unless the .note.GNU-stack "marker" section is included in every object file.</p></div></div></div></div><hr/><div class='thread'><h1 id='2015-05-15'><a href='/blog/2015/05/15/'>Raw Linux Threads via System Calls</a></h1><div class='comment'><div class='author'>Anon</div><time datetime='2015-06-07T19:06:35Z'>Sun, 07 Jun 2015 19:06:35 UTC</time><div class='body'><p>&gt;it takes less than 15 instructions to spawn a<br>thread with its own stack</p><p>Well, on the userland side, yes you only write 15 instructions. But (sadly!) the kernel can't magically process your syscalls and spawn a thread in 0 instructions :)</p><p>Interesting read, though.</p></div></div><div class='comment'><div class='author'>kant kodali</div><time datetime='2015-06-08T10:20:59Z'>Mon, 08 Jun 2015 10:20:59 UTC</time><div class='body'><p>Nice Article. So those User Thread Library calls will event gets mapped to clone() System call? say for example pthread_create will that eventually get mapped to sys_clone() or clone()? Where can we see that mapping?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-06-08T11:47:56Z'>Mon, 08 Jun 2015 11:47:56 UTC</time><div class='body'><p>Since the details of making a system call are specific to each architecture, and library authors generally want to minimize the amount of platform-specific code, a threading library would be encouraged to go through a portable syscall() function rather than hand code it in assembly, or call clone() in a standard library. The clone() function could be implemented on top of syscall(). However, taking a look just now at two of the Linux C libraries, glibc and musl, I can see they each have separate clone() written for each architecture. Here's where you can find that for x86_64 on each.</p><p>glibc: sysdeps/unix/sysv/linux/x86_64/clone.S</p><p>musl: src/thread/x86_64/clone.s</p><p>Ultimately, yes, no matter how you create a kernel thread on Linux you'll eventually make a clone() system call.</p></div></div></div><div class='comment'><div class='author'>Bakka</div><time datetime='2015-06-08T10:26:05Z'>Mon, 08 Jun 2015 10:26:05 UTC</time><div class='body'><p>Very nice article thanks.! Interesting read for sure!</p></div></div><div class='comment'><div class='author'>Shamir Udi</div><time datetime='2015-06-08T23:10:47Z'>Mon, 08 Jun 2015 23:10:47 UTC</time><div class='body'><p>Great article</p></div></div><div class='comment'><div class='author'>wang xbing</div><time datetime='2015-10-16T12:56:33Z'>Fri, 16 Oct 2015 12:56:33 UTC</time><div class='body'><p>Very impressive.</p></div></div><div class='comment'><div class='author'>Ofir</div><time datetime='2017-02-11T21:37:16Z'>Sat, 11 Feb 2017 21:37:16 UTC</time><div class='body'><p>Thank you or the fantastic post, as this makes lots of sense on how thread creating works behind the scene.<br>For completeness, I would add support for thread function that receives an argument (similar to pthread's void* argument), by extending your thread_create function to get another argument.<br>This would probably need no more than two additional instructions:<br>push rsi<br>at the beginning of thread_create, and:<br>pop rdi <br>just before ret.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-02-12T00:14:20Z'>Sun, 12 Feb 2017 00:14:20 UTC</time><div class='body'><p>Yup, you're exactly right. Otherwise it takes some synchronization acrobatics just to get that initial per-thread information to each thread.</p></div></div></div><div class='comment'><div class='author'>Peter Cordes</div><time datetime='2017-07-02T04:00:19Z'>Sun, 02 Jul 2017 04:00:19 UTC</time><div class='body'><p>Very nice writeup.  One improvement, though: MAP_GROWSDOWN is considered harmful, and shouldn't be used even for thread stacks.  The kernel doesn't reserve the address-space below the mapping to stop future mmaps from going right below the new stack, preventing any further growth.  The only safe option is to allocate a big enough stack in the first place, and not depend on it being able to grow.  (There's nearly no cost to mapping extra memory pages that you never touch, except for i386 code where virtual address space is limited.)</p><p> Ulrich Drepper even proposed removing it in Linux 2.6.29 (<a href="https://lwn.net/Articles/294001/)" rel="nofollow noopener" title="https://lwn.net/Articles/294001/)">https://lwn.net/Articles/29...</a>.  See also <a href="https://stackoverflow.com/a/5369022/224132" rel="nofollow noopener" title="https://stackoverflow.com/a/5369022/224132">https://stackoverflow.com/a...</a> for more details.</p><p>MAP_GROWSDOWN also makes stack clash exploits easier, because the mapping can grow all the way into another mapping.  See <a href="https://blog.qualys.com/securitylabs/2017/06/19/the-stack-clash" rel="nofollow noopener" title="https://blog.qualys.com/securitylabs/2017/06/19/the-stack-clash">https://blog.qualys.com/sec...</a> (more links at <a href="https://stackoverflow.com/questions/44858528/where-are-the-stacks-for-the-other-threads-located-in-a-process-virtual-address/44858613#comment76697488_44858528)" rel="nofollow noopener" title="https://stackoverflow.com/questions/44858528/where-are-the-stacks-for-the-other-threads-located-in-a-process-virtual-address/44858613#comment76697488_44858528)">https://stackoverflow.com/q...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-07-03T01:42:23Z'>Mon, 03 Jul 2017 01:42:23 UTC</time><div class='body'><p>Thanks for the heads up! From your links, I'm guessing the proper alternative is to reserve the entire stack at the beginning (no growing) and manually map a guard page/region below, preventing the kernel from picking those addresses for some other mapping. Though that's still subject to some kinds of stack clashing attacks unless the application is compiled with -fstack-check.</p><p>I did write about stack clashing recently, including linking the same article you linked: <a href="http://nullprogram.com/blog/2017/06/21/" rel="nofollow noopener" title="http://nullprogram.com/blog/2017/06/21/">http://nullprogram.com/blog...</a></p></div></div></div><div class='comment'><div class='author'>Liam Huang</div><time datetime='2018-04-09T07:01:12Z'>Mon, 09 Apr 2018 07:01:12 UTC</time><div class='body'><p>Could I translate it into Chinese and post it on my own blog?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-04-09T11:17:05Z'>Mon, 09 Apr 2018 11:17:05 UTC</time><div class='body'><p>Sure, no problem. If you include a link back to this original article then I'll add your link to the translations list at the top.</p></div><div class='comment'><div class='author'>Liam Huang</div><time datetime='2018-04-10T08:54:47Z'>Tue, 10 Apr 2018 08:54:47 UTC</time><div class='body'><p>Sure thing!<br>I've finished the translation and put your name, the link of this post on the top of the translation copy.<br>The translation copy could be found at: <a href="https://liam0205.me/2018/04/10/Raw-Linux-Threads-via-System-Calls/" rel="nofollow noopener" title="https://liam0205.me/2018/04/10/Raw-Linux-Threads-via-System-Calls/">https://liam0205.me/2018/04...</a></p><p>Thanks for your interesting post, again!</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-04-10T13:40:33Z'>Tue, 10 Apr 2018 13:40:33 UTC</time><div class='body'><p>I've added a link to your translation. Thanks!</p></div><div class='comment'><div class='author'>Liam Huang</div><time datetime='2018-04-10T14:48:06Z'>Tue, 10 Apr 2018 14:48:06 UTC</time><div class='body'><p>: )</p></div></div></div></div></div></div></div><hr/><div class='thread'><h1 id='2015-06-06'><a href='/blog/2015/06/06/'>Minimal OpenGL Core Profile Demo</a></h1><div class='comment'><div class='author'>esgames.org</div><time datetime='2015-06-07T22:00:24Z'>Sun, 07 Jun 2015 22:00:24 UTC</time><div class='body'><p>Great article! Also don't forget to mention GLFW! Its more powerful than FreeGLUT (has swap control) but not as big as SDL.</p><p><a href="http://glfw.org" rel="nofollow noopener" title="http://glfw.org">http://glfw.org</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-06-07T22:28:26Z'>Sun, 07 Jun 2015 22:28:26 UTC</time><div class='body'><p>Oh, thanks! I actually intended to mention GLFW instead of SMFL, but got them mixed up (LWJGL, SDL, SMFL, GLFW, GLUT, GTK, FLTK ... too many similar names in this domain!). I might have used GLFW originally instead of FreeGLUT, but it wasn't yet in Debian stable at the time I made that choice, so I skipped on it.</p></div><div class='comment'><div class='author'>iongion</div><time datetime='2015-06-08T19:26:01Z'>Mon, 08 Jun 2015 19:26:01 UTC</time><div class='body'><p>Dear zlohrd! You are so right with that enumeration!</p></div></div></div></div><div class='comment'><div class='author'>kefeer</div><time datetime='2015-06-08T13:13:25Z'>Mon, 08 Jun 2015 13:13:25 UTC</time><div class='body'><p>Thanks!</p><p>Nitpick: Either i am missing something, or there is glBindBuffer(GL_ARRAY_BUFFER, 0) missing somewhere around line 189 just to be consistent.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-06-08T13:27:41Z'>Mon, 08 Jun 2015 13:27:41 UTC</time><div class='body'><p>Good point, I just added that. That's a perfect example of keeping the OpenGL state tidy. It's a guard against accidentally modifying the state of an object left bound by another part of the program.</p></div></div></div><div class='comment'><div class='author'>Oren Hazi</div><time datetime='2015-07-08T08:40:20Z'>Wed, 08 Jul 2015 08:40:20 UTC</time><div class='body'><p>Nice write-up. I wrote a (mostly) 1-1 re-implementation of your demo in Rust to play with the gl and glfw bindings.</p><p><a href="https://github.com/ohazi/opengl-demo-rust" rel="nofollow noopener" title="https://github.com/ohazi/opengl-demo-rust">https://github.com/ohazi/op...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-07-08T14:29:41Z'>Wed, 08 Jul 2015 14:29:41 UTC</time><div class='body'><p>This is great, thanks! As someone who doesn't know Rust (yet?), it's interesting to see how the idioms translate. I'm also impressed with Rust's OpenGL and GLFW bindings.</p></div></div></div></div><hr/><div class='thread'><h1 id='2015-07-10'><a href='/blog/2015/07/10/'>Mandelbrot Set with SIMD Intrinsics</a></h1><div class='comment'><div class='author'>Vasileios Anagnostopoulos</div><time datetime='2015-07-11T05:42:51Z'>Sat, 11 Jul 2015 05:42:51 UTC</time><div class='body'><p>Could you expand in a later article in combined SIMD and multi-core?</p><p>Thank you.</p></div><div class='comment'><div class='author'>siavashserver</div><time datetime='2015-07-11T09:36:24Z'>Sat, 11 Jul 2015 09:36:24 UTC</time><div class='body'><p>It scales linearly: numCores*singleCoreSIMDPerformance</p><p>False data sharing and CPU cache polution will have a negative effect.</p></div></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-07-12T18:23:02Z'>Sun, 12 Jul 2015 18:23:02 UTC</time><div class='body'><p>It was mostly summed up in siavashserver's comment: scales linearly, with caveats on how those cores interact. The complexity of x86 is makes it easier to write correct programs, but harder to reason about performance. It has out of order execution (instructions execute in a different order than written), but it has a strong memory model (memory reads and writes mostly maintain their original order). But on the other hand this makes it harder to tune performance, especially across microarchitectures. Then if that's not complicated enough, throw in hyperthreading, where logical cores share a single physical core using CPU-level scheduling (underneath OS process/thread scheduling).<br> <a href="http://bartoszmilewski.com/2008/11/05/who-ordered-memory-fences-on-an-x86/" rel="nofollow noopener" title="http://bartoszmilewski.com/2008/11/05/who-ordered-memory-fences-on-an-x86/">http://bartoszmilewski.com/...</a> <br><a href="http://preshing.com/20120515/memory-reordering-caught-in-the-act/" rel="nofollow noopener" title="http://preshing.com/20120515/memory-reordering-caught-in-the-act/">http://preshing.com/2012051...</a></p><p>It's something I need to learn more about before I'd feel comfortable writing on article on it.</p></div></div></div><div class='comment'><div class='author'>ttsiodras</div><time datetime='2015-07-12T16:53:23Z'>Sun, 12 Jul 2015 16:53:23 UTC</time><div class='body'><p>You may find my own (similar) attempts - from a decade ago - interesting: <a href="http://users.softlab.ntua.gr/~ttsiod/mandelSSE.html" rel="nofollow noopener" title="http://users.softlab.ntua.gr/~ttsiod/mandelSSE.html">http://users.softlab.ntua.g...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-07-12T18:03:59Z'>Sun, 12 Jul 2015 18:03:59 UTC</time><div class='body'><p>Interesting, thanks for the link! I haven't actually written any SSE assembly by hand yet, just the intrinsics, so it's neat to see the more direct approach.</p></div></div></div><div class='comment'><div class='author'>possiblywrong</div><time datetime='2015-07-15T16:46:53Z'>Wed, 15 Jul 2015 16:46:53 UTC</time><div class='body'><p>Very interesting post.  I have approximately zero experience with ARM, so if you continue further down that road I would love to read more.</p></div></div><div class='comment'><div class='author'>Ahmed Fasih</div><time datetime='2015-07-22T14:41:54Z'>Wed, 22 Jul 2015 14:41:54 UTC</time><div class='body'><p>Is there any way to simplify writing SIMD, so I don't need to write different code for sse2 vs avx? I.e., some way to convert intermediate-level SIMD-ish code into the intrinsics appropriate to the different architectures? I can imagine a half-baked source-to-source transpiler, but…</p><p>Also, did you find any indication that compilers can start auto-SIMDing things? It would be amazing if, say, Julia did this automatically.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-07-23T00:22:24Z'>Thu, 23 Jul 2015 00:22:24 UTC</time><div class='body'><p>A question all the way from Ohio! :-P</p><p>There's certainly a lot of similarity between the different SIMD instruction sets. I haven't tried it yet, but perhaps what you're asking could be done via a high-level macro interface. Macros that expand to the target intrinsics and types (e.g. SIMD_ADD_FLOATS(), SIMD_MUL_FLOATS(), etc.). Some higher-level macros would expand to multiple intrinsics. For example, testing for the early bailout condition across all lanes is rather different between the different architectures, requiring multiple intrinsics in some instruction sets. <br>Unfortunately I've never seen compilers output SIMD instructions (outside of single-lane SSE) and I wouldn't expect it anytime soon. I can understand why: exploiting SIMD usually requires some significant architectural considerations (packed, homogeneous collections; ex: xxxxxx yyyyyy zzzzzz), which are often at odds with OOP (sparse heterogeneous collections; ex: xyz xyz xyz xyz xyz xyz).</p></div><div class='comment'><div class='author'>Ahmed Fasih</div><time datetime='2015-07-23T01:33:04Z'>Thu, 23 Jul 2015 01:33:04 UTC</time><div class='body'><p>Julia seems to have a @simd macro: <a href="https://software.intel.com/en-us/articles/vectorization-in-julia" rel="nofollow noopener" title="https://software.intel.com/en-us/articles/vectorization-in-julia">https://software.intel.com/...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-07-23T02:58:03Z'>Thu, 23 Jul 2015 02:58:03 UTC</time><div class='body'><p>Interesting ...</p></div><div class='comment'><div class='author'>Ahmed Fasih</div><time datetime='2015-07-23T03:15:33Z'>Thu, 23 Jul 2015 03:15:33 UTC</time><div class='body'><p>Having read your blog post, the Julia Intel article, *and* this article on fast numeric Haskell <a href="https://izbicki.me/blog/fast-nearest-neighbor-queries-in-haskell.html" rel="nofollow noopener" title="https://izbicki.me/blog/fast-nearest-neighbor-queries-in-haskell.html">https://izbicki.me/blog/fas...</a> all in the same day, I find myself really wondering if C/C++ isn't the way to go…? The Intel writer concludes that a dynamic prototyping language like Julia getting to within 2x stone's-throw from Fortran/C is “amazing”—and I would agree—but for the amount of knowledge, experimentation, and luck needed to get “smart” languages like Julia and Haskell to within that 2x, I wonder if those of us who need to get Real Work Done aren't better served just slogging through C… and that's not even considering the desire to squeeze blood from a stone and get to parity with a C implementation.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-07-23T13:05:27Z'>Thu, 23 Jul 2015 13:05:27 UTC</time><div class='body'><p>Here's a very relevant video:</p><p>Fast as C: How to write really terrible Java <a href="https://vimeo.com/131394615" rel="nofollow noopener" title="https://vimeo.com/131394615">https://vimeo.com/131394615</a></p><p>Summary: Getting high performance out of Java essentially requires giving up all the nice things about Java and writing some really ugly code in a narrow, C style.</p><p>I don't know what it is, but over the past year or so I haven't really had a desire to code in a language other than C (or C++ to a degree). I did a few things in JavaScript (supporting GUI) in the past year at work and it felt really fragile compared to the C work it was supporting. C's gotten so comfortable for me now (at least when I have near total project control!) that it doesn't feel at all like "slogging." About a year ago I also completely gave up on the Lisp family (except Elisp), in part because the runtime platforms are far too bulky across most of the implementations. I've been enjoying crafting small, tight binaries where I can account for nearly every byte of the result.</p></div><div class='comment'><div class='author'>Ahmed Fasih</div><time datetime='2015-08-24T19:39:08Z'>Mon, 24 Aug 2015 19:39:08 UTC</time><div class='body'><p>Now we have a nice API to SIMD in Rust too! Time to play.</p></div></div></div></div></div></div></div><div class='comment'><div class='author'>notimportant</div><time datetime='2016-03-16T12:39:41Z'>Wed, 16 Mar 2016 12:39:41 UTC</time><div class='body'><p>You may want to look into this:<br><a href="http://ispc.github.io" rel="nofollow noopener" title="ispc.github.io">ispc.github.io</a></p><p>intel spmd program compiler exports to C/C++ and compiles to sse2/4, avx/2/512 and neon. there is also a paper available.</p></div></div></div><div class='comment'><div class='author'>Ahmed Fasih</div><time datetime='2015-10-09T19:53:42Z'>Fri, 09 Oct 2015 19:53:42 UTC</time><div class='body'><p>Something to watch: SIMD.js: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SIMD" rel="nofollow noopener" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SIMD">https://developer.mozilla.o...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-10-10T12:14:37Z'>Sat, 10 Oct 2015 12:14:37 UTC</time><div class='body'><p>I saw a video and read about this a couple of years ago. I'm still skeptical about its usefulness.</p><p>WebGL operates asynchronously and, once everything is set up, only requires a couple dozen function calls per frame to perform a draw. The speed of the language making those calls is largely irrelevant.</p><p>SIMD on the other hand is not (truly) asynchronous. The heavy lifting happens within the context of, and is synchronous to, the JavaScript runtime. There's a lot of fanfare just to execute a single SIMD instruction. More so, I learned from this Mandelbrot Set project that NEON, unlike SSE and AVX, is really difficult to use effectively; it essentially requires hand-tuning the assembly. As mobile continues to grow, ARM is the platform that would benefit the most from better JavaScript performance, but, IMHO, NEON can't really be driven well by this sort of low-level API.</p><p>If something higher level, sort of like WebGL, was built-up around SIMD, something useful could be done with it. For example, on Linux, MESA will render using the CPU's SIMD capabilities when a GPU isn't available. For those platforms, that makes it a high-level API for SIMD which can be used effectively from JavaScript.</p></div></div></div><div class='comment'><div class='author'>Diego Alonso Cortez</div><time datetime='2016-07-25T00:27:38Z'>Mon, 25 Jul 2016 00:27:38 UTC</time><div class='body'><p>I get the code to compile, and if I do `./mandel.x86 &gt; mandel.png` I see the beautiful picture. How do I visualize the render in real time, though?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-07-25T02:21:00Z'>Mon, 25 Jul 2016 02:21:00 UTC</time><div class='body'><p>You would need to hook up some sort of windowing toolkit and make it continuously redisplay the image buffer as the SIMD threads run. Personally, I'd do this with OpenGL running in its own separate thread. To keep things simple for this article, I only made the program dump out the image buffer when done.</p><p>Note that the final output format isn't actually PNG. If that's what you're doing and it still works, your image viewer is simply sniffing the file header to detect format, ignoring the file extension (i.e. what should usually happen).</p></div><div class='comment'><div class='author'>Diego Alonso Cortez</div><time datetime='2016-07-25T08:22:28Z'>Mon, 25 Jul 2016 08:22:28 UTC</time><div class='body'><p>Great info, thanks! (Yes, a PNG dump works, and I had no idea why!)</p></div></div></div></div><div class='comment'><div class='author'>Cameron Elliott</div><time datetime='2016-12-17T02:55:41Z'>Sat, 17 Dec 2016 02:55:41 UTC</time><div class='body'><p>Beautiful work! Could you consider adding a LICENSE file to the repo? If you want suggestions, I would recommend the BSD or MIT license.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-12-17T03:00:38Z'>Sat, 17 Dec 2016 03:00:38 UTC</time><div class='body'><p>Whoops, forgot to do that. I just added the UNLICENSE (public domain), which is my favorite. Thanks!</p></div></div></div><div class='comment'><div class='author'>Maxim Chinyakin</div><time datetime='2017-04-01T08:01:38Z'>Sat, 01 Apr 2017 08:01:38 UTC</time><div class='body'><p>Thank you for the explanation, a nice subject to exercise on SIMD intrinsics, showing why old and badly written programs can't use the modern CPU power to the full.<br>Note that if you use an integer accumulator register (__m256i mk instead of __m256 mk), you don't need to convert it with _mm256_cvtps_epi32 for storing, just scale it and select the bytes which you need to store with _mm256_shuffle_epi8.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-04-02T21:09:42Z'>Sun, 02 Apr 2017 21:09:42 UTC</time><div class='body'><p>That's a good observation about an integer accumulator. I don't remember why I chose to do that as a float. Unfortunately _mm256_shuffle_epi8() is AVX2. I don't have access to any hardware with that instruction set, and I'd prefer to have a separate implementation just for AVX2 anyway.</p></div></div></div><div class='comment'><div class='author'>Peter Cordes</div><time datetime='2017-07-02T04:58:46Z'>Sun, 02 Jul 2017 04:58:46 UTC</time><div class='body'><p>The CPUID instruction is fairly slow, so you don't want to do it for every call.  With a really expensive function, it won't make a measurable difference, but maybe you're vectorizing something that does something fairly fast on a 1k buffer.  It's better to check CPUID once when your program starts, and keep the result in a global.</p><p>gcc / clang can do this for you with  `__builtin_cpu_supports("avx")`.  See <a href="https://stackoverflow.com/questions/17758409/intrinsics-for-cpuid-like-informations" rel="nofollow noopener" title="https://stackoverflow.com/questions/17758409/intrinsics-for-cpuid-like-informations">https://stackoverflow.com/q...</a>.</p><p>Also, instead of branching on a global, you can set function pointers in an initialization function and then call through them later.  An indirect branch still needs branch prediction at the runtime-dispatch site, but it takes less code.  It also avoids a chain of branches to get to the final selected function, which is good if it's not the first one.</p><p>This is also good if you want more complicated logic for figuring out which function to use on which CPU, like x264 (the video encoder) does.  (e.g. SSSE3 with slow shuffles vs. SSSE3 with fast shuffles).  Or if your functions depend on multiple ISA extensions, like one version that uses SSE4.1 and popcnt.  You need to check for both separately.</p></div></div><div class='comment'><div class='author'>Peter Cordes</div><time datetime='2017-07-02T05:05:10Z'>Sun, 02 Jul 2017 05:05:10 UTC</time><div class='body'><p>When you compile, I'd suggest using `-O3 -march=native` to make a binary that's optimized to run on the host you built it on, and can use everything instruction set extension it supports.  `-march=haswell` for example sets `-mtune=haswell`, as well as enabling `-mavx -mavx2 -mfma -mbmi2 -mpopcnt` and so on.  Enabling FMA lets the compiler fold multiply and add intrinsics into an FMA, which can help a lot for Mandelbrot.</p><p>`-mtune=haswell` is also fairly good, especially for AVX, because it disables splitting of unaligned 256b loads/stores into two 128b halves with vextracti128.  See <a href="https://gcc.gnu.org/bugzilla/show_bug.cgi?id=80568" rel="nofollow noopener" title="https://gcc.gnu.org/bugzilla/show_bug.cgi?id=80568">https://gcc.gnu.org/bugzill...</a> for more details.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-07-04T01:45:03Z'>Tue, 04 Jul 2017 01:45:03 UTC</time><div class='body'><p>I deliberately limited the architecture support along the main path, avoiding anything like -march=native for the translation unit containing main(). The idea is to build a binary that runs correctly with SIMD across different hosts by dynamically choosing the appropriate implementation at run-time rather than compile-time, like your example of x264 doing just this.</p><p>Good points about FMA and the advantages of tuning to a particular architecture (-mtune=haskell). I had sort of assumed -ffast-math would cover something like FMA, but that appears not to be the case. I should probably be using FMA intrinsics manually anyway.</p><p>To address your other comment: CPUID _is_ only executed once. It happens at the very beginning of the program when selecting an implementation. As noted in the article, "_builtin_cpu_supports" wasn't yet supported by Clang two years ago, and even still it only arrived in Debian stable (my OS of choice) a couple weeks ago. I chose an alternative that worked on both without changes.</p></div></div></div></div><hr/><div class='thread'><h1 id='2015-09-03'><a href='/blog/2015/09/03/'>Shamus Young&#39;s Twenty-Sided Tale</a></h1><div class='comment'><div class='author'>possiblywrong</div><time datetime='2015-09-04T09:23:50Z'>Fri, 04 Sep 2015 09:23:50 UTC</time><div class='body'><p>&gt; Unfortunately it’s not so much a technical problem as it is a social/educational one.</p><p>This is spot-on.  A recent several weeks spent "group-editing" a technical document... using tracked changes in Word :), felt comically tedious in places where it didn't have to be.  I think the problem is really two-fold: there isn't even widespread comfort with a more reasonable text document format (e.g., LaTeX), let alone use of source control to more efficiently "share" editing effort.</p></div></div><div class='comment'><div class='author'>Samrat Man Singh</div><time datetime='2015-09-16T11:09:01Z'>Wed, 16 Sep 2015 11:09:01 UTC</time><div class='body'><p>How do you find the experience reading CS/programming-related books? I already have a Kindle but I'm considering buying a tablet for reading PDFs.</p><p>Also, are you still using the Note you mentioned in your other post?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-09-16T13:39:09Z'>Wed, 16 Sep 2015 13:39:09 UTC</time><div class='body'><p>Programming books and papers are mostly what I've been reading the last few years. I initially got a cheap Nook Tablet in 2012, which has a smaller screen and resolution that my Samsung Note. The Nook is just garbage, honestly. I totally regret getting it. (Worse, it's one of the unrootable varieties!) Even ignoring that it runs an awful not-quite-Android OS, the screen is simply too small for comfortably reading PDFs and was preventing me from reading many programming books. <br>With the Note in 2013 onward, I had a screen big enough to comfortably read PDFs, making a lot more books available. The aspect ratio (landscape) is also good for flipping through PDF presentations. At this point I prefer PDF programming books to paper books because: 1) The backlit screen means I can read in the dark 2) It's not heavy and clunky like a real programming book 3) It's searchable 4) Being comfortable to read on this screen, there's no real disadvantage to it 5) Quick, easy Internet access to look things up as I read (though, this could be a distracting downside!).</p></div></div></div><div class='comment'><div class='author'>Ahmed Fasih</div><time datetime='2015-10-01T06:34:43Z'>Thu, 01 Oct 2015 06:34:43 UTC</time><div class='body'><p>Reading it now! Off topic, but my friend plays Crusader Kings II and tells me about the crazy events that happen when he's playing (setting up an anti-pope who usurps the Vatican, forcing the actual pope to flee to a Mediterranean island which becomes his much-reduced kingdom) and I always, always beg him to try and turn his games into stories—like this guy did: <a href="http://www.peteradkison.com/can-roleplaying-games-create-good-stories/" rel="nofollow noopener" title="http://www.peteradkison.com/can-roleplaying-games-create-good-stories/">http://www.peteradkison.com...</a> looks like Twenty-Sided Tale is along the same lines.</p><p>I've used Pollen (from the Racket ecosystem) recently, after tiring of writing custom Pandoc writers in Lua. I wrote a tutorial on Pollen: <a href="https://github.com/fasiha/pollen-guide/" rel="nofollow noopener" title="https://github.com/fasiha/pollen-guide/">https://github.com/fasiha/p...</a> but I think there's a lot of dimensions the state of the art in authoring hasn't explored.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-10-03T03:20:17Z'>Sat, 03 Oct 2015 03:20:17 UTC</time><div class='body'><p>Ahmed, you and I are on the same wavelength! This is the core reason I consume YouTube in lieu of traditional television programs. I enjoy watching (and in some cases participating via comments as) people's game stories unfold, drawing on their insight and interpretation of the in-game events.</p><p>To share a similar story, just a few months ago I watched a long playthrough of Medieval II Total War by Damo2986. (I watch most of YouTube at 150% speed in VLC, so it doesn't take quite as long as it might look!)</p><p><a href="https://www.youtube.com/playlist?list=PL9283E4357E110BD0" rel="nofollow noopener" title="https://www.youtube.com/playlist?list=PL9283E4357E110BD0">https://www.youtube.com/pla...</a></p><p>Total War doesn't have quite the same depth as a grand strategy game like Crusader Kings II, but, despite this, in this game he had very similar interactions with the Vatican in an effort to control the Pope (to turn a blind eye to his conquests of Christian lands).</p><p>As far as computer games go, probably the best story engine of all is Dwarf Fortress. For the player's personal sandbox, it generates an entire Tolkienesque world with a history full of kingdoms, heroes, villains, and ancient beasts, simulated at the resolution of individual teeth, fingers, and claws. It becomes a rich, unique context for the player's own story. If you want something to read, I highly recommend you look up Boatmurdered. Or, for something shorter, Bronzemurdered. For video, Damo2986 also has a collaborative playlist on his channel where the group takes their time to dive into the history of the world and their dwarves.</p><p>Thanks for the tip about Pollen! I'll get up to speed using your tutorial.</p></div></div></div><div class='comment'><div class='author'>essay editing service uk</div><time datetime='2015-12-10T04:22:16Z'>Thu, 10 Dec 2015 04:22:16 UTC</time><div class='body'><p>The power of technology that you can be able to read these kind of stuff that would totally help a lot of people. They can manage to bring all of those information into a handy piece of thing and it's quite wonderful.</p></div></div></div><hr/><div class='thread'><h1 id='2015-09-15'><a href='/blog/2015/09/15/'>Recovering Live Data with GDB</a></h1><div class='comment'><div class='author'>australianwritings.com reviews</div><time datetime='2016-01-03T01:24:41Z'>Sun, 03 Jan 2016 01:24:41 UTC</time><div class='body'><p>Learning this kind of guide is actually helpful for someone who needs to gain some effective recovery if they encounter some loss data problem and the main solution is to only do this kind of thing.</p></div></div></div><hr/><div class='thread'><h1 id='2015-09-26'><a href='/blog/2015/09/26/'>Web Tips For Webcomic Authors</a></h1><div class='comment'><div class='author'>Ahmed Fasih</div><time datetime='2015-10-07T15:06:15Z'>Wed, 07 Oct 2015 15:06:15 UTC</time><div class='body'><p>I hope an author or five take you up on this! To the webcomic authors reading this: Chris’ offer here isn’t like your little cousin Vinny’s offer to set you up with a Wordpress site or anything like that. Chris is a very skilled software engineer who loves to mix his profession with his passions and will very likely make you something beyond your dreams.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-10-08T00:31:05Z'>Thu, 08 Oct 2015 00:31:05 UTC</time><div class='body'><p>Aww, shucks ...</p></div></div></div><div class='comment'><div class='author'>Yu0</div><time datetime='2016-02-01T10:38:37Z'>Mon, 01 Feb 2016 10:38:37 UTC</time><div class='body'><p>I was wondering: Do you also follow some webcomics irregularly (e.g. catching up only every few months), and on mobile devices?</p><p>I don't know the exact number of webcomics I follow, but between the likes of XKCD, SMBC, Dilbert... I have started following too many webcomics to keep up with reading the RSS feeds regularly. Because I follow content both on PC and on mobile devices, I am using feedly - but feedly and other hosted alternatives keep the "unread" status only for a limited time (a necessity to avoid database clutter) and hence are unsuitable for following a given webcomic on-and-off. This especially applies to story-heavy webcomics that suffer from viewing pages one at a time.</p><p>The best alternative I know of is comic-rocket, but on iOS it doesn't work too well: The dedicated app is broken and the webapp isn't mobile-friendly. Also many webcomics use redirect scripts to prevent embedding as a frame, which breaks the webapp. This last part is probably the only part directly related to </p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-02-01T16:20:06Z'>Mon, 01 Feb 2016 16:20:06 UTC</time><div class='body'><p>Depends on the webcomic. If it's short, standalone content and doesn't have long story arcs, I'll subscribe right away via Atom/RSS. I'm picky, so I don't subscribe to enough comics that I have trouble keeping up. I think part of what helps is that I use my own web feed reader (Elfeed, in Emacs), which allows me to manage feeds very efficiently. However, I don't have a good way to access this via mobile, so I don't try. I read all my feed content on my desktop.</p><p>If I find a good comic that requires I catch up before subscribing (example: OOTS), I don't subscribe right away. I'll scrape the entire comic to date (wget, curl, etc.), turn it into a PDF/ebook, and read it on my tablet in the evenings as if it were a regular book. Once I'm caught up, then I subscribe.</p></div></div></div></div><hr/><div class='thread'><h1 id='2015-10-14'><a href='/blog/2015/10/14/'>Counting Processor Cores in Emacs</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2015-10-30'><a href='/blog/2015/10/30/'>RSA Signatures in Emacs Lisp</a></h1><div class='comment'><div class='author'>possiblywrong</div><time datetime='2015-10-31T14:23:51Z'>Sat, 31 Oct 2015 14:23:51 UTC</time><div class='body'><p>Interesting post.  The calc-next-prime function doesn't really use Fermat's primality test, does it?  Exercise 10 in the linked documentation even says, "If n is not a prime number, [x^(n-1)%n==1] will not be true for most values of x," which is unfortunately not true (there are some composites for which the equation holds for *all* x).  However, the *solution* to that same exercise mentions the use of a "variant" of Fermat's test, which hopefully plugs this hole?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-10-31T17:24:15Z'>Sat, 31 Oct 2015 17:24:15 UTC</time><div class='body'><p>Up until I wrote this article I assumed calc used Miller-Rabin like everyone else. Wanting to avoid making claims based on false assumptions, I dug into the code and found either Fermat's primality test or at least something that resembles it. See here, line 865.<br> <a href="http://repo.or.cz/emacs.git/blob/refs/tags/emacs-24.4:/lisp/calc/calc-comb.el" rel="nofollow noopener" title="http://repo.or.cz/emacs.git/blob/refs/tags/emacs-24.4:/lisp/calc/calc-comb.el">http://repo.or.cz/emacs.git...</a> <br>Unfortunately that function is a real mess and I'm not interested enough to spend time plucking out the exact algorithm. Based on what you found in the documentation, I'm guessing the author must have changed something about it to turn it into a "variant."</p></div><div class='comment'><div class='author'>possiblywrong</div><time datetime='2015-11-01T14:25:48Z'>Sun, 01 Nov 2015 14:25:48 UTC</time><div class='body'><p>Thanks for the link. This is essentially Miller-Rabin, with some extra special cases thrown in.<br></p></div></div></div></div><div class='comment'><div class='author'>Yu0</div><time datetime='2015-11-01T13:38:53Z'>Sun, 01 Nov 2015 13:38:53 UTC</time><div class='body'><p>You mentioned hashing files. Did you by any chance think about a hashing solution for files larger than the 512MB limit in 32bit Emacs or for files that are too big to be loaded into a buffer due to memory constraints?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-11-01T14:41:02Z'>Sun, 01 Nov 2015 14:41:02 UTC</time><div class='body'><p>That's a good point. The interface to Emacs' secure-hash doesn't permit hashing anything larger than the Emacs limit because it doesn't expose a running hash state. The secure-hash interface should have something like this in addition:</p><p>(let ((context (secure-hash-create 'sha384)))<br>(while (...)<br>(secure-hash-update context more-content))<br>(secure-hash-final context))</p><p>A similar effect can be achieved by hashing parts individually, then hashing the concatenation of the hashes, but that won't produce a *true* SHA-X hash. That would be important if you wanted signature verification by an independent implementation without needing to define a custom hash function.</p><p>Alternatively, when it's a large file you could call out to a command line program if it's available.</p><p>(defun sha384-file (file)<br>(with-temp-buffer<br>(call-process "sha384sum" file t nil)<br>(buffer-string)))</p><p>A third alternative would be to implement the hash function in Elisp itself, but that would be *incredibly* slow -- just like this pure Elisp RSA stuff.</p></div><div class='comment'><div class='author'>Yu0</div><time datetime='2015-11-01T16:30:28Z'>Sun, 01 Nov 2015 16:30:28 UTC</time><div class='body'><p>Actually the problem doesn't even start only when calculating a hash. In 32bit emacs, any bytes of a file beyond the 512 MB limit are entirely inaccessible to elisp functions, so apparently even just for reading those bytes an external program like dd would be needed.</p><p>Which is a shame, since these are not available on Windows (also: Possibly slow).</p><p>(On a curious side note: Apparently calculating a file's sha512sum from a stream in python3 is faster than using the sha512sum shell command).</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2015-11-21'><a href='/blog/2015/11/21/'>Quickly Access x86 Documentation in Emacs</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2015-12-03'><a href='/blog/2015/12/03/'>9 Elfeed Features You Might Not Know</a></h1><div class='comment'><div class='author'>Omar</div><time datetime='2015-12-08T03:57:59Z'>Tue, 08 Dec 2015 03:57:59 UTC</time><div class='body'><p>"Previously it faked a header by writing to the first line of the header." should probably be "Previously it faked a header by writing to the first line of the buffer."</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2015-12-08T04:24:37Z'>Tue, 08 Dec 2015 04:24:37 UTC</time><div class='body'><p>Fixed, thanks!</p></div></div></div><div class='comment'><div class='author'>Fuco</div><time datetime='2015-12-09T17:48:33Z'>Wed, 09 Dec 2015 17:48:33 UTC</time><div class='body'><p>Love the alist for faces.  And it even composes! (unread + a tag face makes that tag face bold, which is very neat)</p></div></div><div class='comment'><div class='author'>Daniel C Berman</div><time datetime='2016-02-27T15:23:22Z'>Sat, 27 Feb 2016 15:23:22 UTC</time><div class='body'><p>Based on the inspiration of Ryan Rix and his "Body Computing System" as well as Howardism with "Emacs is my New Window Manager," I have been working on creating an integrated work environment inside emacs. Elfeed is intriguing me, but I am trying to figure out how to follow twitter posts and RSS feeds inside the same Emacs interface similar to what Inoreader does. (<a href="http://blog.inoreader.com/2014/10/rowing-down-twitter-stream-with.html)" rel="nofollow noopener" title="http://blog.inoreader.com/2014/10/rowing-down-twitter-stream-with.html)">http://blog.inoreader.com/2...</a> Is this something you have looked at or considered?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-02-27T16:44:17Z'>Sat, 27 Feb 2016 16:44:17 UTC</time><div class='body'><p>Twitter used to host RSS feeds for all its content, so it would be trivial to follow anything on Twitter from a standard RSS reader. However, a few years ago they declared RSS an obsolete technology and completely dropped support in favor of their proprietary API.</p><p>One way to deal with this would be to add a new fetcher that goes through the proprietary Twitter API (requires an API key, etc). Since I don't use Twitter, this is unlikely to ever become part of Elfeed proper. But perhaps twittering-mode could be plugged into Elfeed as an extension.</p><p>A much simpler solution is to use a service that exposes Twitter feeds as RSS: <a href="https://twitrss.me/" rel="nofollow noopener" title="https://twitrss.me/">https://twitrss.me/</a> Unfortunately this particular service doesn't support following hashtags/searches/etc. as your link mentions. That's where a custom Twitter API fetcher would have an advantage.</p></div><div class='comment'><div class='author'>Daniel C Berman</div><time datetime='2016-02-28T17:08:28Z'>Sun, 28 Feb 2016 17:08:28 UTC</time><div class='body'><p>Thank you for your thoughts!</p></div></div></div><div class='comment'><div class='author'>Kai Arzheimer</div><time datetime='2016-12-11T17:23:03Z'>Sun, 11 Dec 2016 17:23:03 UTC</time><div class='body'><p>Twitter-RSS-parse is a simple but reliable self-hosted solution <a href="https://github.com/jdelamater99/Twitter-RSS-Parser" rel="nofollow noopener" title="https://github.com/jdelamater99/Twitter-RSS-Parser">https://github.com/jdelamat...</a></p></div></div></div><div class='comment'><div class='author'>Kai Arzheimer</div><time datetime='2016-12-11T17:19:28Z'>Sun, 11 Dec 2016 17:19:28 UTC</time><div class='body'><p>I love to work within Emacs as much as possible and I am intrigued by elfeed, but rely on a self-hosted instance of TT-RSS for all my feed needs (works in any browser, decent Android app, lots of goodies for filtering high-volume feeds). Last summer, you mentioned that syncing with a TT-RSS server could become a feature. <a href="https://github.com/skeeto/elfeed/issues/168" rel="nofollow noopener" title="https://github.com/skeeto/elfeed/issues/168">https://github.com/skeeto/e...</a><br>Is that still on the cards?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-12-11T23:46:33Z'>Sun, 11 Dec 2016 23:46:33 UTC</time><div class='body'><p>It's still in the cards, just hasn't been an itch for me to personally tackle yet.</p><p>If Android is important to you, there is an Android interface to Elfeed maintained by Toni Reina:</p><p><a href="https://play.google.com/store/apps/details?id=com.elfeedcljsrn" rel="nofollow noopener" title="https://play.google.com/store/apps/details?id=com.elfeedcljsrn">https://play.google.com/sto...</a><br><a href="https://github.com/areina/elfeed-cljsrn" rel="nofollow noopener" title="https://github.com/areina/elfeed-cljsrn">https://github.com/areina/e...</a></p></div></div></div><div class='comment'><div class='author'>JohnKitchin</div><time datetime='2017-09-10T19:17:49Z'>Sun, 10 Sep 2017 19:17:49 UTC</time><div class='body'><p>Is there a way to do custom sorting of entries? I am working on a scoring method for new articles again, and I wondered if there was away to get them to show in the search window in sorted order, e.g. by descending score, or grouped by tags, etc. I saw elfeed-sort-order, but that seems limited to time according to the docstring. Maybe a user defined sort function that takes two entries and returns non-nil if the first entry should sort before the second one would be suitable.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-09-10T22:12:58Z'>Sun, 10 Sep 2017 22:12:58 UTC</time><div class='body'><p>You got the right impression. Currently you can sort by any property so long as it's time. That's because the database only has an index for time and not for any other property, and entries are naturally gathered up already sorted by time. During live filter editing this is exploited to speed up the displayed results by bailing out even earlier, making it feel more lively. There's not really any way around this without adding more indexes to the database, increasing its size and slowing down insertions (just like adding indexes to a real database).</p><p>Since you asked, I just committed b62a2d0 which adds elfeed-search-sort-function. It was pretty simple except that it doesn't interact properly with live filter editing. Since elfeed-sort-order already interacts badly with live filter editing for the same reason, I figured it was alright to add this, too. The problem is that during live filter editing the early bailout happens on the time-sorted version, not the custom-sorted version, which would be a lot slower.</p><p>While I was writing this, I just took a moment to estimate the time it would take to build a temporary index on the fly for live filter editing. Looks like the typical case would around 500ms to 1000ms. Maybe this is live editing startup cost is acceptable for correct results under non-default settings.</p></div><div class='comment'><div class='author'>JohnKitchin</div><time datetime='2017-09-12T03:30:26Z'>Tue, 12 Sep 2017 03:30:26 UTC</time><div class='body'><p>It works great, Thanks!</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2016-01-31'><a href='/blog/2016/01/31/'>Small, Freestanding Windows Executables</a></h1><div class='comment'><div class='author'>lobster</div><time datetime='2016-02-01T11:55:38Z'>Mon, 01 Feb 2016 11:55:38 UTC</time><div class='body'><p>"freestanding"</p></div></div><div class='comment'><div class='author'>Ray Long</div><time datetime='2016-02-01T13:48:17Z'>Mon, 01 Feb 2016 13:48:17 UTC</time><div class='body'><p>This is interesting.  It is hard to imagine modern Windows development without .NET, or for the more hardcore, MFC.  I'm going to re-read this a few times.  Also, you mentioned that the LGPL licensing of a C library was "unfortunate."  Personally, I'm a fan of the MIT License; both as a producer of code, and a consumer of code in a commercial setting with proprietary products under development.  What is your preferred open source license, and why?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-02-01T16:07:41Z'>Mon, 01 Feb 2016 16:07:41 UTC</time><div class='body'><p>The LGPL isn't bad when you're dynamically linking against it, but creates a lot of friction under static linking. You either have to distribute source code or your unlinked object files, either of which can be impractical in many circumstances. The MIT license, used by musl libc, is far friendler for a libc. A small copyright notice is easy to manage. I've used musl to make clean, standalone Linux binaries without the significant license hurdles.</p><p>Personally, I prefer a public domain dedication, both as a producer and a consumer, eliminating all legal burdens on the user. I specifically use the UNLICENSE on my open source projects. If you check the footer below these comments, you'll see this blog is also in the public domain. This isn't to say I don't want credit for my work, but rather I don't wish to enforce it legally. It's only a moral request.</p></div><div class='comment'><div class='author'>Semih Masat</div><time datetime='2016-02-01T18:12:35Z'>Mon, 01 Feb 2016 18:12:35 UTC</time><div class='body'><p>Looks like i really need to read about licensing and common open source licenses.</p></div></div></div><div class='comment'><div class='author'>SonicJumper</div><time datetime='2016-02-01T21:42:47Z'>Mon, 01 Feb 2016 21:42:47 UTC</time><div class='body'><p>"It is hard to imagine modern Windows development without .NET" - Absolutely not hard to imagine if you are aware of Delphi. Based on Object Pascal, has a visual form designer, can produce self-contained Windows executables in native code... has always been and still is a great way to develop for Windows. Microsoft actually poached one of Delphi's key architects (Anders Hejlsberg) to work on .NET and C#.</p></div><div class='comment'><div class='author'>Ray Long</div><time datetime='2016-02-01T21:45:54Z'>Mon, 01 Feb 2016 21:45:54 UTC</time><div class='body'><p>Embarcadero hasn't been the greatest steward of Delphi, and in the US, Delphi jobs are not in high demand compared to C#, C++, and Java.</p></div><div class='comment'><div class='author'>SonicJumper</div><time datetime='2016-02-01T22:03:19Z'>Mon, 01 Feb 2016 22:03:19 UTC</time><div class='body'><p>Even if that were true, it doesn't change the fact that Delphi is still a great non-.NET way for "modern Windows development". And there's also FreePascal...</p></div><div class='comment'><div class='author'>Ray Long</div><time datetime='2016-02-01T22:11:07Z'>Mon, 01 Feb 2016 22:11:07 UTC</time><div class='body'><p>Perhaps.</p></div></div></div></div></div></div><div class='comment'><div class='author'>Jaime Lopez</div><time datetime='2016-02-01T15:55:37Z'>Mon, 01 Feb 2016 15:55:37 UTC</time><div class='body'><p>Niee article. It is like seeing the world without all those disturbing methaporical layers. I'm going to try your suggestions.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-02-01T16:12:01Z'>Mon, 01 Feb 2016 16:12:01 UTC</time><div class='body'><p>I'm no fan of giant runtime frameworks, regardless if the domain is C/C++, Java, .NET, JavaScript, etc. It's led to so much awful, bloated software.</p></div></div></div><div class='comment'><div class='author'>thebosz</div><time datetime='2016-02-01T17:58:34Z'>Mon, 01 Feb 2016 17:58:34 UTC</time><div class='body'><p>Note that the link to <a href="http://phreedom.org" rel="nofollow noopener" title="phreedom.org">phreedom.org</a> trips Firefox's malware blocker.</p></div></div><div class='comment'><div class='author'>Embedded Systems</div><time datetime='2016-02-06T14:39:52Z'>Sat, 06 Feb 2016 14:39:52 UTC</time><div class='body'><p>Great article. I would like to let you know that it has been featured in the last embedded systems weekly newsletter <a href="http://embedsysweekly.com/embedded-systems-issue38/" rel="nofollow noopener" title="http://embedsysweekly.com/embedded-systems-issue38/">http://embedsysweekly.com/e...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-02-06T15:25:51Z'>Sat, 06 Feb 2016 15:25:51 UTC</time><div class='body'><p>Interesting newsletter, thanks. I just subscribed to the RSS feed. And one small correction: my last name ends with an s. :-)</p></div></div></div></div><hr/><div class='thread'><h1 id='2016-02-28'><a href='/blog/2016/02/28/'>Calling the Native API While Freestanding</a></h1><div class='comment'><div class='author'>Alex Elsayed</div><time datetime='2016-07-22T23:02:45Z'>Fri, 22 Jul 2016 23:02:45 UTC</time><div class='body'><p>Hey, just an FYI - one can, in fact, implement memmove efficiently in standard C - or at least, more efficiently than using a temporary buffer.</p><p>Specifically:<br>- When dst and src are nonoverlapping, memmove is equivalent to memcpy<br>- When dst's tail overlaps with src's head, memmove is equivalent to "forward" memcpy<br>- When dst's head overlaps with src's tail, memmove is equivalent to "reverse" memcpy</p><p>One important thing to note is that in the latter two cases, dst and src must be pointers into the same object (allocation) according to the C standard - and thus, their pointers are comparable.</p><p>Thus, the trick is to distinguish the first case from the other two - if either of them is in effect, we're free to use the relational operators in order to decide which way the overlap goes.</p><p>This can be done trivially:<br></p><pre>int overlapping(void* a, void* b, size_t len) {<br>    void* btail = b + (len-1);<br>    // For every offset in 'a'...<br>    for (void* cursor = a; cursor != a+len; ++cursor) {<br>        // ...check it for equality to the ends of 'b'<br>        if (cursor == b || cursor == btail) {<br>            return 1;<br>        }<br>    }<br>    return 0;<br>}<br></pre><p></p><p>This is still O(n) - we have to iterate over the length of a - but does not require any allocation, and can be optimized by the compiler, which knows the target machine, and thus isn't bound by the C standard's restrictions regarding inter-object pointer comparisons.</p><p>Of course, this same function can - with no added complexity - also tell us the direction of the overlap, and thus fully implement memmove without using the relational comparisons at all:</p><p></p><pre>void* memmove(void* dst, void* src, size_t len) {<br>    void* srctail = src + (len-1);<br>    // For every offset in 'dst'...<br>    for (void* cursor = dst; cursor != dst+len; ++cursor) {<br>        // ...check it for equality to the ends of 'src'<br>        if (cursor == src) {<br>            // 'src' begins inside of 'dst', and thus we'd<br>            // need a forwards memcpy<br>            return memcpy_forwards(dst, src, len);<br>        } else if (cursor == srctail) {<br>            // 'src' ends inside of 'dst' (and thus 'dst' began<br>            // inside of 'src'), so we do a reverse memcpy<br>            return memcpy_reverse(dst, src, len);<br>        }<br>    }<br>    // No match, safe to memcpy!<br>    return memcpy(dst, src, len);<br>}<br></pre></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-07-23T01:03:01Z'>Sat, 23 Jul 2016 01:03:01 UTC</time><div class='body'><p>Oh, that's clever! In the time since I wrote the article, I had believed the situation was even worse: allocating the temp buffer could fail, and memmove isn't supposed to fail. Your idea technically solves the problem.</p><p>One important fix to your example: those pointers should be cast to char before any pointer arithmetic. Arithmetic on void * isn't defined, though gcc supports it.</p><p>I tried your idea with gcc (4.9.2) and clang (3.5). Unfortunately neither compiler optimized the loop into an O(1) comparison. That would be pretty awesome if they did.</p></div><div class='comment'><div class='author'>Alex Elsayed</div><time datetime='2016-07-23T02:13:05Z'>Sat, 23 Jul 2016 02:13:05 UTC</time><div class='body'><p>I'm kind of curious what CompCert would make of it, to be honest.</p></div></div><div class='comment'><div class='author'>Alex Elsayed</div><time datetime='2016-07-23T18:29:58Z'>Sat, 23 Jul 2016 18:29:58 UTC</time><div class='body'><p>Thinking about what inference would be needed in order to implement O(1)-izing this, I think the following would be sufficient:</p><p>1.) dst &lt;= cursor &lt; dst+len for all cursor (can be inferred from bounds, and it only being updated via ++)<br>2.) (memcpy forwards branch) As cursor == src, dst &lt;= src &lt; dst+len (pointers can only be equal in the same object, so in this case this ordering relationship can be inferred from cursor)<br>3.) (memcpy reverse branch) As cursor == src+len, dst &lt;= src+len &lt; dst+len (same)<br>4.) (memcpy reverse branch) As dst and src are both pointers to char, they must have the same layout, thus the pairs (dst, dst+len) and (src, src+len) are different by the same amount<br>5.) (memcpy reverse branch) Therefore, src &lt;= dst &lt; src+len. This is disjoint from (2) _except_ in the case that src == dst,  and that can be resolved by the ordering of the 'if's.</p><p>However, all of these are almost certainly already implemented - so where's the catch?</p><p>The trick is that the compiler, in order to lift these out of the loop, needs to prove the fallthrough case, which is easy to miss because it's never written explicitly - dst &lt;= dst+len &lt; src || src &lt; dst &lt;= dst+len.</p><p>At the C level, it cannot do this as it has no proof of same-object (because it didn't pass an equality test). That's why it's never written explicitly, in fact - testing for it would be UB, but testing for something that is its exact inverse is fine, and so we just allow ourselves to fall through.</p><p>As a result, the lifting requires the backend inform the optimizer that pointers to the same type form a total ordering, regardless of object.</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2016-03-31'><a href='/blog/2016/03/31/'>Hotpatch a C Function on x86</a></h1><div class='comment'><div class='author'>Albert Zeyer</div><time datetime='2016-04-01T09:15:07Z'>Fri, 01 Apr 2016 09:15:07 UTC</time><div class='body'><p>Very nice read. What compiler option is missing in Clang?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-04-01T12:24:23Z'>Fri, 01 Apr 2016 12:24:23 UTC</time><div class='body'><p>Sorry, I should have elaborated. Clang doesn't (yet?) support the ms_hook_prologue function attribute. This has been a problem for Wine, since they rely on it to mimic parts of the Win32 API.</p></div></div></div><div class='comment'><div class='author'>Doug Binks</div><time datetime='2016-04-01T11:24:49Z'>Fri, 01 Apr 2016 11:24:49 UTC</time><div class='body'><p>I hadn't realised GCC supported the ms_hook_prologue function attribute, so glad to read this.</p><p>I've added links to your blog on a list of runtime compilation alternatives I keep on my Runtime Compiled C++ wiki:</p><p><a href="https://github.com/RuntimeCompiledCPlusPlus/RuntimeCompiledCPlusPlus/wiki/Alternatives" rel="nofollow noopener" title="https://github.com/RuntimeCompiledCPlusPlus/RuntimeCompiledCPlusPlus/wiki/Alternatives">https://github.com/RuntimeC...</a></p><p>Let me know if I need to correct the text there, and thanks for the information here - I'm mulling over a xplatf hotpatcher for C now...</p></div></div><div class='comment'><div class='author'>Rick Gorton</div><time datetime='2016-04-01T11:30:18Z'>Fri, 01 Apr 2016 11:30:18 UTC</time><div class='body'><p>This is not guaranteed to work - the largest write which is atomic (in terms of granularity) is a 4 byte write.  That is, a write of all 5 bytes is not guaranteed to complete in the same cycle.  What you have to do is a stuff in a jmp to ., perform a cache flush, then the 4-byte write of the displacement.  This is documented in various of the Intel/AMD microarchitecture documents</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-04-01T12:17:15Z'>Fri, 01 Apr 2016 12:17:15 UTC</time><div class='body'><p>The "Intel 64 and IA-32 Architectures Developer's Manual: Vol 3A" section 8.2.3.1 states that aligned 8-byte memory accesses are atomic: <br>"The Intel-64 memory ordering model guarantees that [...] the constituent memory operation appears to execute as a single memory access: [...] Instructions that read or write a quadword (8 bytes) whose address is aligned on an 8 byte boundary."</p><p>If this wasn't true, there would be a whole lot of broken software out there that assumes aligned pointer writes are atomic.</p></div><div class='comment'><div class='author'>Rick Gorton</div><time datetime='2016-04-01T12:46:24Z'>Fri, 01 Apr 2016 12:46:24 UTC</time><div class='body'><p>I was thinking re: x86 (32-bit), not x86_64 - thanks for the correction.</p></div></div></div></div><div class='comment'><div class='author'>Fanael</div><time datetime='2016-04-01T13:51:37Z'>Fri, 01 Apr 2016 13:51:37 UTC</time><div class='body'><p>You forgot __attribute__((noclone)), otherwise GCC could make a clone of the function for optimization purposes.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-04-01T14:26:15Z'>Fri, 01 Apr 2016 14:26:15 UTC</time><div class='body'><p>Yup, you're right. I noticed that this morning as I was experimenting with it more. I just added a paragraph for it. Even more, GCC needs to be convinced there's a side effect so that it doesn't optimize away future function calls.</p></div></div></div><div class='comment'><div class='author'>chamibuddhika</div><time datetime='2016-04-01T14:24:49Z'>Fri, 01 Apr 2016 14:24:49 UTC</time><div class='body'><p>This works since x86 guarantees atomicity for aligned reads and writes w.rt. instruction fetch. LOCK prefix can be used for unaligned reads/writes to ensure atomicity of data reads and writes. But Intel SDM says (in 8.1.2 Volume 3A) "Locked instructions should not be used to ensure that data written can be fetched as instructions", which suggests instruction fetch is not atomic even with LOCK'd instructions, specially when the accesses are unaligned. Intel SDM (8.1.3 Volume 3A) suggests a cross modification protocol which requires global synchronization to ensure correct operation in such scenarios. Anyhow recently we unwittingly hit this limitation in our work and this led to some exploratory work for finding a way to relax the global synchronization requirement. Our work can be found at <a href="http://conf.researchr.org/event/pldi-2016/pldi-2016-papers-living-on-the-edge-rapid-toggling-probes-with-cross-modification-on-x86" rel="nofollow noopener" title="http://conf.researchr.org/event/pldi-2016/pldi-2016-papers-living-on-the-edge-rapid-toggling-probes-with-cross-modification-on-x86">http://conf.researchr.org/e...</a> if you are interested.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-04-03T13:52:37Z'>Sun, 03 Apr 2016 13:52:37 UTC</time><div class='body'><p>Thanks, that's a very interesting paper! I'm learning a lot from it. I added it as a "further reading" link.</p></div><div class='comment'><div class='author'>chamibuddhika</div><time datetime='2016-04-04T03:15:55Z'>Mon, 04 Apr 2016 03:15:55 UTC</time><div class='body'><p>Thanks. Glad you found it useful.</p></div></div></div></div><div class='comment'><div class='author'>Fanael</div><time datetime='2016-04-02T01:43:48Z'>Sat, 02 Apr 2016 01:43:48 UTC</time><div class='body'><p>Another way of achieving thread-safety would be mmaping (RW) a completely new page, copying and patching the code there, and only then mprotecting it to RX and mremaping into the old place. Magic 8-byte alignment becomes unnecessary, is perfectly W^X safe, and it's trivially portable to architectures not supporting atomic writes of whatever is their instruction size.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-04-03T14:05:03Z'>Sun, 03 Apr 2016 14:05:03 UTC</time><div class='body'><p>I was thinking more about this and I'm not convinced it's entirely reliable. Sure, you can "write" an entire page atomically, but what about instructions that span cache lines? The write is atomic, but the instruction fetch wouldn't necessarily be. Also, what if the target instruction spans pages? Can I rely on the OS to remap my entire request atomically or might other threads see one page remapped, then another? <br>However, I do believe your approach *does* cleverly solve the problem of W^X safety.</p></div></div></div></div><hr/><div class='thread'><h1 id='2016-04-10'><a href='/blog/2016/04/10/'>Mapping Multiple Memory Views in User Space</a></h1><div class='comment'><div class='author'>Konstantin Khlebnikov</div><time datetime='2016-05-03T06:52:26Z'>Tue, 03 May 2016 06:52:26 UTC</time><div class='body'><p>I know one usage for that: ring buffer. You just mmap buffer twice, so message at the end overlaps into beginning but you can read tail from next mmap of the same buffer.</p><p>BTW for cpus with VIVT caches ring buffer must have particular size to avoid problems with aliasing.</p></div></div><div class='comment'><div class='author'>Nicholas Frechette</div><time datetime='2016-06-01T14:19:57Z'>Wed, 01 Jun 2016 14:19:57 UTC</time><div class='body'><p>You have to be careful with things like this since it can have implications for the TLB and cache. You can read more about it here <a href="https://cseweb.ucsd.edu/classes/fa14/cse240A-a/pdf/08/CSE240A-MBT-L18-VirtualMemory.ppt.pdf" rel="nofollow noopener" title="https://cseweb.ucsd.edu/classes/fa14/cse240A-a/pdf/08/CSE240A-MBT-L18-VirtualMemory.ppt.pdf">https://cseweb.ucsd.edu/cla...</a></p><p>Here be dragons :)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-06-02T13:30:34Z'>Thu, 02 Jun 2016 13:30:34 UTC</time><div class='body'><p>Thanks, that's useful information!</p></div></div></div></div><hr/><div class='thread'><h1 id='2016-04-30'><a href='/blog/2016/04/30/'>Makefile Assignments are Turing Complete</a></h1><div class='comment'><div class='author'>awreece</div><time datetime='2016-05-03T07:17:27Z'>Tue, 03 May 2016 07:17:27 UTC</time><div class='body'><p>Cool! I played around with this a while back -- if you (ab)use the `patsubst` function, you can get subtraction: <a href="http://codearcana.com/posts/2012/03/05/cs-theory-with-make.html" rel="nofollow noopener" title="http://codearcana.com/posts/2012/03/05/cs-theory-with-make.html">http://codearcana.com/posts...</a> This is a more direct approach than the pure variable substitution.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-05-03T23:26:16Z'>Tue, 03 May 2016 23:26:16 UTC</time><div class='body'><p>Interesting, thanks for the link! You were a whole lot more formal about proving it.</p></div></div></div><div class='comment'><div class='author'>possiblywrong</div><time datetime='2016-05-03T15:26:19Z'>Tue, 03 May 2016 15:26:19 UTC</time><div class='body'><p>Very cool!  I would like to share this with some students-- as another layer of bootstrapping, I'm wondering what you used to create the makefile (since I'm guessing you auto-generated most of it)?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-05-03T16:27:27Z'>Tue, 03 May 2016 16:27:27 UTC</time><div class='body'><p>Yeah, I definitely wasn't writing that all by hand! I wrote a few Emacs Lisp functions in a scratch buffer to generate each chunk of the Makefile. But since 1) it was simple, 2) it was ugly, due to feeling my way around the problem as I went, and 3) I massaged the final result by hand, I didn't bother saving it. It should be easy to reproduce just from observing the patterns in my life.mak. Writing a program to generate a Makefile with arbitrary-sized grid and with a specific starting state would be a good exercise.</p></div></div></div><div class='comment'><div class='author'>buskanaka</div><time datetime='2016-05-03T17:56:41Z'>Tue, 03 May 2016 17:56:41 UTC</time><div class='body'><p>One of the original mal implementations (Clojure-inspired Lisp) was in GNU Make macro language: <a href="https://github.com/kanaka/mal/tree/master/make" rel="nofollow noopener" title="https://github.com/kanaka/mal/tree/master/make">https://github.com/kanaka/m...</a> One of the most challenging parts was implementing arbitrary precision numeric operations using string/boolean operations: <a href="https://github.com/kanaka/mal/blob/master/make/numbers.mk" rel="nofollow noopener" title="https://github.com/kanaka/mal/blob/master/make/numbers.mk">https://github.com/kanaka/m...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-05-03T23:43:20Z'>Tue, 03 May 2016 23:43:20 UTC</time><div class='body'><p>That's both impressive and horrifying at the same time! Very interesting. Thanks for the link.</p></div></div></div><div class='comment'><div class='author'>Tom Ritchford</div><time datetime='2016-05-24T13:32:20Z'>Tue, 24 May 2016 13:32:20 UTC</time><div class='body'><p>That is both brilliant and silly.  :-)</p></div></div><div class='comment'><div class='author'>Marcus2012</div><time datetime='2017-08-24T06:13:36Z'>Thu, 24 Aug 2017 06:13:36 UTC</time><div class='body'><p>How can we handle a whole class of files in one rule?</p><p>like, I want to compile all the .c files, do I really need to list them all, then create a rule for them all, or can I just be like "here's the source folder, all the *.c files inside it should be compiled to *.o in a different folder?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-08-28T00:51:15Z'>Mon, 28 Aug 2017 00:51:15 UTC</time><div class='body'><p>Unfortunately there's no way around this. One of the weaker points of make is that, for better or worse, it really is just a dumb tool. It's up to you to explicitly build the entire dependency tree for it. That's why I think it's appropriate for larger projects to use some other tool (script, CMake, etc.) to generate most or all of the Makefile. For a couple of my own projects (not open source ones, sadly) I've hand-written bourne "configure" scripts to generate the Makefile from a template (via -MM/-MT).</p><p>But being a dumb tool means you can use it to build _anything_: C programs, LaTeX documents, ebooks, VM images, etc. Its just driving the dependency tree that it was given.</p></div></div></div></div><hr/><div class='thread'><h1 id='2016-05-30'><a href='/blog/2016/05/30/'>You Can&#39;t Always Hash Pointers in C</a></h1><div class='comment'><div class='author'>Kat Marsen</div><time datetime='2016-06-01T14:16:26Z'>Wed, 01 Jun 2016 14:16:26 UTC</time><div class='body'><p>The reason for the insanity is because the "flat address model" we all take for granted didn't exist in the first place.  For example, on the 8088, which x86 is based on, the instruction set allows for addressing by segment:offset, where each partially overlapped.  "near" pointers only use the offset, but can not address all available memory.  "far" pointers use the segment to reach further, but segment:offset cannot fit into a single machine word (an int).  Casting a far pointer to an int would necessarily lose information.</p></div><div class='comment'><div class='author'>Alan R Wolfe</div><time datetime='2016-10-28T16:52:06Z'>Fri, 28 Oct 2016 16:52:06 UTC</time><div class='body'><p>That issue was still present on the 486 in 16 bit mode.  That's when I "joined the fray" of programming, so remember it well (:</p></div></div></div><div class='comment'><div class='author'>x3ns</div><time datetime='2018-09-19T01:47:47Z'>Wed, 19 Sep 2018 01:47:47 UTC</time><div class='body'><p>Interesting stuff. You have a typo in your example function.</p><p>example(void *&gt;&gt;prt_a&lt;&lt;, void *ptr_b)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-09-20T23:32:57Z'>Thu, 20 Sep 2018 23:32:57 UTC</time><div class='body'><p>Oops, thanks! Just pushed the correction.<br> <a href="https://github.com/skeeto/skeeto.github.com/commit/c00cf8e5b9a6309d0f95eed9a0e065c96d1d3357" rel="nofollow noopener" title="https://github.com/skeeto/skeeto.github.com/commit/c00cf8e5b9a6309d0f95eed9a0e065c96d1d3357">https://github.com/skeeto/s...</a></p></div></div></div></div><hr/><div class='thread'><h1 id='2016-06-13'><a href='/blog/2016/06/13/'>Four Ways to Compile C for Windows</a></h1><div class='comment'><div class='author'>Mārtiņš Možeiko</div><time datetime='2016-06-13T04:42:01Z'>Mon, 13 Jun 2016 04:42:01 UTC</time><div class='body'><p>If you compile your source with __USE_MINGW_ANSI_STDIO defined to 1 then mingw-w64 will support at least stdio c99 library features (like z modifier).</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-06-13T11:03:29Z'>Mon, 13 Jun 2016 11:03:29 UTC</time><div class='body'><p>Whaaa ... I've never heard of this before! It's entirely undocumented as far as I can tell --- it's not mentioned anywhere on either website, nor in any man page, nor is it explained in the headers --- but it certainly fixes all the printf woes I'm throwing at it. Do you know why this isn't the default when using -std=c99? This is incredibly useful information, thanks!</p></div><div class='comment'><div class='author'>Mārtiņš Možeiko</div><time datetime='2016-06-13T20:48:10Z'>Mon, 13 Jun 2016 20:48:10 UTC</time><div class='body'><p>Yeah, it's a very obscure feature. No idea why it's not default.<br>These wiki pages looks like official documentation on this:<br><a href="https://sourceforge.net/p/mingw-w64/wiki2/gnu%20printf/" rel="nofollow noopener" title="https://sourceforge.net/p/mingw-w64/wiki2/gnu%20printf/">https://sourceforge.net/p/m...</a><br><a href="https://sourceforge.net/p/mingw-w64/wiki2/printf%20and%20scanf%20family/" rel="nofollow noopener" title="https://sourceforge.net/p/mingw-w64/wiki2/printf%20and%20scanf%20family/">https://sourceforge.net/p/m...</a></p></div></div></div></div><div class='comment'><div class='author'>Miguel Lechón</div><time datetime='2016-06-13T12:59:01Z'>Mon, 13 Jun 2016 12:59:01 UTC</time><div class='body'><p>Thanks for taking the time to write this down.</p></div></div><div class='comment'><div class='author'>FRex</div><time datetime='2019-05-28T11:45:50Z'>Tue, 28 May 2019 11:45:50 UTC</time><div class='body'><p>I found out about Pelles C via this post and used it for few toy C programs and I'm not very happy with it.</p><p>I ran into a few errors related to warnings being wrong:<br><a href="https://forum.pellesc.de/index.php?topic=7738" rel="nofollow noopener" title="https://forum.pellesc.de/index.php?topic=7738">https://forum.pellesc.de/in...</a><br><a href="https://forum.pellesc.de/index.php?topic=7739" rel="nofollow noopener" title="https://forum.pellesc.de/index.php?topic=7739">https://forum.pellesc.de/in...</a><br><a href="https://forum.pellesc.de/index.php?topic=7816" rel="nofollow noopener" title="https://forum.pellesc.de/index.php?topic=7816">https://forum.pellesc.de/in...</a><br><a href="https://forum.pellesc.de/index.php?topic=7975" rel="nofollow noopener" title="https://forum.pellesc.de/index.php?topic=7975">https://forum.pellesc.de/in...</a></p><p>and into one that outright breaks code of stb_image on -O2:<br><a href="https://forum.pellesc.de/index.php?topic=7837" rel="nofollow noopener" title="https://forum.pellesc.de/index.php?topic=7837">https://forum.pellesc.de/in...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-05-28T12:51:12Z'>Tue, 28 May 2019 12:51:12 UTC</time><div class='body'><p>Incorrect diagnostic messages is something I can live with, though the ones you found in Pelles C do suggest there might be more fundamental underlying issues. Every version of GCC I've ever used has edge cases where it produces false warnings or otherwise incorrect warning messages. Fortunately for GCC it really is restricted to rare, edge cases.</p><p>However, your last link showing Pelles C getting basic integer arithmetic wrong is scary and makes me very wary of trusting it. I was able to reproduce that bug myself and confirm it. Thanks for pointing that out! I've never caught anything this serious when running my test suites on binaries built by Pelles C.</p></div><div class='comment'><div class='author'>FRex</div><time datetime='2019-05-28T15:49:12Z'>Tue, 28 May 2019 15:49:12 UTC</time><div class='body'><p>It was hard and annoying to track since it's such a narrow case, all of: -O2, result that has a top bit of 1, same type for both operands and the result, uchar or ushort, etc. Maybe you can note that in the post itself too to warn someone who reads it but doesn't look at the comments to not rely on it, or at least avoid or be careful with -O2 and these implicit integral promotions (like 2 or 3 things out of 5 I reported to them are related to these).</p><p>Funnily enough if you inspect the asm it produces (pass to their cc.exe -O2 and one of -Tx64-asm or -Tx86-asm) it breaks consistently with itself. If the input values to (a + b) / 2 are known at compile time it's a single mov of a precomputed value (with top bit zeored already), if not then you can see an 'and al, 127' or similar in the asm after the operation, but the value is the same (top bit incorrectly zeroed out) in both cases.</p><p>For me it came up in this small program: <a href="https://github.com/FRex/topng" rel="nofollow noopener" title="https://github.com/FRex/topng">https://github.com/FRex/topng</a></p><p>Long story short it was the average filter decoding (STBI__F_avg) that did such an operation. I was testing if running topng few times on same image over and over produces same result as it should but in case of some images it'd instead progressively corrupt them, or corrupt them once, or corrupt them if I ran optipng on them first, etc.</p><p>I meant topng to be safe, robust, easy to use, ran as a batch via some find + xargs + topng combo on many images, etc. so I quickly dug into the corruption once I saw it (thinking first it must be some mistake I make or some edge case of STB) to not cause someone to lose their data by using it, especially since they might not notice if it corrupts one image in a batch of many or corrupts very slightly at the corner or edge only.</p><p>I now also put a warning about this -O2 bug in the README of each of my small C utils so that someone who sees my "here's 32-bit Windows exe made with Pelles C" releases and looks up Pelles C themselves won't destroy their data by running my C program after compiling it with -O2 too.</p><p>I try not to be too harsh on gratis software made by a single person and not run around saying it's bad like some nitpicker but it's sadly not FOSS (that'd probably help find such bugs) and yesterday I ran into yet another warning bug, posted it and got a reply from a moderator (that they updated after my next post) that sounded like they assume I'm a C newb (despite all my 5 threads on there being bug reports) and like they didn't even read the title and the text, just skimmed the code. That made me decide to not worry about sounding like an asshole spreading FUD and warn you too.</p></div></div><div class='comment'><div class='author'>FRex</div><time datetime='2019-05-29T14:20:36Z'>Wed, 29 May 2019 14:20:36 UTC</time><div class='body'><p>For some reason a longer reply I left is gone (?). It was basically story of how/what my program I found the -O2 bug in and that if you look at asm output (-Tx64-asm) you can see it being broken the same no matter if its precomputed at compile time (single mov of value with top bit already zeroed) or calculated at runtime (it does an and of result register with 127 to zero top bit out after the operation) so it's consistent with itself in that way.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-05-29T14:37:48Z'>Wed, 29 May 2019 14:37:48 UTC</time><div class='body'><p>Sorry, the Disqus spam filter got it. It should be visible now. Your response arrived to me via regular email just fine, so I read it without realizing there was an issue here on Disqus.</p></div><div class='comment'><div class='author'>FRex</div><time datetime='2019-05-29T14:54:32Z'>Wed, 29 May 2019 14:54:32 UTC</time><div class='body'><p>No problem, glad you "enjoyed" the -O2 uchar/ushort bug.</p></div></div></div></div></div></div><div class='comment'><div class='author'>Graham Toal</div><time datetime='2019-09-04T01:48:18Z'>Wed, 04 Sep 2019 01:48:18 UTC</time><div class='body'><p>tcc and lcc have been good to me in the past for quick to install and easy to use systems that don't drag you kicking and screaming into the Windows world like the Microsoft compiler does.</p></div></div></div><hr/><div class='thread'><h1 id='2016-06-16'><a href='/blog/2016/06/16/'>Elfeed, cURL, and You</a></h1><div class='comment'><div class='author'>Fuco</div><time datetime='2016-06-16T19:09:44Z'>Thu, 16 Jun 2016 19:09:44 UTC</time><div class='body'><p>No longer will elfeed clog up and hang my emacs? I love you for doing this!</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-06-16T20:43:08Z'>Thu, 16 Jun 2016 20:43:08 UTC</time><div class='body'><p>If Elfeed normally clogs Emacs for you, then think of cURL as a cable auger.</p></div></div></div><div class='comment'><div class='author'>Byron Schlemmer</div><time datetime='2016-06-20T08:12:04Z'>Mon, 20 Jun 2016 08:12:04 UTC</time><div class='body'><p>As a avid user of elfeed, on Windows, *many* *many* thanks for the work and succinct post on the topic.</p></div></div><div class='comment'><div class='author'>Erik Sjöstrand</div><time datetime='2016-06-21T12:07:22Z'>Tue, 21 Jun 2016 12:07:22 UTC</time><div class='body'><p>I've been using Elfeed on Windows for quite a while, but I don't think it has crashed on me. Will try it out with curl though!</p></div></div><div class='comment'><div class='author'>Seth Mason</div><time datetime='2016-06-21T16:45:58Z'>Tue, 21 Jun 2016 16:45:58 UTC</time><div class='body'><p>Nice. This fixed a few of the mysterious problems that `url-retrieve` had with getting some of my feeds.</p><p>Thanks!</p></div></div></div><hr/><div class='thread'><h1 id='2016-06-23'><a href='/blog/2016/06/23/'>Stealing Session Cookies with Tcpdump</a></h1><div class='comment'><div class='author'>possiblywrong</div><time datetime='2016-06-24T15:50:37Z'>Fri, 24 Jun 2016 15:50:37 UTC</time><div class='body'><p>Very interesting post-- maybe not entirely unrelated, I have noticed that Road Runner seems to be particularly aggressive *in the store* about asking for a lot of unnecessary personal information.</p><p>Do I understand your last section correctly-- setting cookies to both Secure and HttpOnly, would the online cart "fail" anytime you tried to search, since it would redirect to an HTTP page and thus show a logged-out view?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-06-24T16:41:22Z'>Fri, 24 Jun 2016 16:41:22 UTC</time><div class='body'><p>The shopping cart state would be preserved and untouched once you got back to an HTTPS version of a page. If done correctly, you wouldn't be able to put items in your cart from the HTTP page. If you *could* still put items in the cart, then the page would also be vulnerable to cross-site request forgery (CSRF). If the logged-out HTTP site can supply a link capable of manipulating the cart, then so could an attacker from any other page, an e-mail, instant message, etc. (This may even be the case here, but I haven't checked.)</p><p>Visiting the HTTP version wouldn't log you out. That is, it would neither invalidate the cookie on the server, nor delete the cookie locally. That's the value of explicitly logging out of a service via a "log out" link/button rather than allowing the session to expire. Note: session expiration — the server forgetting old sessions — is different from cookie expiration, which locally destroys the cookie but leaves the session open on the server. An explicit log out (again, when done properly) tells the server to forget about the session: the session cookie is no longer useful to an attacker. This also generally deletes the cookie locally, but it's not strictly required since the server wouldn't recognize it and would ignore it. The cookie I used in my example was a real session cookie, but has since been invalidated.</p><p>The browser wouldn't send the Secure cookie for the HTTP page, so the server wouldn't know who you were, due to HTTP being stateless. You'd see the logged-out version but it wouldn't affect the session cookie. However, there is one caveat to all this: the server might respond to the lack of a session cookie by creating a new "logged-out session" overriding the existing, previous session (i.e. a cookie's identity tuple is [name, domain, path] and doesn't include its flags or protocol). Road Runner doesn't do this, so the Secure cookie session would survive the search page.</p></div></div></div></div><hr/><div class='thread'><h1 id='2016-07-25'><a href='/blog/2016/07/25/'>Const and Optimization in C</a></h1><div class='comment'><div class='author'>MasonBially</div><time datetime='2016-07-25T12:32:39Z'>Mon, 25 Jul 2016 12:32:39 UTC</time><div class='body'><p>However the most correct way to write it, in my opinion, and in the coding standards of the projects I write, is:</p><p><code>int const*</code></p><p>This is because it is locally deterministic and reads correctly right to left.</p><p>Consider:</p><p><code>int const**</code><br><code>const int const**</code><br><code>int const* const*</code></p><p>The second is invalid in my coding style because the left most const is <br>modifying the type to it's right, instead of it's left, causing the old <br>const to change what it modifies. The third represents the correct way <br>to cause the same type change.</p><p>Also consider their spoken/written versions as read right to left.</p><p>&gt; pointer to a pointer to a constant integer.<br>&gt; pointer to a pointer, which is constant , to an integer, which is constant <br>&gt; pointer to a constant pointer to a constant integer.</p></div></div><div class='comment'><div class='author'>Totozero</div><time datetime='2016-07-27T16:32:43Z'>Wed, 27 Jul 2016 16:32:43 UTC</time><div class='body'><p>I do not understand what you mean after "Curiously, the specification allows...". It looks like there is some mismatchs is your functions names and missing prototpyes.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-07-27T16:37:58Z'>Wed, 27 Jul 2016 16:37:58 UTC</time><div class='body'><p>Whoops, you're right! I got "foo" and "bar" swapped in all the assembly listings, as well as a few other places. These should now all be corrected.</p></div></div></div><div class='comment'><div class='author'>Travis Downs</div><time datetime='2018-07-31T04:32:53Z'>Tue, 31 Jul 2018 04:32:53 UTC</time><div class='body'><p>Good post. It could perhaps use a summary of the key finding: "In general, const *declarations* can't help the optimizer, but const *definitions* can."</p><p>In particular, const definitions are the only case where the optimizer really knows the value can't be changed. In addition to optimizing the code as your example points out, it also allows the compiler to put any globals (and function static and class static in C++) so declared in the .rodata section (as you last listing shows), which can be a big deal for big static arrays (they can be shared among all processes using the same binary) and prevent at the hardware level inadvertent modification.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-08-01T23:02:56Z'>Wed, 01 Aug 2018 23:02:56 UTC</time><div class='body'><p>Very succinct, nice! I've quoted you at the end of the article.</p></div></div></div><div class='comment'><div class='author'>jdefr89</div><time datetime='2019-05-03T21:35:37Z'>Fri, 03 May 2019 21:35:37 UTC</time><div class='body'><p>const with relationship to pointers act as a “read only” const int *ptr = &amp; Val; tells the compiler that you will not mutate what is in Val by through ptr.</p><p>Also I just found this website, I really enjoy your work. Thanks!</p></div></div></div><hr/><div class='thread'><h1 id='2016-08-03'><a href='/blog/2016/08/03/'>Appending to a File from Multiple Processes</a></h1><div class='comment'><div class='author'>Alex</div><time datetime='2016-08-03T22:23:30Z'>Wed, 03 Aug 2016 22:23:30 UTC</time><div class='body'><p>There is no such thing as nfsv5, you mean nfsv4.x?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-08-03T22:59:24Z'>Wed, 03 Aug 2016 22:59:24 UTC</time><div class='body'><p>You're right, I must have misread something in my research. Maybe it was anticipated to be fixed in some future version of NFS. I've removed the parenthetical from the article.</p></div></div></div><div class='comment'><div class='author'>nwf</div><time datetime='2016-08-04T03:38:58Z'>Thu, 04 Aug 2016 03:38:58 UTC</time><div class='body'><p>I don't understand how you are interpreting the POSIX standard to allow two O_APPEND write(2) calls to interleave their bytes in the file.  It says very clearly that *no file modifications* take place between the implied seek and write, which should exclude any other (partial) write, which would be a file modification.</p><p>Interleaving appears to be permitted by POSIX (IEEE Std 1003.1, 2013 Edition) only on FIFOs, in fact.  What a mistake that is, though I guess I understand the implementation that gave rise to someone arguing for its inclusion in the standard.  Boo.  It'd be so easy to... not do that.</p><p>Now, that said, POSIX still isn't strong enough, there is plenty of room for write(2) to not write its entire buffer in a single atomic pass (e.g. signals), but AFAICT in those cases it will write a prefix and then return to userland indicating a short write, not interleave with other writes.  That's still pretty bad from an application perspective, but it's not quite arbitrary interleaving.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-08-04T11:37:25Z'>Thu, 04 Aug 2016 11:37:25 UTC</time><div class='body'><p>I interpret the lack of information on atomic or interleaving writes to files as being very open-ended (just as POSIX is with filesystems in general). It makes no statement about PIPE_BUF for anything other than pipes and FIFOs, so there's no reason to believe that value applies to files. It's also impractical to allow an application to perform an arbitrary large, atomic append. If that's what was *really* intended by the standard, then that part of the standard doesn't matter because no real systems works that way. They all interleave appends greater than some arbitrary threshold, often PIPE_BUF but not always, likely varying by filesystem.</p><p>For "no intervening," I read that as being entirely about the file offset. That is, the write may be broken arbitrarily into multiple writes (just like a write greater than PIPE_BUF to a pipe), but each will always append without overwriting. Again, that's what real systems do even with their most well-behaved filesystems.</p></div></div></div><div class='comment'><div class='author'>Matrix AI</div><time datetime='2017-07-22T10:24:37Z'>Sat, 22 Jul 2017 10:24:37 UTC</time><div class='body'><p>How do you deal with this if your CSV has rows longer than what a system allows as an atomic write/append? Explicit application synchronization?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-07-23T00:17:29Z'>Sun, 23 Jul 2017 00:17:29 UTC</time><div class='body'><p>If your lines may be longer than what's allowed by writev(2), then, yes, you'll need explicit synchronization (e.g. database, etc.). That limit is 4MB on Linux, which would make for some _very_ long CSV lines, and, in that case, you should probably be using a database anyway.</p></div></div></div></div><hr/><div class='thread'><h1 id='2016-08-07'><a href='/blog/2016/08/07/'>Automatic Deletion of Incomplete Output Files</a></h1><div class='comment'><div class='author'>Bubihybi</div><time datetime='2019-02-22T07:41:50Z'>Fri, 22 Feb 2019 07:41:50 UTC</time><div class='body'><p>There is also ReOpenFile on Windows. With it, it should be possible to clear FILE_FLAG_DELETE_ON_CLOSE.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-02-22T16:55:26Z'>Fri, 22 Feb 2019 16:55:26 UTC</time><div class='body'><p>Interesting, I didn't know about ReOpenFile(). Apparently it's so rarely used by Windows applications that the Wine project has never bothered implementing it, and essentially nobody has noticed its omission. I tried to test this in Wine first, and it crashes in the ReOpenFile() stub with an "unimplemented" error.</p><p>This function does work in Windows 7 (and later) once I choose an appropriate sharing mode. Unfortunately it creates a new file handle. The old handle still exists and retains its FILE_FLAG_DELETE_ON_CLOSE flag, meaning the file is still doomed to be destroyed.</p></div></div></div></div><hr/><div class='thread'><h1 id='2016-08-12'><a href='/blog/2016/08/12/'>An Elfeed Database Analysis</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2016-09-02'><a href='/blog/2016/09/02/'>Two Years as a High School Mentor</a></h1><div class='comment'><div class='author'>Brannock Device</div><time datetime='2016-09-03T18:40:23Z'>Sat, 03 Sep 2016 18:40:23 UTC</time><div class='body'><p>Fantastic! How did you pick your student?<br></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-09-04T13:19:16Z'>Sun, 04 Sep 2016 13:19:16 UTC</time><div class='body'><p>Internally there's a big list of students who have applied and have not been assigned a mentor. I narrowed it down to those with an interest in computer science, then picked the only student who had something other than Microsoft Excel for past experience. That extra experience was Python (though still very little), which also fit well with the advice from Paul Graham's "The Python Paradox."</p></div></div></div><div class='comment'><div class='author'>Timothy Dahlin</div><time datetime='2016-09-06T16:43:25Z'>Tue, 06 Sep 2016 16:43:25 UTC</time><div class='body'><p>Thanks for sharing your mentoring experience.</p><p>By the way, I find the new look of your site to be cleaner.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-09-06T21:51:41Z'>Tue, 06 Sep 2016 21:51:41 UTC</time><div class='body'><p>Thanks! I think I went overboard on my previous design (5 years ago). Check out the printed version, too. I fixed that one up a year ago.</p></div></div></div><div class='comment'><div class='author'>possiblywrong</div><time datetime='2016-09-06T18:02:16Z'>Tue, 06 Sep 2016 18:02:16 UTC</time><div class='body'><p>Great post.  I really like the decision to start with C; even with much younger students, I have been very dismissive in the past of Scratch/Alice/etc., for similar reasons.  But having experimented with both C and Java as a teaching language, I *have* found myself migrating toward Python as that "middle ground" between easy learning and production-ready.  I'm only now getting old enough to wonder how dangerous this approach is?  That is, like your mentee, I (and I'm sure you as well) started learning closer to the bare metal, where the correspondence between the lines of code and the complexity analysis is more one-to-one, so to speak.  It's harder, I think, to squint at Python or similarly higher-level languages, than C or often even C++, and find performance bottlenecks.  By not *starting* with that intuition for what's happening under the hood of all those easy-to-use data structures, is it harder to pick up later?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-09-06T23:38:46Z'>Tue, 06 Sep 2016 23:38:46 UTC</time><div class='body'><p>Actually, I'm a counter-example to your guess. My elementary school's custodian (yes, I remember you, Mr. Jason, if you ever come across this), who had been studying programming in his free time, initially tutored me in QBasic, and on my own I soon moved on to Visual Basic 5 (bought at a computer expo from my allowance). I learned everything I knew about programming from reading the entire manual and experimenting with new things. That was the entirety of my programming experience up through my teens. It wasn't until college that I started learning anything else, including Linux, C, and C++.</p><p>My ad-hoc education in VB5 left me with a twisted impression of OOP, but otherwise I didn't have to unlearn too much. If I had a good mentor to guide me in my teens, I wonder how much further ahead I could be. (Part of why I write this blog is so I can track my improvements over time.) So I don't think starting high makes it harder to pick up low-level intuition later. However, I don't think it's possible to honestly *master* Python or other higher-level languages and frameworks without that low-level intuition. For the craftsman, they're productivity tools, not replacements for the pesky details.</p><p>There's one thing I've realized: My situation was easy. I only had one student to worry about, and we could always focus precisely the next concept for him grasp. If I was running a classroom of students all at different levels, Python would probably help a lot to level the playing field.</p></div></div></div><div class='comment'><div class='author'>Joshua Katz</div><time datetime='2016-09-28T19:29:19Z'>Wed, 28 Sep 2016 19:29:19 UTC</time><div class='body'><p>Is your student's next task to write MIKE?</p><p>I'm going through the book right now, one of the best!</p><p>I'd also like to say that I started out in CS like your student: taken under the wing of a retired professional. Now that I'm in college I'm so far ahead of the other students in my classes it's insane. Most of them can't write simple bash scripts, complete the labs, use data structures, or even write their own algorithms. These are things I was taught how to do at 12-14; I've ended up becoming a defacto tutor in my classes.</p><p>I wish we could teach CS like this rather then via a college environment. I always say CS is a trade, not a science in the traditional sense because it is in reality more an understanding of how to use our surroundings and their limitations to solve problems. The only way I see to do that is via experimentation. Just like you, your student, and I have done.</p></div><div class='comment'><div class='author'>Paul</div><time datetime='2016-09-28T20:45:32Z'>Wed, 28 Sep 2016 20:45:32 UTC</time><div class='body'><p>Except computer science != programming.  The author even says as much by saying that a lot of vocational experience (programming) was gained, but not so much computer science.</p></div></div><div class='comment'><div class='author'>Yohaï Berreby</div><time datetime='2016-09-28T20:51:16Z'>Wed, 28 Sep 2016 20:51:16 UTC</time><div class='body'><p>Hi. I'm self-taught and started at 11. I'll start college next year. Would you be so kind as to provide some advice to someone who is in a similar position to you a few years ago?</p><p>It all started out as a center of interest among others, but grown into a passion, and today I know that I will work on software development. I've gained some experience along the way - worked on real-world, revenue-generating projects for relatives, read through a lot of technical books, and learned varying amounts of Python, Ruby, C, C++, JavaScript (client- and server-side), and Rust. As well as some HTML and CSS. I learned how to use the command line, how to administrate a UNIX system, the basics of information security (just enough not to make overly stupid mistakes as a developer), among (many) other less important things.</p><p>Python was my first 'real' programming experience. I 'know' C, but I wouldn't trust myself to write production software in C without a lot more experience. I can read C code, and I understand most of the low-level details nearly down to register allocation, but writing a sizable amount of _correct_ C is not an easy endeavor and requires a level of care that I am not prepared to put in. I wrote a few production utilities in Ruby and recently started to dabble in Rails. I got interested in game development and read a lot on the matter, so I just _had_ to learn C++. I did for about four months before learning JavaScript seriously. I learned to use JS client-side, and server-side with Node.js, which I used to sell Steam trading bots for peanuts. More recently, I learned Rust, which has been my most pleasant experience so far (static type checking, memory safety, close to the hardware with C-level performance? Sign me in!), and the language in which I've invested the most. I contribute to open-source projects whenever I can, hung out a lot on the #rust IRC channel and on the /r/rust subreddit for some time, and used the language to write a few small production utilities (a few kLOC).</p><p>I like to think that this is a great track record for a 16-year-old. However, my perception of my own skill level is what I'd describe as unstable. Sometimes I'll read through some particularly technical HN threads and feel like a pretentious idiot who knows no more than the bare basics. At other times I'll read stories about college graduates and 'professional' programmers with 5 years of experience who cannot seem _much_ less skilled than me, and I'll feel like I don't even need to go to college.</p><p>So I turn to you. Enlighten me. What new things will college teach me? How should I approach it?</p><p>Here's my GitHub profile in case you want to take a look: <a href="https://github.com/yberreby/" rel="nofollow noopener" title="https://github.com/yberreby/">https://github.com/yberreby/</a></p><p>Thank you for your time.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-09-30T13:50:22Z'>Fri, 30 Sep 2016 13:50:22 UTC</time><div class='body'><p>I'm not the person to whom you directed your comment, but I want to say this: You're on the right track. They key is to practice everything you learn immediately after you learn it. Invent projects for yourself that exercise the knew knowledge. More than likely you'll be practicing several things at once. Keep doing this on a daily basis.</p><p>College will be great for exposing you to concepts you might not have come across on your own. Use the classroom concepts as a stepping stone to more advanced things they won't cover in class. The most obvious sign of a 100% self-taught programmer without the relevant college education is gaps in knowledge. They've naturally focused on practical matters and are very effective, but they don't have the more theoretical concepts that are sometimes useful. This doesn't apply to everyone, but I've noticed it often enough.</p></div></div></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-09-30T13:26:49Z'>Fri, 30 Sep 2016 13:26:49 UTC</time><div class='body'><p>My experience has changed my views on education in general. Like you said, experimentation is essential. Traditional classroom education doesn't practice or encourage this. I suspect the reason is that it's incredibly difficult to scale, and the resources simply aren't there, especially when broadening it to more students with differing ability and interests. It worked well in my mentorship since it was one-on-one with an eager student. I don't think I could do the same working with 10 students simultaneously, let alone 30 or 40.</p><p>This all plays even more into treating it like a trade. There are a limited number of these apprenticeship-style positions available due to a limited number of mentors, and it's not something that would or could be available to every student.</p></div></div></div><div class='comment'><div class='author'>vfulco</div><time datetime='2016-09-29T10:50:50Z'>Thu, 29 Sep 2016 10:50:50 UTC</time><div class='body'><p>Inspirational. Well done.</p></div></div></div><hr/><div class='thread'><h1 id='2016-09-03'><a href='/blog/2016/09/03/'>Read and Write Other Process Memory</a></h1><div class='comment'><div class='author'>Konstantin Khlebnikov</div><time datetime='2016-09-04T03:12:55Z'>Sun, 04 Sep 2016 03:12:55 UTC</time><div class='body'><p>Since 3.2 linux has new syscals for that: process_vm_readv and process_vm_writev.<br>They work without stopping another process.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-09-04T13:10:52Z'>Sun, 04 Sep 2016 13:10:52 UTC</time><div class='body'><p>Thanks! I hadn't come across these. They're way better than mucking around with ptrace. I've added an update to the article.</p></div></div></div><div class='comment'><div class='author'>Terrence Andrew Davis</div><time datetime='2016-09-04T19:35:11Z'>Sun, 04 Sep 2016 19:35:11 UTC</time><div class='body'><p>TempleOS doesn't use paging, basically.  It is single address map.  therefore one task has code at one locationb and another task had code at another.  One task has stack at one location and another task has stack at another location.  You'd be surprised how many people pretend to believe multitasking is impossible without paging.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-09-05T03:01:37Z'>Mon, 05 Sep 2016 03:01:37 UTC</time><div class='body'><p>You've certainly proven that it's possible, but I think anyone who weathered DOS's terminate-and-stay-resident days would argue that virtual memory is far easier for mere mortals to use and manage.</p></div></div></div><div class='comment'><div class='author'>FerminChe YT</div><time datetime='2017-05-31T16:38:34Z'>Wed, 31 May 2017 16:38:34 UTC</time><div class='body'><p>Hi, what program did you use to create the Trap Engine?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-05-31T18:18:42Z'>Wed, 31 May 2017 18:18:42 UTC</time><div class='body'><p>I don't know what the Trap Engine is, and an online search isn't providing any answers about it.</p></div></div></div></div><hr/><div class='thread'><h1 id='2016-09-05'><a href='/blog/2016/09/05/'>Inspecting C&#39;s qsort Through Animation</a></h1><div class='comment'><div class='author'>Thus Torler</div><time datetime='2016-11-22T00:51:15Z'>Tue, 22 Nov 2016 00:51:15 UTC</time><div class='body'><p>It's interesting to see the different sort algorithms in action. Thanks for this!</p></div></div><div class='comment'><div class='author'>GabeJCsapo</div><time datetime='2016-11-22T06:17:17Z'>Tue, 22 Nov 2016 06:17:17 UTC</time><div class='body'><p>This is awesome, hands down coolest sort animation I have seen so far!</p></div></div><div class='comment'><div class='author'>Aleksander Balicki</div><time datetime='2016-11-22T11:55:22Z'>Tue, 22 Nov 2016 11:55:22 UTC</time><div class='body'><p>Some gifs don't work</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-11-22T17:17:20Z'>Tue, 22 Nov 2016 17:17:20 UTC</time><div class='body'><p>GitHub Pages, which hosts this blog, has been having hosting issues the past 12 hours or so. That might be the problem. Also, some mobile devices (including mine) choke up when too many GIFs are loaded on the page. GIFs below the fold don't seem to count until they're visible.</p></div></div></div></div><hr/><div class='thread'><h1 id='2016-09-09'><a href='/blog/2016/09/09/'>Modifying the Middle of a zlib Stream</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2016-09-15'><a href='/blog/2016/09/15/'>Render the Mandelbrot Set with jq</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2016-09-23'><a href='/blog/2016/09/23/'>Linux System Calls, Error Numbers, and In-Band Signaling</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2016-10-02'><a href='/blog/2016/10/02/'>The Vulgarness of Abbreviated Function Templates</a></h1><div class='comment'><div class='author'>Paul Phoenix</div><time datetime='2018-08-21T17:37:19Z'>Tue, 21 Aug 2018 17:37:19 UTC</time><div class='body'><p>Seriously, why?</p><p>You wrote this long blog post without actually, really putting a strong argument against AFT?</p><p>Can you please tell me what is *so* wrong with them? Isn't this concept is a logical next step for auto? And doesn't it mirrors what auto already does in other contexts? Generic lambdas do this already.</p><p>So, your reasoning may also be easily applied against current status of auto. You can easily abuse auto now. Same with AFT and probably half of the features of C++.</p><p>It's just sometimes things are simple enough to stay simple. Why ask developer to type more code?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-08-22T01:08:47Z'>Wed, 22 Aug 2018 01:08:47 UTC</time><div class='body'><p>My last paragraph sums it up. In C++11 the auto keyword was repurposed for type inference, which was both clever and reasonable. However, the semantics of "auto" in AFT is something fundamentally different than type inference. And, unlike type inference, it is not a zero-cost abstraction. It's nothing more than syntactic sugar for a template (hence the name). Not elaborated in the article: IMHO, templates aren't something to be used lightly, so it's not deserving of such syntactic sugar.</p><p>I actually haven't thought about AFT since writing this article, and I haven't seen any more uses of it. Revisiting the situation here in 2018, it seems that, because AFT has been so controversial, should it someday get accepted into C++ it will likely require an explicit template. In my view, this would take the surprising bite out of it, making for a pretty fair compromise. (Unfortunately for me, most of the discussion around Concepts requires a much deeper technical understanding of the C++ specification than I have, so I'm unable to really follow it.)</p></div></div></div></div><hr/><div class='thread'><h1 id='2016-10-07'><a href='/blog/2016/10/07/'>Small-Size Optimization in C</a></h1><div class='comment'><div class='author'>possiblywrong</div><time datetime='2016-10-07T15:51:55Z'>Fri, 07 Oct 2016 15:51:55 UTC</time><div class='body'><p>You mention the Visual Studio functions _malloca() and _freea(); I have tended to stay away from Visual Studio entirely for C stuff, having the impression that although their C++ implementation has actually gotten pretty good, they seem to have ignored C99, so I haven't bothered playing with it much.  Your thoughts?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-10-07T16:48:00Z'>Fri, 07 Oct 2016 16:48:00 UTC</time><div class='body'><p>I discussed this some back in June in my article "Four Ways to Compile C for Windows."</p><p><a href="http://nullprogram.com/blog/2016/06/13/" rel="nofollow noopener" title="http://nullprogram.com/blog/2016/06/13/">http://nullprogram.com/blog...</a></p><p>You're right about C being a low priority for Visual Studio. Fortunately the situation dramatically improved in Visual Studio 2015, when it got C++11 support. Just as most of C99 got merged into C++11, so did many C99 features finally appear in Visual Studio's C compiler, almost by accident. For example, VLAs didn't make it into C++11, so neither does it in Visual Studio's C. Many of its new C99 features are still considered extensions by the compiler, and you'll get warnings about using them. Despite the mediocre C support, since it inherits from Visual Studio's C++ strengths, the code it generates is basically on par with gcc and clang.</p><p>So as of 2015, it's actually in a pretty usuable state, at least for builds. Debugging is still an issue. Naturally it doesn't generate GDB-compatible debugging symbols, so you're basically stuck using Visual Studio as a debugger. So, keeping Visual Studio's limitations in mind (something I've been doing more and more), I can develop and debug comfortably on Linux, then pretty easily port to Visual Studio later for (non-MinGW) Windows builds.</p><p>Even though it's not the compiler I like to use, I think there's value in studying what Microsoft is doing with their tools. The idea of a function like _malloca() hadn't occurred to me before, and seeing/trying it out got the gears turning. Another example is Control Flow Guard (CFG), which, as far as I know, no one else is doing yet due to the (relatively) burdensome loader requirements. It's a ROP mitigation technique that, at run-time, validates all function pointers just before they're followed. If, say, the stack canary fails to detect a function pointer overwrite (i.e. the function epilogue has been run yet), then this is the next line of defense. It also protects function pointers on the heap.</p></div></div></div><div class='comment'><div class='author'>Denis Bakhvalov</div><time datetime='2016-11-05T19:56:57Z'>Sat, 05 Nov 2016 19:56:57 UTC</time><div class='body'><p>Great explanation!<br>This inspired me to implement it in C++.<br><a href="https://github.com/dendibakh/prep/blob/c1a6af1070e20169527346d7b428fe4569d48425/SmallVector.cpp" rel="nofollow noopener" title="https://github.com/dendibakh/prep/blob/c1a6af1070e20169527346d7b428fe4569d48425/SmallVector.cpp">https://github.com/dendibak...</a></p></div></div></div><hr/><div class='thread'><h1 id='2016-10-27'><a href='/blog/2016/10/27/'>An Array of Pointers vs. a Multidimensional Array</a></h1><div class='comment'><div class='author'>Simon</div><time datetime='2016-10-28T13:21:25Z'>Fri, 28 Oct 2016 13:21:25 UTC</time><div class='body'><p>This stuff fascinates me too, such a fantastic write up. This is the second time I have seen an article of yours shared so adding your blog to my feed reader :)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-10-28T20:43:25Z'>Fri, 28 Oct 2016 20:43:25 UTC</time><div class='body'><p>Thanks! What was the first one? I'm going to guess the small-size optimization article.</p></div><div class='comment'><div class='author'>Simon</div><time datetime='2017-03-09T09:40:40Z'>Thu, 09 Mar 2017 09:40:40 UTC</time><div class='body'><p>haha, quite likely that it was the small-size optimization article, possibly from hacker news or reddit? In any case, I have since read a majority of your articles - all quite interesting.</p></div></div></div></div><div class='comment'><div class='author'>Mike Zamansky</div><time datetime='2016-10-29T12:15:06Z'>Sat, 29 Oct 2016 12:15:06 UTC</time><div class='body'><p>This is terrific -- would have loved it when I taught systems at Stuy - I'll have to share it with the current teacher.</p></div></div><div class='comment'><div class='author'>world_turtle</div><time datetime='2016-10-29T15:35:32Z'>Sat, 29 Oct 2016 15:35:32 UTC</time><div class='body'><p>Isn´t it the same with arrays of structs? I suspect that this man got it right: <a href="http://www.the-adam.com/adam/rantrave/st02.pdf" rel="nofollow noopener" title="http://www.the-adam.com/adam/rantrave/st02.pdf">http://www.the-adam.com/ada...</a><br>Will we discover in the future that the ultimate programming language is... FORTRAN 77 ??? :-)</p></div></div><div class='comment'><div class='author'>Alf P. Steinbach</div><time datetime='2016-10-29T19:28:22Z'>Sat, 29 Oct 2016 19:28:22 UTC</time><div class='body'><p>`int ncolors = sizeof(colors) / sizeof(colors[0])`, where `colors` is a pointer, is a classic error. In this case `colors` appears to be an array. I think that's worthy of being pointed out: don't do this if `colors` can be a pointer.</p></div></div><div class='comment'><div class='author'>Denis Bakhvalov</div><time datetime='2016-11-05T19:22:32Z'>Sat, 05 Nov 2016 19:22:32 UTC</time><div class='body'><p>That's interesting.<br>Such a detailed explanation. Thanks!<br>1. What if there will be multiple instances of those arrays?<br>I suppose 2d arrays will consume more memory, because with ptr arrays there will be just ptr, not the copies of all strings. Am I right?<br>2. If there are only benefits, can compilers create such an optimization by always choosing the multidimensional option? Because semantically they are the same. Did you have a chance on feeding this code into different compilers?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-11-05T22:40:57Z'>Sat, 05 Nov 2016 22:40:57 UTC</time><div class='body'><p>Yup, your thinking is correct about string sharing between arrays. The standard doesn't require string literals to be distinct objects (6.4.5-6), which is why writing to a string literal is undefined behavior. If multiple tables have common strings, an array of pointers may very well be the better option due to sharing.</p><p>Compilers have restrictions related to sequence points and observable behavior/state. If the array is static and the compiler can see all accesses at once, and none of those accesses leak pointers, then I believe the compiler could choose any arbitrary representation. This could make debugging awkward, as optimization always does, but that's outside the scope of the language specification. For example, compilers don't need to allocate storage for variables whose address isn't taken. <br>I mostly look at GCC and Clang output, and on occasion MSCV (cl.exe). I didn't see anything unexpected from GCC or Clang with this code. Today's C compilers generally don't do anything as crazy as changing array representation to 2D. I think that's a good thing, since the programmer is likely to be operating with information the compiler doesn't have, so it can't properly make that decision. It's sort of like manual transmission getting better fuel efficiency than automatic: The driver operates on more information than the automatic transmission (upcoming curves and hills, intended route, turns, etc.).</p><p>However, I do know GCC will do interesting things with some algorithms, like convert non-tail-recursive functions into iterative functions:</p><p><a href="http://ridiculousfish.com/blog/posts/will-it-optimize.html" rel="nofollow noopener" title="http://ridiculousfish.com/blog/posts/will-it-optimize.html">http://ridiculousfish.com/b...</a></p></div></div></div><div class='comment'><div class='author'>Graham Toal</div><time datetime='2019-09-04T02:02:32Z'>Wed, 04 Sep 2019 02:02:32 UTC</time><div class='body'><p>closely related to this is an old trick from the 60's for saving space in triangular arrays - it was more efficient to base the structure on a 2D array rather than an array of varyingly-sized slices: <a href="http://gtoal.com/src/triangular.c.html" rel="nofollow noopener" title="http://gtoal.com/src/triangular.c.html">http://gtoal.com/src/triang...</a>  (after writing that recently I found an older reference to the technique in Atlas Autocode from 1965: <a href="http://history.dcs.ed.ac.uk/archive/docs/atlasautocode.html#9.4" rel="nofollow noopener" title="http://history.dcs.ed.ac.uk/archive/docs/atlasautocode.html#9.4">http://history.dcs.ed.ac.uk...</a> )</p></div></div></div><hr/><div class='thread'><h1 id='2016-11-05'><a href='/blog/2016/11/05/'>Emacs, Dynamic Modules, and Joysticks</a></h1><div class='comment'><div class='author'>VanLaser</div><time datetime='2016-11-05T12:42:54Z'>Sat, 05 Nov 2016 12:42:54 UTC</time><div class='body'><p>Cool - your post just gave me the idea of trying to make (in the future...) a module for head-tracking in Emacs, to use with my TrackIR device! :) Nice work!</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-11-05T22:42:00Z'>Sat, 05 Nov 2016 22:42:00 UTC</time><div class='body'><p>Cool idea, I'd like to see that.</p></div></div></div><div class='comment'><div class='author'>&#39;a</div><time datetime='2017-08-23T02:41:16Z'>Wed, 23 Aug 2017 02:41:16 UTC</time><div class='body'><p>Hello,<br>Could you expand/give pointers on the closure pointer and how it can be used.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-08-23T21:28:40Z'>Wed, 23 Aug 2017 21:28:40 UTC</time><div class='body'><p>I have an entire article about this topic: <a href="http://nullprogram.com/blog/2017/01/08/" rel="nofollow noopener" title="http://nullprogram.com/blog/2017/01/08/">http://nullprogram.com/blog...</a></p><p>Summary: I'm using the term "closure" pretty casually in this context. Modules are a C interface, and C doesn't actually have closures. A closure isn't just an anonymous function. It's a function paired with its captured ("closed over") lexical environment. Since C only has function pointers, closures are usually simulated by pairing a function pointer with a void pointer. The void pointer sits in for the lexical environment, allowing the function pointer to behave like a closure, and sets one function pointer apart from another. Another place you can see this technique is in glibc's qsort_r().</p></div><div class='comment'><div class='author'>&#39;a</div><time datetime='2017-08-27T04:03:44Z'>Sun, 27 Aug 2017 04:03:44 UTC</time><div class='body'><p>I guessed it was to be used as a environment store, but my confusion was when and who frees it?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-08-28T00:14:56Z'>Mon, 28 Aug 2017 00:14:56 UTC</time><div class='body'><p>As far as Emacs is concerned, it's just an opaque pointer without any particular meaning and its up to the module to decide its semantics. For example, the argument may not actually be a pointer, but instead an integer cast to a pointer, to be cast back to an integer before use, so dereferencing the pointer would cause a crash.</p></div></div></div></div></div></div><hr/><div class='thread'><h1 id='2016-11-13'><a href='/blog/2016/11/13/'>Zero-allocation Trie Traversal</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2016-11-15'><a href='/blog/2016/11/15/'>Baking Data with Serialization</a></h1><div class='comment'><div class='author'>possiblywrong</div><time datetime='2016-11-17T16:48:56Z'>Thu, 17 Nov 2016 16:48:56 UTC</time><div class='body'><p>Very interesting.  I'm not sure I understand this comment: "The Right Way is to never dereference the data directly but rather memcpy() it into a properly-aligned variable. Byte-order is a non-issue."  Can you describe this in more detail?  I think the part that confused me is the last part about byte-order not being an issue-- or is the idea that it *is* one of several possible architecture-specific issues covered in bullet (1), but even on the same architecture, there are *compiler*-specific issues covered in (2), namely alignment?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-11-17T19:16:24Z'>Thu, 17 Nov 2016 19:16:24 UTC</time><div class='body'><p>I've gone back and adjusted some of the wording. I threw on the sentence about byte-order much later, so maybe that's why it stuck out.</p><p>Byte-order is solved by (1), due to host and target being the same. But (1) doesn't address alignment. Once the data is dumped out, the alignment information is lost. It's now just a buffer. In the main program, this buffer is being treated as an extern variable by the source, but the linker that produced the data's object file (and therefore its storage) doesn't know any of its alignment requirements, and so it may be misaligned in the linked result.</p><p>Other than manually setting the alignment information in the data object file before linking, the safe way to access this data is to memcpy() from the global variable, treating it as little more than a buffer, into a variable that is known to be aligned properly for its type.</p></div></div></div><div class='comment'><div class='author'>Frank Ruben</div><time datetime='2016-11-24T06:53:23Z'>Thu, 24 Nov 2016 06:53:23 UTC</time><div class='body'><p>happy to have followed the traces from medalled u/skeeto to this blog - this is seriously good stuff. You should be famous ;)</p></div></div></div><hr/><div class='thread'><h1 id='2016-11-17'><a href='/blog/2016/11/17/'>A Magnetized Needle and a Steady Hand</a></h1><div class='comment'><div class='author'>Miguel Lechón</div><time datetime='2016-11-19T08:05:10Z'>Sat, 19 Nov 2016 08:05:10 UTC</time><div class='body'><p>Good bedtime story!</p></div></div><div class='comment'><div class='author'>xem</div><time datetime='2016-12-05T17:09:07Z'>Mon, 05 Dec 2016 17:09:07 UTC</time><div class='body'><p>Great read! There's a dead link though: <a href="http://www.x86-64.org/documentation/abi.pdf" rel="nofollow noopener" title="http://www.x86-64.org/documentation/abi.pdf">http://www.x86-64.org/docum...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-12-05T17:45:16Z'>Mon, 05 Dec 2016 17:45:16 UTC</time><div class='body'><p>Looks like <a href="http://x86-64.org" rel="nofollow noopener" title="x86-64.org">x86-64.org</a> is temporarily down again, which happens from time to time. That link should be back up eventually. If it's not, I'll replace it with another host. Maybe this one:</p><p><a href="https://github.com/hjl-tools/x86-psABI/wiki/X86-psABI" rel="nofollow noopener" title="https://github.com/hjl-tools/x86-psABI/wiki/X86-psABI">https://github.com/hjl-tool...</a></p><p>Thanks for the heads up!</p></div></div></div><div class='comment'><div class='author'>ylluminarious</div><time datetime='2017-10-14T06:31:51Z'>Sat, 14 Oct 2017 06:31:51 UTC</time><div class='body'><p>Nice article! Funny as it sounds, hypothetical scenarios like this drive me to learn stuff sometimes...</p></div></div></div><hr/><div class='thread'><h1 id='2016-11-22'><a href='/blog/2016/11/22/'>Portable Structure Access with Member Offset Constants</a></h1><div class='comment'><div class='author'>Mon_Ouie</div><time datetime='2016-11-23T05:41:21Z'>Wed, 23 Nov 2016 05:41:21 UTC</time><div class='body'><p>Any reason to hardcode constants instead of using the offsetof macro? I believe the latter would be more portable, seeing as the size of some types (including types like uint16_t, on platforms where CHAR_BIT &gt; 8) can be different depending on the target platform. Even if you don't intend to compile to such a platform, at least you can get rid of these magic numbers.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-11-23T18:00:19Z'>Wed, 23 Nov 2016 18:00:19 UTC</time><div class='body'><p>Using offsetof relies on the host's structure alignment rules, which is one of the issues with structure overlaying. The magic numbers in my example would come straight from the formal format specification, making them less arbitrary than they might appear.</p><p>You're absolutely right about problems when CHAR_BIT &gt; 8. But that was already a showstopper since such machines couldn't supply the optional uint8_t type (no padding bits allowed), and probably none of the other fixed-width types either. But I do think that's a decent argument in favor of "uint_least8_t" and friends for handling the extracted integers.</p><p>Additionally, it would be unclear exactly how an octet-oriented format maps onto an unusual byte width, and that detail would need to be hammered out with more specification. So there's not really any way to plan for that case anyway.</p></div></div></div></div><hr/><div class='thread'><h1 id='2016-12-01'><a href='/blog/2016/12/01/'>A Showerthoughts Fortune File</a></h1><div class='comment'><div class='author'>Toby Cubitt</div><time datetime='2016-12-02T04:49:39Z'>Fri, 02 Dec 2016 04:49:39 UTC</time><div class='body'><p>Nice use of elisp!</p><p>It's actually more efficient to use a heap instead of an AVL tree for this particular task, i.e. for selecting the top-10,000 entries.</p><p>Intuitively, the reason a heap data structure is more efficient is because, whereas an AVL tree effectively fully sorts every element as it's added to the tree, including elements you later discard, a heap doesn't bother fully sorting elements until   it has to, so avoids wasted effort sorting elements that later get discarded. That makes heaps more efficient in the asymptotic complexity sense for this application.</p><p>A heap will also be more efficient in practice, because it's a far simpler data structure than an AVL tree (or any other self-balancing binary tree, for that matter). On top of that, heaps can easily be implemented internally using arrays, which makes most operations very fast. Growing an array-based heap is slow when the internal array has to be resized (though still log(n) amortised complexity). But in your case you only need a fixed-size heap, so you get all the benefits of the array-based implementation whilst avoiding all the downsides.</p><p>(Even heaps don't give the most efficient algorithm - they're beaten by an algorithm that uses a partial quicksort. I'm not certain, but heaps may give the most efficient online algorithm, though. Which matters here because you have so much data. The partial quicksort algorithm would require *all* the data to be stored in memory during the algorithm, which would surely be prohibitive. The heap algorithm should beat it easily in practice here.)</p><p>Probably you knew all this already, and just used an AVL tree because there's already an elisp implementation of those bundled with emacs. But there's actually an elisp heap.el package in GNU ELPA (which is indeed array-based). I'd be interested to hear if using that gives you any noticeable speedup...</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-12-02T20:57:00Z'>Fri, 02 Dec 2016 20:57:00 UTC</time><div class='body'><p>You're exactly about my reasons for picking an AVL tree. Also, since I use it for Elfeed's primary index, it was already familiar.</p><p>I figured you were right about the heap, so I gave it a shot using that ELPA heap. I found there was no measurable difference between the AVL tree and the heap. But I also found there was also no measurable difference between either of those and using nothing at all, just throwing away the results as they're read. The time is completely dominated by parsing JSON, and limiting the working set to 10,000 objects keeps the object management time so small that it can't be measured.</p></div></div></div><div class='comment'><div class='author'>Radon Rosborough</div><time datetime='2016-12-04T22:11:45Z'>Sun, 04 Dec 2016 22:11:45 UTC</time><div class='body'><p>This is great! It wasn't immediately obvious to me how to get this working on OS X with Zsh, so hopefully this will help someone else:</p><p>$ brew install fortune<br>$ strfile showerthoughts<br>$ mkdir ~/.fortune<br>$ cp showerthoughts* ~/.fortune</p><p>And then in your .zshrc:</p><p>if [[ -o login &amp;&amp; -z $HAS_FORTUNE_ALREADY_RUN ]]; then<br>    export HAS_FORTUNE_ALREADY_RUN=true<br>    fortune ~/.fortunes 2&gt;/dev/null || true<br>fi</p></div></div><div class='comment'><div class='author'>VanLaser</div><time datetime='2016-12-05T15:33:51Z'>Mon, 05 Dec 2016 15:33:51 UTC</time><div class='body'><p>Nice :) And this goes very well with the "fortune-cookie" emacs package (which I use to feed the comments in my scratch buffer)</p></div></div><div class='comment'><div class='author'>Rei Hino</div><time datetime='2017-10-26T23:05:00Z'>Thu, 26 Oct 2017 23:05:00 UTC</time><div class='body'><p>Thank you, this is really nice!</p><p>Just one thing: if you want to place these fortunes in the offensive set, you need to convert them to ROT13:</p><p>rot13 &lt; showerthoughts &gt; showerthoughts-o<br>strfile -x showerthoughts-o</p><p>Then you get showerthoughts-o and showerthoughts-o.dat</p><p>Under Debian/Ubuntu/Mint, they are installed to /usr/share/games/fortunes/off/showerthoughts[.dat]<br>Under Slackware, they are installed to /usr/share/games/fortunes/showerthoughts-o[.dat]</p><p>Then the fortunes are available through <br>All including offensive: fortune -a<br>Offensive only: fortune -o (Debian/Ubuntu/Mint) or fortune all -o (Slackware).<br>Just Showerthoughts: fortune off/showerthoughts (Debian/Ubuntu/Mint) or fortune showerthoughts-o (Slackware)</p><p>If you're interested in packaging these with a Makefile, etc, I also make custom fortunes, all are CC0 unless noted:</p><p>YKYWTMSMW (Sailor Moon joke book, custom noderivatives statement): <a href="https://github.com/redblade7/smtoomuch/" rel="nofollow noopener" title="https://github.com/redblade7/smtoomuch/">https://github.com/redblade...</a><br>Fifteen Thousand Useful Phrases: <a href="https://github.com/redblade7/usefulphrases" rel="nofollow noopener" title="https://github.com/redblade7/usefulphrases">https://github.com/redblade...</a><br>Mark Twain: <a href="https://github.com/redblade7/twain" rel="nofollow noopener" title="https://github.com/redblade7/twain">https://github.com/redblade...</a><br>Catholic Saints: <a href="https://github.com/redblade7/saints" rel="nofollow noopener" title="https://github.com/redblade7/saints">https://github.com/redblade...</a><br>BitchX Kick &amp; Quit Messages (New BSD): <a href="https://github.com/redblade7/bxfortunes" rel="nofollow noopener" title="https://github.com/redblade7/bxfortunes">https://github.com/redblade...</a></p></div></div></div><hr/><div class='thread'><h1 id='2016-12-11'><a href='/blog/2016/12/11/'>Faster Elfeed Search Through JIT Byte-code Compilation</a></h1><div class='comment'><div class='author'>Clément Pit-Claudel</div><time datetime='2016-12-12T13:27:14Z'>Mon, 12 Dec 2016 13:27:14 UTC</time><div class='body'><p>Wonderful post! Mind if I share this with emacs-devel? There are not that many example of lexical scope making things faster in the wild (I think json.el is another one), and I'm sure many of the emacs-devel regulars would enjoy reading this :)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-12-12T14:27:24Z'>Mon, 12 Dec 2016 14:27:24 UTC</time><div class='body'><p>Thanks! Not only do I not mind you sharing it, I encourage it. I've been preaching about better performance with lexical scope for 3 years now (since my "Emacs Lisp Readable Closures" article), though this is the first time I've gathered hard data to support it.</p></div></div></div><div class='comment'><div class='author'>Phil</div><time datetime='2016-12-15T03:29:10Z'>Thu, 15 Dec 2016 03:29:10 UTC</time><div class='body'><p>Very cool. Thanks for posting this (and your other articles) Chris -- always interesting and enlightening reading. I suspect that some nice improvements to the elisp manual could be derived from them as well, if that's something you'd be interested in? (I admit I've put zero actual thought or investigation into that comment, but I'll raise the idea anyway :) Even if the manual *does* discourage actively poking around with byte code, I see no reason for the details -- and the potential benefits of that knowledge -- not to be documented.)</p></div></div><div class='comment'><div class='author'>Frank Ruben</div><time datetime='2018-10-04T04:20:34Z'>Thu, 04 Oct 2018 04:20:34 UTC</time><div class='body'><p>Late to the game reading this, thanks anyway for another highly interesting post.</p><p>When you say "It’s as fast as Elisp can get.", there is one more trick that might help: Not language-specific, but as used by database-systems: because of the short-circuiting you can use static information about the distribution of the tags in the entries to build the (or (memq ...) ...) clauses, in that case so that the most-used tag comes first. For real-world data with an expected unequal distribution of tag values this should give a measurable speed-up.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-10-04T12:40:46Z'>Thu, 04 Oct 2018 12:40:46 UTC</time><div class='body'><p>That's an interesting idea, thanks! I might try this out. If it seems like it would prove generally useful, I might want to (redundantly) track tag distribution in the database so that the information is readily available.</p></div></div></div></div><hr/><div class='thread'><h1 id='2016-12-22'><a href='/blog/2016/12/22/'>Some Performance Advantages of Lexical Scope</a></h1><div class='comment'><div class='author'>Phil</div><time datetime='2016-12-22T03:42:08Z'>Thu, 22 Dec 2016 03:42:08 UTC</time><div class='body'><p>It's good advice, with the proviso that judicious use of dynamic variables ought to cover <em>everything that a user of your code might conceivably want to override, even if the author did not originally anticipate the use-case</em>. Using lexical scope by default has the potential to deny users the ability to leverage dynamic scope for their own benefit, so it's important to write and review your own code with that in mind (unless sharing your code with others is somehow not a possibility). Good code will indeed provide the best of both worlds, though.</p></div></div><div class='comment'><div class='author'>Xah Lee</div><time datetime='2016-12-23T02:25:35Z'>Fri, 23 Dec 2016 02:25:35 UTC</time><div class='body'><p>a quibble: i was asking about the lexical-binding directive/“file variable” vs a new special form, with respect to language design choice. Not about the existing macro in cl lib that happens to be called lexical-let (am aware of it but avoid using anything in cl lib, so far.).</p><p>Among your explanations, the one info you convinced me that a language directive is more proper is this:</p><p>“It applies not just to let, but to all forms that create local bindings, such as function parameters, condition-case, and any macros that expand to let.”</p><p>from this, i understand that a new special form won't work. It must be a language directive (e.g. file variable in emacs)</p><p>this one scratched my spot. :D and i learned many other things from your post!</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-12-23T03:12:34Z'>Fri, 23 Dec 2016 03:12:34 UTC</time><div class='body'><p>I primarily mentioned our discussion in order to indicate what sparked the article, using it as an excuse to describe how lexical-let works since it's a pretty neat hack. Regardless, I'm glad I was able to convince you of the value of lexical-binding! Thanks for the discussion topic.</p></div></div></div></div><hr/><div class='thread'><h1 id='2016-12-23'><a href='/blog/2016/12/23/'>Relocatable Global Data on x86</a></h1><div class='comment'><div class='author'>ner0x652</div><time datetime='2016-12-24T20:13:32Z'>Sat, 24 Dec 2016 20:13:32 UTC</time><div class='body'><p>Great article! Thanks!</p><p>P.S. and uses cl (the lowest bit of rcx) in a shift operation. -&gt; I know you meant lowest byte ;)<br></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-12-24T20:17:39Z'>Sat, 24 Dec 2016 20:17:39 UTC</time><div class='body'><p>Thanks! It's now been corrected to "byte."</p></div></div></div></div><hr/><div class='thread'><h1 id='2016-12-27'><a href='/blog/2016/12/27/'>Domain-Specific Language Compilation in Elfeed</a></h1><div class='comment'><div class='author'>Phil</div><time datetime='2016-12-28T09:12:57Z'>Wed, 28 Dec 2016 09:12:57 UTC</time><div class='body'><blockquote>The remaining time is dominated by <code>xml-parse-region</code>, which is mostly out of my control.</blockquote><p> Are you using <code>libxml-parse-xml-region</code> when it's available?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2016-12-28T15:26:12Z'>Wed, 28 Dec 2016 15:26:12 UTC</time><div class='body'><p>Surprisingly, libxml-parse-xml-region isn't any faster than xml-parse-region, at least for syndication feeds. In fact, it's a tiny bit slower in my tests. I don't know why, but maybe its integration into Emacs isn't ideal, or maybe all the consing and interning is what actually dominates the time.</p><p>Also since libxml2 is an optional dependency, Elfeed would need to support both. That's complicated because libxml-parse-xml-region is less configurable and its parsing results are subtly different. So even if it *was* faster, it would be need to be fast enough to make it worth the extra complication.</p><p>Elfeed *does* use libxml-parse-html-region for elfeed-show since the xml package doesn't support HTML parsing. That means libxml2 is required for viewing feed content.</p></div><div class='comment'><div class='author'>Phil</div><time datetime='2016-12-28T21:24:46Z'>Wed, 28 Dec 2016 21:24:46 UTC</time><div class='body'><p>That <em>is</em> surprising -- but I was merely assuming it would be quicker. Not a low-hanging fruit after all, then.</p></div></div></div></div><div class='comment'><div class='author'>Clément Pit-Claudel</div><time datetime='2017-01-01T22:08:26Z'>Sun, 01 Jan 2017 22:08:26 UTC</time><div class='body'><p>Very nice.  I doubt compiling regular expressions would help; parsed regexps are already cached by the regexp engine, and it's fairly well optimized.</p></div></div></div><hr/><div class='thread'><h1 id='2017-01-08'><a href='/blog/2017/01/08/'>C Closures as a Library</a></h1><div class='comment'><div class='author'>zephyrpellerin</div><time datetime='2017-01-09T00:33:26Z'>Mon, 09 Jan 2017 00:33:26 UTC</time><div class='body'><p>It must be in the Zeitgeist,</p><p>I was working on something like this as well a few days ago --  a META II compiler that emits x86 assembly code for custom C 'closures' and partially applied functions. Right now it just basically rewrites the existing instruction constants, which seriously limits it's functionality (so for example, in an 'add' partial function, the instruction `add EAX, 0x0`, and later in the function body locate the address of "0x0" and replace it with the value of EAX).</p><p>I wrote this in Rust and put it on Github, but having something in C is just as well!</p><p>Something I'd be curious about if you happen to know is how to ensure that ld respects omagic options, or otherwise ensure that the .text section begins life as RWE (without mprotect).</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-01-09T23:19:30Z'>Mon, 09 Jan 2017 23:19:30 UTC</time><div class='body'><p>You could try using your own linker script.</p></div></div></div><div class='comment'><div class='author'>Greg V</div><time datetime='2017-01-09T12:12:36Z'>Mon, 09 Jan 2017 12:12:36 UTC</time><div class='body'><p>A more practical solution that already works on many operating systems (well, everywhere with LLVM) and gives you nice syntax: clang -fblocks -lBlocksRuntime</p></div></div><div class='comment'><div class='author'>Boštjan Vesnicer</div><time datetime='2017-01-11T08:12:21Z'>Wed, 11 Jan 2017 08:12:21 UTC</time><div class='body'><p>First of all I want to say that I really enjoy reading your posts/articles. They are very technical and informative.</p><p>Just a small remark. You are marking distance function as inline (which I know is just a hint to the compiler), but in case of passing it as a callback to the qsort function the compiler can't possibly inline it.</p><p>This is in contrast to the C++'s std::sort function which is a function template so the compiler is free to inline the compare function if it wants. Inlining could of course make a performance difference.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-01-11T12:28:32Z'>Wed, 11 Jan 2017 12:28:32 UTC</time><div class='body'><p>You're right about the qsort() callback not practically being inlined. (Though LTO can and does inline callbacks, and it could do this when libc is statically linked, achieving the same effect as std::sort, but this is not generally the case.) However, the callback is actually coord_cmp() / coord_cmp_r(), not distance(), and distance() would certainly be inlined into those functions regardless of my hint.</p></div><div class='comment'><div class='author'>Boštjan Vesnicer</div><time datetime='2017-01-11T15:58:04Z'>Wed, 11 Jan 2017 15:58:04 UTC</time><div class='body'><p>You're of course right.</p></div></div></div></div><div class='comment'><div class='author'>proteansec</div><time datetime='2017-01-28T11:23:28Z'>Sat, 28 Jan 2017 11:23:28 UTC</time><div class='body'><p>If the C had support for nested functions, would defining a closures be a rather simple task, since all we had to do is to write a write a wrapper with nested function that would call the original function that doesn't accept user pointer argument right?</p><p>Basically, I would like to know whether closures are dependent on the support on nested functions (in other programming languages as well) and if such support exist, closures can be easily defined/used in arbitrary programming language. If such support existed in C, this whole task would've been rather simpler?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-01-31T22:50:10Z'>Tue, 31 Jan 2017 22:50:10 UTC</time><div class='body'><p>The syntax of nested functions would be an important part of integrating closures into the language proper, but one of the real difficulties is how closures are to be allocated since they have memory associated with them. You can see this with C++11 where closures are explicit in how things are captured, leveraging C++'s implicit memory allocation. C has always been explicit about memory allocation, and closures don't really fit that model. Ultimately they're not very C-like.</p><p>Nested functions themselves could be pretty C-like (and GCC even supports it already), and sticking to the explicit pointer argument mostly solves the closure problem in a C-like way.</p></div></div></div></div><hr/><div class='thread'><h1 id='2017-01-21'><a href='/blog/2017/01/21/'>Manual Control Flow Guard in C</a></h1><div class='comment'><div class='author'>Guest</div><time datetime='2017-01-22T13:52:02Z'>Sun, 22 Jan 2017 13:52:02 UTC</time><div class='body'><p>&gt;The size of the name buffer is 8 bytes, and peeking at the assembly I see an extra 8 bytes allocated above, so there’s 16 bytes to fill, then 8 bytes to overwrite the return pointer with the address of self_destruct.</p><p>What?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-01-22T14:03:55Z'>Sun, 22 Jan 2017 14:03:55 UTC</time><div class='body'><p>In other words, the compiler allocates 16 bytes for "name," not just 8. In order to overflow the buffer, I have to write more than 16 bytes into the buffer. I knew about the extra 8 bytes from examining the disassembly for the function. In the end, that's 24 bytes in total for the exploit.</p></div><div class='comment'><div class='author'>Guest</div><time datetime='2017-01-23T01:27:53Z'>Mon, 23 Jan 2017 01:27:53 UTC</time><div class='body'><p>Oh, I see. Thank you for the reply!</p></div></div></div></div><div class='comment'><div class='author'>psh3nka</div><time datetime='2017-01-25T06:58:11Z'>Wed, 25 Jan 2017 06:58:11 UTC</time><div class='body'><p>"to make it harder for an attacker to manipulate the bitmap should he get the ability to overwrite it by a vulnerability." should he? it's not misprint?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-01-25T19:31:41Z'>Wed, 25 Jan 2017 19:31:41 UTC</time><div class='body'><p>That's exactly what I intended to write. Imagine a comma appears after "bitmap" and it may help you parse the sentence.</p></div></div></div></div><hr/><div class='thread'><h1 id='2017-01-30'><a href='/blog/2017/01/30/'>How to Write Fast(er) Emacs Lisp</a></h1><div class='comment'><div class='author'>agumonkey</div><time datetime='2017-01-31T18:16:01Z'>Tue, 31 Jan 2017 18:16:01 UTC</time><div class='body'><p>Upvote as usual. How often do you write perf sensitive elisp code ? I was under the impression you were kinda busy with other languages these days.</p><p>Thanks for your great insights!</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-01-31T22:01:18Z'>Tue, 31 Jan 2017 22:01:18 UTC</time><div class='body'><p>Thanks, agumonkey! These thoughts came out of the two big Elfeed optimizations I did last month (JIT and DSL articles). I've been using Elfeed on a daily basis for nearly 3.5 years now, being an vital part of my routine. I have a deeply vested interest in its smooth operation.</p><p>Then again more recently someone found a bug deep inside simple-httpd (issue #13), in some awful code I wrote 8 years ago. I completely rewrote it, fixing the problem and dramatically faster, subsequently giving Skewer a nice boost as well. You can really tell the difference in Skewer for large (100kB+) results.</p><p>And then last week, just for fun, I wrote a throwaway Killer Sudoku solver. For practice I spent a couple hours trying to make it as fast as possible. Applying the techniques in this article, plus a jump table hack (to be covered in a future article), I got it down from around 3 minutes to 12 seconds. This was without changing the algorithm. Some careful considerations in the right places can have dramatic results!</p><p>But otherwise you're right, since I've been focusing on a lot of C stuff lately.</p></div><div class='comment'><div class='author'>agumonkey</div><time datetime='2017-02-01T03:21:37Z'>Wed, 01 Feb 2017 03:21:37 UTC</time><div class='body'><p>Interesting, eager to see that future article.</p></div></div></div></div><div class='comment'><div class='author'>progrock</div><time datetime='2017-01-31T22:33:44Z'>Tue, 31 Jan 2017 22:33:44 UTC</time><div class='body'><p>This is fantastic. How did you get to this level? I see so many article on emacs which are little more than basic functions on a hook. Seibel's Practical Common Lisp, what got you over the first hurdle Chris? I'm aware there is no easy path, but as an experienced procedural programmer how to plot the course to intermediate elisp and beyond?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-02-01T13:54:51Z'>Wed, 01 Feb 2017 13:54:51 UTC</time><div class='body'><p>My advice is always this: regular purposeful practice. In programming, experience really is the best teacher. When you've completed something useful in Elisp, consider how it could be better. Could it be faster? Could it use less memory? Could it be done with less code? (Not in the line count sense, but with fewer conceptual components.) Could it be clearer to the reader? These are often trade-offs with each other, and it takes experience and practice to strike that balance well.</p></div></div></div><div class='comment'><div class='author'>anon</div><time datetime='2017-02-01T04:01:54Z'>Wed, 01 Feb 2017 04:01:54 UTC</time><div class='body'><p>It's probably with mentioning that the loop unrolling example is the same as just using cond.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-02-01T13:45:59Z'>Wed, 01 Feb 2017 13:45:59 UTC</time><div class='body'><p>Oh yeah, you're right. That didn't occur to me, so it's a less optimal example than I intended. When I've applied unrolling to real code, it wasn't actually equivalent to a cond. For example, see my other article "Faster Elfeed Search Through JIT Byte-code Compilation."</p></div></div></div><div class='comment'><div class='author'>Clément Pit-Claudel</div><time datetime='2017-02-01T08:08:41Z'>Wed, 01 Feb 2017 08:08:41 UTC</time><div class='body'><p>I wouldn't word rule 3 so strongly — especially because it contradicts rule 2.  Here are the timings I get for your three functions, on my machine:</p><p>0.6968s [slow]<br>0.6654s [fast]<br>0.6707s [cl]</p><p>This is for a 5000-elements list; I used the following code to benchmark it:</p><p>(defvar ~/input<br>  (let ((lst nil))<br>    (dotimes (n 5000)<br>      (push n lst))<br>    (nreverse lst)))</p><p>(dotimes (_ 10)<br>  (with-timer "slow"<br>    (dotimes (_ 1000)<br>      (expt-list ~/input 2)))<br>  (with-timer "fast"<br>    (dotimes (_ 1000)<br>      (expt-list-fast ~/input 2)))<br>  (with-timer "cl"<br>    (dotimes (_ 1000)<br>      (expt-list-fast ~/input 2))))</p><p>with-timer is this:</p><p>(defmacro with-timer (message &amp;rest body)<br>  "Show MESSAGE and elapsed time after running BODY."<br>  (declare (indent defun))<br>  `(let* ((start-time (current-time)))<br>     (prog1<br>         ,@body<br>       (message "%.4fs [%s]" (float-time (time-since start-time)) ,message))))</p><p>All in all, the lambda form isn't that bad :) (and it's much faster when the code isn't byte-compiled, though that's not a big concern)</p><p>Btw, did you hear about the byte-switch branch?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-02-01T13:40:37Z'>Wed, 01 Feb 2017 13:40:37 UTC</time><div class='body'><p>I'm also seeing about the same 5% speedup from the "fast" version. It's not as dramatic as I thought it would be. Since mapcar is a built-in, I think this makes sense because the loop is implemented in C rather than byte-code. However if you reduce the list to something a lot shorter (I chose 20 elements) and increase the number of benchmark iterations to compensate, that gap opens up to 25% faster. Going in the other direction, up to around a million elements, the "fast" version actually gets much slower.</p><p>I speculated that the boost for short lists was garbage collection, since the closure allocation isn't amortized over as many list elements. However, disabling garbage collection (high gc-cons-threshold) makes the effect even more dramatic, up to 35%-40% faster.</p><p>The slowdown in the other direction may be in part due to cache misses on the second traversal. That's a lot of memory to go back and touch. However, I the "slow" version also does a lot fewer garbage collections for huge lists. I don't know why this is. Maybe mapcar is doing something special internally? The "fast" version remains faster for huge lists when garbage collection isn't involved.</p><p>I made some changes to your benchmark. First, I added a manual garbage collection right before grabbing the start time. That way all tests start with the heap state. I then added a garbage collection counter. I also dropped the "cl" version since it's literally just the nreverse version with an extra variable. Finally, I made the list length and number of iterations parameters and include them in the output (message, length, iterations).</p><p>Here are the results with 25.1. You can see the garbage collector was disabled in the second grouping. I did multiple iterations at each length/iteration pairing but only kept the last pair of each figuring it was sufficiently "warmed up" by then.</p><p>4.6893s 510gc [slow 20 1000000]<br>3.5296s 400gc [fast 20 1000000]<br>4.2031s 409gc [slow 200 100000]<br>3.7720s 400gc [fast 200 100000]<br>3.8490s 400gc [slow 2000 10000]<br>3.4427s 400gc [fast 2000 10000]<br>3.7330s 333gc [slow 20000 1000]<br>3.6769s 400gc [fast 20000 1000]<br>3.1441s 100gc [slow 200000 100]<br>5.1803s 346gc [fast 200000 100]<br>2.6902s 10gc  [slow 2000000 10]<br>4.9232s 61gc  [fast 2000000 10]</p><p>2.7241s 0gc [slow 20 1000000]<br>1.7058s 0gc [fast 20 1000000]<br>1.7881s 0gc [slow 200 100000]<br>1.5595s 0gc [fast 200 100000]<br>1.7724s 0gc [slow 2000 10000]<br>1.5482s 0gc [fast 2000 10000]<br>1.8012s 0gc [slow 20000 1000]<br>1.5467s 0gc [fast 20000 1000]<br>1.8160s 0gc [slow 200000 100]<br>1.6160s 0gc [fast 200000 100]<br>1.8444s 0gc [slow 2000000 10]<br>1.6827s 0gc [fast 2000000 10]</p><p>So the guideline is more complicated: For lists under 100k elements, use nreverse. Over 100k elements, use mapcar unless you're temporarily suspending garbage collection.</p></div></div></div><div class='comment'><div class='author'>Wilfred Hughes</div><time datetime='2017-03-05T22:41:34Z'>Sun, 05 Mar 2017 22:41:34 UTC</time><div class='body'><p>There's no reason why dash.el couldn't use an explicit loop in its macros, so I benchmarked this with the intention of sending a PR.</p><p><a href="https://gist.github.com/Wilfred/d51db0a1433ec4abdbca58a0dec039a5" rel="nofollow noopener" title="https://gist.github.com/Wilfred/d51db0a1433ec4abdbca58a0dec039a5">https://gist.github.com/Wil...</a></p><p>However, I'm struggling to find a scenario where mapcar is slower. Any ideas why?</p><p>The timings I got were:</p><p>Small list with mapcar (seconds): 1.0259000000000001e-05<br>Small list with loop (seconds): 2.8387e-05<br>Medium list with mapcar (seconds): 0.0027399819999999997<br>Medium list with loop (seconds): 0.007948615<br>Large list with mapcar (seconds): 0.7446324980000001<br>Large list with loop (seconds): 1.236648743</p></div></div><div class='comment'><div class='author'>Vibhav Pant</div><time datetime='2017-07-03T16:47:59Z'>Mon, 03 Jul 2017 16:47:59 UTC</time><div class='body'><p>update: emacs 26 has support for jump tables for elisp code written with cond/cl-case/pcase.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-07-04T01:08:24Z'>Tue, 04 Jul 2017 01:08:24 UTC</time><div class='body'><p>Thanks, I'll have to check that out. It's great that existing Elisp gets the free upgrade when it's byte-compiled for the newer release.</p></div></div></div></div><hr/><div class='thread'><h1 id='2017-02-14'><a href='/blog/2017/02/14/'>Asynchronous Requests from Emacs Dynamic Modules</a></h1><div class='comment'><div class='author'>Vladimir Kazanov</div><time datetime='2017-02-14T08:10:47Z'>Tue, 14 Feb 2017 08:10:47 UTC</time><div class='body'><p>Chris, thanks for the article and useful ideas/feedback/contributions!</p><p>I'll add some background to the project's README and a link to the article, if you don't mind.</p><p>For blog readers: actually, there are a few caveats in the way Elfuse works right now. First, it does not support multiple FUSE filesystems per Emacs instance. Second, Emacs-side API is a bit awkward right now. I'll fix the limitations in the next iteration of work on Elfuse.</p><p>Meanwhile, I'm looking for interesting Elfuse-based demo project ideas :-) I have a few of my own but who knows...</p></div></div></div><hr/><div class='thread'><h1 id='2017-03-01'><a href='/blog/2017/03/01/'>OpenMP and pwrite()</a></h1><div class='comment'><div class='author'>Boštjan Vesnicer</div><time datetime='2017-03-14T12:59:32Z'>Tue, 14 Mar 2017 12:59:32 UTC</time><div class='body'><p>Just another small remark from an interested reader :-)</p><p>Since you are using Windows' WriteFile in an asynchronous  manner, wouldn't it be more correct to issue an GetOverlappedResult call after calling WriteFile to wait the IO operation to finish before returning from write_frame function? Please correct me if I am wrong.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-03-14T19:05:59Z'>Tue, 14 Mar 2017 19:05:59 UTC</time><div class='body'><p>I could be mistaken since I only know enough Win32 to be dangerous, but since standard output presumably wouldn't be opened in overlapped mode (FILE_FLAG_OVERLAPPED), it's not actually asynchronous. The "OVERLAPPED" argument is merely doubling as a plain old file position even for synchronous operations.</p></div></div></div></div><hr/><div class='thread'><h1 id='2017-03-12'><a href='/blog/2017/03/12/'>Why I&#39;ve Retired My PGP Keys and What&#39;s Replaced It</a></h1><div class='comment'><div class='author'>Ryan C</div><time datetime='2017-03-14T14:50:01Z'>Tue, 14 Mar 2017 14:50:01 UTC</time><div class='body'><p>Generating public keys from a passphrase is a catastrophically bad footgun - it makes the public key into a password-hash equivalent that can be cracked. For bitcoin, this was called a "brainwallet" and resulted in people - even very smart ones - losing large amounts of money to theft.</p><p>This is *exactly* why you're not supposed to roll your own crypto.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-03-14T18:48:09Z'>Tue, 14 Mar 2017 18:48:09 UTC</time><div class='body'><p>The danger with brainwallets is poor passphrases, address re-use (in the naive case), and poor key derivation (i.e. a single round of SHA-256). Electrum, my personal Bitcoin wallet client of choice, is doing just fine with passphrase-derived addresses because it's dealt with each of these issues.</p><p>With the default key derivation settings, keys derived by Enchive are very resistant to cracking (and probably *too* paranoid). As I mentioned in the article, each cracker guess requires its own 512MB random-access read+write memory buffer through a computationally intensive process. Guessing ain't cheap. It's still ultimately the user's responsibility to pick a good passphrase, which is why this feature isn't the default. I know my own Enchive passphrase is sufficiently long, so this feature will be useful.</p></div><div class='comment'><div class='author'>Ryan C</div><time datetime='2017-03-14T19:14:21Z'>Tue, 14 Mar 2017 19:14:21 UTC</time><div class='body'><p>You cite Electrum, which as far as I know, no longer allows users to choose their own passphrase, then go on to say it's the user's responsibility to pick a good passphrase.</p><p>Electrum style tools that generate the passphrase for the user and actively try to prevent people from choosing their own are fine if done right, but making the user responsible for their own security in this sort of tool is actively harmful. Most people simply do not have the necessary understanding to choose one that is secure enough (even with a heavy KDF).</p></div></div></div></div><div class='comment'><div class='author'>Greg</div><time datetime='2019-04-20T01:06:08Z'>Sat, 20 Apr 2019 01:06:08 UTC</time><div class='body'><p>Borg backup might be up your alley, for this use case or a similar need. I replaced a pile of rsync/reverse encfs stuff with it.</p></div></div><div class='comment'><div class='author'>Michał Kosek</div><time datetime='2019-08-19T08:58:17Z'>Mon, 19 Aug 2019 08:58:17 UTC</time><div class='body'><p>This doesn't build confidence: "Enchive uses an scrypt-like algorithm for key derivation". Why are you rolling your own key derivation instead of using scrypt? Scrypt has received a fair amount of attention from cryptographers and one can be relatively sure that it doesn't have obvious flaws, which is not the case with your algo.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-08-19T15:38:59Z'>Mon, 19 Aug 2019 15:38:59 UTC</time><div class='body'><p>At least at the time I originally wrote Enchive, there didn't exist embeddable libraries of scrypt nor Argon2. In a sense you could say the algorithms weren't yet mature enough to have a wide variety of implementations. Since then, I have developed my own embeddable Argon2 library, and it's what I use now in C applications that need a KDF. This is all in contrast to, say, SHA-256, for which I had half a dozen embeddable options. Avoiding dependencies was, and still is, a higher priority than using either scrypt or Argon2, so I went a different route.</p><p>Fortunately, key stretching is only necessary if you want to use a shorter passphrase. If you're using, say, a 10-word Diceware passphrase (worth ~129 bits), a single SHA-256 hash over your passphrase is a perfectly sufficient KDF for Curve25519. It wouldn't matter if you're using any of scrypt, Argon2, or Enchive's custom KDF.</p></div></div></div></div><hr/><div class='thread'><h1 id='2017-03-30'><a href='/blog/2017/03/30/'>How to Write Portable C Without Complicating Your Build</a></h1><div class='comment'><div class='author'>Nicholas Wilson</div><time datetime='2017-03-31T08:08:49Z'>Fri, 31 Mar 2017 08:08:49 UTC</time><div class='body'><p>It may be a tool too far for your tastes, but CMake is becoming very popular as a makefile-generator and we use it very successfully for generating Unix makefiles + ninja rules + VS projects + Xcode projects and more. If your goal is a portable project, something like CMake is ultimately the way to go, rather than trying to get Unix makefiles to work on Windows.</p></div></div><div class='comment'><div class='author'>Doug Cuthbertson</div><time datetime='2017-04-01T11:33:25Z'>Sat, 01 Apr 2017 11:33:25 UTC</time><div class='body'><p>I see two separate problems for creating portable application (regardless of whether they have a GUI component) - available APIs in each operating system, and the build tools. Your solution to the API issue, to create your own functions to isolate API differences is great. Make the operating system adapt to your application. Your sleep example can even be extended to other OS-specific things like reading and writing files. Make wrapper functions that put data into a form that's internally consistent for your application, but read and written in an OS-specific way.</p><p>As far as build tools go, use what's appropriate and easiest/simplest for the build environment. On unix-like operating systems, it's probably make and makefiles and your favorite compiler. On Windows - well, I'm most familiar with Visual Studio. It makes it easy to create consistent builds in a variety of configurations (debug, release, 32-bit, 64-bit), and to add, move and remove components for an application as the software grows. Also, msbuild.exe reads the solution and project files, so you can execute a build from the command line just as easily as from the IDE.</p><p>CMake and other tools that build build-configuration projects are overly complex and are an impediment to the software development cycle. They hide details like compile and link options, or make you use their language/syntax to express those options, and don't help you avoid os-dependent configuration issues. I just spent a couple of months removing CMake from a project at work. CMake was used to generate Visual Studio projects from several third party libraries, as well as the in-house,project-specific libraries and executables. It generated a lot of project files, and made it very difficult to see which projects built libraries and which were there just to kickoff Cmake so it could do some kind of internal dependency checking. Once CMake was removed, I was left with 14 projects, each with a clear purpose. A fresh build would run in a couple of minutes instead of 17 minutes. If no changes are made, it would take Visual Studio and Cmake 20-30 seconds to determine there was nothing to build. Now it takes a split second.</p><p>Make the OS a service to your app. Keep the build as simple as possible.</p><p>Edit: fix a typo</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-04-01T19:09:05Z'>Sat, 01 Apr 2017 19:09:05 UTC</time><div class='body'><p>That's a good point about just having a separate Visual Studio build, since that's the natural way to build on that platform. I've seen other projects do this, where there's a Makefile for unix-like systems, and in parallel a Visual Studio build. The only real downside I can see is having to maintain them both.</p><p>The main hesitation for me is that the Visual Studio build is more of an afterthought. I've learned its quirks and such (e.g. being _almost_ C99, but not quite), and it's easy to plan ahead to make my software Visual Studio friendly. Ultimately I only run the command line tools (vcvars.bat, then cl.exe, link.exe, etc.) and avoid firing up the whole thing if possible. If I took it more seriously, I'd probably follow your advice.</p><p>I agree with you on CMake. I've tried using it in a few projects and was never satisfied. Seeing LLVM make pretty effective use of CMake makes me hestitate to write it off completely yet, but maybe there's just some really heroic stuff going on behind the scenes to keep it working well.</p></div></div></div><div class='comment'><div class='author'>Powerslave</div><time datetime='2018-09-05T21:57:45Z'>Wed, 05 Sep 2018 21:57:45 UTC</time><div class='body'><p><i>There’s a much easier solution: Document that the application requires,<br>say, C99 and POSIX.1-2001. It’s the responsibility of the person<br>building the application to supply these implementations, so there’s no<br>reason to waste time testing for it.</i></p><p>That's the most unprofessional paragraph I've seen in a good while.</p></div><div class='comment'><div class='author'>Zeturic</div><time datetime='2019-06-16T07:03:36Z'>Sun, 16 Jun 2019 07:03:36 UTC</time><div class='body'><p>Are you trying to say that "professionals" are responsible for ensuring that their programs can be built on any random machine?</p></div><div class='comment'><div class='author'>Powerslave</div><time datetime='2019-06-18T06:37:13Z'>Tue, 18 Jun 2019 06:37:13 UTC</time><div class='body'><p>Would you be happy if you had to hand-pick resource and library files for your favorite GTA/WoW/Blender/whatever because some lunatic developer insisted it's your responsibility to provide them? That'd pretty much be in the same vein.</p><p>Like it or not, real professionals are responsible for ensuring that their software can be built on any "random" system it is intended to be built on. That's absolutely part of being a professional (as opposed to hacking shit together and crossing fingers).<br>Providing a ubiquitous, automated way to resolve your product's dependencies is, give or take a few corner-case exceptions, always your responsibility as someone who writes the said software. Trying to delegate this task to a downstream consumer is as unprofessional as it gets.</p></div><div class='comment'><div class='author'>Zeturic</div><time datetime='2019-06-19T21:56:37Z'>Wed, 19 Jun 2019 21:56:37 UTC</time><div class='body'><p>Here's the thing: if you're writing C99 code for a POSIX system, systems without a C99 compiler or POSIX support necessarily fall outside of the set of systems that you're intending your program to be built on.</p><p>Do you think that it is unprofessional that, for example, Chromium can't be built for the PDP-11?</p></div><div class='comment'><div class='author'>Powerslave</div><time datetime='2019-06-21T09:43:19Z'>Fri, 21 Jun 2019 09:43:19 UTC</time><div class='body'><p>"for a POSIX system"<br>That's exactly where one fails at portability.<br>Do you think it'd be professional to say a Win32 application is perfectly portable and it's the responsibility of the end user to provide the W32 API (e.g. have Wine installed)?</p></div></div></div></div></div></div><div class='comment'><div class='author'>L Michaels</div><time datetime='2019-05-15T12:53:54Z'>Wed, 15 May 2019 12:53:54 UTC</time><div class='body'><p>I'm not a fan of autoconf or the standard GNU way of building programs.  It requires Perl and m4 languages just to build something in C/C++.  There are some times when just using #ifdef to test for the platform and/or compiler just isn't enough.  I think CDetect makes a nice (C based) replacement for autoconf/configure.  It's available at Sourceforge.  There have been a few forks of it as well including mine which adds support for cross-compilation and other features like working in conjunction with pkgconfig/pkconf.</p><p>I do quite a lot of cross-platform development.  I use a custom build system and also use CDetect and pkgconf (when needed) and make.  My build system can autogenerate parts of a makefile and deal with utility/tool differences on various platforms to make things more portable.  I've been able to build applications that run on Windows, Linux, FreeBSD, Android.  I sometimes build cross-platform programs that work on DOS as well.  On Windows, I prefer MinGW to Visual Studio.  I've used both and I've hit some bugs using Visual Studio when the same program passed various validation tests and worked fine with 4 other Windows compilers and a Linux compiler.  If anyone wants a POSIX compatible Windows compiler, there are projects like Cygwin and midipix that supply them.</p><p>I'm currently investigating portable GUI options and working on writing a minimal one for my own use.  There are several good cross-platform graphics and/or GUI libraries that can be useful cross-platform, such as nano-x/microwindows (which works on a variety of platforms and has a subset of the X Windows and Win32 APIs), SDL, allegro, PDcurses/ncurses, nuklear, GLFW.</p></div></div></div><hr/><div class='thread'><h1 id='2017-04-01'><a href='/blog/2017/04/01/'>My Journey with Touch Typing and Vim</a></h1><div class='comment'><div class='author'>Nagora</div><time datetime='2017-04-01T11:53:59Z'>Sat, 01 Apr 2017 11:53:59 UTC</time><div class='body'><p>I do find these sorts of posts very surprising. I've done relatively little modification of my Emacs keys (CapsLock-&gt;Ctl is the main one) and I write a LOT of text and code with it. I've just finished a 75,000 word novel (with week-long bursts of 2000 words every day) and I work on PHP, Perl, and Bash scripts as my day job (and a plethora of other languages for fun at home); touch-typing is absolutely required for the level of output I sustain. In 20 years of Emacs use I've never had any trouble doing this, so I can't see why touch-typing would be an issue to drive anyone to model editing.</p><p>Perhaps your “Hmm, that’s not very convenient. I’ll change it.” approach has actually hampered you and switching to an unmodified Vim simply represents a "reset to sanity" opportunity? Or perhaps the keyboard itself places the Ctl and Alt keys in odd places? I know that the keyboard on my laptop is definitely harder to use than my work's HP or home IBM-M boards (although the laptop does give me a Super- key to play with).</p><p>Certainly, you would have to hold a gun to my head to make me use Vim for even 15% of my output, and I say this as someone who values having Vim on the various servers I have to access for routine maintenance. Modal editing was my introduction to Unix and I am very happy that I do not have to use it more than once or twice a day for short periods.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-04-01T18:41:09Z'>Sat, 01 Apr 2017 18:41:09 UTC</time><div class='body'><p>Congratulations with the novel! That's a ton of text editing.</p><p>It could be that I still haven't figured out how to comfortably press some of the frequent Emacs bindings without my fingers getting lost. Unlike right SHIFT, right CTRL isn't really an option because it's badly placed and its position varies so much from one keyboard to the next. Between work and home, I do use a number of different keyboards. Being stuck with only left CTRL makes for awkward left-handed CTRL combinations (C-x, C-a, C-s). Using caps-lock as CTRL only helps a little bit. In contrast, modal editing has felt very natural while building touch typing muscle memory.</p><p>I don't suffer from RSI, but I know it's fairly common for sufferers to switch to modal editing to relieve their RSI problems. The most recent example I've seen is Casey Muratori (of Handmade Hero), who switched from Emacs 23 to 4coder (a modal editor). I've taken this overall trend as evidence that Emacs' default bindings really do cause strain under touch typing, and it's not just a matter of technique.</p><p>When I've changed some the default Emacs bindings -- which I haven't actually done *that* much -- I don't think it's that I choose something worse. It's just that I chose something arbitrarily different. Then I built up muscle memory for the non-standard bindings. Since I'm starting fresh with Vim, I can avoid this by stopping it before it even starts.</p></div></div></div><div class='comment'><div class='author'>VanLaser</div><time datetime='2017-04-03T10:10:49Z'>Mon, 03 Apr 2017 10:10:49 UTC</time><div class='body'><p>As a person that started with Vim before Emacs, I can only admire Emacs people that are sufficiently intrigued by Vim to start studying it. There are a lot of 're-inventing the wheel' Emacs packages, or keymaps, or bits of elisp that try to solve problems that Vim solved "perfectly" a long time ago.</p><p>The "one" book to read afterwards IMHO, and before starting to move to 'leader keys' and all kind of Vim-oriented keymaps, is "Practical Vim" - it's an excellent distillation of 'good habits' and manners of working with Vim.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-04-03T20:18:53Z'>Mon, 03 Apr 2017 20:18:53 UTC</time><div class='body'><p>I've observed an Emacs re-invented wheel myself: multiple-cursors. You create a region, then invoke its main function to put a cursor on each line in the region, allowing you to edit multiple lines at once, though it's not quite as powerful as the normal cursor. It's really slick, and it's visually impressive, but 99% my uses can be done with Vim's visual mode and visual block mode. Technically multiple-cursors can do a bit more, but I never it all. Vim's approach is better because it composes elegantly with the existing editing commands, and it doesn't have a bunch of little quirks.</p><p>Thanks for the tip on the book. The official user manual has all the information, but not a lot of opinion on how to use it. When I'm new to something, I really do want guidance on good habits.</p></div><div class='comment'><div class='author'>VanLaser</div><time datetime='2017-04-04T23:23:58Z'>Tue, 04 Apr 2017 23:23:58 UTC</time><div class='body'><p>Glad I could help a little! About multiple cursors, the topic is also periodically mentioned on vim reddit. Newish vim versions have the 'gn' text object to help with  (an alternative way of) offering some of the same functionality (together with visual block etc.). This blog post covers it pretty nicely I think: <a href="https://medium.com/@schtoeffel/you-don-t-need-more-than-one-cursor-in-vim-2c44117d51db" rel="nofollow noopener" title="https://medium.com/@schtoeffel/you-don-t-need-more-than-one-cursor-in-vim-2c44117d51db">https://medium.com/@schtoef...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-04-05T00:30:37Z'>Wed, 05 Apr 2017 00:30:37 UTC</time><div class='body'><p>Interesting article, thanks! That's exactly the sort of thing I was talking about with multiple cursors. I didn't know about gn, either. With some research I see Evil has gn as well, though it requires some coniguration to enable it.</p></div></div></div></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-04-17T23:27:53Z'>Mon, 17 Apr 2017 23:27:53 UTC</time><div class='body'><p>Following up on your suggestion, I'm happy to report that "Practical Vim" has been an excellent book, thanks! I should have started with it in the first place instead of diving into the official Vim manual. I'm going to add a note to the article about it.</p></div><div class='comment'><div class='author'>VanLaser</div><time datetime='2017-04-18T22:13:04Z'>Tue, 18 Apr 2017 22:13:04 UTC</time><div class='body'><p>YW! - glad I could help a little :)</p></div></div><div class='comment'><div class='author'>VanLaser</div><time datetime='2017-04-19T12:56:33Z'>Wed, 19 Apr 2017 12:56:33 UTC</time><div class='body'><p>(with the risk of posting too many "helpful" links) <br>Something that helped me a lot in order to go in the other direction (Vim -&gt; Emacs) was this document: <a href="https://github.com/noctuid/evil-guide" rel="nofollow noopener" title="https://github.com/noctuid/evil-guide">https://github.com/noctuid/...</a> which provides a kind of informational "glue" between the two editors.</p></div></div></div></div><div class='comment'><div class='author'>Anonymous</div><time datetime='2017-04-04T02:54:15Z'>Tue, 04 Apr 2017 02:54:15 UTC</time><div class='body'><p>Evil is the best of two worlds, I'm sure you'll love it.</p></div></div><div class='comment'><div class='author'>mirabilos</div><time datetime='2017-04-24T12:39:26Z'>Mon, 24 Apr 2017 12:39:26 UTC</time><div class='body'><p>I just use ed(1) for that, it’s easy to use and pretty universal.</p><p>Well, enter GNU distributions. First Gentoo “oooh, GNU nano is sooo user-friendly¹, let’s install it as the default editor², oh and then we don’t need the standard³ editor⁴”, then others like Debian followed. FU!</p><p>① it’s not, I always configure my pine to never even TRY to show pico and to dump me straight into my favourite curses-based editor, and GNU nano’s just a pico clone</p><p>② it’s “editor” not “nanoitor” you imbeciles!<br>③ also ignoring the POSIX mandated install location of /bin/ed and not even providing a symlink… fortunately this got fixed after I bugreported it AND figured out where the relevant Linux standard says to follow POSIX in this regard… *sigh*<br>④ not installing the others by default; not nice</p><p>I mean, ed(1) is concise and easy to lern, so every serious Unix user ought to know it anyway.<br>Manpage: <a href="http://www.mirbsd.org/man1/ed" rel="nofollow noopener" title="http://www.mirbsd.org/man1/ed">http://www.mirbsd.org/man1/ed</a><br>Tutorial: <a href="http://www.mirbsd.org/manUSD/09.edtut" rel="nofollow noopener" title="http://www.mirbsd.org/manUSD/09.edtut">http://www.mirbsd.org/manUS...</a><br>Advanced: <a href="http://www.mirbsd.org/manUSD/10.edadv" rel="nofollow noopener" title="http://www.mirbsd.org/manUSD/10.edadv">http://www.mirbsd.org/manUS...</a></p></div></div><div class='comment'><div class='author'>Greg Graham</div><time datetime='2018-11-01T16:02:57Z'>Thu, 01 Nov 2018 16:02:57 UTC</time><div class='body'><p>I like vim, and I learned the original vi in 1984. However, when I am using vim a lot, it causes me problems when I have to edit text in a non-vim environment, especially situations where ESC means cancel. As I get older, I have more trouble switching back and forth, so now I do my programming in Sublime Text.</p></div></div></div><hr/><div class='thread'><h1 id='2017-04-27'><a href='/blog/2017/04/27/'>Two Games with Monte Carlo Tree Search</a></h1><div class='comment'><div class='author'>Boštjan Vesnicer</div><time datetime='2017-04-28T17:14:45Z'>Fri, 28 Apr 2017 17:14:45 UTC</time><div class='body'><p>Interesting post, as always. Keep posting ...</p><p>Shameless plug: I managed to win Connect4 in first try. Here is the proof :-) <a href="https://uploads.disquscdn.com/images/6a959eadc1bc37345db3edeb36f35d35d342de43bc11f74a338967218ed1918e.png" rel="nofollow noopener" title="https://uploads.disquscdn.com/images/6a959eadc1bc37345db3edeb36f35d35d342de43bc11f74a338967218ed1918e.png">https://uploads.disquscdn.c...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-04-28T17:36:07Z'>Fri, 28 Apr 2017 17:36:07 UTC</time><div class='body'><p>Nice! I've got to figure out how to make it stronger. If you want to try something simple yourself, tweak the "AI parameters" weights at the top of the source. Recompile it and see if it plays better.</p></div></div></div><div class='comment'><div class='author'>Ruben</div><time datetime='2017-04-29T11:24:34Z'>Sat, 29 Apr 2017 11:24:34 UTC</time><div class='body'><p>I won't feel bad for that AI when it finally falls into 'shallow trap'. It kicks my ass everytime in connect four...<br>Is the only reason for saving the tree that the information can be re-used?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-04-29T12:49:20Z'>Sat, 29 Apr 2017 12:49:20 UTC</time><div class='body'><p>Yes, it's just for re-use. The previous game states aren't considered, and so tree could be constructed from scratch each time a decision is needed. The 500,000 playout limit is an additional 500,000 on top of the information carried forward in the reused branch, so reusing it effectively increases the number of playouts for free. Besides this, it may generally be faster to garbage collect the dead branches than to reinitialize the buffer for a fresh tree (e.g. reconstructing the entire free list). If that's true, then there's no benefit at all to starting from scratch each turn anyway.</p></div></div></div><div class='comment'><div class='author'>Eric Boesch</div><time datetime='2017-10-24T20:31:30Z'>Tue, 24 Oct 2017 20:31:30 UTC</time><div class='body'><p>Late comment after I stumbled onto your blog --</p><p>I would not assume UCT is a poor fit because of traps, but rather that basic UCT is not enough. The extra step of feeding the UCT tree back into the playouts to make that stage smarter can discourage traps, and I believe that's what rather quickly pushed Go programs from around KGS 2 dan to 7 dan, just shy of pro strength. (I have not looked into what AlphaGo did later to reach its current ridiculous strength of maybe 13 dan.) I do not think that extra step is easy, since it requires judging similarity of different positions. I had had the same idea -- it's kind of obvious -- but I did not figure out how I might implement it.</p></div></div></div><hr/><div class='thread'><h1 id='2017-05-03'><a href='/blog/2017/05/03/'>The Adversarial Implementation</a></h1><div class='comment'><div class='author'>Jan Tušil</div><time datetime='2017-05-03T20:59:20Z'>Wed, 03 May 2017 20:59:20 UTC</time><div class='body'><p>There is a compiler based on formal semantics of C, which detects every undefined behaviour: <a href="https://github.com/kframework/c-semantics" rel="nofollow noopener" title="https://github.com/kframework/c-semantics">https://github.com/kframewo...</a>. It could be used as an adversial compiler.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-05-04T19:58:20Z'>Thu, 04 May 2017 19:58:20 UTC</time><div class='body'><p>Thanks, this is an interesting project! My adversarial implementation concept is more of a thought experiment, a tool to reason about a questionable piece of code, but having a concrete compiler like this should be useful for testing.</p></div></div></div><div class='comment'><div class='author'>Paddy3118</div><time datetime='2017-05-08T06:53:59Z'>Mon, 08 May 2017 06:53:59 UTC</time><div class='body'><p>&gt; However, this code is incorrect. The deterministic handle closing an implementation behavior, not part of the specification.</p><p>Implementation details aren't necessarily incorrect. The spec may omit mentioning a detail, (by accident or design).</p><p>Specs need to end. Expect some discrepancies found by this method to be accepted, but some to be rejected as being too pedantic or better *not* added to the spec.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-05-08T11:03:43Z'>Mon, 08 May 2017 11:03:43 UTC</time><div class='body'><p>What I mean is that the small sample program is incorrect, not the implementation or specification. That's because sample's correctness depends on the behavior of a particlar implementation, and it's perfectly fine for implementations to deviate on that detail.</p></div></div></div></div><hr/><div class='thread'><h1 id='2017-05-15'><a href='/blog/2017/05/15/'>Web Scraping into an E-book with BeautifulSoup and Pandoc</a></h1><div class='comment'><div class='author'>Eric Burns-White</div><time datetime='2017-05-15T13:13:51Z'>Mon, 15 May 2017 13:13:51 UTC</time><div class='body'><p>For the record? I literally hand-converted this to Markdown about four months ago so I could edit and prep the upcoming eBook and print editions. Your script would have made that 8000 times easier. :)</p><p>I used the hash for scene breaks specifically because I use hr differently, as you surmised. My wife mocks my HTML markup, it's worth noting.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-05-15T17:57:10Z'>Mon, 15 May 2017 17:57:10 UTC</time><div class='body'><p>Thanks for chiming in, Eric! And thanks for sharing your book online. Knowing now that you've read my commentary about your markup, I feel like I was being a little too harsh, but, at the same time, I'm also vindicated by your wife's teasing. :-)</p><p>Converting an entire book to Markdown by hand is incredibly tedious, but I hope at least it paid off for for you as an extra pass of proofreading. Pandoc can also convert HTML to Markdown, and if I had known about BeautifulSoup two years ago when I converted the other book, I would have used a script just like this to do the bulk of the conversion. Especially since that book is almost twice as long as yours. <br>If you ever need to bulk process your writing again in the future, feel free to get in touch with me if you need any technical assistance.</p></div><div class='comment'><div class='author'>Eric Burns-White</div><time datetime='2017-06-16T13:22:56Z'>Fri, 16 Jun 2017 13:22:56 UTC</time><div class='body'><p>Following up -- I've been using modifications of your script for scraping/converting other projects that are on Banter Latte proper, and they work like a charm.</p><p>Also -- when I mentioned all this to my wife, she pointed at me, shouting "See?! See?!" Hell hath no fury like a usability specialist vindicated. :-)</p></div></div></div></div><div class='comment'><div class='author'>Eric Burns-White</div><time datetime='2017-05-15T13:17:21Z'>Mon, 15 May 2017 13:17:21 UTC</time><div class='body'><p>Oh, and while I appreciate not handing out the ebook of the original (mostly so I can track readership), I don't have any problem with folks doing this themselves. It's not Creative Commons released, per se, but it's online for free and I sure as heck don't mind people adjusting things to their reading preferences.</p><p>Not that people would need me to thumb this up, per se, but no reason I shouldn't.</p></div></div><div class='comment'><div class='author'>Cees Timmerman</div><time datetime='2019-07-15T16:19:11Z'>Mon, 15 Jul 2019 16:19:11 UTC</time><div class='body'><p>if language == "Python": print("No need for braces in if.")</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-07-15T21:35:42Z'>Mon, 15 Jul 2019 21:35:42 UTC</time><div class='body'><p>You're right. Hold C habits are hard to break. I've just fixed it:<br> <a href="https://github.com/skeeto/skeeto.github.com/commit/6d1e21a25863f164f436d2ab0de1df0c0af41927" rel="nofollow noopener" title="https://github.com/skeeto/skeeto.github.com/commit/6d1e21a25863f164f436d2ab0de1df0c0af41927">https://github.com/skeeto/s...</a></p></div></div></div></div><hr/><div class='thread'><h1 id='2017-06-15'><a href='/blog/2017/06/15/'>Switching to the Mutt Email Client</a></h1><div class='comment'><div class='author'>B Brad</div><time datetime='2017-06-16T07:48:39Z'>Fri, 16 Jun 2017 07:48:39 UTC</time><div class='body'><p>Kind of confused by the "Maildir setup (i.e. not IMAP)" comment.  In any case if you are using IMAP I suggest dovecot.  Very easy to setup, and if you use dovecot's deliver (recommend and default) you get Sieve for free.  Dovecot's deliver is of course aware of dovecot's index format, so everything stays in sync without reindexing.  I greatly prefer sieve's secure and human friendly configure files over procmails insecure and line noise like configuration files.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-06-16T15:16:02Z'>Fri, 16 Jun 2017 15:16:02 UTC</time><div class='body'><p>You're right, I could have both, but I prefer to just ssh into the server and work directly with Maildir. Currently, my procmailrc just sorts out spam, but if I ever needed something more complex, Sieve does look like the nicer, better option.</p></div></div></div><div class='comment'><div class='author'>possiblywrong</div><time datetime='2017-06-16T12:41:30Z'>Fri, 16 Jun 2017 12:41:30 UTC</time><div class='body'><p>I skimmed the RFC and maybe missed the appropriate details, but it isn't clear to me how source code is handled, particularly things like "raw" triple-quoted multi-line strings in Python which might have trailing whitespace, but you wouldn't want to be flowed?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-06-16T15:41:27Z'>Fri, 16 Jun 2017 15:41:27 UTC</time><div class='body'><p>Unfortunately I think there's just no way to express code with trailing whitespace under f=f. You need those hard newlines to prevent wrapping. That's a good point about Python triple-quoted strings, being one of the handful of legitimate places to require trailing whitespace in code. Another case is inline patches where the context has trailing whitespace.</p></div></div></div><div class='comment'><div class='author'>Anonymous</div><time datetime='2017-06-20T00:03:52Z'>Tue, 20 Jun 2017 00:03:52 UTC</time><div class='body'><p>You might be interested in mutt-sidebar, it's a patch but I believe Debian distributes a separate mutt package with the sidebar pre-patched (under the mutt-sidebar name).</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-06-20T01:36:18Z'>Tue, 20 Jun 2017 01:36:18 UTC</time><div class='body'><p>Thanks for the tip. I have looked into the sidebar patch, and Debian does indeed include the patch (Stretch actually ships Neomutt), but it's not something I want to use. I don't want to split the Mutt window down any further.</p></div></div></div></div><hr/><div class='thread'><h1 id='2017-06-19'><a href='/blog/2017/06/19/'>Building and Installing Software in $HOME</a></h1><div class='comment'><div class='author'>Nicolò Balzarotti</div><time datetime='2017-06-19T11:45:44Z'>Mon, 19 Jun 2017 11:45:44 UTC</time><div class='body'><p>What about using the nix package manager? I think most of the problems would have been solved easily</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-06-19T13:25:32Z'>Mon, 19 Jun 2017 13:25:32 UTC</time><div class='body'><p>I was aware of nix but hadn't really considered it. I do see it supports home directory installs, which is great. However, it doesn't really fit either of my use cases. 1) I want to install specific versions or patches of software not available in nix (i.e. my multiple Emacs example). 2) I didn't mention it in the article, but when I'm not root, I also usually don't have direct internet access, so nix can't help me. <br>I had considered discussing pkgsrc, which I like better than nix, but it also doesn't fit the bill for the same reasons.</p></div><div class='comment'><div class='author'>Nicolò Balzarotti</div><time datetime='2017-06-19T14:16:03Z'>Mon, 19 Jun 2017 14:16:03 UTC</time><div class='body'><p>You can easily edit the nix expression to add patches, and it's just a<br>"patches = [./patch1.patch ./patch2.path];"<br>away. And I think that having an offline repository is not that difficult, but I've never tried. But with a small setup I think it's possible to be able to install everything needed from a USB drive</p><p>OT: thanks for your posts, I always enjoy reading them</p></div></div></div></div><div class='comment'><div class='author'>Anonymous</div><time datetime='2017-06-19T23:58:44Z'>Mon, 19 Jun 2017 23:58:44 UTC</time><div class='body'><p>Have you tried GNU stow? It's well suited for this, though I haven't used it myself as my system (practically identical to yours) "just works".</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-06-20T01:42:25Z'>Tue, 20 Jun 2017 01:42:25 UTC</time><div class='body'><p>I don't really need all the bells and whistles that comes with Stow. A few environment variables and my dotfiles install script have been perfectly sufficient for these past few years:</p><p><a href="https://github.com/skeeto/dotfiles/blob/master/install.sh" rel="nofollow noopener" title="https://github.com/skeeto/dotfiles/blob/master/install.sh">https://github.com/skeeto/d...</a></p><p>In all things, I'm very adverse to increasing the number of dependencies from 0 to 1. That's a huge leap. Going from 1 to 2 ain't so bad.</p></div></div><div class='comment'><div class='author'>Kaushal Modi</div><time datetime='2017-07-28T04:15:33Z'>Fri, 28 Jul 2017 04:15:33 UTC</time><div class='body'><p>+1</p><p>It's a one-stop shop for managing dot files, installing multiple versions of libraries and packages. You simply set PATH, MANPATH, etc. to point to the stow target.</p></div></div></div><div class='comment'><div class='author'>Wilfred Hughes</div><time datetime='2017-07-15T19:37:03Z'>Sat, 15 Jul 2017 19:37:03 UTC</time><div class='body'><p>Have you looked at Gentoo Prefix?</p><p>I've used it to great success to build an entire Linux userland in $HOME. I was using a Red Hat 5 box with an ancient GCC, and Gentoo Prefix helps you bootstrap the compiler. It also provides a package manager, so you don't need to manually chase dependencies.</p></div></div></div><hr/><div class='thread'><h1 id='2017-06-21'><a href='/blog/2017/06/21/'>Stack Clashing for Fun and Profit</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2017-07-02'><a href='/blog/2017/07/02/'>Rolling Shutter Simulation in C</a></h1><div class='comment'><div class='author'>Tudor Watson</div><time datetime='2017-07-03T07:08:08Z'>Mon, 03 Jul 2017 07:08:08 UTC</time><div class='body'><p>nice :)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-07-03T10:41:58Z'>Mon, 03 Jul 2017 10:41:58 UTC</time><div class='body'><p>No weight, just me pulling on the string slowly. Though using a weight would have been a good idea.</p></div><div class='comment'><div class='author'>Tudor Watson</div><time datetime='2017-07-03T11:19:48Z'>Mon, 03 Jul 2017 11:19:48 UTC</time><div class='body'><p>I thought that, then rescinded as I think it would accelerate over time right ?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-07-03T11:37:22Z'>Mon, 03 Jul 2017 11:37:22 UTC</time><div class='body'><p>True, but at some point the acceleration would be negated by friction and the speed would become constant. Striking that balance within the available space would be the tricky part.</p></div><div class='comment'><div class='author'>Tudor Watson</div><time datetime='2017-07-03T12:15:56Z'>Mon, 03 Jul 2017 12:15:56 UTC</time><div class='body'><p>I think this will do the job, <a href="https://en.wikipedia.org/wiki/Centrifugal_governor" rel="nofollow noopener" title="https://en.wikipedia.org/wiki/Centrifugal_governor">https://en.wikipedia.org/wi...</a> maybe you can 3d print it to :)</p></div></div></div></div></div></div><div class='comment'><div class='author'>Murielle Bolle</div><time datetime='2017-07-04T06:16:03Z'>Tue, 04 Jul 2017 06:16:03 UTC</time><div class='body'><p>I am using Linux Mint 18.1 and the transparent encode/decode command in the article does not work for me:<br>lavf [error]: could not open input file<br>raw [error]: raw input requires a resolution.<br>x264 [error]: could not open input file `/dev/stdin' via any method!</p><p>but this works:<br>ffmpeg -i input.mp4 -f rawvideo - | x264 --input-res 1080x1080 -o output.mp4 -</p><p>Then adding the C program in the middle produces a segfault which tells me that the file format isn't what's expected...</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-07-04T13:16:49Z'>Tue, 04 Jul 2017 13:16:49 UTC</time><div class='body'><p>The "rawvideo" format is neither PPM nor YUV4MPEG. It's just a raw dump of video data and may not even include the video dimensions or pixel format. This definitely won't work with the provided C program. For decoding, you should use the command I provided in the article so that you specifically get a PPM stream.</p><p>However, it looks like the version of libavformat in Linux Mint 18.1 (libavformat 2.8.11, derived from Ubuntu 16.04) doesn't support PPM input, so you'll need to throw ppmtoy4m (from mjpegtools) in front to first encode it to Y4M. I've added a note to the article about this.</p></div><div class='comment'><div class='author'>Murielle Bolle</div><time datetime='2017-07-04T18:59:30Z'>Tue, 04 Jul 2017 18:59:30 UTC</time><div class='body'><p>Fantastic, works now!</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2017-07-19'><a href='/blog/2017/07/19/'>Integer Overflow into Information Disclosure</a></h1><div class='comment'><div class='author'>possiblywrong</div><time datetime='2017-07-19T20:08:56Z'>Wed, 19 Jul 2017 20:08:56 UTC</time><div class='body'><p>"The frightening takeaway is that this check is very easy to forget." Very interesting post. And the check was indeed apparently easy enough to forget that I wasn't able to find the cause of the problem, even when you put it right under my nose in the article.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-07-19T23:58:10Z'>Wed, 19 Jul 2017 23:58:10 UTC</time><div class='body'><p>Being so easy to miss, I've probably left dozens of unchecked potential integer overflows throughout my C career so far. My primary saving grace is that I've mostly developed for 64-bit platforms, and so all the exploitable arithmetic has been performed as 64-bit integers (size_t), generally beyond the range of untrusted input.</p></div></div></div><div class='comment'><div class='author'>Clément Pit-Claudel</div><time datetime='2017-07-19T23:22:37Z'>Wed, 19 Jul 2017 23:22:37 UTC</time><div class='body'><p>Doesn't the fix introduce a new potential vulnerability? You don't seem to check that nmemb is greater than 0 anywhere, and nmemb seems to be taken directly from the image height (which is attacker-controlled), so there's a risk of dividing by 0, which is undefined behavior.</p><p>IOW, couldn't a malicious user cause your program to run into undefined behavior by crafting a zero-width image and thereby making your safety check divide by 0? (real callocs actually do seem to check that nmemb != 0 — see e.g. <a href="https://code.woboq.org/userspace/glibc/malloc/malloc.c.html#3188)" rel="nofollow noopener" title="https://code.woboq.org/userspace/glibc/malloc/malloc.c.html#3188)">https://code.woboq.org/user...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-07-19T23:43:55Z'>Wed, 19 Jul 2017 23:43:55 UTC</time><div class='body'><p>Whoops, you're exactly right! I neglected to include the first part of the overflow check. I've corrected the article, thanks!</p></div></div></div></div><hr/><div class='thread'><h1 id='2017-07-27'><a href='/blog/2017/07/27/'>Introducing the Pokerware Secure Passphrase Generator</a></h1><div class='comment'><div class='author'>Impossibly Stupid</div><time datetime='2017-07-27T22:21:08Z'>Thu, 27 Jul 2017 22:21:08 UTC</time><div class='body'><p>Minor typo: "Suppose in step 2 you draw King of Hearts (KS" should clearly end with KH.</p><p>Otherwise, I always like seeing things mapped to word lists (I did it for locations on my own blog).  Doing it for cards raises another interesting possibility:  cheating!  With the right tools (or just an astounding memory) two players in cahoots could use plain English to communicate their hand's value.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-07-27T22:35:56Z'>Thu, 27 Jul 2017 22:35:56 UTC</time><div class='body'><p>Good catch, thanks! It's now fixed.</p><p>That's a neat idea about cheating. As you point out, that sure would be quite the memorization job. Reliably memorizing 10 random words from this list for a strong passphrase takes some effort. Memorizing thousands of these words along with their mappings would be a serious undertaking.</p></div><div class='comment'><div class='author'>Impossibly Stupid</div><time datetime='2017-07-28T17:44:09Z'>Fri, 28 Jul 2017 17:44:09 UTC</time><div class='body'><p>Keep in mind, though (and as I note in my discussion about creating a location phrase), once you set out to specifically make a "random" selection more meaningful, you would likely pick different encoding techniques and curate a different word list in order to more efficiently convey the info that matters.  Especially if you want to slip it into the regular banter that might occur during a card game.</p><p>It also helps that dealt order doesn't generally matter for most card games, so you're working with combinations rather than permutations.  And the "garbage" cards in a hand can probably be left out.  Maybe 16 bits of information worth conveying in total.</p></div></div></div></div><div class='comment'><div class='author'>Anon</div><time datetime='2017-07-28T04:39:17Z'>Fri, 28 Jul 2017 04:39:17 UTC</time><div class='body'><p>But why?</p></div></div><div class='comment'><div class='author'>Aaron Toponce</div><time datetime='2017-08-17T13:09:41Z'>Thu, 17 Aug 2017 13:09:41 UTC</time><div class='body'><p>Hmm. Using playing cards as an RNG is an interesting idea. Unfortunately, as an RNG, it's very prone to error, both intrinsic to the deck of cards itself as well as to human error.</p><p>First, you mention on your Github page that six to seven riffle shuffles is sufficient, and you cite <a href="https://possiblywrong.wordpress.com/2011/03/27/card-shuffling-youre-not-done-yet/" rel="nofollow noopener" title="https://possiblywrong.wordpress.com/2011/03/27/card-shuffling-youre-not-done-yet/">https://possiblywrong.wordp...</a> as a reference. However, it turns out that you need to get about 10-12 riffle shuffles before you've maximized the entropy in the deck.</p><p>Brad Mann, a mathematician and Harvard, shows mathematically why you need to get up to 11-12 riffle shuffles before you can say that a deck is thoroughly shuffled enough that each of the 52 cards is fully unpredictable. PDF here: <a href="http://www.dartmouth.edu/~chance/teaching_aids/Mann.pdf" rel="nofollow noopener" title="http://www.dartmouth.edu/~chance/teaching_aids/Mann.pdf">http://www.dartmouth.edu/~c...</a></p><p>An answer on StackExchange also shows that by mimicking a riffle shuffle in software, and calculating the entropy of deck after each shuffle, entropy isn't maximized until about 10-11 riffle shuffles. <a href="https://stats.stackexchange.com/questions/78591/correlation-between-two-decks-of-cards/79552#79552" rel="nofollow noopener" title="https://stats.stackexchange.com/questions/78591/correlation-between-two-decks-of-cards/79552#79552">https://stats.stackexchange...</a></p><p>The problem with riffle shuffling, of course, is that paper-based cards get sticky after heavy use, and cards stick to each other during the riffle shuffle, lowering entropy during each shuffle. High quality plastic cards, like those from Kem or Copag, will not stick together, and thus keep the entropy maximized during each riffle shuffle.</p><p>As a human, you can also help maximize the entropy during each round by doing:</p><p>1. Riffle shuffle<br>2. Cut<br>3. 4-pile shuffle<br>4. Cut</p><p>You would still need to do 10-12 rounds, but at least then you can guarantee that by the end of step 3 in each round, every card has been separated from each other by a distance of 4. The problem with this approach, however, is that it's slow.</p><p>Personally, when I'm playing card games with my friends or family, much to their chagrin, I:</p><p>1. Riffle shuffle<br>2. Cut<br>3. Overhand shuffle<br>4. Cut<br>5. Weave shuffle<br>6. Cut<br>7. 4-Pile shuffle<br>8. Cut</p><p>I'll do this three times, at which point the deck has gone through 12 shuffles and cuts, and I've guaranteed that each card has been separated from the others. The riffle shuffle and overhand shuffles are providing me entropy, while the weave and pile shuffles are deterministic, but guaranteed to be separating cards.</p><p>Aside from execution time (it takes a few minutes), I've never had anyone complain about the deck shuffle during a game of Uno or Go Fish, for example. The deck is sufficiently shuffled, that players aren't seeing repeats of the past game or round, or some combination of it.</p><p>That's why dice are so attractive as an RNG. No shuffling or cutting, and no waiting around. Just throw the dice, and see what falls out. Write down the response, and throw them again. The problem with dice as an RNG, however, is that they can be biased just due to poor manufacturing quality.</p><p>You can purchase precision dice, with either razor edges or floating edges, but they're pricey. Even then, it's difficult to guarantee that the surrounding environment isn't affecting the throw, like an unlevel table. Regardless, they provide less control variables than a deck of playing cards, and are less-likely to exhibit bias in the system.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-08-18T18:01:18Z'>Fri, 18 Aug 2017 18:01:18 UTC</time><div class='body'><p>Thanks for the additional references. I'll have to check them out.</p><p>In this application, the only thing that matters is that an attacker doesn't have sufficient information to take shortcuts in a brute force search. If it is true that 7 riffle shuffles has a slightly uneven result, it won't practically matter unless the attacker has a really solid idea of the original card permutation, and probably also a decent model of your personal shuffling quirks. It's likely the cards were last used to play a game, and therefore the deck started in a nearly shuffled state. An notable exception is solitaire, which leaves the deck sorted at the end of the game.</p><p>Second, only a small amount of entropy (about 5.5% of the total) is drawn from the deck for each word, and additional shuffles are made in between words, introducing even more entropy back into the deck. Even if the first word is drawn from a not quite perfectly shuffled deck, the deck will certainly be thoroughly shuffled for the remaining words.</p></div><div class='comment'><div class='author'>Aaron Toponce</div><time datetime='2017-08-18T18:26:49Z'>Fri, 18 Aug 2017 18:26:49 UTC</time><div class='body'><blockquote>If it is true that 7 riffle shuffles has a slightly uneven result, it won't practically matter unless the attacker has a really solid idea of the original card permutation, and probably also a decent model of your personal shuffling quirks.</blockquote><p></p><p>Playing cards maintain state, so unless you sort them in order, or sufficiently shuffle them, leaving them lying around will reveal that state, and could potentially expose your prior generated passwords.</p><p>Dice do not maintain state, so there is no indication of what past passwords were generated just by examining the dice. You could potentially get one word from the current state the dice are in on the table, but that's as far back as they can take you. Picking them up, and dropping them in a cup would remove that possibility.</p><p></p><blockquote>Even if the first word is drawn from a not quite perfectly shuffled deck, the deck will certainly be thoroughly shuffled for the remaining words.</blockquote><p></p><p>This is a bias that you do not have with fair dice, and why using playing cards as an RNG is less-than-optimal. If you are not re-inserting the cards after every draw, then not every word is equally likely to be generated, and you've introduced a bias into the system.</p><p>Aside from the execution speed, which is horribly slow, you have to deal with these biases, or you weaken your result, as the words are not chosen true randomly. Fair dice are fast and unbiased, of which are extremely difficult to achieve with playing cards.</p><p>It's an interesting idea, but one that doesn't stack up under scrutiny, and is cumbersome enough to prevent the general public from adopting.</p></div><div class='comment'><div class='author'>Penguin Cardsharp</div><time datetime='2018-02-15T21:44:40Z'>Thu, 15 Feb 2018 21:44:40 UTC</time><div class='body'><p>Could you deal with the state issue by washing the cards for a minute before you start generating a passphrase, following the Pokerware procedure, and then washing the cards for another minute after generating a passphrase but before you put them back in the deck box?</p></div></div></div></div></div></div><hr/><div class='thread'><h1 id='2017-08-20'><a href='/blog/2017/08/20/'>A Tutorial on Portable Makefiles</a></h1><div class='comment'><div class='author'>Andrew</div><time datetime='2017-08-20T03:35:40Z'>Sun, 20 Aug 2017 03:35:40 UTC</time><div class='body'><p>Two small nits:</p><p>1. "Fortunately there is, in the form of inteference rules" should be "... inference rules".</p><p>2. "A target is out-of-date if it is older than any of its prerequisites" is ambiguous (English can't make up its mind about distributing comparisons over quantifiers, so this can also be read as saying that the target has to be older than *all* of its prereqs). I would suggest "a target is out of date if any of its prerequisites are newer than it is" for safety.</p></div><div class='comment'><div class='author'>Andrew</div><time datetime='2017-08-20T03:38:52Z'>Sun, 20 Aug 2017 03:38:52 UTC</time><div class='body'><p>Sorry, forgot to say: thanks for a useful article!</p></div></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-08-20T22:18:04Z'>Sun, 20 Aug 2017 22:18:04 UTC</time><div class='body'><p>Thanks for the tips, Andrew! I've corrected the "interference" mistake (how silly of me), but I still prefer my original wording for your second suggestion.</p></div></div></div><div class='comment'><div class='author'>Lucas</div><time datetime='2017-08-20T14:28:38Z'>Sun, 20 Aug 2017 14:28:38 UTC</time><div class='body'><p>First of all, kudos for being one of the few people online that posts about POSIX make, breaking the GNU-makefile tendency that reigns.</p><p>There's a detail about .POSIX and the usage you show: it should be the first non-comment line of the file, and not the first target. Otherwise, the implementation could do whatever it wants to.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-08-20T21:57:54Z'>Sun, 20 Aug 2017 21:57:54 UTC</time><div class='body'><p>Oops, you're right! I got the .POSIX situation mixed up in my head at some point. The article as been corrected. Thanks!</p></div></div></div><div class='comment'><div class='author'>Konstantin</div><time datetime='2017-08-20T19:19:05Z'>Sun, 20 Aug 2017 19:19:05 UTC</time><div class='body'><p>Thank you! Because of your posts I want to write in C again!</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-08-20T22:05:45Z'>Sun, 20 Aug 2017 22:05:45 UTC</time><div class='body'><p>Perfect! My secret plan of writing lots of articles about C and its ecosystem in order to increase its popularity must be working. :-)</p></div></div></div><div class='comment'><div class='author'>agumonkey</div><time datetime='2017-08-20T19:55:06Z'>Sun, 20 Aug 2017 19:55:06 UTC</time><div class='body'><p>You have a talent for explanation. It just flows. And includes Hedberg jokes. What else could we want ..</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-08-20T22:08:08Z'>Sun, 20 Aug 2017 22:08:08 UTC</time><div class='body'><p>Thanks, agumonkey! You being such a long-time reader is a compliment on its own.</p></div></div></div><div class='comment'><div class='author'>Ralph Corderoy</div><time datetime='2017-08-21T11:05:42Z'>Mon, 21 Aug 2017 11:05:42 UTC</time><div class='body'><p>Hi Christopher, The common target for running tests is ‘check’ rather than ‘test’. Cheers, Ralph.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-08-22T01:14:33Z'>Tue, 22 Aug 2017 01:14:33 UTC</time><div class='body'><p>You're right. I've seen both, so I added it to the article in addition to "test".</p></div><div class='comment'><div class='author'>Ralph Corderoy</div><time datetime='2017-08-22T10:18:50Z'>Tue, 22 Aug 2017 10:18:50 UTC</time><div class='body'><p>Thanks. I think ‘check’ is more common, probably because ‘test’ could be the name of a target, especially test(1). <a href="https://www.gnu.org/prep/standards/standards.html#Standard-Targets" rel="nofollow noopener" title="https://www.gnu.org/prep/standards/standards.html#Standard-Targets">https://www.gnu.org/prep/st...</a> says ‘check’ and it's then been popularised by the GNU autotools so ‘./configure &amp;&amp; make all check install’ is common.</p></div></div></div></div><div class='comment'><div class='author'>Joshua Barnett</div><time datetime='2017-08-21T11:15:10Z'>Mon, 21 Aug 2017 11:15:10 UTC</time><div class='body'><p>So when writing a portable make file should you worry about checking and resolving dependencies required in order for your build to run? (a compiler, an architecture, an OS, shared libraries and etc.)</p><p>Should these be resolved out of Make in some prior step to configure the project?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-08-22T01:58:41Z'>Tue, 22 Aug 2017 01:58:41 UTC</time><div class='body'><p>I've had the best results on small and medium projects from doing two things. First, I consider how much I *really* need to rely on some non-standard feature of the compiler, operating system, etc. Most of the time I don't think it's worth the cost. Anything non-standard that can be eliminated is another feature that doesn't need a configure-time / compile-time test.</p><p>A perfect example is byte endian. Rather than test for the architecture endian in order to select an integer parsing implementation, just write clean, architecture-independent code. Modern compilers will figure it out and do the efficient thing anyway (see my "Portable Structure Access with Member Offset Constants" article for a hands-on example).</p><p>Conditionals in Makefiles are nearly always a mess, and it's very difficult to reason about the effects on the build. I've had a lot more success pushing the conditions down into the C preprocessor. Of course there's definitely a wrong way to do this, and you can just as easily end up with the same mess in the preprocessor. Make it a hard rule to *never* use an "#ifdef" within a function body, and avoid testing the same value more than once (e.g. do it all in one place).</p><p>Instead invent an abstracted API, and then use a single, large "#ifdef" to select the appropriate implementation of that API based on the operating system, configuration, etc. There's an example of this in my "OpenMP and pwrite()" article for the write_frame() abstraction. Do it well and the compiler will inline much of it, so that it's no less efficient than the traditional within-function "#ifdef" spaghetti, while still clean and readable.</p><p>If it's a configuration option for the user, have it configured via a documented "-D" option in CFLAGS. For an example of this, see "config.h" in my Enchive project. If the user doesn't explicitly set an option, it gets a default value in "config.h", and the rest of the program can assume it's always set. The user's interface looks like:</p><p>make CFLAGS='-O3 -DMAX_FOO=64'</p><p>This sort of thing composes well with the "-MM" feature for those projects large enough to require automated dependency management. The preprocessor will be doing the same work during dependency discovery.</p><p>I should just write an entire article on this since it's hard to describe it properly here.</p><p>For a large project where the selection of libraries to be linked is configurable (and should even be discovered automatically), this all wouldn't work well. The user would have to coordinate LDLIBS with CFLAGS, which is far too complicated an interface. That's where you *really* need a layer above make to generate a configured Makefile — the "prior step" as you said. I'm a fan of hand-written configure scripts, but something like CMake would be reasonable, too. (I just hate Autoconf.) This layer would also run the "-MM" stuff.</p></div></div></div><div class='comment'><div class='author'>int19h</div><time datetime='2017-08-22T00:28:14Z'>Tue, 22 Aug 2017 00:28:14 UTC</time><div class='body'><p>Wouldn't "del /q" be the equivalent to "rm -f" on Windows?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-08-22T01:11:54Z'>Tue, 22 Aug 2017 01:11:54 UTC</time><div class='body'><p>Hmm, I thought there was something about "del /q" that didn't work quite right, but I can't remember what that would have been. It complains when the files to be deleted don't exist, but that fact doesn't change the errorlevel and therefore doesn't communicate a failure to make. Maybe that's the part that threw me off. So, except for the pointless error message from del — which can be silenced with a stderr redirection — I guess it's essentially the same as "rm -f". Thanks for pointing that out!</p></div></div></div><div class='comment'><div class='author'>Vincent Picaud</div><time datetime='2017-08-22T11:17:47Z'>Tue, 22 Aug 2017 11:17:47 UTC</time><div class='body'><p>As usual high quality posts... Thanks for sharing.</p></div></div><div class='comment'><div class='author'>James Wright</div><time datetime='2017-09-05T02:17:04Z'>Tue, 05 Sep 2017 02:17:04 UTC</time><div class='body'><p>To avoid having the wrong make run you makefile they should be named GNUMakefile or BSDMakefile</p></div></div><div class='comment'><div class='author'>Adam Chambost</div><time datetime='2017-10-11T07:23:12Z'>Wed, 11 Oct 2017 07:23:12 UTC</time><div class='body'><p>Fantastic article Chris!</p><p>Your paragraph "Out-of-source builds" touches on an area of makefiles where I've yet to find a solution that is simple, concise, DRY, and portable.</p><p>The question I have for you is whether you think "immediate evaluation syntax" (::= or :=) is standard POSIX syntax.</p><p>Having read and re-read the 2016 Edition of the standard you link to [1], I'm fairly convinced the answer is "no, this syntax is (not yet) in the POSIX standard".</p><p>Yet, in an old article by David A. Wheeler [2], where he links to the POSIX author's (the Austin Group) discussion forum [3], with the claim that "I am happy to report that the POSIX committee accepted this proposal and has added support for immediate evaluation." The discussion timestamps are from 2011 and the article from 2014.</p><p>The only conclusion I can make from these three documents is that while this was proposed and positively received back then, it ultimately never made it into the 2016 Edition of the standard.</p><p>Does this sound right to you? What are your thoughts on "immediate evaluation"?</p><p>I run my makefile against GNU and BSD make variants and both seem to support it (at least the := version, ::= seems to be problematic if I recall correctly). Personally I'm tending to adopt a custom POSIX+ImmediateEvaluation standard for my own Portable makefiles. In theory this may make them non-standard, but in practice it does not seem to impact their portability in all known test cases available to me. (The only portability concern I am aware of is that := is incompatible with SunOS make).</p><p>This discussion relates to my own "Out-of-source builds" solution. If you would like me to post very concise makefile examples with and without immediate evaluation that models this solution please let me know and I can provide them.</p><p>[1] <a href="http://pubs.opengroup.org/onlinepubs/9699919799/utilities/make.html" rel="nofollow noopener" title="http://pubs.opengroup.org/onlinepubs/9699919799/utilities/make.html">http://pubs.opengroup.org/o...</a><br>[2] <a href="https://www.dwheeler.com/essays/make.html" rel="nofollow noopener" title="https://www.dwheeler.com/essays/make.html">https://www.dwheeler.com/es...</a><br>[3] <a href="http://austingroupbugs.net/view.php?id=330" rel="nofollow noopener" title="http://austingroupbugs.net/view.php?id=330">http://austingroupbugs.net/...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-10-11T21:17:52Z'>Wed, 11 Oct 2017 21:17:52 UTC</time><div class='body'><p>Thanks, Adam. Yeah, I _really_ wish inference rules were just a little more capable so that they could cover out-of-source builds. Regarding your final sentence, where would you post these Makefiles? Have you written an article about this? I'm interested in seeing how you approach portable out-of-source builds.</p><p>That's a good question about immediate evaluation. I'm also not seeing it anywhere in the Open Group document. Adding another source to your list, the GNU Make manual claims it was standardized by POSIX in 2012. Yeah, I agree that it seems to have not actually made it into the standard in yet.</p><p>The are two implementations I know about that don't support immediate evaluation with "::=". One is Microsoft's nmake — but that's got a bunch of bigger issues anyway. The other is Solaris / OmniOS, which is probably what you've seen with SunOS. I like to test stuff on OmniOS since it's the "wierdest" unix available to me. (It's funny that being closer to the original unix actually makes it look less like unix since I'm so accustomed to Linux and BSD.)</p><p>So while not yet formally standardized, as you noticed it seems like a fairly safe bet, especially since it's likely be standardized eventually. In practice it's very portable, and that's what ultimately counts. You're not tying yourself to GNU Make by using it.</p></div></div></div><div class='comment'><div class='author'>Yannick Duchêne</div><time datetime='2018-10-19T13:09:57Z'>Fri, 19 Oct 2018 13:09:57 UTC</time><div class='body'><p>About `rm -rf` on Windows: MS-DOS has the `deltree /y` command.</p></div></div><div class='comment'><div class='author'>Lifepillar</div><time datetime='2019-07-05T07:14:17Z'>Fri, 05 Jul 2019 07:14:17 UTC</time><div class='body'><p>&gt;When talking about files in subdirectories, just include the subdirectory in the name.</p><p>According to the standard: “Applications shall select target names from the set of characters consisting solely of periods, underscores, digits, and alphabetics from the portable character set […]”. It doesn't mention slashes. So I wonder: are paths in targets POSIX compliant?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-07-11T20:29:52Z'>Thu, 11 Jul 2019 20:29:52 UTC</time><div class='body'><p>Good observation! I hadn't noticed that. I suppose that does mean using a path as a target isn't compliant. That's a really unfortunate detail in the spec since it means only recursive Makfiles can build subdirectory targets. Though, fortunately, every implementation I've ever seen supports slashes in targets.</p></div><div class='comment'><div class='author'>Lifepillar</div><time datetime='2019-07-11T20:44:46Z'>Thu, 11 Jul 2019 20:44:46 UTC</time><div class='body'><p>I find that quite surprising, as inference rules apparently do support paths (there are 'D' and 'F' modifiers for internal macros). It looks like an unnecessary restriction to me.</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2017-08-22'><a href='/blog/2017/08/22/'>Vim vs. Emacs: The Working Directory</a></h1><div class='comment'><div class='author'>deathbullet</div><time datetime='2017-08-22T07:41:55Z'>Tue, 22 Aug 2017 07:41:55 UTC</time><div class='body'><p>Where else being aware of "project root" be useful? I think with time, it is losing its relevance</p></div><div class='comment'><div class='author'>Jan Ciger</div><time datetime='2017-08-22T11:25:59Z'>Tue, 22 Aug 2017 11:25:59 UTC</time><div class='body'><p>Many places - e.g. search, revision control, debugging, etc.</p><p>However, a much better solution than these hacks is to use something like Projectile and cpputils-cmake to set up your environment. Then you don't need to bother with it - Projectile will correctly find the root of your project and a lot of tools integrate with it automatically.</p></div></div></div><div class='comment'><div class='author'>Clément Pit-Claudel</div><time datetime='2017-08-22T10:06:01Z'>Tue, 22 Aug 2017 10:06:01 UTC</time><div class='body'><p>I use the following instead:</p><p></p><pre><code><br>(defun ~/compile ()<br>  "Same as `compile', with bells and whistles.<br>Add -C if command is make and a Makefile can be found, and always<br>run in comint mode. Written by Clément Pit-Claudel."<br>  (interactive)<br>  (let* ((command (eval compile-command))<br>         (makefile-dir (locate-dominating-file default-directory "Makefile"))<br>         (is-default-dir (or (null makefile-dir)<br>                             (string= (expand-file-name default-directory)<br>                                      (expand-file-name makefile-dir)))))<br>    (when (string-match "make \\(?:-C \\([^'\" ]+\\|\"[^\"]+\"\\|'[^']+'\\)\\)?" command)<br>      (setq command (replace-match (if (not is-default-dir)<br>                                       (format "make -C %S -j8 " makefile-dir)<br>                                     "make -j8 ")<br>                                   nil t command)))<br>    (let ((current-prefix-arg (cons 4 nil))<br>          (compile-command command))<br>      (call-interactively #'compile))))<br></code></pre><p></p><p>The difference is that it doesn't change the working directory: instead, it gives make an appropriate -C argument (it also adds -j8, for convenience, and it runs compilation in shell mode to facilitate interaction)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-08-23T19:41:20Z'>Wed, 23 Aug 2017 19:41:20 UTC</time><div class='body'><p>If you want to automatically choose the proper value for -j, I have an article about finding the number of processor cores in Emacs across different operating systems: <a href="http://nullprogram.com/blog/2015/10/14/" rel="nofollow noopener" title="http://nullprogram.com/blog/2015/10/14/">http://nullprogram.com/blog...</a></p></div></div></div><div class='comment'><div class='author'>jonEbird</div><time datetime='2017-08-22T13:36:23Z'>Tue, 22 Aug 2017 13:36:23 UTC</time><div class='body'><p>If you haven't already checked out projectile[1], do it. There is a nice function `(projectile-project-root)` that works to find the root of your particular project for many project types. That is what I use to set `default-directory` in a let statement.</p><p>[1]: <a href="https://github.com/bbatsov/projectile" rel="nofollow noopener" title="https://github.com/bbatsov/projectile">https://github.com/bbatsov/...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-08-23T19:35:23Z'>Wed, 23 Aug 2017 19:35:23 UTC</time><div class='body'><p>I actually had the Projectile repository open in my browser while writing the article, but I ultimately didn't mention it since I've never actually gotten around to using it. As I understand it, it really is solving the same problem in a really smart way.</p></div></div></div><div class='comment'><div class='author'>Nick F</div><time datetime='2017-08-22T15:17:25Z'>Tue, 22 Aug 2017 15:17:25 UTC</time><div class='body'><p>Great comparison of the trade offs that each editor makes. I love the insight, hope to see more posts like this.</p></div></div><div class='comment'><div class='author'>VanLaser</div><time datetime='2017-08-22T16:01:00Z'>Tue, 22 Aug 2017 16:01:00 UTC</time><div class='body'><p>Interesting comparison (and I did find that automatic path change annoying when moving from Vim to Emacs). I wonder if a solution would be to use either `locate-dominating-file` or `projectile-project-root` (or both, if the 2nd fails, use 1st) with a "new buffer" hook to setup the `default-directory` local buffer variable?</p></div><div class='comment'><div class='author'>jonEbird</div><time datetime='2017-08-22T17:08:23Z'>Tue, 22 Aug 2017 17:08:23 UTC</time><div class='body'><p>I personally would just use (projectile-project-root) and configure it to support any special cases I might have with my projects. Easier path for maintainability, I'd think.</p></div></div></div><div class='comment'><div class='author'>Oleksandr Gavenko</div><time datetime='2018-07-11T09:55:00Z'>Wed, 11 Jul 2018 09:55:00 UTC</time><div class='body'><p>I've written "mymake", that looks directories up for build.xml, Makefile, build.gradle etc and run corresponding build tool. I have (setq compile-command "mymake ") and In order to move to error I need to do M-x cd sometimes...</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-07-11T19:20:07Z'>Wed, 11 Jul 2018 19:20:07 UTC</time><div class='body'><p>Looks like we've ended up on similar solutions. I've got an "smake" (search make?) script to do the same thing as your "mymake", though mine just looks for a Makefile:</p><p><a href="https://github.com/skeeto/dotfiles/blob/master/bin/smake" rel="nofollow noopener" title="https://github.com/skeeto/dotfiles/blob/master/bin/smake">https://github.com/skeeto/d...</a></p></div></div></div></div><hr/><div class='thread'><h1 id='2017-09-01'><a href='/blog/2017/09/01/'>Ten Years of Blogging</a></h1><div class='comment'><div class='author'>Vincent Bernat</div><time datetime='2017-09-01T06:02:11Z'>Fri, 01 Sep 2017 06:02:11 UTC</time><div class='body'><p>Thanks for your blog!</p><p>I liked the part on the impact of technical blogging. The figures may miss some visitors like me, using the RSS feed and/or using an adblocker preventing Google Analytics to work.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-09-02T02:01:45Z'>Sat, 02 Sep 2017 02:01:45 UTC</time><div class='body'><p>I completely block Google Analytics, too. Since that's easy to do, I don't feel too bad about using it here. For feed analytics there's Feedburner, but I hate pretty much everything about Feedburner.</p></div></div></div><div class='comment'><div class='author'>deathbullet</div><time datetime='2017-09-01T08:29:51Z'>Fri, 01 Sep 2017 08:29:51 UTC</time><div class='body'><p>Thank you for the blog! (and for elfeed which I use to read the blog!)<br>This is my favorite place after <a href="http://lwn.net" rel="nofollow noopener" title="lwn.net">lwn.net</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-09-02T02:18:11Z'>Sat, 02 Sep 2017 02:18:11 UTC</time><div class='body'><p>Elfeed primarily exists to scratch my own itch, but the secondary reason is that I _really_ want syndication feeds to continue being popular. They're vital to a properly decentralized internet. Some of the huge platforms (Facebook, Twitter, Google+) that can afford to operate as walled gardens either don't support feeds or eventually stopped supporting feeds, but the vast majority of sites publishing content are still expected to provide either RSS or Atom feeds, and I want to keep it that way.</p></div><div class='comment'><div class='author'>NoonianAtall</div><time datetime='2018-09-04T07:07:01Z'>Tue, 04 Sep 2018 07:07:01 UTC</time><div class='body'><p>The more I put into customizing Elfeed, the more I enjoy it.  Thank you very much for making and supporting it!</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-09-04T23:50:14Z'>Tue, 04 Sep 2018 23:50:14 UTC</time><div class='body'><p>You're welcome! And thank you for all your efforts within the Emacs community, too, Adam.</p></div></div></div></div></div><div class='comment'><div class='author'>compunaut</div><time datetime='2017-09-01T09:17:00Z'>Fri, 01 Sep 2017 09:17:00 UTC</time><div class='body'><p>I learned a lot reading your blog! Somehow I read this post and thought: What if he stops blogging and this is some kind of goodbye message? Thankfully not! I will follow your future posts as I did in the past and I'm quite happy that your are planning to continue blogging for such a long time!</p><p>A thankful reader.</p></div></div><div class='comment'><div class='author'>Klaus</div><time datetime='2017-09-01T09:37:42Z'>Fri, 01 Sep 2017 09:37:42 UTC</time><div class='body'><p>Isn't this discussing mixing up the concepts of "magazines" and "journals"? (Though I had to lookup how the terms are formally used, to even find the right words for the distinction, so please bear with me if the choice of words is bad.)</p><p>Your articles are interesting even for non-specialists like me (physicist with some education in computer science + private interest), but they are typically not fulfilling the novelty criteria expected of academic journals.</p><p>Additionally, formal publications are expected to be subject to long-term archiving. For scientific publications, it is desirable for original sources to be still available in a century; In physics I had several cases where I had to dig up original publications from the 1930s, and routinely reference original sources from the 1960s. A friend working in paleontology routinely works with sources from the 19th century, as far as I understood. On such time scales, a blog cannot be reliably kept available.</p><p>I would however agree, that journals should incorporate some aspects of blogs; Then "open xxx" things are mostly doable without dropping the advantages of journals, though there is probably a lot of conflict-of-interest stuff going on in that regard.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-09-02T03:08:00Z'>Sat, 02 Sep 2017 03:08:00 UTC</time><div class='body'><p>I'm still new to the journal/magazine thing, so I could indeed be mixing them up. You're right that my content here isn't the same as what you'd find in a journal, but content that _would_ normally be published in a journal could be published in blog form with only some minor structural changes for the different format.</p><p>For example, suppose the ROP paper I linked — which did go through the whole journalistic peer review process — had been published across, say, a three-part blog posts here. It would have gotten a lot more exposure and at least an order of magnitude more people would have read it, on top of the other benefits I mentioned. Unfortunately since blogs aren't taken seriously, it would never be cited by anyone following the traditional route, only by other bloggers. That's a cultural issue rather than an issue inherent with blogs.</p><p>I've seen the archive argument before, and that is a really good point. Lots of stuff disappears from the internet every day, and links go dead far too often. I've probably got hundreds of dead links throughout my older articles, and the only place left to access the original content is on the Internet Archive, if they happened to catch it.</p><p>This is where open access on par with open source really pays off. Since my entire blog is in a git repository, it's ready to clone at a moment's notice. The content here has really good prospects for longevity. This is very much like open source software. While important websites to occasionally disappear without any sort of backups, it's basically unheard of for an open source project to disappear from the internet. Open source software with at least a handful of users is archived many different places, such as by various OS distributions.</p><p>While journals are good at archiving articles, they're absolutely terrible at archiving data. It basically doesn't happen. That's why so many researchers have to scrape data from graphs/plots. Even for recently published articles, most of the time it's not possible to get the data (they almost never even respond to my emails). If scientific publishing followed the open source blogging model, the article and the associated scripts and data would be archived together as a single unit. Massive datasets (hundreds of GBs or more) still present a problem, though.</p><p>I agree with your last point. Authors don't have to switch to blogging if journals were to become a lot more like blogs. :-)</p></div></div></div><div class='comment'><div class='author'>Impossibly Stupid</div><time datetime='2017-09-01T14:59:53Z'>Fri, 01 Sep 2017 14:59:53 UTC</time><div class='body'><blockquote>URLs work better when they include human-meaningful context. Ideally I should be able to look at any one of my URLs and know what it’s about.</blockquote><p></p><p>On this matter, you could do what I did to maintain backwards compatibility for my own blog: add a meaningful query string to clarify things.  For most server side processing, it'll just be ignored if it isn't being used.  For example:</p><p><a href="https://www.impossiblystupid.com/node/208/?content=blog-redesign" rel="nofollow noopener" title="https://www.impossiblystupid.com/node/208/?content=blog-redesign">What’s All This, Then?</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-09-02T02:08:05Z'>Sat, 02 Sep 2017 02:08:05 UTC</time><div class='body'><p>That's an interesting idea with the query string. I'll have to consider it.</p><p>One problem is that it's technically a different URL regardless if the server here happens to respond the same way. Other sites (reddit, etc.) can't know this and will treat the query URLs as if they were different articles than the query-less ones. On the other hand, fragments don't truly constitute a fundamentally different URL, so maybe that's a better way to do it.</p></div><div class='comment'><div class='author'>Vincent Bernat</div><time datetime='2017-09-02T09:41:07Z'>Sat, 02 Sep 2017 09:41:07 UTC</time><div class='body'><p>You can use <code>link rel="canonical"</code> to workaround that. However, I don't know if reddit would understand it. Google does.</p></div></div><div class='comment'><div class='author'>Impossibly Stupid</div><time datetime='2017-09-03T21:19:29Z'>Sun, 03 Sep 2017 21:19:29 UTC</time><div class='body'><p>Keep in mind, though, that the fragment is something that the browser may act on by default.  There probably won't be much chance of collision with element id's for the particular case of acting as a stand in for the page title, but the query string is more flexible for all kinds of other things (especially if you <i>do</i> want to do some JavaScript processing on the client side).</p><p>I guess it all comes down to who you want to annotate it for.  I do it mainly to remind myself of what I'm linking to, and secondarily to give people an idea of what they're clicking through to.  Deduplication isn't a big priority for me; I just never publish the URL without the query string.</p></div></div></div></div><div class='comment'><div class='author'>Kaushal Modi</div><time datetime='2017-09-09T13:14:55Z'>Sat, 09 Sep 2017 13:14:55 UTC</time><div class='body'><blockquote>URLs are forever, and I don’t want to break all my old links. Consistency is better than any sort of correction.</blockquote><p></p><p>I use Hugo (<a href="http://gohugo.io" rel="nofollow noopener" title="gohugo.io">gohugo.io</a>) as my static site generator. It has a feature called <a href="https://gohugo.io/content-management/urls/#aliases" rel="nofollow noopener" title="https://gohugo.io/content-management/urls/#aliases">Aliases</a> that allows setting multiple links (aliases) to point to the same post, and this can be easily scripted too. I won't be surprised if other static site generators support this too.</p><p>And keep your blog posts coming! They are very informational, whether they appeal me (post on writing your own minor mode) or not (recent post on campaign against multiple cursors) :)</p></div></div><div class='comment'><div class='author'>NoonianAtall</div><time datetime='2018-09-04T07:06:06Z'>Tue, 04 Sep 2018 07:06:06 UTC</time><div class='body'><p>Well, gee, Chris, I was about to say, "Thanks, and keep up the great work!" but then you went and PROMISED to keep doing it for another DECADE.  So what do I need to be nice for?  :)</p></div></div></div><hr/><div class='thread'><h1 id='2017-09-07'><a href='/blog/2017/09/07/'>Gap Buffers Are Not Optimized for Multiple Cursors</a></h1><div class='comment'><div class='author'>Theldoria</div><time datetime='2017-09-07T09:52:25Z'>Thu, 07 Sep 2017 09:52:25 UTC</time><div class='body'><p>It would be nice to have the ability of multiple-cursors to insert <br>multiple cursors (I often use by lines, by same word/symbol and manually<br> setting), record a macro for the work to do and apply the macro to all <br>cursor positions.</p><p>This, of course, can easily be done with first recording the macro, setting multiple cursors and applying them with C-x e.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-09-07T12:15:42Z'>Thu, 07 Sep 2017 12:15:42 UTC</time><div class='body'><p>The typical way to handle this is to end the macro with a search (or just movement) to the next position, allowing you to repeat the macro N times in a row without any intervention. If the movement will fail properly after the last position, then you can safely overestimate N and the macro will stop firing when it's run out of things to do.</p></div></div></div><div class='comment'><div class='author'>Aankhen</div><time datetime='2017-09-07T11:21:00Z'>Thu, 07 Sep 2017 11:21:00 UTC</time><div class='body'><p>Do you work with a lot of large files? I never find Emacs to be the bottleneck in any sort of editing, whether using multiple cursors or not, but I also don’t work with a lot of large files, so perhaps that’s why our experience is different.</p><p>For what it’s worth, I normally use multiple cursors as an alternative to regexp search &amp; replace that lets me think less.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-09-07T12:22:13Z'>Thu, 07 Sep 2017 12:22:13 UTC</time><div class='body'><p>I occasionally use macros to uniformly modify large files with complex enough transforms that the other options either aren't viable (unix text utilities) or would take a lot longer (writing a script). For instance, when I made my r/Showerthoughts fortune file:</p><p><a href="http://nullprogram.com/blog/2016/12/01/" rel="nofollow noopener" title="http://nullprogram.com/blog/2016/12/01/">http://nullprogram.com/blog...</a></p><p>Ultimately I did end up writing some Elisp since I was expecting to process more of the same data in the future, but I initially did the work with a macro. Processing those 10,000 entries takes Emacs several minutes, and that's in the gap-buffer-efficient script/macro form. It would have been infeasible to do interactively with multiple cursors.</p></div><div class='comment'><div class='author'>Aankhen</div><time datetime='2017-09-08T05:33:51Z'>Fri, 08 Sep 2017 05:33:51 UTC</time><div class='body'><p>I see, that’s interesting. Thanks for the example.</p></div></div></div></div><div class='comment'><div class='author'>Mike Zamansky</div><time datetime='2017-09-07T12:09:10Z'>Thu, 07 Sep 2017 12:09:10 UTC</time><div class='body'><p>This is great!!! Now I can just point people here when I try to explain why I don't use multiple cursors much if at all</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-09-07T12:26:46Z'>Thu, 07 Sep 2017 12:26:46 UTC</time><div class='body'><p>The "You don’t need more than one cursor in vim" article I linked has been the article I've shared in the past when making this argument. That one probably works better for Vim folks since gap buffer argument doesn't apply to them.</p></div></div></div><div class='comment'><div class='author'>Mike F</div><time datetime='2017-09-07T13:05:39Z'>Thu, 07 Sep 2017 13:05:39 UTC</time><div class='body'><p>Good to see some commentary in the direction of less is more.  You don't need a 100,000 piece mechanics tool kit to do most home repairs.  Most of the time a screwdriver, hammer, and pair of pliers will do.  In the same way many of the Emacs add on packages (no names) can be over complicated (complicated to learn, use, maintain) for what is typically needed to develop code.  Maybe the principal of diminishing returns is here somewhere.</p><p>Many of the same packages are very interesting and fantastic accomplishments by smart and generous people, to whom I am grateful to for showing is what is possible, for sharing their work freely, and sometimes personally supporting my use of their work for free.</p><p>Emacs user (elisp hacker) since 2011.</p></div></div><div class='comment'><div class='author'>Alex V Koval</div><time datetime='2017-09-07T18:52:21Z'>Thu, 07 Sep 2017 18:52:21 UTC</time><div class='body'><p>I've got your points about efficiency, but in real life only a small fraction of real situations are CPU intensive, and in real life visual picture is what users need. With multiple cursors you can get immediate feedback on screen, and so it is better because of that.</p></div></div><div class='comment'><div class='author'>agumonkey</div><time datetime='2017-09-08T13:08:01Z'>Fri, 08 Sep 2017 13:08:01 UTC</time><div class='body'><p>I like multiple cursors a lot, even though I agree it meshes badly with gap buffers and has UI flaws. But I'd love for more ideas around the concept to pop off.</p></div></div><div class='comment'><div class='author'>Reificator</div><time datetime='2017-09-08T13:13:34Z'>Fri, 08 Sep 2017 13:13:34 UTC</time><div class='body'><p>Implementation A is obviously superior because Editor B uses it internally.  Feature C does not mesh well with Implementation A, and therefore you should not use it.</p><p>Is that an accurate summary of this article?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-09-08T13:40:23Z'>Fri, 08 Sep 2017 13:40:23 UTC</time><div class='body'><p>I didn't say gap buffers were "obviously superior" but that, despite being dead simple, they've been perfectly sufficient for 30 years, especially when used with long-established editing paradigms. However, multiple cursors—a relatively recent invention—interacts poorly with gap buffers, making this young feature even less valuable than it already is.</p></div><div class='comment'><div class='author'>Reificator</div><time datetime='2017-09-08T14:15:28Z'>Fri, 08 Sep 2017 14:15:28 UTC</time><div class='body'><p>Fair enough, that phrase was unfair on my part.</p><p>Still, an up and coming feature that some users seem to enjoy not meshing well with a particular implementation disproves the idea that the implementation is perfectly sufficient.</p><p>I take no issue with the rest of the article, as I don't have a lot of experience with macro based workflows, and I've seen people be quite effective with them.</p><p>But to start the article by saying that this implementation is perfectly sufficient, as a segway into why you shouldn't use a feature that it doesn't handle well seems to me like putting the cart before the horse.</p></div></div></div></div><div class='comment'><div class='author'>AreaMan</div><time datetime='2017-09-08T13:35:05Z'>Fri, 08 Sep 2017 13:35:05 UTC</time><div class='body'><p>We can write a program (a macro) to process the data more efficiently. But writing and testing and documenting the program take time too. I find that after running a macro I need to inspect each spot visually and often run a diff of before and after. Mistakes from letting macros run without inspection are no excuse for introducing bugs into source code.</p><p>Or we can use the new tools to get the same work done with less human effort. I might still need to inspect and diff the source code. But the simpler original task should reduce the incidence and effect of subtle macro bugs.</p><p>Longer running editor tasks will eventually provide sufficient psychological pressure on a coder somewhere to crack open a text on algorithms and data structures and figure out a new implementation that works better than gap buffers.  Eventually the additional human effort will reduce the cost in both human and computer terms, if properly amortized over the many programmers using the improved editors.</p><p>Machines should work for us. We should not work too much for machines.</p><p>Besides, computer hardware is astonishingly cheap.</p></div></div><div class='comment'><div class='author'>Stu</div><time datetime='2017-09-08T22:07:02Z'>Fri, 08 Sep 2017 22:07:02 UTC</time><div class='body'><p>Interesting - it sounds like the underlying editor should be built on multiple cursors.   This all seems to be side effects of multiple cursors being bolted on after the fact.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-09-08T22:19:39Z'>Fri, 08 Sep 2017 22:19:39 UTC</time><div class='body'><p>Exactly!</p></div></div><div class='comment'><div class='author'>Evgeny Panasyuk</div><time datetime='2017-09-09T15:56:35Z'>Sat, 09 Sep 2017 15:56:35 UTC</time><div class='body'><p>1) Only one small part of underlying editor<br>2) With today's memory throughput (RAM: order of 10 GiB/s for single core; Cache <br>order of 100 GiB/s) - sequential multi-tossing of typical several MiB gap <br>buffers is not a bottleneck. It could be a bottleneck only for very large files.</p></div><div class='comment'><div class='author'>Stu</div><time datetime='2017-09-09T16:57:06Z'>Sat, 09 Sep 2017 16:57:06 UTC</time><div class='body'><p>This may be true, however having an architecture based on multiple cursors from the very bottom could well open up different paradigms further up the stack, so could be interesting nonetheless.</p></div><div class='comment'><div class='author'>Evgeny Panasyuk</div><time datetime='2017-09-10T12:55:30Z'>Sun, 10 Sep 2017 12:55:30 UTC</time><div class='body'><p>Yes, having them in mind from the begin would result in better treatment of edge cases. This is also true for many other features Emacs has.</p><p>Nonetheless, current implementation of multiple-cursors is pretty usable, and does provide practical advantages over keyboard macros in range of use-cases. Yes, there is some overlap, but each of them also has unique advantages.<br>And by the way, there is also some overlap with visual-regexp.el - and this is OK, I use vr/* too.</p></div></div></div></div></div><div class='comment'><div class='author'>Evgeny Panasyuk</div><time datetime='2017-09-09T15:31:44Z'>Sat, 09 Sep 2017 15:31:44 UTC</time><div class='body'><p>I use both - multiple cursors and keyboard macros. It is not only esthetic difference, but practical as well.</p><p>For multiple cursors you have instant feedback on multiple edge cases, and more importantly - you can undo and fix mistake immediately. While with keyboard macros you have to either: redo all from scratch or edit macro as text or execute stepwise editing - and none of them is as convenient as instant multi-undo-fix.<br>Moreover, for multiple cursors phases of places selection and actual editing are distinctly separated, while with keyboard macros you are doing both movement and editing in single iteration, and it is possible to catch interference between place-movement and editing-movement</p><p>On another hand, keyboard macros are very powerful.<br>They are not limited to "for each" workflow - steps of iterations can sequentially depend one on another.<br>They are also not limited to "edit/manipulate multiple places" workflow. With them you can jump between buffers/windows/frames, For instance I used this to emulate "debug step into" in source files based on extraction of file:line from trace log output in separate buffer.</p><p>Regarding performance - with Emacs I am usually working with source files, which are not big, and taking into account today's memory throughput (RAM: order of 10 GiB/s for single core; Cache order of 100 GiB/s) - sequential multi-tossing of several MiB gap buffers is not a bottleneck. Even if it would be real bottleneck - that means that bottleneck should be fixed, but not abandonment of multiple cursors. (for instance it can be fixed by switching to other data structure - multi-gap, rope, etc or maybe postpone execution for out-of-screen cursors).<br>That being said, I have to admit that in some cases Emacs is not fast in doing movements, editing, maybe it is related to complexity of some of major modes or maybe some other under-the-hood stuff - and this affects both keyboard macros and multiple cursors. And here, what really matters performance-wise - is that with keyboard macros you can fire-and-drink-coffee batch execution, while with multiple cursors you have to suffer multiplied latency for each single step. But multiple cursors are so connivent, that I am ready to pay occasional price of switching to keyboard macros or even to shell-command-on-region.</p><p>I understand, it can be appealing to stick to single tool and single approach, but what I observed from my experience - it is counterproductive to artificially limit yourself to single tool, and trying to find contrived excuse for not using other which is more appropriate for particular problem.<br>I do use and even combine Linux and Windows; statically typed and dynamically typed languages; scoped-based lifetime and garbage collection, Emacs and Vim.<br>I do use and even combine keyboard macros and multiple cursors.</p></div></div></div><hr/><div class='thread'><h1 id='2017-09-15'><a href='/blog/2017/09/15/'>Blowpipe: a Blowfish-encrypted, Authenticated Pipe</a></h1><div class='comment'><div class='author'>possiblywrong</div><time datetime='2017-09-18T19:03:55Z'>Mon, 18 Sep 2017 19:03:55 UTC</time><div class='body'><p>"In CTR mode, blowfish_decrypt() is never called." If I understand this correctly, does this mean decryption is just re-applying the same encryption transformation-- the same sequence of XOR operations, with the same initialization, same incrementing counter, etc.?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-09-19T15:15:01Z'>Tue, 19 Sep 2017 15:15:01 UTC</time><div class='body'><p>Yup, exactly right. CTR mode turns a block cipher into a stream cipher, which itself is a simulation of a one-time pad. Or another way to think about it is that it turns a block cipher into a CSPRNG. It almost seems wasteful to throw away literally half the block cipher algorithm!</p></div></div></div></div><hr/><div class='thread'><h1 id='2017-09-21'><a href='/blog/2017/09/21/'>Finding the Best 64-bit Simulation PRNG</a></h1><div class='comment'><div class='author'>Lugus</div><time datetime='2017-09-22T16:58:29Z'>Fri, 22 Sep 2017 16:58:29 UTC</time><div class='body'><p>Just a typo, you write "Generic algorithms" but I think you mean "Genetic algorithm".</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-09-22T18:18:44Z'>Fri, 22 Sep 2017 18:18:44 UTC</time><div class='body'><p>Oops, thanks! You're right. It's fixed now.</p></div></div></div><div class='comment'><div class='author'>possiblywrong</div><time datetime='2017-09-23T23:21:05Z'>Sat, 23 Sep 2017 23:21:05 UTC</time><div class='body'><p>It would be interesting to see how xorshift1024* fares next to these others in your analysis; I'm not sure I agree with the xoroshiro128+ authors that "it [xoroshiro128+] is acceptable only for applications with a mild amount of parallelism" (I wouldn't call stepping on a 2^64 period, with a fast jump mode, "mild parallelism"). It seems fine at least for the Monte Carlo applications I typically encounter, and it seems more convenient than Mersenne Twister particularly in its ease of supporting parallel streams, which is quite a bit more awkward and less "standardized" in Twister.</p><p>Also curious that the speed difference between xoroshiro128+ and MT is so much greater here than in similar analysis referenced by the authors <a href="https://www.cocoawithlove.com/blog/2016/05/19/random-numbers.html" rel="nofollow noopener" title="https://www.cocoawithlove.com/blog/2016/05/19/random-numbers.html">here</a>. It's Mac and Swift instead of Linux and C, but the actual speed numbers seem otherwise pretty comparable.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-09-24T03:28:10Z'>Sun, 24 Sep 2017 03:28:10 UTC</time><div class='body'><p>I just added xorshift1024* to the shootout. On the same machine and setup, I've measured it at 5620 MB/s (GCC) and 4090 MB/s (Clang). That puts it in third place for GCC and 5th place for Clang (behind both PCGs). It got 5 WEAK results and 0 FAILED.</p><p>I've completely ignored xorshift1024* in the past because of its large, heterogeneous state, and because it's cumbersome to seed. I figured I might as well use MT if I was actually considering xorshift1024*. However, it _is_ faster than I expected.</p><p>The speed difference between MT and xoroshiro128+ may be due to my aggressive unrolling and inlining. I can't find any code for their benchmark other than snippets in their paper, let alone see how they built it. Perhaps they put their PRNGs in separate compilation units, so they never got inlined. That would add function call overheard to each and reduce the disparity.</p><p>It also depends a lot on the hardware. On an old Core 2 Duo (a 2009 laptop), all three xorshift, xoroshiro128+, and both PCGs run at essentially baseline speed in my shootout. MT is still only 1/3 the speed of xoroshiro128+.</p><p>Just to add some of my own wild speculating: MT's main generation algorithm has lots of dependencies between steps. Each shift+AND depends on the results of the previous shift+AND. That makes it harder to exploit the deeper and wider pipelines of more recent CPUs. In xoroshiro128+, s0 and s1 are loaded from the PRNG state and used more independently. Those operations can be re-ordered and even executed on different ports in parallel, especially when unrolled.</p></div></div></div><div class='comment'><div class='author'>Aaron Toponce</div><time datetime='2018-07-22T15:44:57Z'>Sun, 22 Jul 2018 15:44:57 UTC</time><div class='body'><p>You should try Threefish-1024. That gives you 16 concecutive non-overlapping 64-bits, and it operates about 8 cpb where Blowfish is around 20 cpb. I'm guessing it'll be a serious competitor in your shootout, although memorising the algorithm may not be feasible.</p></div></div><div class='comment'><div class='author'>Pelle Evensen</div><time datetime='2018-08-15T19:30:31Z'>Wed, 15 Aug 2018 19:30:31 UTC</time><div class='body'><p>If you have the same configuration available, it would be interesting to see what timings you'd get for my mixing function when used as a PRNG.<br>It's a relative of SplitMix but with much better behaviour w.r.t. sparse increments:<br><a href="http://mostlymangling.blogspot.com/2018/07/on-mixing-functions-in-fast-splittable.html#conclusion" rel="nofollow noopener" title="http://mostlymangling.blogspot.com/2018/07/on-mixing-functions-in-fast-splittable.html#conclusion">http://mostlymangling.blogs...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-08-17T18:18:39Z'>Fri, 17 Aug 2018 18:18:39 UTC</time><div class='body'><p>I added rrmxmx() as a PRNG in the rrmxmx branch of the shootout repository. I randomly generated and hardcoded a gamma, though the specific value doesn't matter for benchmark purposes.</p><p>Using an identical setup as before, I'm getting 7100 MB/s, which is about 93% of the speed of splitmix64() (added after I wrote my article, so it's not in the table). That's about what I'd expect considering rrmxmx() replaces a shift with two rotates and an XOR (e.g. a net addition two bitwise operations).</p><p>As I write this I'm also running it against dieharder just for completeness, but I'm not expecting to see any issues.</p></div><div class='comment'><div class='author'>Pelle Evensen</div><time datetime='2018-08-17T19:16:13Z'>Fri, 17 Aug 2018 19:16:13 UTC</time><div class='body'><p>I have exposed it to BigCrush of TestU01 (with a gamma of 1, multiple starting points) as well as PractRand, which it does fail after 2^44 bytes with a gamma of 1. As soon as the gamma gets less sparse (2 bits seems to be enough), it passes BigCrush and PractRand.</p><p>It might be of interest to note that SplitMix with sparse gammas fails BigCrush quite miserably. PractRand even more so. Sadly, when Steele et al tested SplitMix, they used the floating point interface of TestU01 which is quite flattering,  if one expects to eventually use *all* the output bits.</p><p>I have a slightly different construction that (on my machine) is 5% faster than rrmxmx but which I yet have to put under the same scrutiny. More on that to follow. I am still pursuing a mixing function that passes PractRand with 1-bit gammas as well as traversal in gray code order. rrmxmx gets close but is not enitrely there.</p></div></div></div></div><div class='comment'><div class='author'>Jorge Fuentes González</div><time datetime='2018-12-21T04:55:51Z'>Fri, 21 Dec 2018 04:55:51 UTC</time><div class='body'><p><a href="http://www.pcg-random.org/posts/a-quick-look-at-xoshiro256.html" rel="nofollow noopener" title="http://www.pcg-random.org/posts/a-quick-look-at-xoshiro256.html">http://www.pcg-random.org/p...</a></p></div></div><div class='comment'><div class='author'>Elliot</div><time datetime='2019-11-23T21:51:16Z'>Sat, 23 Nov 2019 21:51:16 UTC</time><div class='body'><p>Blowfish is secure but slow. How about another block cipher? If it's good enough for military secrets, it's certainly good enough for a userspace PRNG.</p><p>AES-128 is extremely fast in hardware, and otherwise you have e.g. ChaCha20 and Speck. Speck has a shorter implementation than xorshift, and will absolutely beat the snot out of it regardless of any NSA backdoors. Furthermore, it can have an arbitrarily small or large state.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-11-24T21:26:02Z'>Sun, 24 Nov 2019 21:26:02 UTC</time><div class='body'><p>My focus here was on simple, portable C code, but at one point I did compare AES-NI (CTR) with xoshiro256**: <a href="https://redd.it/ahbs47" rel="nofollow noopener" title="https://redd.it/ahbs47">https://redd.it/ahbs47</a> The result was that AES-NI was ~50% slower than xoshiro256**. Considering that the quality is excellent, that's reasonably competitive.</p><p>Since I have my own software implementation of Speck128/128, I just added a "speck" branch to see how it competes. It's not competitive at all at the full 32 rounds: an order of magnitude slower (600 MB/s). Cutting to 8 rounds helps a lot (2400 MB/s), but it's still trailing behind: 3x slower than xoshiro256**. At 4 rounds it fails statistical tests.</p><p>I also just pushed a "chacha" branch with ChaCha8, and even at 8 rounds its also not meaningfully competitive (800 MB/s) with xoshiro256**.</p></div></div></div><div class='comment'><div class='author'>Dr. Strangelove</div><time datetime='2020-01-02T01:23:47Z'>Thu, 02 Jan 2020 01:23:47 UTC</time><div class='body'><p>Great blog post! Thank you for sharing the code for the shootout too, I was itching to try it out with a few less known PRNGs! I cloned it down today and had no major problems getting it to run (except some MinGW-shenanigans when using SIGALRM). Nice "final" choice btw, xoshiro256** is a great PRNG. I have seen some discussion in Julia and rust-lang, and it seems that there is a big chance we might be getting xoshiro in some form in both language standard libraries. Also, something cool:</p><p>I was thinking xoshiro256++ would be a great target for vectorization, and it seems I wasn't the only one that thought so: <a href="https://github.com/JuliaLang/julia/issues/27614" rel="nofollow noopener" title="https://github.com/JuliaLang/julia/issues/27614">https://github.com/JuliaLan...</a>, someone has already created a vectorized version of it. Performance is very good, and the assembly it spits out reads almost like poetry (on both gcc and clang). I implemented it for your test suite too, and comparing it to standard xoshiro gives me around 200% better performance numbers (~5000 MB/s vs almost 10000 MB/s on my testing system).</p><p><code>static void<br>xoshiro8x256pp(uint64_t s[4][8], uint64_t* r)<br>{<br>uint64_t x[8]; uint64_t t[8]; // Optimized for 8-way AVX/SSE instructions.<br><br>for (int i = 0; i &lt; 8; ++i) x[i] = s[0][i] + s[3][i];<br>for (int i = 0; i &lt; 8; ++i) r[i] = ((x[i] &lt;&lt; 23) | (x[i] &gt;&gt; 41)) + s[0][i];<br>for (int i = 0; i &lt; 8; ++i) t[i] = s[1][i] &lt;&lt; 17;<br><br>for (int i = 0; i &lt; 8; ++i) s[2][i] ^= s[0][i];<br>for (int i = 0; i &lt; 8; ++i) s[3][i] ^= s[1][i];<br>for (int i = 0; i &lt; 8; ++i) s[1][i] ^= s[2][i];<br>for (int i = 0; i &lt; 8; ++i) s[0][i] ^= s[3][i];<br>for (int i = 0; i &lt; 8; ++i) s[2][i] ^= t[i];<br><br>for (int i = 0; i &lt; 8; ++i) s[3][i]  = (s[3][i] &lt;&lt; 45) | (s[3][i] &gt;&gt; 19);<br>}</code></p><p>I had to tweak the DEFINE_BENCH definition to consume eight uint64_t, but other than that, it was very straightforward to integrate into your shootout test suite. Some compilers are a bit stingy when vectorizing the loops of the code above (so take a peek at the assembly). I would recommend you pass in the "-ftree-vectorize" flag in GCC so that it does the right thing. For me 8-way vectorization gave me the best results (I assume this depends on your CPU architecture, so play around with that one).</p></div></div></div><hr/><div class='thread'><h1 id='2017-10-06'><a href='/blog/2017/10/06/'>A Branchless UTF-8 Decoder</a></h1><div class='comment'><div class='author'>Andrew</div><time datetime='2017-10-07T08:02:40Z'>Sat, 07 Oct 2017 08:02:40 UTC</time><div class='body'><p>The self-synchronizing feature of UTF-8 isn't only good for error-recovery — it also means that functions like "strstr" work on UTF-8 without modification. As long as the needle and haystack are both valid UTF-8, strstr can't accidentally find the right sequence of bytes with the wrong alignment. It also can't fail to find the thing it's looking for because the prohibition on overlong forms guarantees a unique representation for each codepoint.</p><p>Of course, if you want "[LATIN CAPITAL LETTER A WITH ACUTE]" to match "[LATIN CAPITAL LETTER A][COMBINING ACUTE ACCENT]" and vice versa, you have to bust out the normalizer.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-10-07T13:34:51Z'>Sat, 07 Oct 2017 13:34:51 UTC</time><div class='body'><p>You're right. Since substring search is much more important than error recovery, I've updated the article to mention this. Thanks!</p></div></div></div><div class='comment'><div class='author'>James Dunne</div><time datetime='2017-10-07T19:41:44Z'>Sat, 07 Oct 2017 19:41:44 UTC</time><div class='body'><p>Have you considered taking this optimization into SIMD territory? SIMD code can often benefit from branchless algorithms. You could probably dscode 4 groups of 4 characters simultaneously.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-10-08T03:08:13Z'>Sun, 08 Oct 2017 03:08:13 UTC</time><div class='body'><p>That's an interesting idea to explore in the future.</p></div></div><div class='comment'><div class='author'>Bryan Donlan</div><time datetime='2017-10-09T06:31:35Z'>Mon, 09 Oct 2017 06:31:35 UTC</time><div class='body'><p>I was inspired by this article to give this a shot myself: <a href="https://github.com/bdonlan/branchless-utf8/commit/3802d3b0e10ea16810dd40f8116243971ff7603d" rel="nofollow noopener" title="https://github.com/bdonlan/branchless-utf8/commit/3802d3b0e10ea16810dd40f8116243971ff7603d">https://github.com/bdonlan/...</a> (see also the PEXT-based non-vector implementation in the previous commit)</p><p>There's probably still room for optimization - I'm doing a lot of loads of constant vectors for various utility masks and shuffle tables. It's interesting to note though that depending on CPU microarchitecture this approach can either be modestly faster than the non-vector implementation, or _very_ slow.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-10-09T23:50:34Z'>Mon, 09 Oct 2017 23:50:34 UTC</time><div class='body'><p>Wow, nice work! That's impressive. And nice job commenting your assembly, too. I'm surprised how much the performance differs across microarchitectures.</p></div></div></div><div class='comment'><div class='author'>Martin Dürst</div><time datetime='2017-10-09T08:18:41Z'>Mon, 09 Oct 2017 08:18:41 UTC</time><div class='body'><p>Regarding SIMD, please make sure you check out the work of Robert D. Cameron (<a href="https://www.sfu.ca/computing/people/faculty/robertdcameron.html)" rel="nofollow noopener" title="https://www.sfu.ca/computing/people/faculty/robertdcameron.html)">https://www.sfu.ca/computin...</a>. He gave some very interesting talk including UTF-8 handling with SIMD at one (actually two) of the last Internationalization and Unicode Conferences.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-10-09T23:05:45Z'>Mon, 09 Oct 2017 23:05:45 UTC</time><div class='body'><p>Thanks for the heads up!</p></div></div></div></div><div class='comment'><div class='author'>Tmr</div><time datetime='2017-10-07T20:28:02Z'>Sat, 07 Oct 2017 20:28:02 UTC</time><div class='body'><p>This is pretty neat, but as you note, it's just a mental exercise.  I've been spending the past week profiling and optimizing some big data processing pipelines, and UTF-8 encoding/decoding is never the bottleneck.  You could make it 100x faster, and I would never notice.</p><p>It would be cool if you could somehow apply this obsessiveness to some software that needs it.  There's lots of software out there that really needs it.  ;-)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-10-08T03:07:37Z'>Sun, 08 Oct 2017 03:07:37 UTC</time><div class='body'><p>Yup, I'd be surprised if UTF-8 was ever a bottleneck in practice. Especially a strict, error-checking version.</p><p>However, I _can_ imagine a situation where a text editor might have a giant buffer of UTF-8 text in memory and needs to traverse or operate on a large contiguous section of it. On the other hand, it's likely the buffer is assumed to be in a valid state and better shortcuts are available.</p></div></div></div><div class='comment'><div class='author'>Guy Shaw</div><time datetime='2017-10-08T06:43:43Z'>Sun, 08 Oct 2017 06:43:43 UTC</time><div class='body'><p>On modern architectures memory references are expensive.  Many optimization techniques that involve table lookup that were great advice in the 1960s, 1970s, and 1980s -- such as table lookup for trig functions -- are now pretty much obsolete.  Changing some or all of the table look ups with calculations, or small tables in registers could speed things up considerably.  Also, not all if-then-else decisions coded in C lead to branches.  Even on x86 hardware, some simple decisions can generate conditional moves, instead of branches.  And modern architectures can do much more with predication and nullification.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-10-08T17:42:52Z'>Sun, 08 Oct 2017 17:42:52 UTC</time><div class='body'><p>These things are all true. Originally a few of those tables where computed values (shiftc and shifte in particular), but error checking became an annoying edge case that complicated the expressions (len=0), so I just switched to tables.</p></div></div></div><div class='comment'><div class='author'>sneakyruds</div><time datetime='2017-10-08T15:53:03Z'>Sun, 08 Oct 2017 15:53:03 UTC</time><div class='body'><p>I wonder if you can avoid "precomputing" next by declaring s and/or len as const?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-10-08T17:38:57Z'>Sun, 08 Oct 2017 17:38:57 UTC</time><div class='body'><p>Pointer to const never helps the optimizer because it's not strong enough to prove anything useful. Const values can occasionally help the optimizer, such as when pointers to const objects escape. But generally const values don't improve performance either. I wrote an article on this topic last year: <a href="http://nullprogram.com/blog/2016/07/25/" rel="nofollow noopener" title="http://nullprogram.com/blog/2016/07/25/">http://nullprogram.com/blog...</a></p></div></div></div><div class='comment'><div class='author'>Impossibly Stupid</div><time datetime='2017-10-08T20:14:02Z'>Sun, 08 Oct 2017 20:14:02 UTC</time><div class='body'><p>First, a typo: "to made" probably should be "to make".<br>Second, Rosetta Code lacks any sort C implementation, so you might consider making your version available there:</p><p><a href="http://rosettacode.org/wiki/UTF-8_encode_and_decode" rel="nofollow noopener" title="http://rosettacode.org/wiki/UTF-8_encode_and_decode">http://rosettacode.org/wiki...</a></p><p>It was also interesting to hear that <code>!len</code> was a costly operation.  On a whim I replaced it with <code>(len==0)</code> and saw an overall benchmark improvement of 1.4%.  Exercise for the reader to compare if/how the assembly code differs for your preferred compiler.</p><p>And finally, your benchmark has a bug in that the random characters it fills the buffer with can be longer than the remaining space.  My fix was to just stop short:</p><p><code><br>char *end = p + z - 4;<br></code></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-10-08T20:45:41Z'>Sun, 08 Oct 2017 20:45:41 UTC</time><div class='body'><p>Thanks for the heads up about those two mistakes. I fixed the typo in the article and added your fix to the benchmark. At some point I think I did have a "- 4" in there to deal with the overflow, but it got lost at some point (prior to committing anything).</p></div></div></div><div class='comment'><div class='author'>Michael</div><time datetime='2017-10-09T05:44:48Z'>Mon, 09 Oct 2017 05:44:48 UTC</time><div class='body'><p>Given that only the most-significant four bits are significant (you can dispense with the 0 in 11110 for a 3-byte encoded value), can you go faster if you ROT 4 instead of ROT 3? Or is it absolutely identical?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-10-09T23:30:20Z'>Mon, 09 Oct 2017 23:30:20 UTC</time><div class='body'><p>Some architectures can only shift 1 bit at a time, and so there could be an advantage to using smaller shifts. On x86, all the static shifts are equal (as far as I know), so it would only help to make the lengths table shorter.</p><p>However, that 5th bit _is_ important for error checking since it must be 0 for 4-byte sequences (11110xxx). For example, byte values 0xF5 through 0xFF never appear in a UTF-8 stream.</p></div></div></div><div class='comment'><div class='author'>Martin Dürst</div><time datetime='2017-10-09T08:02:23Z'>Mon, 09 Oct 2017 08:02:23 UTC</time><div class='body'><p>Interesting exercise, great writeup. However:</p><p>"the<br>caller must zero-pad the buffer to at least four bytes"<br>This is a pretty strong restriction, as it makes it impossible to integrate this directly into any existing library. One would have to write special copies e.g. of strcpy and friends. Removing the restriction that all bytes are null-padded may be possible, but that would not help with the danger that we hit a segment boundary (-&gt;segmentation fault). The problem could be fixed by making the indices depend on len, but that would make everything slower.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-10-09T23:22:37Z'>Mon, 09 Oct 2017 23:22:37 UTC</time><div class='body'><p>Yup, I fully admit the interface is rather inconvenient! Even if this did turn out to be dramatically faster, the padding rule would still cause hesitation about choosing it.</p></div></div></div><div class='comment'><div class='author'>Martin Dürst</div><time datetime='2017-10-09T08:15:10Z'>Mon, 09 Oct 2017 08:15:10 UTC</time><div class='body'><p>One additional comment:</p><p>"Adding that !len is actually somewhat costly, though I couldn’t figure out why."<br>Well, !len is a hidded 'len==0'. And C-level comparison operation operations traditionally don't have directly compatible machine-level instructions. The average instruction set uses a 'compare' instruction to set some flags inside the CPU, and then some conditional jumps. So !len may well hide some branching!</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-10-09T23:18:40Z'>Mon, 09 Oct 2017 23:18:40 UTC</time><div class='body'><p>Both GCC and Clang do use comparison instructions but consume the result from the flags register with a branchless SETcc (which is what I was counting on). I imagine other architectures would have to implemented this as a branch, though.</p></div></div></div><div class='comment'><div class='author'>Vincent Bernat</div><time datetime='2017-10-09T09:29:59Z'>Mon, 09 Oct 2017 09:29:59 UTC</time><div class='body'><p>What about <code>unlikely()</code> (translated to GCC's <code>__builtin_expect()</code>)? Are they translated to something sensible to the processor or is it just help for the compiler? This would seem to be a good use case for error handling.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-10-09T23:04:48Z'>Mon, 09 Oct 2017 23:04:48 UTC</time><div class='body'><p>On x86 there used to be branch prefixes to provide additional static prediction hints to the CPU. As far as I know, on x86 it now only affects the compiler's instruction scheduling. You're right about it potentially being useful to indicate that errors are not expected, or that most code points are only one byte long, though I doubt it would have a significant effect.</p></div><div class='comment'><div class='author'>David Zmick</div><time datetime='2017-10-15T03:13:55Z'>Sun, 15 Oct 2017 03:13:55 UTC</time><div class='body'><p>this is correct, the compiler hints only are hints for the compiler. This is stated in the intel optimization guide :)</p></div></div></div></div><div class='comment'><div class='author'>Marcus2012</div><time datetime='2017-12-04T20:01:21Z'>Mon, 04 Dec 2017 20:01:21 UTC</time><div class='body'><p>What about Emojis? the U.S. flag emoji for example is composed of 2 code points, with no zero width joiner between them.</p><p>That requires a table lookup as far as I can tell, and it's the reason I haven't tried writing my own UTF8 decoder.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-12-04T22:53:30Z'>Mon, 04 Dec 2017 22:53:30 UTC</time><div class='body'><p>I don't know about that particular emoji, but that sounds just like a combining character, which is perfectly normal for Unicode. Dealing with those is not the UTF-8 decoder's job, which is merely to decode a sequence of code points. It's up to the renderer, or whoever is consuming those code points, to resolve combining characters into grapheme clusters and such. That's the complicated part of Unicode.</p></div><div class='comment'><div class='author'>Marcus2012</div><time datetime='2017-12-11T07:56:32Z'>Mon, 11 Dec 2017 07:56:32 UTC</time><div class='body'><p>It's not a combining character, the UTF32 codepoint is U+1F1FA for the U and  U+1F1F8 for the S.</p><p>the whole flag is: U+1F1FA U+1F1F8</p><p>aka 🇺🇸</p><p>Feel free to look it over in a hex editor if you're confused.</p><p>in UTF8 it's: 0xF09F87BA 0xF09F87B8</p><p>Anyway, I was wrong, it doesn't take a table lookup, I didn't understand how UTF8 encoded the literal Unicode code point when I wrote that last comment.</p><p>and since I'm not writing a GUI it doesn't matter to me how it's parsed out, all I care about are code units and code points.</p></div></div></div></div><div class='comment'><div class='author'>Quinten Lansu</div><time datetime='2018-01-09T10:02:40Z'>Tue, 09 Jan 2018 10:02:40 UTC</time><div class='body'><p>Very interesting! The decoder I wrote for utf8rewind does use branches:</p><p><a href="https://bitbucket.org/knight666/utf8rewind/src/fcd81acd336d0bc25e9c47ddb959c90a41ecf51a/source/internal/codepoint.c?at=default&amp;fileviewer=file-view-default#codepoint.c-161" rel="nofollow noopener" title="https://bitbucket.org/knight666/utf8rewind/src/fcd81acd336d0bc25e9c47ddb959c90a41ecf51a/source/internal/codepoint.c?at=default&amp;fileviewer=file-view-default#codepoint.c-161">https://bitbucket.org/knigh...</a></p><p>The reason for this is edge cases like overlong sequences and not enough input data. The only problem with your decoder I can see is that you do not write U+FFFD on incorrect sequences. You can find all test cases I have here:</p><p><a href="https://bitbucket.org/knight666/utf8rewind/src/fcd81acd336d0bc25e9c47ddb959c90a41ecf51a/source/tests/suite-codepoint-read.cpp?at=default&amp;fileviewer=file-view-default" rel="nofollow noopener" title="https://bitbucket.org/knight666/utf8rewind/src/fcd81acd336d0bc25e9c47ddb959c90a41ecf51a/source/tests/suite-codepoint-read.cpp?at=default&amp;fileviewer=file-view-default">https://bitbucket.org/knigh...</a></p><p>Overall, very nice example of branchless code!</p><p>If you want a tougher challenge, see if you can optimize code point composition for normalization. ;)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-01-09T22:42:11Z'>Tue, 09 Jan 2018 22:42:11 UTC</time><div class='body'><p>Thanks! As for U+FFFD, I think that's just out of scope for a plain UTF-8 decoder. The proper way to respond to an invalid byte sequence depends on the caller's needs. The caller may prefer to abort the decoding operation entirely — particularly in a security-sensitive context — rather than use a replacement character. Having the decoder silently emit a replacement character removes that control: It would be ambiguous whether the original stream had that character or if it was the result of a bad sequence.</p></div></div></div></div><hr/><div class='thread'><h1 id='2017-10-27'><a href='/blog/2017/10/27/'>Make Flet Great Again</a></h1><div class='comment'><div class='author'>NoonianAtall</div><time datetime='2017-10-28T08:17:27Z'>Sat, 28 Oct 2017 08:17:27 UTC</time><div class='body'><p>I wish you had written this article a year ago, would have saved me a bit of time.  ;)</p><p>Seriously, though, I can recommend Nic Ferrier's noflet package.  It works very well and adds some handy features, like being able to access the original function definition.  I use it in some unit testing, works great.</p></div><div class='comment'><div class='author'>Phil</div><time datetime='2017-10-28T12:10:52Z'>Sat, 28 Oct 2017 12:10:52 UTC</time><div class='body'><p><a href="http://endlessparentheses.com/understanding-letf-and-how-it-replaces-flet.html" rel="nofollow noopener" title="http://endlessparentheses.com/understanding-letf-and-how-it-replaces-flet.html">http://endlessparentheses.c...</a> would have saved you a bit of time :)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-10-30T17:02:12Z'>Mon, 30 Oct 2017 17:02:12 UTC</time><div class='body'><p>Thanks for the link. I had no idea Artur Malabarba wrote about this already. I usually avoid writing about topics that have already been covered elsewhere.</p></div><div class='comment'><div class='author'>Phil</div><time datetime='2017-11-10T05:38:10Z'>Fri, 10 Nov 2017 05:38:10 UTC</time><div class='body'><p>FWIW I'm glad you did write this, as the explanation about byte-complied opcodes vs flet/advice was new to me, and definitely useful to know.</p></div></div></div></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-10-30T17:04:20Z'>Mon, 30 Oct 2017 17:04:20 UTC</time><div class='body'><p>I've had a trivial bugfix PR open on noflet for over two years, so I've basically given up on it.</p></div></div></div><div class='comment'><div class='author'>Raimon Grau</div><time datetime='2017-10-30T12:04:55Z'>Mon, 30 Oct 2017 12:04:55 UTC</time><div class='body'><p>That's a great trick to emulate the effect of dynamic scope for mocking.</p><p>I guess problems arise if you use any kind of multithreading as #'symbol-function deals with a globally unique symbol table, but well... at least it's something :)</p><p>If anyone wants to turn that into a mocking library, here's a CL function with a similar approach where one can take ideas from <a href="https://github.com/Ferada/cl-mock" rel="nofollow noopener" title="https://github.com/Ferada/cl-mock">https://github.com/Ferada/c...</a> .</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-10-30T17:09:50Z'>Mon, 30 Oct 2017 17:09:50 UTC</time><div class='body'><p>Yeah, good observation. That's one the big issues of adding threads to Emacs, even if those threads aren't preemptive. Even the coroutine-like accept-process-output can run into trouble with these temporary global bindings.</p></div></div></div></div><hr/><div class='thread'><h1 id='2017-11-03'><a href='/blog/2017/11/03/'>Render Multimedia in Pure C</a></h1><div class='comment'><div class='author'>possiblywrong</div><time datetime='2017-11-04T14:18:39Z'>Sat, 04 Nov 2017 14:18:39 UTC</time><div class='body'><p>Very cool. And definitely radix sort for the aesthetic win.</p><p>The image describing the envelope tapering the amplitude of each tone looks like a parabola, but the code suggests a 6-th order envelope (comparison <a href="https://imgur.com/hi0Loex" rel="nofollow noopener" title="https://imgur.com/hi0Loex">here</a>), which I imagine sounds even cleaner?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-11-06T00:27:22Z'>Mon, 06 Nov 2017 00:27:22 UTC</time><div class='body'><p>I actually like the radix sort in the original w0rthy video better. It's downright frightening. I was unable to match the effect with my own implementation.</p><p>Good eye spotting the parabola discrepancy. I'm not surprised it's you that noticed! I made my plot in a hurry and got sloppy. Mind if I steal yours to replace it?</p><p>Why 6th order? It's the result of experimentation. 2nd and 4th order were still leaving some artifacts. They went away with 6, so I stopped.</p></div></div></div><div class='comment'><div class='author'>Vincenzo La Spesa</div><time datetime='2017-12-26T13:46:43Z'>Tue, 26 Dec 2017 13:46:43 UTC</time><div class='body'><p>I see that, in the end, you didn't use Frei0r (i came  from here <a href="https://stackoverflow.com/questions/44997614/is-there-a-way-to-use-external-filters-in-ffmpeg" rel="nofollow noopener" title="https://stackoverflow.com/questions/44997614/is-there-a-way-to-use-external-filters-in-ffmpeg">https://stackoverflow.com/q...</a> )</p><p>In your opinion, is there a specific reason why Ffmpeg doesn't allow to load external filter? security reason maybe?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-12-29T01:11:31Z'>Fri, 29 Dec 2017 01:11:31 UTC</time><div class='body'><p>Thanks for the info. I didn't know about Frei0r, so I'll have to check it out. What I still like about my PPM technique is that I can also interface with other tools in the middle, like ImageMagick.</p><p>Purely speculation since I've never looked into it, but I think you're right about security. Video data is generally untrusted (i.e. it's from the internet), so it must be handled very carefully. An external filter could have flaws that may allow ffmpeg to be exploited by carefully crafted video data.</p></div></div></div><div class='comment'><div class='author'>Ciro Santilli</div><time datetime='2018-06-24T06:43:29Z'>Sun, 24 Jun 2018 06:43:29 UTC</time><div class='body'><p>Here is a minimal C FFmpeg example that synthesizes video directly from buffers, without intermediate PPMs: <a href="https://stackoverflow.com/questions/12831761/how-to-resize-a-picture-using-ffmpegs-sws-scale/36487785#36487785" rel="nofollow noopener" title="https://stackoverflow.com/questions/12831761/how-to-resize-a-picture-using-ffmpegs-sws-scale/36487785#36487785">https://stackoverflow.com/q...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-06-24T19:34:36Z'>Sun, 24 Jun 2018 19:34:36 UTC</time><div class='body'><p>Interesting, thanks for the link!</p></div></div></div></div><hr/><div class='thread'><h1 id='2017-11-30'><a href='/blog/2017/11/30/'>Initial Evaluation of the Windows Subsystem for Linux</a></h1><div class='comment'><div class='author'>Ionel Cristian Mărieș</div><time datetime='2017-12-01T11:57:27Z'>Fri, 01 Dec 2017 11:57:27 UTC</time><div class='body'><p>Note that Xming hasn't made a public release for 10 years. Use this instead: <a href="https://sourceforge.net/projects/vcxsrv/files/" rel="nofollow noopener" title="https://sourceforge.net/projects/vcxsrv/files/">https://sourceforge.net/pro...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-12-01T14:53:06Z'>Fri, 01 Dec 2017 14:53:06 UTC</time><div class='body'><p>Thanks for the tip! It's literally been about that long since I've run an X server on Windows, so I haven't kept up with developments.</p></div></div></div><div class='comment'><div class='author'>J. Ryan Stinnett</div><time datetime='2017-12-04T21:59:09Z'>Mon, 04 Dec 2017 21:59:09 UTC</time><div class='body'><p>As of Windows 10 Fall Creator's Update (shipped on 2017-10-17), you no longer need to enable developer mode to use WSL.</p><p><a href="https://blogs.msdn.microsoft.com/commandline/2017/10/11/whats-new-in-wsl-in-windows-10-fall-creators-update/" rel="nofollow noopener" title="https://blogs.msdn.microsoft.com/commandline/2017/10/11/whats-new-in-wsl-in-windows-10-fall-creators-update/">https://blogs.msdn.microsof...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2017-12-04T22:47:29Z'>Mon, 04 Dec 2017 22:47:29 UTC</time><div class='body'><p>Thanks for the heads up! I've modified the article.</p></div></div></div><div class='comment'><div class='author'>Szabolcs Szasz</div><time datetime='2017-12-20T17:47:55Z'>Wed, 20 Dec 2017 17:47:55 UTC</time><div class='body'><p>Chris, for the poor fs performance, FYI:</p><p>"Interoperability with Windows</p><p>... DrvFs [the WSL component that lets you access your normal Windows drives or shares] does not store any [metadata]. Instead, all inode attributes are derived from information used in NT, by querying file attributes, effective permissions, and other information.</p><p>*DrvFs also disables directory entry caching* to ensure it always presents the correct, up-to-date information even if a Windows process has modified the contents of a directory. As such, there is no restriction on what Windows processes can do with the files while DrvFs is operating on them."</p><p>(<a href="https://blogs.msdn.microsoft.com/wsl/2016/06/15/wsl-file-system-support/)" rel="nofollow noopener" title="https://blogs.msdn.microsoft.com/wsl/2016/06/15/wsl-file-system-support/)">https://blogs.msdn.microsof...</a></p></div></div></div><hr/><div class='thread'><h1 id='2017-12-14'><a href='/blog/2017/12/14/'>What&#39;s in an Emacs Lambda</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2018-01-17'><a href='/blog/2018/01/17/'>Debugging Emacs or: How I Learned to Stop Worrying and Love DTrace</a></h1><div class='comment'><div class='author'>NoonianAtall</div><time datetime='2018-01-18T03:46:17Z'>Thu, 18 Jan 2018 03:46:17 UTC</time><div class='body'><p>Thanks for the writeup, Chris.  A couple of thoughts:</p><p>1.  I'd like to cite this as an example of why apparently unreproducible bug reports should not be closed.  Sometimes old bug reports linger a long time before things fall into place and they are finally solved--but if the bug report had been closed, it would likely have fallen by the wayside (unless someone else reported it, which would have duplicated effort and wasted time).  Patience is the key.  Obviously you know this, and some projects get it (e.g. Debian), but a lot of other software projects don't (e.g. Ubuntu).</p><p>2.  Partly inspired by #1, I encourage you to go ahead and report this to the Emacs bug tracker.  As you know, the Emacs devs are really smart, and they might have ideas for how to reproduce it, or they might have puzzle pieces floating around in their heads that might fall into place.  If not, the bug already being reported might save a future reporter some time and help solve the bug by keeping evidence together.</p><p>Thanks very much for your work on Elfeed!</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-01-19T01:37:30Z'>Fri, 19 Jan 2018 01:37:30 UTC</time><div class='body'><p>Yup, I agree on point #1. Though often these bugs sit around so long they end up becoming irrelevant before they get fixed, due to something being rewritten or some component being swapped out. As for #2, I really do intend to report it, but I'd like to spend some more time narrowing things down. Since it's not urgent, I'd prefer a more complete report later than an incomplete report now.</p><p>Thanks!</p></div></div><div class='comment'><div class='author'>Noam Postavsky</div><time datetime='2018-04-02T23:53:03Z'>Mon, 02 Apr 2018 23:53:03 UTC</time><div class='body'><p>&gt; but if the bug report had been closed, it would likely have fallen by <br>the wayside (unless someone else reported it, which would have <br>duplicated effort and wasted time).</p><p>Hmm, but even if a bug is left open, it'll be hard to find in the huge pile of open bugs, so probably someone else will report it and duplicate the effort anyway.</p></div></div></div><div class='comment'><div class='author'>smitty</div><time datetime='2018-01-18T15:34:31Z'>Thu, 18 Jan 2018 15:34:31 UTC</time><div class='body'><p>&gt;I mostly program in Vim these days</p><p>Have you availed yourself of <a href="http://spacemacs.org/" rel="nofollow noopener" title="http://spacemacs.org/">http://spacemacs.org/</a> ?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-01-19T01:55:26Z'>Fri, 19 Jan 2018 01:55:26 UTC</time><div class='body'><p>Spacemacs doesn't interest me since I prefer to fully manage my own configuration, but I *have* been using Evil for about 10 months now. Evil is by far the best Vim clone I've seen in any editing environment. When I'm testing a package in an unconfigured Emacs, I turn on Viper since I've lost all my old Emacs muscle memory, but I wouldn't want to use Viper long term.</p><p>So, thanks to Evil, I still do some editing in Emacs, including all of my Emacs Lisp programming. It would be silly to do that in Vim. More importantly, Smartparens (and previously Paredit) is just too good to pass up for an s-expression language. However, Evil is sometimes a bit flaky, getting stuck in weird states or just not being Vim enough in some situations. And, by no fault of its own, it's ultimately a stranger in a strange land, with a jarring to switch from an Evil buffer to a plain old Emacs buffer (due to major mode conflicts with Evil). If I can do something comfortably in Vim, then I just do it in Vim.</p></div></div></div><div class='comment'><div class='author'>xiongtx</div><time datetime='2018-01-19T05:39:12Z'>Fri, 19 Jan 2018 05:39:12 UTC</time><div class='body'><p>The Emacs Lisp manual is actually pretty explicit about this:</p><p>&gt; If available, ptys are usually preferable for processes visible to the user, as in Shell mode, because they allow for job control (C-c, C-z, etc.) between the process and its children, and because interactive programs treat ptys as terminal devices, whereas pipes don't support these features.</p><p>&gt; However, for subprocesses used by Lisp programs for internal purposes, it is often better to use a pipe, because pipes are more efficient, and because they are immune to stray character injections that ptys introduce for large (around 500 byte) messages.</p><p><a href="https://www.gnu.org/software/emacs/manual/html_node/elisp/Asynchronous-Processes.html#Asynchronous-Processes" rel="nofollow noopener" title="https://www.gnu.org/software/emacs/manual/html_node/elisp/Asynchronous-Processes.html#Asynchronous-Processes">https://www.gnu.org/softwar...</a></p></div></div><div class='comment'><div class='author'>jcs</div><time datetime='2018-01-21T17:35:04Z'>Sun, 21 Jan 2018 17:35:04 UTC</time><div class='body'><p>Yes, I noticed a dramatic increase in Elfeed's feed loading speed but didn't know what happened until I read this post. This is on macOS.</p></div></div><div class='comment'><div class='author'>xiongtx</div><time datetime='2018-02-15T00:53:27Z'>Thu, 15 Feb 2018 00:53:27 UTC</time><div class='body'><p>Good news on DTrace: Oracle is apparently GPL'ing it and doing a proper Linux port: <a href="https://gnu.wildebeest.org/blog/mjw/2018/02/14/dtrace-for-linux-oracle-does-the-right-thing/" rel="nofollow noopener" title="https://gnu.wildebeest.org/blog/mjw/2018/02/14/dtrace-for-linux-oracle-does-the-right-thing/">https://gnu.wildebeest.org/...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-02-15T01:02:48Z'>Thu, 15 Feb 2018 01:02:48 UTC</time><div class='body'><p>Awesome! Apparently Oracle was just waiting around for me to complain about it. :-)</p></div><div class='comment'><div class='author'>xiongtx</div><time datetime='2018-02-15T01:15:35Z'>Thu, 15 Feb 2018 01:15:35 UTC</time><div class='body'><p>Now you're got to be very strategic about your next target of complaint 🤣.</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2018-02-07'><a href='/blog/2018/02/07/'>Inspiration from Data-dependent Rotations</a></h1><div class='comment'><div class='author'>possiblywrong</div><time datetime='2018-02-08T13:20:09Z'>Thu, 08 Feb 2018 13:20:09 UTC</time><div class='body'><p>"In these cases, a data-dependent shift would require a loop." My initial interpretation of this was a loop iterating over the number of bit shifts, right? I wonder if this could be compacted into a tighter, loop-less algorithm that only used, say, a 256x64-element lookup table of *byte* shifts?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-02-08T18:23:53Z'>Thu, 08 Feb 2018 18:23:53 UTC</time><div class='body'><p>Yup, that's exactly what I meant by a loop (or even something unrolled via Duff's Device). I hadn't thought of a table, though. While in theory a table reduces the operation to O(1), a table can still present a significant side channel due to cache effects. RC4's 256-byte s-box is large enough that researchers have demonstrated cache timing attacks to steal its contents. A huge lookup table will be even more vulnerable.</p><p>In a data-dependent shift lookup table, an attacker could flush parts of the table from cache (such as via cache collisions) and then measure the cipher's performance to discover the shift operands, revealing secret information about the cipher's internal state.</p><p>For the less-security sensitive PRNG, an architecture that lacks an instruction for data-dependent shifts also probably can't afford the memory for lookup tables, especially if a another PRNG would work fine.</p></div></div></div></div><hr/><div class='thread'><h1 id='2018-02-14'><a href='/blog/2018/02/14/'>Options for Structured Data in Emacs Lisp</a></h1><div class='comment'><div class='author'>Yu0</div><time datetime='2018-02-14T22:22:38Z'>Wed, 14 Feb 2018 22:22:38 UTC</time><div class='body'><p>The dynamic dispatch part has me somewhat worried.</p><p>One of the reasons emacs lisp has become my favorite programming language is discoverability with C-x h f and that the same global name will mean the same anywhere in the system. It creates a sort of clarity that is obfuscated by namespace systems to some degree, which I regularly stumble over when using python. Was .move os.move or shutil.move?</p><p>I can't quite imagine how this can translate into dynamic dispatch.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-02-14T22:37:54Z'>Wed, 14 Feb 2018 22:37:54 UTC</time><div class='body'><p>I generally agree. Dynamic dispatch currently isn't very transparent, and it can hamper debugging. In my original draft I actually cautioned against it, noting that it makes a program more complicated. It's occasionally useful (such as how I use it in EmacSQL), but it should be applied judiciously.</p></div></div></div><div class='comment'><div class='author'>Damien Cassou</div><time datetime='2018-02-16T07:57:09Z'>Fri, 16 Feb 2018 07:57:09 UTC</time><div class='body'><p>I just finished a complete rewrite of mpdel, an MPD Emacs client, and made great use of cl-defstruct and cl-defgeneric (especially in libmpdel.el). I enjoyed writing my code with it and had the impression it made the logic simpler. I would love feedback: <a href="https://github.com/DamienCassou/mpdel" rel="nofollow noopener" title="https://github.com/DamienCassou/mpdel">https://github.com/DamienCa...</a>.</p><p>Thanks for your great post.</p></div></div><div class='comment'><div class='author'>Andrew Kirkpatrick</div><time datetime='2018-02-27T12:43:36Z'>Tue, 27 Feb 2018 12:43:36 UTC</time><div class='body'><p>I really appreciate multiple inheritance and method combinations in CLOS, they give more options to interoperate with preexisting code without having to actually patch it. They must be used judiciously but I'd not go so far as to say they are a bad idea.</p></div></div></div><hr/><div class='thread'><h1 id='2018-02-15'><a href='/blog/2018/02/15/'>Two Chaotic Motion Demos</a></h1><div class='comment'><div class='author'>Fred</div><time datetime='2018-02-16T17:15:50Z'>Fri, 16 Feb 2018 17:15:50 UTC</time><div class='body'><p>If you want to avoid energy loss, you probably want a symplectic integrator. There's a symplectic version of Runge-Kutta, but a quick search didn't turn up any immediately usable code. It's described here: <a href="http://www.unige.ch/~hairer/poly_geoint/week2.pdf" rel="nofollow noopener" title="http://www.unige.ch/~hairer/poly_geoint/week2.pdf">http://www.unige.ch/~hairer...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-02-17T23:30:16Z'>Sat, 17 Feb 2018 23:30:16 UTC</time><div class='body'><p>Thanks for the tip! I'll have to study this.</p></div></div></div></div><hr/><div class='thread'><h1 id='2018-02-22'><a href='/blog/2018/02/22/'>Emacs Lisp Lambda Expressions Are Not Self-Evaluating</a></h1><div class='comment'><div class='author'>Clément Pit-Claudel</div><time datetime='2018-02-23T20:35:33Z'>Fri, 23 Feb 2018 20:35:33 UTC</time><div class='body'><p>That's a nice write-up.  I'm always scared of quoting lambdas, though; we ran into the following example recently in Flycheck:</p><p></p><pre>(progn<br>  (defmacro m (f) `(function ,f))<br>  (message "%S" (m (lambda ()))))<br></pre><p></p><p>(To see what's wrong with it, try evaluating it twice)</p></div><div class='comment'><div class='author'>Andrew Kirkpatrick</div><time datetime='2018-02-27T10:55:45Z'>Tue, 27 Feb 2018 10:55:45 UTC</time><div class='body'><p>That's intriguing, and you can reset the state to get the original result with (fmakunbound 'm). So its an interaction between read time and/or macroexpand time and/or evaluation time. It doesn't happen in Common Lisp (SBCL).</p></div><div class='comment'><div class='author'>Clément Pit-Claudel</div><time datetime='2018-02-27T14:48:30Z'>Tue, 27 Feb 2018 14:48:30 UTC</time><div class='body'><p>That particular example turned out to be a bug that was fixed just days after I posted here; but there's now a lively discussion going on about with-eval-after-load on <a href="https://lists.gnu.org/archive/html/emacs-devel/2018-02/msg00516.html" rel="nofollow noopener" title="https://lists.gnu.org/archive/html/emacs-devel/2018-02/msg00516.html">emacs-devel</a></p></div><div class='comment'><div class='author'>Andrew Kirkpatrick</div><time datetime='2018-02-27T22:20:13Z'>Tue, 27 Feb 2018 22:20:13 UTC</time><div class='body'><p>BTW at first I tried evaluating it twice in ielm but got the same result. I got the different results you're talking about by evaluating it in a lisp interaction mode buffer.</p></div></div></div></div></div><div class='comment'><div class='author'>Phil</div><time datetime='2018-02-24T05:40:29Z'>Sat, 24 Feb 2018 05:40:29 UTC</time><div class='body'><p>A valuable write-up as usual Chris, but  I think it would be improved significantly if you <em>showed</em> how the example is "subtly broken" (i.e. displayed the error that results) much much earlier, in order that the reader has some context for the ensuing discussion.</p><p>The eventual mention of the <code>(void-function closure)</code> error is buried a long way into the text, and with no direct reference to the original code, so it's all too easy to miss what the article is all about.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-02-26T17:04:37Z'>Mon, 26 Feb 2018 17:04:37 UTC</time><div class='body'><p>Thanks for the tip, Phil. I was intentionally delaying the "reveal" for the sake of telling a story, but, you're right, I probably obscured the issue too much by doing so.</p></div></div></div></div><hr/><div class='thread'><h1 id='2018-03-27'><a href='/blog/2018/03/27/'>A Crude Personal Package Manager</a></h1><div class='comment'><div class='author'>Ralph Corderoy</div><time datetime='2018-03-30T12:52:22Z'>Fri, 30 Mar 2018 12:52:22 UTC</time><div class='body'><p>Have you come across GNU Stow?  <a href="https://www.gnu.org/software/stow/" rel="nofollow noopener" title="https://www.gnu.org/software/stow/">https://www.gnu.org/softwar...</a>  It maintains a symlink farm.  In your case, your ~/.local/bin would end up with symlinks to ~/.local/stow/.../bin/...  The stow directory can have many versions of a package;  just one of them is symlinked in at a time.  It's easy to switch between versions.  It doesn't provide your `build from nothing but cc(1)' though, unless you build Perl too.  :-)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-03-30T18:59:07Z'>Fri, 30 Mar 2018 18:59:07 UTC</time><div class='body'><p>I had thought of Stow only as a "dotfiles installer," but since writing this article I've found out it's more general than that (since you're not the first to mention this). My little package manager is still probably better suited for my needs, but it seems I need to spend some time with Stow to see what other ways it could be useful.</p></div></div><div class='comment'><div class='author'>Kaushal Modi</div><time datetime='2018-05-11T20:05:10Z'>Fri, 11 May 2018 20:05:10 UTC</time><div class='body'><p>Can you share a wrapper script if you use any? Here's <a href="https://gist.github.com/caf9276819e05de874a011a43766e711" rel="nofollow noopener" title="https://gist.github.com/caf9276819e05de874a011a43766e711">mine</a> :) The linked is my wrapper script for Stow for dotfiles (I have separate groups of those for private and public), and then various packages, versioned.</p><p>The only thing I don't like is the requirement to create that dir_struct that you see in that script around line 125.</p></div></div></div><div class='comment'><div class='author'>oso2k</div><time datetime='2019-04-17T13:23:48Z'>Wed, 17 Apr 2019 13:23:48 UTC</time><div class='body'><p>This sounds very similar CRUX's package manager</p><p><a href="https://crux.nu/Main/Handbook3-4#ntoc13" rel="nofollow noopener" title="https://crux.nu/Main/Handbook3-4#ntoc13">https://crux.nu/Main/Handbo...</a></p></div></div></div><hr/><div class='thread'><h1 id='2018-04-13'><a href='/blog/2018/04/13/'>Blast from the Past: Borland C++ on Windows 98</a></h1><div class='comment'><div class='author'>Kurt Jung</div><time datetime='2018-04-13T20:50:37Z'>Fri, 13 Apr 2018 20:50:37 UTC</time><div class='body'><p>Thanks, Christopher, for the ride in the time machine. I've often thought about firing up a virtual DOS, circa 1988, to run a fairly large application I wrote in Turbo Pascal. When Lawrence Kesteloot discovered some old diskettes with graphics programs he and a friend wrote in 1989, he wrote a web-based Turbo Pascal compiler (<a href="https://www.teamten.com/lawrence/projects/turbo_pascal_compiler/" rel="nofollow noopener" title="https://www.teamten.com/lawrence/projects/turbo_pascal_compiler/">https://www.teamten.com/law...</a> ) to run them!</p><p>I had already spent a few years working with Turbo Pascal by the time I switched over to their C/C++ compiler. My editor at the time, some features of which I still miss, was Borland's editor toolbox with a bunch of home-grown extensions. It had everything I needed for software development so I never really got to know their packaged IDEs. With Pascal, Borland never considered itself constrained by standards. If some feature made sense, they implemented it. They borrowed so heavily from the best parts of Modula-2 that I am sure it was only marketing that compelled them to keep the name Pascal. It was a joy with which to work daily. My switch to C was dismal -- it felt slow and, with C's header files and macro language, ridiculously antiquated. I am grateful to Go for bringing back some of the magic of Turbo Pascal.</p><p>Of course, it was the C standard that allowed that language to flourish, and gives your program a lifetime that will be measured in decades. Nice work!</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-04-15T16:04:46Z'>Sun, 15 Apr 2018 16:04:46 UTC</time><div class='body'><p>Interesting story. Thanks for sharing. Kurt. I think I missed out on Pascal by a few years or so. By the time I got into programming it had already fallen off the radar.</p></div></div><div class='comment'><div class='author'>possiblywrong</div><time datetime='2018-04-15T16:37:06Z'>Sun, 15 Apr 2018 16:37:06 UTC</time><div class='body'><p>This was a really enjoyable and rather nostalgic read, both the OP and your comment. Most of my experience with Pascal was also via Turbo Pascal, and then initial exposure to C++ via Turbo C++. I still have a lot of Pascal source from 30+ year-old projects.</p></div></div></div><div class='comment'><div class='author'>Mike Zamansky</div><time datetime='2018-04-14T15:09:23Z'>Sat, 14 Apr 2018 15:09:23 UTC</time><div class='body'><p>This was a fun read. Back in the late 80's I was developing for Windows 2.1 / 3.0 which was really on top of DOS.</p><p>I used the Microsoft compiler and Epsilon which was (is?) an Emacs clone by Lugaru software. Things ran pretty well. The real trick was debugging and logging info and we handled that by having two displays on our PCs - one, a graphical display to run Windows and our application and another monochrome text only display where we could redirect logging info as our programs ran.</p><p>On the CLI, I used a product called the MKS toolkit which had a pretty functional shell along with many of the Unix command line tools we all know and love.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-04-15T16:50:55Z'>Sun, 15 Apr 2018 16:50:55 UTC</time><div class='body'><p>Somehow I'd never heard of either Epsilon or MKS Toolkit, but I see they both have Wikipedia articles. Interesting stuff. Thanks, Mike!</p></div></div></div><div class='comment'><div class='author'>Tim</div><time datetime='2018-05-02T14:29:42Z'>Wed, 02 May 2018 14:29:42 UTC</time><div class='body'><p>I'm glad you found a better command history program, otherwise I'd have to tell you about F3 (last command) and F2 (interactive partial of previous command), and that famous backwards compatibility means they still work in Windows 10.</p></div></div></div><hr/><div class='thread'><h1 id='2018-05-01'><a href='/blog/2018/05/01/'>When the Compiler Bites</a></h1><div class='comment'><div class='author'>Davidbrcz</div><time datetime='2018-05-02T07:36:54Z'>Wed, 02 May 2018 07:36:54 UTC</time><div class='body'><p>On a related subjet, there is a a paper on the effect of compilers' optimizations toward program security: <a href="https://www.lightbluetouchpaper.org/2018/04/24/what-you-get-is-what-you-c/" rel="nofollow noopener" title="https://www.lightbluetouchpaper.org/2018/04/24/what-you-get-is-what-you-c/">https://www.lightbluetouchp...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-05-03T15:16:52Z'>Thu, 03 May 2018 15:16:52 UTC</time><div class='body'><p>Interesting paper, thanks! I haven't finished reading it yet, but I've enjoyed it so far.</p></div></div></div><div class='comment'><div class='author'>justsomeguy</div><time datetime='2018-05-02T10:55:08Z'>Wed, 02 May 2018 10:55:08 UTC</time><div class='body'><p>Interesting blog post, thank you for posting.</p><p>Irrelevant and possibly autistic nitpick, please ignore: For the "new_image" function, shouldn't it test for </p><pre><code>w != 0 &amp;&amp; h != 0 &amp;&amp; h &lt;= SIZE_MAX / w</code></pre><p> instead of </p><pre><code>w == 0 || h &lt;= SIZE_MAX / w</code></pre><p>?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-05-02T11:14:54Z'>Wed, 02 May 2018 11:14:54 UTC</time><div class='body'><p>The "w == 0" check is to avoid division by zero. If one of the dimensions is zero, then the empty allocation decision is left to malloc(), either returning NULL or unique pointer: <a href="http://yarchive.net/comp/linux/malloc_0.html" rel="nofollow noopener" title="http://yarchive.net/comp/linux/malloc_0.html">http://yarchive.net/comp/li...</a></p></div><div class='comment'><div class='author'>justsomeguy</div><time datetime='2018-05-02T13:53:34Z'>Wed, 02 May 2018 13:53:34 UTC</time><div class='body'><p>I knew about the division by zero, but returning an empty allocation if one or more of the dimensions are zero I did not anticipate. Also, thank you for the link. Reading through it, it does seem a bit specific to kernel development; Linus writes among other things that in the kernel, they use NULL for representing a specific case:</p><p></p><blockquote><br>No. NULL really _is_ special.<br><br>We use NULL in tons of places for saying "we haven't allocated anything at<br>all".<br></blockquote><p></p><p>He also writes about returning a special case pointer that is not NULL to represent a different case, namely empty allocation:</p><p></p><blockquote><br>That's *not* the same as saying "we have initialized this pointer, it just<br>happens to point to a zero-sized object".<br></blockquote><p></p><p>So, the way you are doing things here may be the best and optimal way given the style, idioms and chosen approaches in the code base. The usage of C here with a rendering project makes a lot of sense, since C is both extremely portable and also has the possibility for very good runtime performance. In a different language and different project where runtime performance would not be as important, returning a union type or a tagged union type (one case for successful result, one case for error) or similar might be more maintainable and less error-prone.</p></div></div></div></div><div class='comment'><div class='author'>Anonymous</div><time datetime='2018-05-02T12:11:52Z'>Wed, 02 May 2018 12:11:52 UTC</time><div class='body'><p>1.3f case felt really wrong, so I checked the standard. Unfortunately, the standard explicitly says (in the section "Characteristics of floating types") that FLT_EVAL_METHOD 1 and 2 should ignore the constant type.</p></div></div><div class='comment'><div class='author'>Yury Schkatula</div><time datetime='2018-05-03T10:49:56Z'>Thu, 03 May 2018 10:49:56 UTC</time><div class='body'><p>"Floating point precision" - you should never compare them by equality/inequality, regardless the compiler and Standard applied. Just rule of thumb :)</p></div></div><div class='comment'><div class='author'>LilleCarl</div><time datetime='2019-02-25T14:02:49Z'>Mon, 25 Feb 2019 14:02:49 UTC</time><div class='body'><p>Very interesting article!</p></div></div></div><hr/><div class='thread'><h1 id='2018-05-27'><a href='/blog/2018/05/27/'>When FFI Function Calls Beat Native C</a></h1><div class='comment'><div class='author'>Kreemy N. Almind</div><time datetime='2018-05-28T08:26:06Z'>Mon, 28 May 2018 08:26:06 UTC</time><div class='body'><p>Great article as always! I learned so many new things. One small question regarding your code. In your benchmark code you use indirection to enable and disable the running flag for each benchmark <a href="https://github.com/skeeto/dynamic-function-benchmark/blob/master/benchmark.c#L25" rel="nofollow noopener" title="https://github.com/skeeto/dynamic-function-benchmark/blob/master/benchmark.c#L25">https://github.com/skeeto/d...</a></p><p>Is there any specific reason for this? Only reason I see is because you have another running flag in your jit struct <a href="https://github.com/skeeto/dynamic-function-benchmark/blob/master/benchmark.c#L49" rel="nofollow noopener" title="https://github.com/skeeto/dynamic-function-benchmark/blob/master/benchmark.c#L49">https://github.com/skeeto/d...</a> and you free it in main() after the jit benchmark is over. Why not have one running flag and enable/disable it before/after each benchmark directly?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-05-28T11:24:40Z'>Mon, 28 May 2018 11:24:40 UTC</time><div class='body'><p>I wanted one signal handler to cover all benchmarks. The PLT and Indirect benchmarks trivially share a "running" flag since they're all nearby in memory. They can (and do) both access the flag using RIP-relative addressing, per the "small" code model in the Eli Bendersky article.</p><p>However, the JIT code is intentionally placed adjacent to the shared object's base address, not the main program, so its address is almost certainly very far away (&gt;2GB) from "running". The flag is not accessible by RIP-Relative addressing, which has the same 2GB (signed 32-bit) range of the call instruction. To deal with this, the JIT code gets its own flag allocated adjacently in its own page. I mentioned this (without much explanation) in the paragraph about allocating two pages. <br>I could have used absolute 64-bit addressing to reach back to the original "running" flag, but this would make for a larger instruction, different from the other two benchmarks. Worse, it's inside the tight loop that I was measuring. I wanted each benchmark to be as comparable as possible, differing *only* by call style, accessing the running flag in an identical way.</p></div></div></div><div class='comment'><div class='author'>Travis Downs</div><time datetime='2018-05-30T22:02:44Z'>Wed, 30 May 2018 22:02:44 UTC</time><div class='body'><p>You could also consider static linking. Now static linking isn't really an apples-to-apples comparison when talking about FFI, which kind of implies a shared object that other languages can call into, whereas static linking really only applies to C, C++ and other "link-level" compatible languages. Still, this type of call is the major type of non-inlined call found in most applictions, even that don't statically link libraries, since it is the one used for calls between different translation units in the same binary.</p><p>AFAIK static linking will end up the same as the JIT example (a direct relative call, at least for the normal small code model) for executables including PIE executables, but for code inside a shared PIC object it's more complicated due to the possibility of interposition. Basically if you want to support interposition of calls within a library, interposable calls within the library have to jump through the same hoops as cross-library calls - but there are various tricks you can do to control this (linker maps, anonymous namespaces, etc).</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-05-31T19:08:11Z'>Thu, 31 May 2018 19:08:11 UTC</time><div class='body'><p>Yup, static linking gives you the equivalent of the "JIT" calls. If the static library was built with with LTO (unusual) and you're using a compatible compiler, then in theory it could do even better and inline library functions.</p><p>Good point about interposition, too.</p></div></div></div></div><hr/><div class='thread'><h1 id='2018-05-31'><a href='/blog/2018/05/31/'>Emacs 26 Brings Generators and Threads</a></h1><div class='comment'><div class='author'>Clément Pit-Claudel</div><time datetime='2018-06-01T03:16:21Z'>Fri, 01 Jun 2018 03:16:21 UTC</time><div class='body'><p>Neat article.  I'm happy that we're gaining (cooperative) threads, mostly because it helps with getting out of callback hell. Note also that we alread have an equivalent of web workers in Emacs, in the form of the emacs-async library: <a href="https://github.com/jwiegley/emacs-async" rel="nofollow noopener" title="https://github.com/jwiegley/emacs-async">https://github.com/jwiegley...</a> .</p></div></div><div class='comment'><div class='author'>Noam Postavsky</div><time datetime='2018-06-02T01:57:57Z'>Sat, 02 Jun 2018 01:57:57 UTC</time><div class='body'><p>FYI, generators were added in 25.1, not 26.1</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-06-02T10:58:31Z'>Sat, 02 Jun 2018 10:58:31 UTC</time><div class='body'><p>Doh! I feel stupid now. Thanks for the correction. It wouldn't be so bad if I didn't base the title around my mistake.</p></div></div></div><div class='comment'><div class='author'>NoonianAtall</div><time datetime='2018-06-02T02:12:58Z'>Sat, 02 Jun 2018 02:12:58 UTC</time><div class='body'><p>Great article, thanks, Chris!</p></div></div><div class='comment'><div class='author'>Lawrence D’Oliveiro</div><time datetime='2018-06-03T07:36:22Z'>Sun, 03 Jun 2018 07:36:22 UTC</time><div class='body'><p>Given that Elisp is Lisp, I wonder why they don’t implement a full continuation <a href="http://www.codecodex.com/wiki/Continuations" rel="nofollow noopener" title="http://www.codecodex.com/wiki/Continuations">http://www.codecodex.com/wi...</a> facility to begin with.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-06-04T14:07:09Z'>Mon, 04 Jun 2018 14:07:09 UTC</time><div class='body'><p>As I mentioned, generators require no special run-time support. Adding them to Emacs came at no cost. But continuations typically require significant architectural run-time support, where stacks are first-class objects, managed directly by the run-time. This is one of the big hurdles when implementing Scheme, especially because its continuations are undelimited. An implementer typically can't simply use implementation language's stack (unless that language supports continuations itself).</p><p>To add another complication: Continuations couldn't be safely combined with Emacs' dynamic modules. A dynamic module frame "sandwiched" inside a continuation would likely break or misbehave if control returns through it other than exactly one time. For example, imagine an intermediate frame in C++ that's using RAII.</p></div></div></div><div class='comment'><div class='author'>Mike</div><time datetime='2018-06-04T20:14:57Z'>Mon, 04 Jun 2018 20:14:57 UTC</time><div class='body'><p>Did you try printing and reading a generator? It does not work here:</p><p>LISP&gt; (iter-defun test-gen ()<br>         (while t<br>           (let ((inp (iter-yield nil)))<br>             (cond<br>              ((equal inp 'end)<br>               (signal 'iter-end-of-sequence nil))<br>              (t<br>               (message "Got %s" inp))))))<br>test-gen<br>ELISP&gt; (read (prin1-to-string (test-gen)))<br>*** Eval error ***  Invalid read syntax: "#"</p><p>It would be useful for a game (ala Lua pluto library, save-the-world).</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-06-04T23:28:54Z'>Mon, 04 Jun 2018 23:28:54 UTC</time><div class='body'><p>Since generators compile into a set of closures that reference and call each other, they form a circular data structure. So in order to print an iterator object properly, you need to bind print-circle to t when printing. (It doesn't matter when reading.) Without this, the printer still inserts special markers when it detects loops, but they can't be read back in.</p></div></div></div></div><hr/><div class='thread'><h1 id='2018-06-10'><a href='/blog/2018/06/10/'>Minimalist C Libraries</a></h1><div class='comment'><div class='author'>Roy</div><time datetime='2018-06-10T12:54:13Z'>Sun, 10 Jun 2018 12:54:13 UTC</time><div class='body'><p>you should check out seans (nothings) stb libraries on github <a href="https://github.com/nothings/stb" rel="nofollow noopener" title="https://github.com/nothings/stb">https://github.com/nothings...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-06-10T13:01:45Z'>Sun, 10 Jun 2018 13:01:45 UTC</time><div class='body'><p>Oh, yes, I love Sean Barrett's stuff. stb has influenced my own minimalist libraries. In fact, the "growable-buf" library linked at the bottom of the article is my own take on "stretchy_buffer.h".</p></div></div></div><div class='comment'><div class='author'>Klaus</div><time datetime='2018-06-10T16:09:22Z'>Sun, 10 Jun 2018 16:09:22 UTC</time><div class='body'><p>What you describe is what I wish more python libraries were. It often feels as if the public APIs are overly complex and scattered. Mind, it still leaves Python often enough as the preferable choice (data analysis), but view libraries provide minimalist interfaces with the full power that would be possible.</p><p>Then again, the same seems to go for any language.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-06-10T19:07:22Z'>Sun, 10 Jun 2018 19:07:22 UTC</time><div class='body'><p>I've noticed that about Python, too, even including some of the officially included modules. It seems its "only one obvious way to do it" philosophy never quite extended to API design.</p></div><div class='comment'><div class='author'>Klaus</div><time datetime='2018-06-11T09:30:00Z'>Mon, 11 Jun 2018 09:30:00 UTC</time><div class='body'><p>I'd argue, that it doesn't even extend to the core language API, e.g. strings. We have ``s1.startswith(s2)``, ``s1.endswith(s2)``, but ``s2 in s1`` instead of ``s1.contains(s2)`` and ``len(s1)`` instead of ``s1.length()``.</p><p>Or for that matter, assignment syntax. We have ``NAME = VALUE`` as an assignment statement, but ``VALUE as NAME`` everywhere else. This can make with-statements quite hard to parse, as it requires placing the name *after* the closing parantheses of a potentially long expression.</p><p>It also violates the "explicit is better than implicit" mantra by not having explicit variable declaration (like javascripts' untyped const,var,let), which can easily create weird errors due to shadowing or unintentional variable-reuse. This is typically defended by saying "its a name, not a variable", though it really just means "variable without fixed type", which makes the distinction somewhat irrelevant.</p><p>*edit* Monday morning rant... &gt;_&lt;</p></div></div></div></div><div class='comment'><div class='author'>James Lin</div><time datetime='2018-06-10T18:04:39Z'>Sun, 10 Jun 2018 18:04:39 UTC</time><div class='body'><p>It's a very minor point, but your preprocessor macros should wrap the negative constants in parentheses so that there are proper compilation errors if someone somehow accidentally types something like `some_number UTF7_OK`.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-06-10T19:03:54Z'>Sun, 10 Jun 2018 19:03:54 UTC</time><div class='body'><p>Good point, thanks! I'm usually pretty conscientious about wrapping my macro values but hadn't considered the unary negative being an issue.</p></div></div></div><div class='comment'><div class='author'>heden</div><time datetime='2018-06-10T20:55:36Z'>Sun, 10 Jun 2018 20:55:36 UTC</time><div class='body'><p>cat article | sed 's/limites/limits/'</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-06-10T21:19:28Z'>Sun, 10 Jun 2018 21:19:28 UTC</time><div class='body'><p>Thanks! Looks like "limites" is a real word, which explains why the spell checker missed it.</p></div></div></div><div class='comment'><div class='author'>Adam Kennedy</div><time datetime='2018-06-11T12:19:48Z'>Mon, 11 Jun 2018 12:19:48 UTC</time><div class='body'><p>Would these be suitable for CCAN?</p><p><a href="https://ccodearchive.net" rel="nofollow noopener" title="https://ccodearchive.net">https://ccodearchive.net</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-06-13T19:43:54Z'>Wed, 13 Jun 2018 19:43:54 UTC</time><div class='body'><p>I never heard of CCAN before. That's pretty neat. Yeah, I'd expect these sorts of libraries would be very suitable there since they embed so easily.</p></div></div></div><div class='comment'><div class='author'>Will Good</div><time datetime='2018-06-13T18:11:47Z'>Wed, 13 Jun 2018 18:11:47 UTC</time><div class='body'><p>Nice examples.  How would you distribute your minimalist c library? Also, would it be statically or dynamically linked?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-06-13T20:00:51Z'>Wed, 13 Jun 2018 20:00:51 UTC</time><div class='body'><p>The libraries I discussed are all embed libraries. They're small, portable, and trivial to build (e.g. just include as a header library). So you copy them into your won project when needed. That's why it's especially important to get the bugs shaken out up front, since updating later isn't so smooth. Fortunately small interfaces with explicit state are easy to test!</p><p>This makes it most like static linking. I'd expect this from most typical minimalist C libraries, though I can imagine situations where embedding may make less sense.</p></div></div></div><div class='comment'><div class='author'>Graham Toal</div><time datetime='2019-09-04T02:04:56Z'>Wed, 04 Sep 2019 02:04:56 UTC</time><div class='body'><p>for some time I've been starting to think that operating systems are overkill and that a suitable environment is just a good library that can be bound with a program and run as bare metal! At least for a large number of applications.  With computers like the Pi Zero W being so cheap, it shakes up the cost/benefit ratio and the relative value of the software to the hardware.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-09-04T17:28:08Z'>Wed, 04 Sep 2019 17:28:08 UTC</time><div class='body'><p>Check out rump kernels and unikernels: <a href="https://en.wikipedia.org/wiki/Rump_kernel" rel="nofollow noopener" title="https://en.wikipedia.org/wiki/Rump_kernel">https://en.wikipedia.org/wi...</a> <a href="https://en.wikipedia.org/wiki/Unikernel" rel="nofollow noopener" title="https://en.wikipedia.org/wiki/Unikernel">https://en.wikipedia.org/wi...</a></p></div><div class='comment'><div class='author'>Graham Toal</div><time datetime='2019-09-07T20:35:48Z'>Sat, 07 Sep 2019 20:35:48 UTC</time><div class='body'><p>Yep, that was pretty much what I was envisioning.  So, not a crazy idea after all :)</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2018-06-23'><a href='/blog/2018/06/23/'>Intercepting and Emulating Linux System Calls with Ptrace</a></h1><div class='comment'><div class='author'>Xiaoguang-Gary Wang</div><time datetime='2018-11-13T16:29:10Z'>Tue, 13 Nov 2018 16:29:10 UTC</time><div class='body'><p>Nice article. I'm wondering whether we could use ptrace to trick a syscall execution. For example, can we trick the SYS_read with our pre-defined input, so that user will not have to type anything from keyboard? Thanks!</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-11-13T18:25:24Z'>Tue, 13 Nov 2018 18:25:24 UTC</time><div class='body'><p>The "trick" you're talking about is exactly what I was getting at with emulating system calls. When the SYS_read arrives, you change the system call to an invalid system call number, let it run (and fail), but on the way out you service it yourself writing to the caller's buffer and returning the number of bytes written. The tracee won't know their system call *really* failed (due to your sabotage) since you emulated a success with a different result.</p><p>That's what I did in this little project, which intercepts entropy-gathering system calls: <a href="https://github.com/skeeto/keyed" rel="nofollow noopener" title="https://github.com/skeeto/keyed">https://github.com/skeeto/k...</a></p></div></div></div></div><hr/><div class='thread'><h1 id='2018-07-20'><a href='/blog/2018/07/20/'>The Value of Undefined Behavior</a></h1><div class='comment'><div class='author'>Concerned Programmer</div><time datetime='2018-07-21T11:25:58Z'>Sat, 21 Jul 2018 11:25:58 UTC</time><div class='body'><p>Honestly this triggered me a little. I hate the idea of exploiting such danger for a little performance gain - and an unreliable one at that! Rather write correct and maintainable code than a strange /`/ here be dragons` work. PS. Your example code is actually slower on Clang.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-07-22T00:21:40Z'>Sun, 22 Jul 2018 00:21:40 UTC</time><div class='body'><p>Yeah, I don't know what's going on with Clang in my example. Neither function compiles as cleanly as GCC's code for sum_signed(). In the video I linked, Chandler is (of course) using Clang, and it produces much better code for int32_t than uint32_t in its bzip2 example.</p></div></div></div><div class='comment'><div class='author'>PaX Team</div><time datetime='2018-07-21T14:27:11Z'>Sat, 21 Jul 2018 14:27:11 UTC</time><div class='body'><p>your 'int i' is more of an example of why 'int' should be considered harmful. if you use a register sized type (long/unsigned long here) then all is well, you get the same efficient code in both functions:</p><p>        movl    (%rdi,%rsi,8), %eax<br>        addl    (%rdi,%rsi,4), %eax<br>        ret</p><p>and if you extend this idea to the callers, you'll never force the compiler to juggle with sign extension, truncation, etc. seriously, people should have retrained their muscle memory from 'int' to 'long' decades ago.</p></div><div class='comment'><div class='author'>renozyx</div><time datetime='2018-07-21T19:51:07Z'>Sat, 21 Jul 2018 19:51:07 UTC</time><div class='body'><p>Replace long with size_t and I agree with you</p></div></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-07-22T00:53:05Z'>Sun, 22 Jul 2018 00:53:05 UTC</time><div class='body'><p>On x86-64, strictly using only 64-bit integers will lead to larger code and put more strain on the instruction cache. Even though it's a 64-bit platform, the default operand size is still just 32 bits. Most common instructions require a REX.W prefix byte (e.g. 0x48) to select 64-bit operands. That is, the "l" on "movl" typically makes the instruction one byte larger than it would otherwise be.</p><p>To see this for yourself, hex dump some x86-64 code and note how often 0x48 shows up. It's actually a pretty handy trick for differentiating x86-64 code from arbitrary data using only your eyes.</p><p>It's not always larger: any use of r9–r15 already requires a REX prefix (the 4th bit of register selection comes from REX, and lacking a REX byte implies a 0 for this bit), so it doesn't cost anything extra to use these registers for 64-bit operands. But it's still not something you _always_ want on x86-64.</p></div><div class='comment'><div class='author'>Travis Downs</div><time datetime='2018-07-22T02:13:09Z'>Sun, 22 Jul 2018 02:13:09 UTC</time><div class='body'><p>Yeah, 64-bit code is larger, *everything else being equal* - but often it's not equal: here you save 1 or 2 instruction which way more than makes up for a couple of prefix bytes in size. I have often looked at otherwise "efficiently" written loops that use mix 64 bit pointers and 32-bit values, and by extending everything to 64 bits in the right away everything ends up much smaller and faster.</p></div></div></div></div><div class='comment'><div class='author'>Shafik Yaghmour</div><time datetime='2018-07-21T15:23:40Z'>Sat, 21 Jul 2018 15:23:40 UTC</time><div class='body'><p>I wrote a long article on strict aliasing here <a href="https://gist.github.com/shafik/848ae25ee209f698763cffee272a58f8" rel="nofollow noopener" title="https://gist.github.com/shafik/848ae25ee209f698763cffee272a58f8">https://gist.github.com/sha...</a> and one of the point I cover is whether</p><p>int8_t and uint8_t char types and you are correct they do not have to be. Although currently on implementation I know of they are.</p><p>One point that is covered in a gcc bug report <a href="https://gcc.gnu.org/bugzilla/show_bug.cgi?id=66110#c13" rel="nofollow noopener" title="https://gcc.gnu.org/bugzilla/show_bug.cgi?id=66110#c13">https://gcc.gnu.org/bugzill...</a> is that changing them to not be char types would be an ABI break for C++.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-07-22T00:37:34Z'>Sun, 22 Jul 2018 00:37:34 UTC</time><div class='body'><p>Great article! I've added a link to it. Also thanks for the links to that very interesting discussion on GCC's Bugzilla.</p></div></div></div><div class='comment'><div class='author'>Brian</div><time datetime='2018-07-21T18:31:14Z'>Sat, 21 Jul 2018 18:31:14 UTC</time><div class='body'><p>The problems I have with undefined behavior are twofold.</p><p>First, no user or programmer ever wants to invoke undefined behavior.  The main point of C (AFAICT) is that it's easy to implement efficiently.  Therefore, if an abstraction offered by the language can't be implemented in such a way, maybe it's just a bad abstraction for C.  There's several new languages today which offer null-safety and also high performance.  Undefined behavior could be seen as a red flag in language design.  It usually is, in every other context.  If there was some combination of buttons I could press on my toaster or my car to exhibit "undefined behavior", that would be bad design, without qualification.</p><p>Second, because nobody wants to invoke UB, it's essentially an unwritten "assert cant_happen;", except the user isn't required (or able) to say this, and the compiler has no means to report this to the programmer.  As such, it's almost always a Surprise, and thus violates the Principle of Least.  It's even unusual for C.  In all other cases in the language, something that "can't happen" is enforced by the compiler.  When I write a function that takes an int, for example, I know it won't be called with a double.  Actually, in pre-ANSI C, you didn't have to declare parameter types, but eventually they made the programmer do extra work to declare all types to eliminate this type of surprise.  Why not be consistent and do the same for undefined behavior, too?</p><p>Your article explains quite well why undefined behavior is beneficial to compiler writers, given a fixed language specification, but I don't understand why it was beneficial for the language designers to have left it that way.  Given the other design changes that have been made since the 1970's, it really seems like one of the few remaining inconsistent warts that hasn't been fixed.</p></div><div class='comment'><div class='author'>John Payson</div><time datetime='2018-09-02T18:15:42Z'>Sun, 02 Sep 2018 18:15:42 UTC</time><div class='body'><p>Programmers may never want to perform actions which their compilers won't handle predictably, but they will often perform actions whose behavior is needed for their intended purpose, but which is not recognized by the Standard.  Quality implementations which are suitable for the programs' intended tasks will support such behaviors whether the Standard requires them to or not; the fact that a program is targeted exclusively toward such implementations hardly means it's "broken".</p><p>For some reason, some compiler writers seem to view the Standard as a complete specification of everything programmers should expect.  The authors of the Standard, however, not expecting it to be viewed that way, made no effort to define all the behaviors necessary to accomplish any particular task efficiently, if at all.  According to the Rationale, they viewed as a quality of implementation issue the choice of what behaviors implementations should define beyond those the Standard requires.  Because behaviors that are essential for some kinds of programming are useless for others, the authors of the Standard expected that the "marketplace" of programmers in various fields and compilers intended for use in those fields would be able to recognize what additional behaviors are appropriate in quality compilers intended for those fields.</p><p>For some reason, the authors of some compilers, who perhaps think "clever" and "stupid" are antonyms, have become fascinated with "optimizing" cases where quality implementations behave in constrained fashion (at worst choosing in unspecified fashion from a few possible behaviors) but where the Standard would allow them to negate laws of time and causality.  A quality implementation which guarantees such constrained behavior (even though not required by the Standard), fed a program that exploits that, will be able to generate more efficient machine code than a more aggressive implementation fed code that is written to use only Standard-mandated behaviors.  The notion that no programmers would want to let a quality implementation choose freely from among behaviors meeting application requirements is destructive and needs to be nixed.</p></div></div></div><div class='comment'><div class='author'>SherekhudaHazratali.com</div><time datetime='2018-07-21T21:03:23Z'>Sat, 21 Jul 2018 21:03:23 UTC</time><div class='body'><p>I have a hard time accepting the premise that a language is better because you have to hope that it does what you want instead of telling it, and for that reason it has become successful.</p><p>In fact, the ANSI C spec even states from your link that "Undefined behavior gives the implementer license not to catch certain program errors that are difficult to diagnose." That's just not an acceptable tradeoff anymore -- in fact I don't know it ever was. That's akin to shipping your org chart because you can't make your program do what everyone agrees it should do. You know, catch programming errors, in this case.</p></div></div><div class='comment'><div class='author'>Travis Downs</div><time datetime='2018-07-22T02:09:17Z'>Sun, 22 Jul 2018 02:09:17 UTC</time><div class='body'><p>Good article. The outcry over undefined behavior seems to have reached a peak lately, but the position in favor (of at least some cases) isn't often laid out. The idea IMO, that compiler authors are being malicious here, I think is mostly wrong: many of the "surprising" optimizations are outcomes of generic optimization steps that also produce some very necessary and "obvious" optimizations.</p><p>Note "truncate in case of overflow" comment (the implication that the prior multiplication may overflow) isn't correct - there is no overflow here: the destination register is esi, which doesn't hold the result of the prior multiplication. What is happening here is actually a quirk of the SysV ABI: the high 32 bits of 32-bit or smaller arguments may contain garbage and the caller has to clear them if it relies on them being clear. Lower unused bits (e.g., bits 16-31 when a short is passed) are generally cleared, but this was up for debate for a while: clang expected them cleared, but icc didn't do it, so they were C ABI incompatible for years!</p><p>Some discussion here:<br><a href="https://stackoverflow.com/q/40475902" rel="nofollow noopener" title="https://stackoverflow.com/q/40475902">https://stackoverflow.com/q...</a></p><p>and</p><p><a href="https://stackoverflow.com/a/36760539" rel="nofollow noopener" title="https://stackoverflow.com/a/36760539">https://stackoverflow.com/a...</a></p><p>In general, I don't agree with the conclusion that signed is better (for performance) when used for indexes. Yes, your example shows a case where it wins, but I've seen a lot of cases where it also causes an extra sign-extension. The design of the x86-64 ISA is such that the zero-extension needed by unsigned values often comes for free, whereas the sign extension doesn't.</p><p>For example, here's a related example that shows the opposite case:</p><p><a href="https://godbolt.org/g/2yG9Ra" rel="nofollow noopener" title="https://godbolt.org/g/2yG9Ra">https://godbolt.org/g/2yG9Ra</a></p><p>The signed version has an extra instruction to do the sign extension.</p><p>Finally, note that on the exact same code you produced, clang generated worse code for the signed version (yes, it's the fault of clang, but still it belies the advice to always used signed):</p><p><a href="https://godbolt.org/g/BAUwBw" rel="nofollow noopener" title="https://godbolt.org/g/BAUwBw">https://godbolt.org/g/BAUwBw</a></p><p>Overall, I think it's roughly a wash when it comes to signed vs unsigned pointer indexing outside of loops. Both win sometimes. You really have to check your code to see what it's generating for the places you care about performance. A good guideline (as you mentioned) is just to use full width types like size_t or ssize_t if you can: this almost always generates equally good or better code. It doesn't mean you need to store bulk data in that format: you can use 32-bits there, but cast or assign to full size for the performance sensitive parts so pointer and index widths match up.</p><p>For loop counters used as indexes, signed has some additional advantages because in a structure like:</p><p>for (int i = x; i != y; i++)</p><p>the compiler knows it will be a simple incrementing iteration from x to y, taking (y - x) iterations. In the case of unsigned i, however, the possibility exists that x &gt; y, so the iteration will wrap around, and can inhibit various loop optimizations, including vectorization.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-07-22T15:53:15Z'>Sun, 22 Jul 2018 15:53:15 UTC</time><div class='body'><p>You're totally right about my example. I misread the assembly and it wasn't showing what I thought it was showing. I've replaced the example with one lifted directly from the bzip2 example in the linked video since it actually does demonstrate a particular case of signed integers being more efficient. I was hoping to contrive an even simpler example. <br>Also, good points you've made on this topic. With all the trouble I've had with trying to isolate a single, clean example that demonstrates the optimization in the same direction on both GCC and Clang, I'm now thinking it's not *quite* so clear cut about signed integers being faster in the general case. However, I still appreciate that, due to undefined signed overflow, it is a constraint I can influence even if it takes more effort than simple rule-of-thumb to exploit it.</p><p>Thanks for the input!</p></div></div></div><div class='comment'><div class='author'>possiblywrong</div><time datetime='2018-07-23T18:02:20Z'>Mon, 23 Jul 2018 18:02:20 UTC</time><div class='body'><p>Interesting post. Perhaps a simple question: you point out that char * can alias with anything; is this also true of unsigned char *? I ask because I frequently see this used as the type for a "byte buffer," and I've written it myself in the past as well.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-07-24T01:14:17Z'>Tue, 24 Jul 2018 01:14:17 UTC</time><div class='body'><p>Yup, doesn't matter if it's signed or unsigned, the aliasing exception still applies.</p></div></div></div><div class='comment'><div class='author'>cplusplus</div><time datetime='2018-07-27T09:20:37Z'>Fri, 27 Jul 2018 09:20:37 UTC</time><div class='body'><p>Great article about Undefined Behavior. Can you write now an article about Unspecified Behavior ?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-07-27T13:04:33Z'>Fri, 27 Jul 2018 13:04:33 UTC</time><div class='body'><p>A couple of years ago I wrote an article on a specific instance of implementation defined behavior:</p><p>You Can't Always Hash Pointers in C <a href="https://nullprogram.com/blog/2016/05/30/" rel="nofollow noopener" title="https://nullprogram.com/blog/2016/05/30/">https://nullprogram.com/blo...</a></p></div></div></div><div class='comment'><div class='author'>John Payson</div><time datetime='2018-08-30T20:58:12Z'>Thu, 30 Aug 2018 20:58:12 UTC</time><div class='body'><p>If multiple ways of performing an operation would have identical behavior in cases defined by the Standard, but differing behavior in many other cases, allowing implementations to choose among the various ways in Unspecified fashion will often facilitate useful optimizations.  The value of such optimizations, however, will be much greater if programmers can exploit scenarios where all ways of performing an operation would all yield acceptable results, than if programmers must avoid at all costs any situations where behavior isn't 100% rigidly defined..</p><p>When the Standard characterizes some situation as invoking Undefined Behavior, that means that nothing an implementation could do in that situation would make the it non-conforming.  That in no way implies that different ways of handling the situation won't render an implementation more or less suitable for various purposes.  Further, when the Standard describes a category of actions as as invoking UB, that doesn't imply any judgment as to whether commonplace implementations should be expected to process at least some of them consistently.  Instead, according to the rationale, the authors expect that quality implementations intended for various purposes will interpret UB as an invitation to extend the semantics of the language in ways that usefully serve those purposes.</p><p>One thing that would allow the Standard to be straightforward and yet more useful for programmers and compiler writers alike would be if it allowed programmers to explicitly invite certain kinds of optimizations in certain cases, even when whether doing so might alter observable behaviors, rather than trying to characterize as UB all situations where the effects of useful optimizations might be observable.  If applying various combinations of optimizations might result in a program behaving in many different ways, but all of those ways would be acceptable, letting programmers exploit that fact would make it possible for compilers to do likewise, and thus produce better code than would be possible if programmers had to avoid all such situations.</p><p>As an example, consider an invitation to treat automatic objects of integer types as holding "recipes" rather than values, and its effect on something like "x=y * 2468; ... z=x/1234;" with none of the  intervening operations showing any evidence of affecting x or y.  If the compiler keeps track of the fact that "x" was computed as "y * 2468", it could replace the latter assignment with "z = y * 2;".  This may result in x and z holding inconsistent values if an overflow occurs during the multiply, or if the value of y changes unexpectedly, but if code doesn't care about the values being inconsistent in such cases, the implementation shouldn't either.  If events that would disrupt computation are rare, and program is prepared to throw out the results from a series of computations if they are found to have occurred, the costs of computations that get thrown out may be less than the cost of using "volatile" qualifiers within a tight loop.</p></div></div></div><hr/><div class='thread'><h1 id='2018-07-31'><a href='/blog/2018/07/31/'>Prospecting for Hash Functions</a></h1><div class='comment'><div class='author'>Nand Xorsson</div><time datetime='2018-08-02T06:08:56Z'>Thu, 02 Aug 2018 06:08:56 UTC</time><div class='body'><p>Sloshing effect = confusion and diffusion</p><p>Google 'confusion and diffusion' to find out more. I think Wikipedia has an article on it.</p><p>Confusion and diffusion is created with substitution and permutation.</p></div></div><div class='comment'><div class='author'>Jan De Kock</div><time datetime='2018-08-02T06:09:49Z'>Thu, 02 Aug 2018 06:09:49 UTC</time><div class='body'><p>I wonder what the results would be when using signed numbers, as Java only has these. More for like strengthening existing hash codes. I might play around with your source code :)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-08-02T14:33:38Z'>Thu, 02 Aug 2018 14:33:38 UTC</time><div class='body'><p>With two's compliment, the bitwise result of multiplication is the same regardless of operands' signedness. That's why Java implementations of these hash functions work just fine despite the lack of unsigned integers. Division is another matter, though, which is why it has a separate divideUnsigned() method.</p></div><div class='comment'><div class='author'>Jan De Kock</div><time datetime='2018-08-21T06:12:29Z'>Tue, 21 Aug 2018 06:12:29 UTC</time><div class='body'><p>Thanks! The rules for two's complement have fled my brain unfortunately... Time to put those on my reading list again :)</p></div></div></div></div><div class='comment'><div class='author'>Thomas Mueller</div><time datetime='2018-08-02T08:01:08Z'>Thu, 02 Aug 2018 08:01:08 UTC</time><div class='body'><p>The function with the 0x45d9f3b constants: yes, I found those, see also <a href="https://stackoverflow.com/questions/664014/what-integer-hash-function-are-good-that-accepts-an-integer-hash-key/12996028#12996028" rel="nofollow noopener" title="https://stackoverflow.com/questions/664014/what-integer-hash-function-are-good-that-accepts-an-integer-hash-key/12996028#12996028">https://stackoverflow.com/q...</a></p><p>At the time I tested it, I found it is slightly faster to use the same constant twice. That was with Java, a few years ago... Not sure if that's still the case. Did you also test performance?</p><p>(By the way, I didn't test Murmur3, not sure why, maybe Murmur3 didn't exist back then.)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-08-02T15:24:43Z'>Thu, 02 Aug 2018 15:24:43 UTC</time><div class='body'><p>Ah, thanks for clearing up! I did come across your Stack Overflow answer while researching the origin (via searching on the 32-bit constant). It seemed like it was yours, but you didn't explicitly take credit.</p><p>I did wrap my overall evaluation function with a high precision clock so that I could measure the performance if necessary. However, for x86 I expect there to be absolutely no difference in performance just from tweaking the constants (of course, outside of certain, obviously special values like 0 and 1). Performance should be exactly identical.</p><p>The C version compiles to the same code just with different immediates, and reusing the 32-bit constant doesn't change this fact (the value is repeated). Looking more my closely at those performance measurements, I'm not seeing any differences above the noise. Perhaps there was a difference in Java due to its bytecode constant pool, and using the same constant takes pressure off the pool. I have no idea what HotSpot's JIT output would look like.</p><p>It looks like the MurmurHash3 beta was announced 2010-11-04, and it was finalized 2011-03-01. That's about 19 months before your Stack Overflow answer (2012-10-21). You _do_ mention MurmurHash's finalizer and even specifically link to MurmurHash3, suggesting that _is_ the function you tested.</p><p>If I'm understanding it correctly, your hash evaluation in H2 is using the Monte Carlo method just like my estimate. However, I found that the best I could get from a Monte Carlo method bias estimation with 2^18 samples was between 5 and 6 digits of precision, which is just _barely_ enough to differentiate the three, 32-bit functions shown in my article (including yours). Throwing lots more samples at it was just noise. This is in line with the (disappointing) Monte Carlo pi estimates I've seen/tried. So I had to switch to the exhaustive, exact evaluation to be sure. This is what's really limiting my ability to improve on the existing 64-bit hashes.</p></div></div></div><div class='comment'><div class='author'>Joshua Corbin</div><time datetime='2018-08-02T16:02:29Z'>Thu, 02 Aug 2018 16:02:29 UTC</time><div class='body'><p>Some thoughts on the transition from integer hash to string hash:<br>- the FNV family of hash functions are, in my view, about the simplest answer to the prompt "how would you turn an LCG into a hash function?": FNV just xors a byte of input into the hash, then twists the LCG (technically it's a degenerate Multiplicative Congruential Generator, and but I like to view it as a choice in Linear Congruential Generator space)<br>- I came by this viewpoint by, after being inspired by M.E. O'Neill's PCG construction, rediscovering how to convert a simple integer-based PRNG into a hash function; maybe you too will find some inspiration in PCG's permutation framework</p></div></div><div class='comment'><div class='author'>Pelle Evensen</div><time datetime='2018-08-02T16:20:51Z'>Thu, 02 Aug 2018 16:20:51 UTC</time><div class='body'><p>You may want to check this out:<br><a href="http://mostlymangling.blogspot.com/2018/07/mathjax.html" rel="nofollow noopener" title="http://mostlymangling.blogspot.com/2018/07/mathjax.html">http://mostlymangling.blogs...</a></p><p>I'm using a primitive that's not on your list but as far as I can measure very fast, comparable to x ^= x shift a:<br>x ^= ror(x, a) ^ ror(x, b), which is invertible for 64-bit x's and a != b.</p><p>It would be interesting to see what bias you detect. When I designed it, I used an energy function that considered higher order avalanche. Here is the version I posted a few weeks ago;</p><p>#include &lt;stdint.h&gt;</p><p>static inline uint64_t ror64(uint64_t v, int r) {<br>    return (v &gt;&gt; r) | (v &lt;&lt; (64 - r));<br>}</p><p>uint64_t rrmxmx(uint64_t v) {<br>    v ^= ror64(v, 49) ^ ror64(v, 24);<br>    v *= 0x9FB21C651E98DF25L;<br>    v ^= v &gt;&gt; 28;<br>    v *= 0x9FB21C651E98DF25L;<br>    return v ^ v &gt;&gt; 28;<br>}</p></div></div><div class='comment'><div class='author'>Bulat Ziganshin</div><time datetime='2018-08-21T22:13:37Z'>Tue, 21 Aug 2018 22:13:37 UTC</time><div class='body'><p>CRC-n on n-bit values is also reversible since it's remainder of polynomial division by some order-n polynomial</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-08-22T19:46:08Z'>Wed, 22 Aug 2018 19:46:08 UTC</time><div class='body'><p>Interesting, I didn't realize that about CRC-n.</p></div></div></div><div class='comment'><div class='author'>C. A. Ferraris</div><time datetime='2019-09-27T22:59:51Z'>Fri, 27 Sep 2019 22:59:51 UTC</time><div class='body'><p>I think there are other fast invertible primitives you may be able to make use of, e.g. <a href="https://www.felixcloutier.com/x86/bswap" rel="nofollow noopener" title="https://www.felixcloutier.com/x86/bswap">BSWAP</a>.</p><p>See also <a href="http://programming.sirrida.de/bit_perm.html" rel="nofollow noopener" title="http://programming.sirrida.de/bit_perm.html">http://programming.sirrida....</a> for many additional candidates (sure some of these primitives are fairly complex, but you already included XORL and XORR so I'm not sure where to draw the line).</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-09-29T17:31:37Z'>Sun, 29 Sep 2019 17:31:37 UTC</time><div class='body'><p>Oh, that's a good idea! I was focused only on primitives that can be expressed efficiently in portable C, so I hadn't considered it. But both GCC and Clang recognize a manual byteswap operation and emit a single bswap instruction for it. It's essentially the same situation as rotate. I'll have to try this out!</p></div></div></div></div><hr/><div class='thread'><h1 id='2018-09-06'><a href='/blog/2018/09/06/'>Brute Force Incognito Browsing</a></h1><div class='comment'><div class='author'>a</div><time datetime='2018-09-06T16:35:07Z'>Thu, 06 Sep 2018 16:35:07 UTC</time><div class='body'><p>In chromium you can simply click on the new tab button to open a new tab and search or open whatever you have in your selection clipboard.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-09-06T17:00:14Z'>Thu, 06 Sep 2018 17:00:14 UTC</time><div class='body'><p>Yeah, that's what I end up doing. I'm mostly complaining about having to make that extra click every time I start a fresh instance. :-) Mentally it feels like starting it up should work like opening a new empty tab, though I completely understand why this can't be.</p></div></div></div><div class='comment'><div class='author'>Maxolasersquad</div><time datetime='2018-09-06T19:38:47Z'>Thu, 06 Sep 2018 19:38:47 UTC</time><div class='body'><p>For these cases I simply open a "Guest Window" in Chrome. It's effectively and incognito window, but acts more like a regular window.</p></div></div><div class='comment'><div class='author'>NoonianAtall</div><time datetime='2018-09-07T06:32:34Z'>Fri, 07 Sep 2018 06:32:34 UTC</time><div class='body'><p>Very handy, thanks!</p></div></div><div class='comment'><div class='author'>NoonianAtall</div><time datetime='2018-09-07T06:41:56Z'>Fri, 07 Sep 2018 06:41:56 UTC</time><div class='body'><p>BTW, the HTML of this article is not correctly structured.  There is no HTML nor HEAD element.  It renders correctly in Chrome, but I noticed that Pandoc can't process it, because it acts as if the whole page were in a HEAD element with an empty BODY.</p></div><div class='comment'><div class='author'>Ash</div><time datetime='2018-09-07T13:47:09Z'>Fri, 07 Sep 2018 13:47:09 UTC</time><div class='body'><p>That's allowed in the HTML5 spec. The Google Style Guide even recommends omitting them. <a href="https://google.github.io/styleguide/htmlcssguide.html#Optional_Tags" rel="nofollow noopener" title="https://google.github.io/styleguide/htmlcssguide.html#Optional_Tags">https://google.github.io/st...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-09-07T14:58:23Z'>Fri, 07 Sep 2018 14:58:23 UTC</time><div class='body'><p>Yup, exactly right. I only just learned about this part of the HTML5 spec in February, after which I removed the unnecessary elements:<br> <a href="https://github.com/skeeto/skeeto.github.com/commit/7af822428bcfbb3e917cd3033437101083d6977b" rel="nofollow noopener" title="https://github.com/skeeto/skeeto.github.com/commit/7af822428bcfbb3e917cd3033437101083d6977b">https://github.com/skeeto/s...</a> <br>If you wanted to run my articles through Pandoc, you're better off working directly from the Markdown source. You can find it in that repository.</p></div><div class='comment'><div class='author'>NoonianAtall</div><time datetime='2018-09-10T13:22:26Z'>Mon, 10 Sep 2018 13:22:26 UTC</time><div class='body'><p>Well, I'm using org-web-tools, which downloads the URL and passes it directly through Pandoc.  I can capture any web page's content into Org by copying the URL to the clipboard and pressing "&lt;f1&gt; w r".  (It also makes use of "eww-readable" to extract only the "readable" portion of the page.)  Leaving out those tags breaks Pandoc, which breaks that simple workflow.</p><p>It also inevitably breaks many other HTML-consuming utilities which don't expect major structural tags like &lt;html&gt; and &lt;head&gt; to be left out, and those kind of utilities tend to not be updated for years, if ever.  I can't even find any issues on the Pandoc tracker about omitted or optional HTML tags.  If I posted a bug, it could be months or years before anyone fixes it, and then months or years more before the new Pandoc version hits Debian stable.  (I finally had to give up and install a binary package directly from Pandoc, because the version of Pandoc in my Ubuntu system is so outdated.)</p><p>I've been doing HTML for over 20 years, and while I don't keep up with all the latest stuff anymore, this is the first I've heard of leaving out &lt;html&gt; and &lt;head&gt;.  I don't think the breakage is worth it.  What's gained, other than complying with Google's arbitrary style guide?  If it breaks simple workflows with simple tools for Emacs users, is it worth it?  Having to go dig out a markdown file from a git repo is a lot of extra trouble.  :(</p><p>EDIT: Upon further investigation, it appears that it's not Pandoc that's the problem, but, probably, shr-dom-print in Emacs.  After parsing the HTML to a DOM object, since the original HTML lacks &lt;html&gt; and &lt;head&gt;, shr-dom-print puts the whole page in a &lt;head&gt;, so Pandoc sees an empty body.  And to be quite honest, I'm not interesting in digging into shr-dom-print, fixing the bug, and submitting a patch to emacs-devel.</p><p>This is an example of the kind of stuff that breaks when basic expectations are not fulfilled.  I think it's a very bad idea for those tags to be made optional in HTML5.  Please consider replacing them.</p></div></div></div></div></div><div class='comment'><div class='author'>Ash</div><time datetime='2018-09-07T13:55:00Z'>Fri, 07 Sep 2018 13:55:00 UTC</time><div class='body'><p>Back when I needed something similar, I installed a copy of my browser from <a href="http://PortableApps.com" rel="nofollow noopener" title="PortableApps.com">PortableApps.com</a>, did all the first time configuration, and put the installation into a git repo.</p><p>To reset the the browser back to its completely clean state, it was as easy as running a .bat file containing:<br>git reset --hard<br>git clean -fdx</p><p>Granted, this is Windows-specific, but something similar could be done in Linux.</p></div></div><div class='comment'><div class='author'>Anon</div><time datetime='2018-09-08T04:55:05Z'>Sat, 08 Sep 2018 04:55:05 UTC</time><div class='body'><p>Nice. If you want to treat the environment variables as untrusted, better switch the quote types in<br>  trap "rm -rf -- '$TEMP' " ...<br>to protect from injection :)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-09-08T13:39:19Z'>Sat, 08 Sep 2018 13:39:19 UTC</time><div class='body'><p>It's not so much that I don't trust the environment, but rather that I want the script to not choke on a weird profile path if possible. You're right that, as I've written it, it would choke if the path contains a single quote. Inverting the quotes on that line should solve it without really complex double-quote escaping.</p><p>At some point I got into the habit of writing traps the way that I did since it was necessary for the variable's current value to be captured in the trap string, rather than expanded later when the trap was executed. In this case that's not necessary.</p></div></div></div><div class='comment'><div class='author'>l0b0</div><time datetime='2018-09-08T05:43:38Z'>Sat, 08 Sep 2018 05:43:38 UTC</time><div class='body'><p>Neat! Trapping `EXIT` should be enough, at least in Bash (tested with Ctrl-c and `kill -TERM`).</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-09-08T13:33:48Z'>Sat, 08 Sep 2018 13:33:48 UTC</time><div class='body'><p>Hmm, looks like you're right. I tested with dash, too. If a SIGINT or SIGTERM causes the shell to exit, then it will already trap on the resulting EXIT. By trapping on the signals, I'm handling them, preventing them from causing an exit, which is kind of the opposite of the effect I want. (Note: Hitting CTRL-C while the browser is up causes the browser to get the signal rather than the shell.)</p></div></div></div><div class='comment'><div class='author'>Anonymous Coward</div><time datetime='2018-09-08T08:01:14Z'>Sat, 08 Sep 2018 08:01:14 UTC</time><div class='body'><p>If you really want to remove your temporary folder, you can also use `shred`. It will overwrite the content of your file instead of just delete them in the filesystem index.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-09-08T13:06:42Z'>Sat, 08 Sep 2018 13:06:42 UTC</time><div class='body'><p>Unfortunately shred is useless on modern systems, for both software and hardware reasons. Your best bet is to only store data encrypted, and then to destroy that data, you destroy the key. In this context, that means putting the profile in a temporary, encrypted volume.</p><p>Software: Filesystems are more complex today, and there's no reliable way to overwrite any particular underlying storage through the filesystem interface. Journals delaying writes are a problem (mitigated with fsync), but really advanced filesystems such as ZFS and Btrfs actively avoid overwriting older data (especially with snapshotting).</p><p>Hardware: SSDs add another layer to the problem with wear leveling and such. Not even the operating system can guarantee a piece of data has been completely overridden on physical storage. (Though this means the operating system probably can't access it anyway, which is worth something.)</p></div></div></div><div class='comment'><div class='author'>abigail buttox</div><time datetime='2018-09-08T12:04:29Z'>Sat, 08 Sep 2018 12:04:29 UTC</time><div class='body'><p>one remark; EXIT in trap is bash feature. change to '0' to be portable</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-09-08T12:49:32Z'>Sat, 08 Sep 2018 12:49:32 UTC</time><div class='body'><p>According to this documentation, EXIT is part of POSIX trap:</p><p><a href="http://pubs.opengroup.org/onlinepubs/007904975/utilities/trap.html" rel="nofollow noopener" title="http://pubs.opengroup.org/onlinepubs/007904975/utilities/trap.html">http://pubs.opengroup.org/o...</a></p><p>You are correct in that I really don't want any bash-isms in my script.</p></div></div></div><div class='comment'><div class='author'>possiblywrong</div><time datetime='2018-09-08T13:12:43Z'>Sat, 08 Sep 2018 13:12:43 UTC</time><div class='body'><p>Interesting post. I may misunderstand the sentence, but I think "intentionally unpredicate" is supposed to be "intentionally unpredictable"?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-09-08T13:42:47Z'>Sat, 08 Sep 2018 13:42:47 UTC</time><div class='body'><p>Oops, you're right! Fixed now. Thanks!<br> <a href="https://github.com/skeeto/skeeto.github.com/commit/db7802507d8e523aff40bc0efc82d5659a5341e2" rel="nofollow noopener" title="https://github.com/skeeto/skeeto.github.com/commit/db7802507d8e523aff40bc0efc82d5659a5341e2">https://github.com/skeeto/s...</a></p></div></div></div><div class='comment'><div class='author'>Roland</div><time datetime='2018-09-08T16:11:27Z'>Sat, 08 Sep 2018 16:11:27 UTC</time><div class='body'><p>Controlling this stuff isn't that difficult once you set it up:<br>Prefs=&gt;Privacy=&gt;CustomSettgs, check everything except "Always...", 3rd party cookies never. Close. Now hit Ctrl-Shift-Delete, you should get a box. Set the timespan to forever, check as many boxes as you want/can. You have fine control.</p><p>You should hit Ctrl-Shift-Delete frequently during the day, especially before and after doing anything financial. Now that wasn't too hard, was it?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-09-08T16:46:38Z'>Sat, 08 Sep 2018 16:46:38 UTC</time><div class='body'><p>Your instructions achieve a little bit of what I need, but misses a number of key features. There's more to my script than just clearing the basic browser state.</p><p>First, I don't necessarily want to destroy my main browser state just to test something. The whole point of this is to get a browser instance that's completely isolated from my primary browser.</p><p>Second, I mentioned in the article that, with my script, I can run multiple instances of private sessions in parallel, each isolated from each other. That's really useful for comparing between instances where I've intentionally diverged state. Destroying the state in my main browser doesn't help at all with this.</p><p>Third, my script gives me a fresh browser instance without extensions. Some extensions interfere with websites even when they're not supposed to. That's really bad for testing. For example, for a long time now if you visit Eric Raymond's blog in Firefox with uBlock Origin installed, it will have a horizontal scroll bar. This happens even when the extension is disabled. I haven't determined if this is a uBlock Origin bug or a Firefox bug (it doesn't happen in Chromium). Regardless, this reduces my confidence in Firefox to properly isolate itself when I need it to.</p><p>Further along this tangent, Ctrl-Shift-Delete doesn't clear extension state. I don't know what state might leaking through extensions. This would be a very difficult problem to solve -- exactly what state should get wiped from each extension? -- and would rely on each extension's developer to get the details right.</p></div></div></div><div class='comment'><div class='author'>lukaslt</div><time datetime='2018-09-08T18:33:56Z'>Sat, 08 Sep 2018 18:33:56 UTC</time><div class='body'><p>Instead of creating a fresh session, would it be possible to use a “template”? <br>Start a fresh session, do the initial setup (close initial browser tabs, install required plugins, etc).<br>Then starting new “private” session, copy the template to given random folder. Aka use it as a basic snapshot. <br>Or is there any risk of browsing this way?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-09-09T15:04:35Z'>Sun, 09 Sep 2018 15:04:35 UTC</time><div class='body'><p>Using a template is a really good idea. I'll have to try it out. I'll want both since sometimes I won't want to use a template, such as when I need a truly pristine configuration. It's useful when reproducing an issue.</p></div></div></div><div class='comment'><div class='author'>Jarbel Menucem</div><time datetime='2019-09-05T22:57:58Z'>Thu, 05 Sep 2019 22:57:58 UTC</time><div class='body'><p>Firefox Containers solves your problem</p></div></div></div><hr/><div class='thread'><h1 id='2018-09-20'><a href='/blog/2018/09/20/'>From Vimperator to Tridactyl</a></h1><div class='comment'><div class='author'>NoonianAtall</div><time datetime='2018-09-21T00:30:31Z'>Fri, 21 Sep 2018 00:30:31 UTC</time><div class='body'><p>Thanks for the detailed article, Chris.  I was a Pentadactyl user for a long time.  With the destruction of XUL, and gradual "Chromatization" of Firefox, there's less and less reason to use it over Chrome or Chromium.  That reasoning has always fallen on deaf ears at Mozilla, of course.  And after reading things like <a href="https://www.reddit.com/r/linux/comments/9hh3gc/to_unsuspecting_admins_firefox_continues_to_send/" rel="nofollow noopener" title="https://www.reddit.com/r/linux/comments/9hh3gc/to_unsuspecting_admins_firefox_continues_to_send/">https://www.reddit.com/r/li...</a> and <a href="https://blog.mozilla.org/data/2018/08/20/effectively-measuring-search-in-firefox/" rel="nofollow noopener" title="https://blog.mozilla.org/data/2018/08/20/effectively-measuring-search-in-firefox/">https://blog.mozilla.org/da...</a> , I'm not sure if Firefox is even better from a privacy perspective.</p><p>I'm glad that some people have the energy to work on Tridactyl, anyway.  For me, the issue of it not working until after a page has loaded is a deal-breaker; that kind of inconsistent, dependent behavior would drive me nuts.  I hope they're able to convince Mozilla to allow them to fix that, but I'm not holding my breath.</p><p>I almost feel like we're headed for another dark age of Web browsers, and it seems like the chances of coming out of it are less than last time because of the complexity issue.  I don't know if a phoenix can rise from these ashes again.  So I find myself using Elfeed, w3m, eww, org-web-tools, etc. more.  I use uBlock and uMatrix, of course, but I feel less interested in customizing my browser like I did with Firefox/Pentadactyl (I even released the TabTint Firefox extension, now consigned to the dust bin).  I feel like my effort would be wasted, whereas with Emacs, Org, etc, I feel like the improvements I make will last much longer.</p><p>Hey, NetSurf keeps chugging along, and I think it even supports JavaScript now.  Maybe someday it will be viable, haha.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-10-01T21:15:33Z'>Mon, 01 Oct 2018 21:15:33 UTC</time><div class='body'><p>Despite my optimism with Tridactyl, I too am worried we're still headed for a web browser dark age. Users are, in general, _far_ too tolerant of awful performance and interfaces. (That's much more the fault of app and web developers rather than browser developers.) Further, the complexity of the web has lead to centralization, which is ripe for abuse.</p><p>Until recently, I thought the end of XUL would play a much bigger role in this than it did. The reason that it didn't is not good news, though: Firefox is quickly becoming irrelevant. Today, most web browsing happens on mobile devices, and Firefox's mobile market share is half of a percent. Even on the desktop it's under 10% and still plummeting.</p><p>A big reason behind Firefox's "Chromatization" — not just with dropping XUL extensions, but also, as a side effect, the overall gradual reduction of customizability, including the removal of useful about:config entries — is a desperate attempt to remain relevant. But you're right, what's the point of using Firefox if it's just like Chrome? For me it's still different enough, but for most users it isn't.</p></div></div></div><div class='comment'><div class='author'>Aurélien Gâteau</div><time datetime='2018-09-21T15:35:24Z'>Fri, 21 Sep 2018 15:35:24 UTC</time><div class='body'><p>Nice article! I need to give Tridactyl a try!<br>Regarding keyboardless browsing, I find Firefox context menu surprisingly efficient. I use it a lot, especially for going to the previous page.</p></div></div><div class='comment'><div class='author'>Visitor</div><time datetime='2018-12-12T17:17:55Z'>Wed, 12 Dec 2018 17:17:55 UTC</time><div class='body'><p>You may like to try Surfingkeys <a href="https://github.com/brookhong/Surfingkeys" rel="nofollow noopener" title="https://github.com/brookhong/Surfingkeys">https://github.com/brookhon...</a>. I'm an Emacs user and use Emacs default key bindings. After using Surfingkeys for few months, I think I may switch to the EVIL side.</p></div></div><div class='comment'><div class='author'>jemin</div><time datetime='2018-12-14T12:12:36Z'>Fri, 14 Dec 2018 12:12:36 UTC</time><div class='body'><p>How do you set up search key now that the earlier version was deprecated?</p><p>searchsetkeyword</p><p>    searchsetkeyword(keyword: string, url: string): void</p><p>        Defined in src/excmds.ts:2819</p><p>    Set a search engine keyword for use with *open or set searchengine</p><p>    deprecated</p><p>        use set searchurls.KEYWORD URL instead</p></div></div><div class='comment'><div class='author'>jemin</div><time datetime='2018-12-14T12:16:03Z'>Fri, 14 Dec 2018 12:16:03 UTC</time><div class='body'><p>Ah, actually it is the reverse. The setting you show is actually the current one.</p><p>Still, .tridactylrc does not seem to be picked up by firefox. Setting in the tri's command prompt works, though.</p></div></div><div class='comment'><div class='author'>Ramiro Rela</div><time datetime='2019-07-19T19:06:54Z'>Fri, 19 Jul 2019 19:06:54 UTC</time><div class='body'><p>Did you ever get to use muttator on thunderbird? It's the same project as vimperator. I lost it and don't have a replacement.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-07-21T00:10:40Z'>Sun, 21 Jul 2019 00:10:40 UTC</time><div class='body'><p>Sorry, I just use Mutt itself for email, and I don't have any use for Thunderbird. I don't expect I'll ever try Muttator.</p></div></div></div></div><hr/><div class='thread'><h1 id='2018-10-31'><a href='/blog/2018/10/31/'>The Missing Computer Skills of High School Students</a></h1><div class='comment'><div class='author'>Антон Южанинов</div><time datetime='2018-11-01T01:08:14Z'>Thu, 01 Nov 2018 01:08:14 UTC</time><div class='body'><p>It is definitely better to touch type but I don't think it is a big issue. I learned to touch type about year or two ago, after many years working as sysadmin/developer. And I still type only marginally faster then before. I was able to type fast looking at keyboard and using only a few fingers. If you type a lot you will type fast even without touch typing.</p></div></div><div class='comment'><div class='author'>typer</div><time datetime='2018-11-01T01:57:59Z'>Thu, 01 Nov 2018 01:57:59 UTC</time><div class='body'><p>I have something to add to your discussion of "students have poor typing skills".</p><p>Most people, at least, me, and the people I know, generally do not learn how to type from a "type training" computer class (unless word processing in an office is one's day job). Of course in the very beginning, when you just started to use the keyboard, you need some basic training and practice by using various software, but **real typing skill is learned by actually using the computers day-by-day** - on surfing the web, chatting, gaming, programming, or editing an actual document.</p><p>In this process, people can often learn their own way of typing, which "just works" for them, despite its inefficiency compared to touch-typing in the standard finger position. For example, I can type at 50 WPM minimum by just pecking two fingers on the keyboard, and even faster when I use more fingers. I barely need to look down at the keyboard, I only do it to readjust my hand position, but most of the time, I can do this by using the text I just mistyped on the screen as my feedback. Many people I know who are not touch-typers, have naturally acquired similar typing skills.</p><p>Just in the same way, when the cool kids in the 2000s were using SMS to text all the days, they learned to type at an unbelievable speed on the 3x3 numpad phone keyboard, which I see as a a form of torture.</p><p>In conclusion, IMHO, touch-typing in standard finger position is ABSOLUTELY NOT REQUIRED to be a successful computer technician. As long as you can type in a reasonable speed so it doesn't become a significant bottleneck of your human-machine interface, it is okay. It is good to learn the standard way to improve your efficiency, but often it is optional.</p><p>On the other hand, I think the real underlying cause of "poor typing skills" problem, is exactly the same "poor computer knowledge" problem you are addressing, they are closely related - if one is struggling to type words and commands on the keyboard, e.g. to use a commandline often indicates A LACK OF GENERAL EXPERIENCE ON USING COMPUTERS, and this is the real problem.</p><p>Many people from the younger generation simply don't have the experience of surfing the web, posting in online forums, writing one's own blog posts, or chatting all night long, or even gaming, ON A GENERAL-PURPOSE COMPUTER, which was exactly how the older generation learned to type, or learned the basis of computing, at least the application.</p><p>As general-purpose computers are becoming less and less common, this is going to be the new norm.</p></div></div><div class='comment'><div class='author'>No_Ads_No_Tracking_No_PII</div><time datetime='2018-11-01T02:26:37Z'>Thu, 01 Nov 2018 02:26:37 UTC</time><div class='body'><p>I have something to add to your discussion of "students have poor typing skills".</p><p>Most people, at least, me, and the people I know, generally do not learn how to type from a "type training" computer class (unless word processing in an office is one's day job). Of course in the very beginning, when you just started to use the keyboard, you need some basic training and practice by using various software, but <strong>real typing skill is learned by actually using the computers day-by-day</strong> - on surfing the web, chatting, gaming, programming, or editing an actual document.</p><p>In this process, people can often learn their own way of typing, which "just works" for them, despite its inefficiency compared to touch-typing in the standard finger position. For example, I can type at 50 WPM minimum by just pecking two fingers on the keyboard, and even faster when I use more fingers. I barely need to look down at the keyboard, I only do it to readjust my hand position, but most of the time, I can do this by using the text I just mistyped on the screen as my feedback. Many people I know who are not touch-typers, have naturally acquired similar typing skills.</p><p>Just in the same way, when the cool kids in the 2000s were using SMS to text all the days, they learned to type at an unbelievable speed on the 3x3 numpad phone keyboard, which I see as a a form of torture.</p><p>In conclusion, IMHO, touch-typing in standard finger position is ABSOLUTELY NOT REQUIRED to be a successful computer technician. As long as you can type in a reasonable speed so it doesn't become a significant bottleneck of your human-machine interface, it is okay. It is good to learn the standard way to improve your efficiency, but often it is optional.</p><p>On the other hand, I think the real underlying cause of "poor typing skills" problem, is exactly the same "poor computer knowledge" problem you are addressing, they are closely related - if one is struggling to type words and commands on the keyboard, e.g. to use a commandline often indicates A LACK OF GENERAL EXPERIENCE ON USING COMPUTERS, and this is the real problem.</p><p>Many people from the younger generation simply don't have the experience of surfing the web, posting in online forums, writing one's own blog posts, or chatting all night long, or even gaming, ON A GENERAL-PURPOSE COMPUTER, which was exactly how the older generation learned to type, or learned the basis of computing, at least the application.</p><p>As general-purpose computers are becoming less and less common, this is going to be the new norm.</p></div></div><div class='comment'><div class='author'>Dave Delaney</div><time datetime='2018-11-01T10:07:33Z'>Thu, 01 Nov 2018 10:07:33 UTC</time><div class='body'><p>As a dad this hits home for me. I especially want my kids to learn the essentials. I need to do a better job at getting them participating. It would probably help to buy them machines they can poke around with. I wonder what percentage of homes now exclusively have mobile devices/tablets without PCs. If it's as high as I think, your 80s analogy is spot on.</p><p>Any tips on the best machines for them to learn on? Maybe I need to get them a TRS-80 or C64, like I learned on.</p></div><div class='comment'><div class='author'>OllieJones</div><time datetime='2018-11-01T10:16:15Z'>Thu, 01 Nov 2018 10:16:15 UTC</time><div class='body'><p>For the typing, IT, and academic skills: previous-generation laptops back from corporate lease. They're tough, and they're cheap. Ebay.</p><p>For computer skills in general: Previous generation minitowers. Kids can take them apart, add components, and so forth. If you can possibly make the kids use wired ethernet to connect, that will help: that will help them get a concrete conceptual model of the intertoobz.  Then, when one of them has $20 from mowing a lawn or something, she can buy her own wifi dongle.</p><p>Or, as Chris wrote, a Raspberry Pi starter kit, a monitor, a mouse, and a GOOD keyboard. Skimp on anything, but not on the keyboard.</p></div><div class='comment'><div class='author'>Dave Delaney</div><time datetime='2018-11-01T10:28:56Z'>Thu, 01 Nov 2018 10:28:56 UTC</time><div class='body'><p>Great call! Thanks, Ollie.</p></div></div></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-11-01T21:27:27Z'>Thu, 01 Nov 2018 21:27:27 UTC</time><div class='body'><p>I'd just put the kid in front of a Linux system either on a spare machine or a Raspberry Pi (clone or not). Something where you could give them enough freedom to break it (unintentionally). If you want to go old school, the Z80 paired with the excellent book Programming the Z80 would be pretty exciting:</p><p><a href="http://www.z80.info/zip/zaks_book.pdf" rel="nofollow noopener" title="http://www.z80.info/zip/zaks_book.pdf">http://www.z80.info/zip/zak...</a></p><p>I would have loved to have that when I was a kid. I've never tried to teach someone using this book, though.</p></div></div></div><div class='comment'><div class='author'>OllieJones</div><time datetime='2018-11-01T10:07:47Z'>Thu, 01 Nov 2018 10:07:47 UTC</time><div class='body'><p>Thanks for the post. It's good to be reminded what's obvious and what isn't.</p><p>There was a time when US high schools offered classes in typing. When I took one (I'm not saying how long ago) it included some basic layout skills. But the meat of it , on Royal manual typewriters, was drills:</p><p> a;sldkfjgh</p><p>repeated enough times to get the finger positions into muscle memory. A semester of that made a huge difference to my work life and my ability to create. I'm hard on keyboards because I learned to pound. But they are cheap.</p><p>For a while Apple had the pole position in computers for young students. But, when they started pushing tablets, Google and the OEMs started pushing Chromebook mini-laptops.  The school system where I volunteer has ditched Apple and gone with Chromebooks, BECAUSE THEY HAVE KEYBOARDS. It helps that they're robust, cheap and easy to manage.</p><p>But the schools are not doing a good job teaching kids to USE those keyboards.</p><p>The vocational school kids learn their trades by practicing muscle memory: culinary students cook, electrical students wire things up, and so forth.</p><p>Knowledge work is a vocation too. The core skill for knowledge work is TYPING.  You're a programmer: you type for a living. You're an insurance worker: you type for a living. You're a librarian, you type for a living.</p><p>You go to college: you type, and type, and type.</p><p>Endless typing drills are boring. But the benefits over a lifetime are vast.</p><p>Schools! Do this!</p></div></div><div class='comment'><div class='author'>Mike Zamansky</div><time datetime='2018-11-01T11:39:01Z'>Thu, 01 Nov 2018 11:39:01 UTC</time><div class='body'><p>I don't know if it's fair to blame the schools. I think it's more the society we're in and the technology we have.</p><p>I wrote about this a couple of times:</p><p><a href="https://cestlaz.github.io/posts/2015-01-15-kids-know-nuttin.html/" rel="nofollow noopener" title="https://cestlaz.github.io/posts/2015-01-15-kids-know-nuttin.html/">https://cestlaz.github.io/p...</a></p><p><a href="https://cestlaz.github.io/oldblog/keyboarding-dig-divite/" rel="nofollow noopener" title="https://cestlaz.github.io/oldblog/keyboarding-dig-divite/">https://cestlaz.github.io/o...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-11-01T21:48:24Z'>Thu, 01 Nov 2018 21:48:24 UTC</time><div class='body'><p>Fair enough. I suppose the root of the problem goes deeper than schools. Thanks for the links! I hadn't yet seen the "A new digital divide" article linked from your article.</p></div></div></div><div class='comment'><div class='author'>Chris Gonnerman</div><time datetime='2018-11-01T13:41:28Z'>Thu, 01 Nov 2018 13:41:28 UTC</time><div class='body'><p>I have worked with general users on computers for my entire career, basically since 1984, and one of the things I've found to be true is that people either "get" paths or they don't. I often ask users, if I gave them a flash drive and told them there was a file in a folder on that drive, and gave them the names of both, could they find it?  Almost all of those who answer yes tell me they don't understand what's hard about it; practically none of those who answer no ever figure it out.  Age and gender don't seem to have any effect, though I have not actually done statistics.  It seems to be a kind of abstract thinking that not everyone has.  Curiously, I find accountants (and accounting students) mostly get it.  Nothing more abstract than a page full of numbers, I suppose.  And general intelligence isn't an indicator either... my favorite (now retired) doctor never got it, and I have great confidence in his intelligence.  But everything in his world is real and physical; there's nothing abstract about a heart or lungs or whatever.</p></div></div><div class='comment'><div class='author'>possiblywrong</div><time datetime='2018-11-01T20:32:41Z'>Thu, 01 Nov 2018 20:32:41 UTC</time><div class='body'><p>I know we've talked about this, but I think it's worth commenting on some additional good observations here: I tend to agree with the disconnect starting in the schools (and I typically have to *defend* the quality of public school education, at least in this area). I find it fascinating that there is so much current emphasis on "STEM," while at the same time a seeming lack of recognition of how fundamental the keyboard is to almost any S-, T-, E-, or M-related vocation.</p></div></div><div class='comment'><div class='author'>David Kraft</div><time datetime='2018-11-02T00:14:56Z'>Fri, 02 Nov 2018 00:14:56 UTC</time><div class='body'><p>WHAT? <br>How about Excel?<br>There isn't a human being in the workforce that shouldn't be able to add a column of numbers together.</p><p>Cutting and pasting grid data and manipulating it to your needs is essential.</p><p>Fundamental as reading and writing.</p></div></div><div class='comment'><div class='author'>Hirox</div><time datetime='2018-11-02T10:53:46Z'>Fri, 02 Nov 2018 10:53:46 UTC</time><div class='body'><p>I'm a main programmer in a major game publisher / studio. We had a wrong hire not long ago.</p><p>She's a multimedia major student. And she applied Planner and IT department. IT dept were full so she got assigned to my team.<br>I can assure you, team treated her like a princess, but... no way we can say she's useful to the team.<br>1. Don't know where to find installers.<br>2. Unfamiliar with Windows, need people help setting up her PC.<br>3. Deleted resources / repo by accident.<br>4. Definitely unfit to be a programmer.<br>5. etc, etc.<br>School lab has PCs but all softwares were pre-installed, no set up needed, and at home, she only use iPhone. Apparently, she's not alone in this.</p><p>Do you think IT will suit her better? Planer? Even a Planer needs to be familiar with Version Controller, Ticket System, Project Manager, MS Office (especially Excel), Database and other business tools.<br>Law firm? Accountant?<br>How about canteen staff? Front desk? Arcade center staff?</p><p>Kids are innocent imo. I blame parents and school, the system.<br>Imagine this. Parents thinks their kids are so smart, knows how to swipe / operate "PC" without me teaching... Yeah, that's the source of the problem. And professors in the universities failed at teaching those kids PC skills. Or, maybe, you reckon it is already too late (typping with muscle memory for example)? When I was 13 or 14, I was fumbling around and built my 1st PC. I broke it then I diagnosed and fixed it. I knew what a "computer" is way before I enter university.<br>* Then programming became my vocation. C++ is my root. Havok took me a month to start cause I had 0 3d programming knowledge at the time. I can start fumbling JS, html5, python, Java, C#, Unity, Unreal, jQuery (I even wrote my own framework before jQuery's time) and other computer languages around on day 1.</p></div><div class='comment'><div class='author'>Hirox</div><time datetime='2018-11-02T11:12:24Z'>Fri, 02 Nov 2018 11:12:24 UTC</time><div class='body'><p>btw, not long ago, someone was arguing on the internet, saying business applications are better on the iOS because it has APP and Windows only have WEB version. And because of that, his company, are adapting iPads (I bet it was a lie).</p><p>Ticket System for example.<br>Say, you are on the ListView. You are about to open a ticket. What if, you don't want to navigate away from the ListView?</p><p>Most "APP", shows 1 view at a time. So when you open ticket#123, ListView is gone. What if you want to go to ticket#432? Hit the back button at the top left corner (instead of alt+ left). Wait for the ListView to reload then navigate to ticket#432.</p><p>On Windows (browser), you have tabs and windows.<br>Colleague came "hey, can you double check ticket#432 with me?"<br>"Sure" you then alt+d, ctrl+c, ctrl+n, alt+d, ctrl+v, end, ctrl+backSpace, 432, enter.<br>What if you want to compare 2 tickets side by side? win+right, alt+tab, win+left.<br>What if you want to jump between tabs? ctrl(+shift)+tab or, ctrl+[numKeys].</p><p>How do you correct typo?<br>left, menu, enter?</p><p>Some tools lack pro-features/shortcuts, you cannot hack it or inject scripts to enhance your work flow on phone OSes. You cannot hack stuff, create automations to speed up your work flow on phone OSes too.</p><p>How efficient can you work on a phone OS?</p></div></div></div><div class='comment'><div class='author'>oso2k</div><time datetime='2018-11-26T17:49:44Z'>Mon, 26 Nov 2018 17:49:44 UTC</time><div class='body'><p>Chris,</p><p>Something I've started using with my daughter is "Mario Teaches Typing for DOS" as hosted on the Internet Archive.  Simply google for "Internet Archive Mario Teaches Typing".</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-11-26T22:24:18Z'>Mon, 26 Nov 2018 22:24:18 UTC</time><div class='body'><p>That's a good idea. I've got an old DOS copy of Mavis Beacon for similar reasons. Works great. I've looked into the open source options since I generally prefer it, but they're just not good enough to recommend to anyone.</p></div><div class='comment'><div class='author'>oso2k</div><time datetime='2018-12-04T19:31:36Z'>Tue, 04 Dec 2018 19:31:36 UTC</time><div class='body'><p>Same here.   :/   Educational software is somewhere FLOSS is far behind Closed Source.</p></div></div><div class='comment'><div class='author'>4thGenBendite77</div><time datetime='2019-01-03T03:47:25Z'>Thu, 03 Jan 2019 03:47:25 UTC</time><div class='body'><p>skeeto but</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2018-11-15'><a href='/blog/2018/11/15/'>A JIT Compiler Skirmish with SELinux</a></h1><div class='comment'><div class='author'>ttsiodras</div><time datetime='2018-11-16T20:23:20Z'>Fri, 16 Nov 2018 20:23:20 UTC</time><div class='body'><p>Excellent story - I learned a lot!</p><p>Thanks for sharing.</p></div></div></div><hr/><div class='thread'><h1 id='2018-11-21'><a href='/blog/2018/11/21/'>Why Aren&#39;t There C Conferences?</a></h1><div class='comment'><div class='author'>Jon Kalb</div><time datetime='2018-11-24T20:24:19Z'>Sat, 24 Nov 2018 20:24:19 UTC</time><div class='body'><p>Chris,</p><p>How would you feel about making this into a play list for the CppCon YouTube channel?</p><p>Let's make that happen.</p><p>Jon</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2018-11-26T22:21:34Z'>Mon, 26 Nov 2018 22:21:34 UTC</time><div class='body'><p>Good idea, Jon. I just put these together:<br> <a href="https://www.youtube.com/playlist?list=PLhDGzIT9alpDT87TYoFFSE91hPXmgYgkC" rel="nofollow noopener" title="https://www.youtube.com/playlist?list=PLhDGzIT9alpDT87TYoFFSE91hPXmgYgkC">https://www.youtube.com/pla...</a> <a href="https://www.youtube.com/playlist?list=PLhDGzIT9alpBRl4biKm1HjvRYf5WBanQ1" rel="nofollow noopener" title="https://www.youtube.com/playlist?list=PLhDGzIT9alpBRl4biKm1HjvRYf5WBanQ1">https://www.youtube.com/pla...</a> <br>I almost didn't do it since the YouTube UI is so ridiculously awful, and I was terrified at the idea of of manually adding 42 videos through that interface. Fortunately I found this nice little hack and it only took a few minutes:</p><p><a href="https://webapps.stackexchange.com/a/106340" rel="nofollow noopener" title="https://webapps.stackexchange.com/a/106340">https://webapps.stackexchan...</a></p><p>(I did get your email about this. I've just been neglecting my email lately.)</p></div><div class='comment'><div class='author'>Jon Kalb</div><time datetime='2018-11-26T23:08:50Z'>Mon, 26 Nov 2018 23:08:50 UTC</time><div class='body'><p>Do reply by email and we'll discuss hosting a version of your blog post on <a href="https://cppcon.org" rel="nofollow noopener" title="https://cppcon.org">https://cppcon.org</a> and putting the playlist on our channel.</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2018-12-25'><a href='/blog/2018/12/25/'>A Survey of $RANDOM</a></h1><div class='comment'><div class='author'>John Doe</div><time datetime='2018-12-27T13:34:57Z'>Thu, 27 Dec 2018 13:34:57 UTC</time><div class='body'><p>You can find the code of ksh86a, with the RANDOM variable already present, here:<br><a href="https://github.com/weiss/original-bsd/blob/master/local/toolchest/ksh/sh/msg.c#L202" rel="nofollow noopener" title="https://github.com/weiss/original-bsd/blob/master/local/toolchest/ksh/sh/msg.c#L202">https://github.com/weiss/or...</a></p><p>The version number is here: <a href="https://github.com/weiss/original-bsd/blob/master/local/toolchest/ksh/sh/msg.c#L28" rel="nofollow noopener" title="https://github.com/weiss/original-bsd/blob/master/local/toolchest/ksh/sh/msg.c#L28">https://github.com/weiss/or...</a> : ksh-06/03/86a</p><p>Also, the RELEASE file for this version (<a href="https://github.com/weiss/original-bsd/blob/master/local/toolchest/ksh/RELEASE)" rel="nofollow noopener" title="https://github.com/weiss/original-bsd/blob/master/local/toolchest/ksh/RELEASE)">https://github.com/weiss/or...</a> reference the list of changes introduced since the previous version (ksh-02/21/85). It *does not mention RANDOM*, bit mention fo rexample the addition of the special variable SECONDS, or change of behavior for variables PWD and _ (underscore), or bugfix for the variable PPID. So, I guess it is safe to assume that RANDOM var already present in ksh-02/21/85.</p></div></div></div><hr/><div class='thread'><h1 id='2019-01-23'><a href='/blog/2019/01/23/'>A JavaScript Typed Array Gotcha</a></h1><div class='comment'><div class='author'>Klaus</div><time datetime='2019-01-23T08:22:50Z'>Wed, 23 Jan 2019 08:22:50 UTC</time><div class='body'><p>Gotta love MATLAB XD</p><p>(See link at end of article)</p><p>Now I wonder if the behaviour is consistent in Octave.</p></div></div><div class='comment'><div class='author'>WebReflection</div><time datetime='2019-02-11T15:24:36Z'>Mon, 11 Feb 2019 15:24:36 UTC</time><div class='body'><p>Alternatively: `let r = (++array[0], array[0]);` 🎉</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-02-11T15:49:05Z'>Mon, 11 Feb 2019 15:49:05 UTC</time><div class='body'><p>Clever!</p></div></div></div></div><hr/><div class='thread'><h1 id='2019-01-25'><a href='/blog/2019/01/25/'>The Day I Fell in Love with Fuzzing</a></h1><div class='comment'><div class='author'>César Rodríguez</div><time datetime='2019-01-28T19:47:19Z'>Mon, 28 Jan 2019 19:47:19 UTC</time><div class='body'><p>Did you consider using a dictionary for your input format? I'm sure you can improve the coverage of your tests by using one. More in section 9 of <a href="http://lcamtuf.coredump.cx/afl/README.txt" rel="nofollow noopener" title="http://lcamtuf.coredump.cx/afl/README.txt">http://lcamtuf.coredump.cx/...</a>.</p><p>Another point is that updating the code doesn't render useless all AFL-generated tests. You can always use them as seeds in a new fuzzing session on the updated source code. The coverage you already achieved with them in the previous session will save you time for the next one.</p><p>AFL is great if you want to fuzz a C program, but for managed languages (e.g, Java) there is practically nothing available. We are trying to put an end to that: <a href="https://www.diffblue.com/blog/2018/12/19/diffblue-microservice-testing-a-sneak-peek-at-our-early-product-and-results" rel="nofollow noopener" title="https://www.diffblue.com/blog/2018/12/19/diffblue-microservice-testing-a-sneak-peek-at-our-early-product-and-results">https://www.diffblue.com/bl...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-01-28T20:22:09Z'>Mon, 28 Jan 2019 20:22:09 UTC</time><div class='body'><p>Thanks for the tips. I'm aware of afl's support for dictionaries, but, since it's just INI, the input has no keywords. Some strings may be special to the game, but my parser only knows about INI. All the special parts of the syntax (brackets, commas, quotes, etc.) are single bytes, which, unlike long keywords, are not difficult for afl to discover on its own. It even very quickly figured out floating point syntax — though without instrumentation on strtod() there wasn't much more for it to explore.</p><p>That's also a good point about about seeding the next corpus from the current test set.</p></div></div></div><div class='comment'><div class='author'>Philippe Bourgau</div><time datetime='2019-02-06T12:50:28Z'>Wed, 06 Feb 2019 12:50:28 UTC</time><div class='body'><p>Thanks for the article. My team thought of similar tools when doing exploratory testing, and I'm really interested to see that there is some theory behind this technique.</p><p>We were doing exploratory testing, through the UI, which has some pros and cons compared to fuzzing. We would use gamification to spice the thing up a bit and make developers want to break their program! (<a href="https://philippe.bourgau.net/how-we-started-exploratory-testing/)" rel="nofollow noopener" title="https://philippe.bourgau.net/how-we-started-exploratory-testing/)">https://philippe.bourgau.ne...</a></p><p>I guess fuzzing would come has a handy tool when doing exploratory testing.</p></div></div><div class='comment'><div class='author'>Qqwy</div><time datetime='2019-04-12T06:13:06Z'>Fri, 12 Apr 2019 06:13:06 UTC</time><div class='body'><p>What is your opinion about Property-based testing? When would you use fuzzing vs propchecking?</p></div></div></div><hr/><div class='thread'><h1 id='2019-02-24'><a href='/blog/2019/02/24/'>The CPython Bytecode Compiler is Dumb</a></h1><div class='comment'><div class='author'>Kurt Jung</div><time datetime='2019-02-25T00:11:19Z'>Mon, 25 Feb 2019 00:11:19 UTC</time><div class='body'><blockquote>...in this case for my wife’s photo blog</blockquote><p></p><p>Stunning bird photographs, really exceptional. And nice work on that responsive static album generator. Now time to continue reading about CPython byte code...</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-02-25T12:49:36Z'>Mon, 25 Feb 2019 12:49:36 UTC</time><div class='body'><p>Thanks, Kurt! I showed her your comment.</p></div></div></div><div class='comment'><div class='author'>D ZJ</div><time datetime='2019-02-25T03:40:43Z'>Mon, 25 Feb 2019 03:40:43 UTC</time><div class='body'><p>Optimization passes obvious takes time. So Julia does the compilation and stores the compiled function. I guess some implementation of Python can try a similar route where the first time a function runs it tries to compile it with optimization passes. But that changes the whole language. Julia on the other hand can suffer from long compilation times if the programs are complex.</p><p>maybe give Julia a try and see if you like it.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-02-25T13:07:11Z'>Mon, 25 Feb 2019 13:07:11 UTC</time><div class='body'><p>I did look into Julia about five years ago:</p><p><a href="https://nullprogram.com/blog/2014/03/06/" rel="nofollow noopener" title="https://nullprogram.com/blog/2014/03/06/">https://nullprogram.com/blo...</a></p><p>I thought the FFI API was super-slick and it inspired me to experiment with an Emacs Lisp FFI. My complaint about modules was too harsh. I don't really care much about inferior-process interactive development anymore, so that part doesn't really matter to me. I still think its string indexing is weird and ill-suited for its intended target audience.</p><p>I don't personally have a need for Julia, but I do have a bunch of Matlab-addicted co-workers. My exploration of Julia was more about finding an alternative that I could sell to them so that they could kick their expensive and unhealthy habit. I would happily use Julia instead of Matlab when collaborating with them. After all these years still no luck with either Julia or NumPy + Matplotlib.</p></div></div></div><div class='comment'><div class='author'>dave</div><time datetime='2019-02-25T04:49:09Z'>Mon, 25 Feb 2019 04:49:09 UTC</time><div class='body'><p>Obviously there's not much value in optimizing specific cases like 'return [1024][0]' because that would rarely if ever occur in real code. But the problem is that nearly anything more general than that could likely not be optimizable because dynamic typing, operator overloading, runtime eval support, etc. all combine to make it all but impossible to know ahead of time what the actual behavior will be.</p><p>So yes you could optimize the specific case of a builtin array object being created explicitly and initialized with an explicit single member that is an int followed by an array access of an explicit numerical parameter. But even small differences from that exact set of conditions and you can't really optimize it anymore - if you instead use a class constructor instead of array syntactic sugar, or instead of an explicit int you use a variable that may not point to an int for the initialized value, or instead of an explicit int for the array index you use a variable that may not point to an int, then it may no longer be safe to take a shortcut.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-02-25T13:22:37Z'>Mon, 25 Feb 2019 13:22:37 UTC</time><div class='body'><p>Yeah, you'll never see "[1024][0]" in real code. I wrote it that way to avoid introducing a variable, which, from the previous section, I already knew would inhibit modification. Consider a function that references a dict as if it were static data local to that function. The data never changes, so it doesn't really need to be reconstructed every time the function is called.</p><p>table = {'a': 1, 'b': 2, 'c': 2}<br>return table[name]</p><p>This isn't uncommon. The bytecode compiler does the "dumb" thing and rebuilds the dict each time. (This is exactly the sort of thing escape analysis is for.) If I want to avoid this penalty, I have to arrange for it myself, like you were saying (global variable, closure, class member, etc.).</p></div></div></div><div class='comment'><div class='author'>possiblywrong</div><time datetime='2019-02-25T14:34:10Z'>Mon, 25 Feb 2019 14:34:10 UTC</time><div class='body'><p>Very interesting post, particularly the comparison with other language compilers. Python strives to be a language that "you can keep in your head," not having nooks and crannies and unexpected corner cases either in its language specification or in its implementation. Although I think it does a decent job of this (or at least it used to, but just like C++, the spec is getting more complex), your puzzle involving the tuple modification (and the constant optimization discussed here) was an interesting unexpected gotcha for me.</p><p>I'm reminded of another gotcha presented by a student, who while learning to program had gotten in the habit of always testing boolean conditions by explicit equality comparison with the literal True... with unexpected results that made me stop and think. For example:</p><p>x=-1<br>if x &lt; 0 == True: print('Negative')</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-02-26T22:58:00Z'>Tue, 26 Feb 2019 22:58:00 UTC</time><div class='body'><p>Your example was really puzzling. I was confused for awhile, but I think I figured it out thanks to something you pointed out a couple years ago. <br>I looked up Python operator precedence to see if there was anything funny going on. I did notice that Python gives the relational and equality operators equal precedence, which is unusual (but has a good reason). Most languages, including C, give relational operators higher precedence in order to avoid this sort of confusion.</p><p>However, in this case, having equal precedence wouldn't hurt since its left-to-right and the relational operator came first. So that's not it. Next I looked at the assembly for that bytecode and walked through it, which is when it hit me: Python does the conventional mathematics notation thing with "a &lt; b &lt; c". This is just a case of it in action.</p><p>Something else I learned from the bytecode is that "a &lt; b &lt; c" is short-circuiting. You can count on it stopping evaluation as soon as it knows the answer.</p></div></div><div class='comment'><div class='author'>shevek</div><time datetime='2019-03-02T20:51:28Z'>Sat, 02 Mar 2019 20:51:28 UTC</time><div class='body'><p>One more interesting example of the same gotcha is:<br><code>False == False in [False]</code></p></div></div></div><div class='comment'><div class='author'>kallikanzarid</div><time datetime='2019-02-27T12:52:19Z'>Wed, 27 Feb 2019 12:52:19 UTC</time><div class='body'><p>At least when you're dealing with NumPy, you can use Numba. It JIT-compiles functions that you mark with a special decorator allowing you to create arrays and loop over them without paying for the interpreter overhead. It's useful for writing kernels on Kaggle or just any prototyping any numerical code where you have a bottleneck that you don't want to rewrite in C.</p><p><a href="https://numba.pydata.org" rel="nofollow noopener" title="https://numba.pydata.org">https://numba.pydata.org</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-02-27T16:14:41Z'>Wed, 27 Feb 2019 16:14:41 UTC</time><div class='body'><p>Didn't know about Numba, thanks!</p></div></div></div><div class='comment'><div class='author'>shevek</div><time datetime='2019-03-02T20:54:12Z'>Sat, 02 Mar 2019 20:54:12 UTC</time><div class='body'><p>@skeeto:disqus <br>Very interesting post, thank you :)</p></div></div></div><hr/><div class='thread'><h1 id='2019-03-08'><a href='/blog/2019/03/08/'>Python Decorators: Syntactic Artificial Sweetener</a></h1><div class='comment'><div class='author'>Clément Pit-Claudel</div><time datetime='2019-03-09T16:46:18Z'>Sat, 09 Mar 2019 16:46:18 UTC</time><div class='body'><p>&gt; but I still wonder why it was defined that way.</p><p>The PEP explains it, actually: 'The decorator statement is limited in what it can accept -- arbitrary expressions will not work. Guido preferred this because of a gut feeling [17].'  The link is to <a href="https://mail.python.org/pipermail/python-dev/2004-August/046711.html" rel="nofollow noopener" title="https://mail.python.org/pipermail/python-dev/2004-August/046711.html">https://mail.python.org/pip...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-03-09T17:31:18Z'>Sat, 09 Mar 2019 17:31:18 UTC</time><div class='body'><p>Ah, thanks, I didn't notice that. Looks like I'm 15 years behind on this.</p></div></div></div><div class='comment'><div class='author'>Henry Chen</div><time datetime='2019-03-22T18:55:22Z'>Fri, 22 Mar 2019 18:55:22 UTC</time><div class='body'><p>Illuminating article! Not suggesting this is a good idea, but a possible way to circumvent the restricted decorator grammar could be a function<br><code><br>def do_nothing(x):<br>  return x<br></code><br>which wraps some expression:<br><code><br>@do_nothing(lambda f: f)<br>def f():<br>  pass<br></code></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-03-23T00:07:11Z'>Sat, 23 Mar 2019 00:07:11 UTC</time><div class='body'><p>Oh, clever idea! It seems so obvious now.</p></div></div></div></div><hr/><div class='thread'><h1 id='2019-03-10'><a href='/blog/2019/03/10/'>An Async / Await Library for Emacs Lisp</a></h1><div class='comment'><div class='author'>Nance</div><time datetime='2019-03-11T03:21:57Z'>Mon, 11 Mar 2019 03:21:57 UTC</time><div class='body'><p>You might be interested in <a href="http://trio.rtfd.org" rel="nofollow noopener" title="trio.rtfd.org">trio.rtfd.org</a>, which I am optimistic will become the future of async programming in python. For a more theoretical perspective on the concept of "structured concurrency": <a href="https://vorpus.org/blog/notes-on-structured-concurrency-or-go-statement-considered-harmful/" rel="nofollow noopener" title="https://vorpus.org/blog/notes-on-structured-concurrency-or-go-statement-considered-harmful/">https://vorpus.org/blog/not...</a></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-03-13T19:05:21Z'>Wed, 13 Mar 2019 19:05:21 UTC</time><div class='body'><p>Very interesting article, Nance, thanks. In playing around with my little library, I was noticing this pattern myself. If I created a promise but never awaited on it, errors were silently swallowed up in the promise and lost. It's confusing and risky, and it's an indication that I probably shouldn't do that. Having an explicit nursery context awaiting on everything solves this problem.</p><p>The diagrams in the article are really useful, too. It's obvious that a "goto" is half of a function call: It's a primitive on which to build functions as a proper abstraction. In the same way a "go" is just a primitive used in constructing a nursery, and you need the second part, the join, in order to have a complete abstraction.</p></div></div></div><div class='comment'><div class='author'>JDS</div><time datetime='2019-05-10T02:48:14Z'>Fri, 10 May 2019 02:48:14 UTC</time><div class='body'><p>This looks very interesting.  Currently I'm struggling with implementing a completion framework for a mode where a trip to an external process is required to calculate completions.  Sadly, completion-at-point-functions (CAPF) provides no callback interface.  What would be fantastic is to 'await' the external process' work in the CAPF function, then continue on, returning a set of completions to caller.  The caller would itself never know an asynchronous excursion occurred.   Possible with aio?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-05-10T20:39:49Z'>Fri, 10 May 2019 20:39:49 UTC</time><div class='body'><p>In order for aio to do its job, the event you're waiting on must relinquish the thread — it must truly be asynchronous. Otherwise it's simply not possible. If Emacs threads were more useful, you could put work around this by putting it on a thread, but they're not quite there yet.</p></div><div class='comment'><div class='author'>JD</div><time datetime='2019-05-10T23:21:43Z'>Fri, 10 May 2019 23:21:43 UTC</time><div class='body'><p>It is an asynchronous <i>process</i>, but the completion framework itself is fully synchronous.  So I suppose there is no way to pause it without blocking.  I guess you need aio function "all the way up" the stack to make this possible.  I.e. inserting an aio-defun somewhere down the call stack cannot simulate a "paused" function.</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2019-02-06'><a href='/blog/2019/02/06/'>Some Galois Linear Feedback Shift Generators</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2019-03-22'><a href='/blog/2019/03/22/'>Endlessh: an SSH Tarpit</a></h1><div class='comment'><div class='author'>Charlie</div><time datetime='2019-03-22T20:57:16Z'>Fri, 22 Mar 2019 20:57:16 UTC</time><div class='body'><p>OpenBSD spamd (for SMTP) actually has a 2-second delay between sending each character. Perhaps their code might be useful?</p><p>In the first years that I ran it, I had a few threatening messages from spammers who thought that I had personally maligned them with it.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-03-23T18:10:15Z'>Sat, 23 Mar 2019 18:10:15 UTC</time><div class='body'><p>I'd heard about that OpenBSD spamd feature before but had forgotten all about it. Glad to be reminded, thanks! I'm surprised spammers took the time to threaten you over it.</p></div></div></div><div class='comment'><div class='author'>Ishwor Gurung</div><time datetime='2019-03-23T13:34:03Z'>Sat, 23 Mar 2019 13:34:03 UTC</time><div class='body'><p>I see where you are coming from on developing `endlessh` but it begs the question why?</p><p>Even on a 1Gbit link that gets DoSed at close to line rate, I can safely deploy internet facing servers that *ban* IPv4/IPv6 noise for a prolonged period using fail2ban (which uses iptables and log parsing to drop the packets). It has served me well thus far.</p><p>On a 10Gbit+ links, those logic need to be moved closer to the NICs (eBPF) and/or ASICs to bypass kernel processing of packets if so you desire.</p><p>Is there something I am missing?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-03-23T18:23:14Z'>Sat, 23 Mar 2019 18:23:14 UTC</time><div class='body'><p>On the server where I'm currently running it, port 22 is constantly bombarded with SSH brute force attempts. I hope my tarpit slows down these attackers by tying up some of their resources for a time, at practically no cost to myself. Presumably they're committing to N attempts in parallel (threads, processes, etc.) spread across different targets. N is likely based less on network bandwidth and more on some other resource (available memory, CPU cores, etc.). My tarpit will trap some of those attempts and effectively reduce N for a time. Overall I'm making SSH brute force attempts a little more expensive.</p></div></div></div><div class='comment'><div class='author'>Stanislas</div><time datetime='2019-03-23T13:34:39Z'>Sat, 23 Mar 2019 13:34:39 UTC</time><div class='body'><p>I didn't know about tarpits! Thank you for sharing.</p></div></div><div class='comment'><div class='author'>FRex</div><time datetime='2019-03-23T17:30:48Z'>Sat, 23 Mar 2019 17:30:48 UTC</time><div class='body'><p>I wonder if a compression bomb or other kind of malicious reply could be used to waste some CPU and RAM.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-03-23T18:08:41Z'>Sat, 23 Mar 2019 18:08:41 UTC</time><div class='body'><p>For SSH you'd need to do this later in the protocol, assuming the server can force compression to be enabled (can it?). But I know for sure you can pull it off quite simply with with HTTP. That's exactly what Neal Krawetz did here to defend his hidden TOR service against malicious bots:<br> <a href="https://www.hackerfactor.com/blog/index.php?/archives/763-The-Continuing-Tor-Attack.html" rel="nofollow noopener" title="https://www.hackerfactor.com/blog/index.php?/archives/763-The-Continuing-Tor-Attack.html">https://www.hackerfactor.co...</a></p></div><div class='comment'><div class='author'>FRex</div><time datetime='2019-03-23T18:18:53Z'>Sat, 23 Mar 2019 18:18:53 UTC</time><div class='body'><p>It was just a wild idea since we are already into "frustrate attacker/waste his resources" territory. I wasn't sure if there even was compression in SSH and quick googling just got me to server side stuff, like 'yes' (enable) vs. 'delayed' (enable only after auth to not expose server to attacks via compression algo).</p></div></div></div></div><div class='comment'><div class='author'>mmorgan27</div><time datetime='2019-03-24T19:34:32Z'>Sun, 24 Mar 2019 19:34:32 UTC</time><div class='body'><p>I was running your program and discovered, to no one's surprise, most of the probes are coming from China. I was considering putting some rules in my firewall (for fear of attracting additional attention due to the tarpit), but the number of subnets that the probes are coming from is just too many, despite almost all being from China. Then I remembered some post on Reddit the other day about how these jokers would send messages in in-game chat about Tiananmen square in a chat and the Chinese player would be booted. Probably just a joke, but still funny.<br>So I modified the program to send back messages that are likely on the blocked keyword list for the Great Chinese Firewall. Perhaps the problem will be taken care of by the Chinese government by putting my server on <b>their</b> firewall rules. If nothing else, I think it's pretty funny that these guys are now downloading political dissident messages.</p></div></div><div class='comment'><div class='author'>SRG</div><time datetime='2019-03-30T18:22:48Z'>Sat, 30 Mar 2019 18:22:48 UTC</time><div class='body'><p>This is brilliant !</p><p>I've just installed your dockerfile (c version) image, it's working fine.</p><p>Of course, i fear that in the end it's going to be taken in account by attackers (that are going to add extra timeouts in their scan procedures and auto-avoidance of servers running that kind of tarpits), but it's still a nice first layer defend for now.</p></div></div><div class='comment'><div class='author'>Jim P</div><time datetime='2019-06-14T14:18:17Z'>Fri, 14 Jun 2019 14:18:17 UTC</time><div class='body'><p>I have also moved my sshd to a different port.  For some time, the logs were very quiet.  Last month, however, something must have discovered the proper port and I've been fielding failed logins about once a minute, which led me here.  I've noticed, with verbose settings, that the attacking clients will hang up after the second line gets written out, so I've had to extend the timeout to 1000 seconds in order to keep clients trapped.</p></div></div></div><hr/><div class='thread'><h1 id='2019-03-28'><a href='/blog/2019/03/28/'>Fibers: the Most Elegant Windows API</a></h1><div class='comment'><div class='author'>Jon Forrest</div><time datetime='2019-03-29T00:55:45Z'>Fri, 29 Mar 2019 00:55:45 UTC</time><div class='body'><p>Extremely minor typo:</p><p>"It’s not quite and apples-to-apples comparison" -&gt; "It’s not quite an apples-to-apples comparison"</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-03-29T01:40:18Z'>Fri, 29 Mar 2019 01:40:18 UTC</time><div class='body'><p>Oops! Fixed now, thanks! I gave the whole article another pass and fixed some other issues, too.</p></div></div></div><div class='comment'><div class='author'>possiblywrong</div><time datetime='2019-03-29T15:27:43Z'>Fri, 29 Mar 2019 15:27:43 UTC</time><div class='body'><p>This was really interesting, I wasn't familiar with this API at all. How does the "equivalent to the process main thread returning from main()" work? That is, if a fiber exiting (with void return) can shut things down like this, then what integer gets returned from int main()?</p><p>I wonder if you could get around the WaitForMultipleObjects() count limitation by using WaitForSingleObject() instead, with some extra mutex and condition variable wrapping? In other words, effectively implement WaitForMultipleObjects() "in terms of" WaitForSingleObject()?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-03-29T17:00:51Z'>Fri, 29 Mar 2019 17:00:51 UTC</time><div class='body'><p>Based on experiments like my "coup" example, the process will automatically exit with status 0. However, that's not the whole story, and your question prompted me to dig a bit further. Normally the C runtime also does cleanup when the main function returns, such as flushing output buffers and running atexit() routines. What actually happens depends on the toolchain and the host.</p><p>When compiled with Mingw-w64 and run on Windows, it seems the C runtime exits cleanly when any fiber returns on the main thread. However, when run under Wine it either crashes (older Wine), or it flushes but fails to run atexit() routines (newer Wine).</p><p>When compiled with MSVC, the C runtime doesn't exit cleanly when a fiber returns on the main thread, and neither flushing nor atexit() occurs. I can't really say I'm surprised by this.</p><p>There isn't any clearly documented behavior, but Mingw-w64 is the most conscientious. There's an uncertain interaction between the host and the C runtime here. The host implements CreateFiber() and the CRT supplies the C cleanup routine, but there's no documented way for them to coordinate. It would be interesting to explore this further.</p></div></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-03-29T17:15:59Z'>Fri, 29 Mar 2019 17:15:59 UTC</time><div class='body'><p>I replied then realized I only addressed the first paragraph! Here's my reply for your second paragraph.</p><p>You're on the right track. We'd need some way to group multiple handles under a single, new handle, creating a kind of tree of handles where no level has more than 64. This can be done with a thread pool, where each thread waits on multiple handles, and the non-leaves wait on other thread in the pool. In fact, this is what RegisterWaitForSingleObject() is for.</p><p>There's an efficiency benefit to this: Only one path down the wait-tree to the signaled handle was woken up, and so only waits on handles along those paths need to be restarted. If I'm thinking about this properly, for about a million handles, the wait-tree would be log64(N) = 4 layers deep (not bad), and you'd need around N/64 = 16,000 threads (not so great).</p></div></div></div><div class='comment'><div class='author'>Zafer Balkan</div><time datetime='2019-10-25T07:27:50Z'>Fri, 25 Oct 2019 07:27:50 UTC</time><div class='body'><p>It's the first time I have ever seen the Fiber API. I was into porting a library that utilizes <a href="https://github.com/canonical/libco" rel="nofollow noopener" title="https://github.com/canonical/libco">libco </a>(a coroutine library) to Windows and trying to find an equivalence. Alternatives are using a cross-platform library like <b>libfiber </b>or Windows native Fibers, after I have seen your post. Thank you  for your enlightening demo also. By the way, the library I have mentioned,  <a href="https://github.com/iqiyi/libfiber" rel="nofollow noopener" title="https://github.com/iqiyi/libfiber">libfiber</a> might be helpful since it works on windows too.</p></div></div></div><hr/><div class='thread'><h1 id='2019-04-30'><a href='/blog/2019/04/30/'>Looking for Entropy in All the Wrong Places</a></h1><div class='comment'><div class='author'>FRex</div><time datetime='2019-05-01T10:29:28Z'>Wed, 01 May 2019 10:29:28 UTC</time><div class='body'><p>Noticed small typo 1/3 way through in sentence "The more pressing issue is that time(3) as a resolution of one second." the "as" seems like it should have been a "has".</p><p>It surprised me all this work of looking for entropy in unusual places (using tmpnam like that was very neat) went to seeding rand (which at the start was said to be low quality, unknown algorithm and even slow) instead of bringing along some random algorithm written in portable C and seeding that.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-05-01T19:09:45Z'>Wed, 01 May 2019 19:09:45 UTC</time><div class='body'><p>Fixed, thanks!</p></div></div></div><div class='comment'><div class='author'>Anonymous</div><time datetime='2019-05-25T22:06:00Z'>Sat, 25 May 2019 22:06:00 UTC</time><div class='body'><p>What about getpid and getppid?<br>There's also the raw value<br> of a FILE*, although if you can't open /dev/urandom that doesn't help. <br>And as a last-ditch effort, there is of course always uninitialized <br>memory/registers. Although if you're that starved for entropy, maybe <br>it's better to give up than to attempt to spit out something that might <br>actually be horribly insecure.<br>On newer-model x86 processors, there's also RDSEED, and this is coming in ARM v8.5-A too.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-05-26T00:21:32Z'>Sun, 26 May 2019 00:21:32 UTC</time><div class='body'><p>The purpose of the exercise is to gather entropy using only strictly conforming C. Since getpid() is part of POSIX, not C, that's off the table, as is RDRAND since it's only accessible via compiler extensions. <br>I didn't use uninitialized values for two reasons. First, it is, at best, a secondary source, residual from a source that is already being sampled directly (ASLR, etc.), so it has no practical value. Second, reading initialized values is a bit dubious in a strictly conforming program anyway. Except for char, the value could be a trap representations.</p></div><div class='comment'><div class='author'>Anonymous</div><time datetime='2019-05-26T15:13:19Z'>Sun, 26 May 2019 15:13:19 UTC</time><div class='body'><p>Well, RDRAND is accessible through assembly too.</p><p>If you're okay with using the JIT technique you used for some other stuff, that could work. But it's probably not a very good idea for production code.</p><p>malloc() is pretty slow, so you could put that in the clock() loop to extract some entropy from the time it takes the OS to hand you a block, and also spend less time busy waiting.</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2019-05-29'><a href='/blog/2019/05/29/'>UTF-8 String Indexing Strategies</a></h1><div class='comment'><div class='author'>Klaus</div><time datetime='2019-05-30T08:13:04Z'>Thu, 30 May 2019 08:13:04 UTC</time><div class='body'><p>I’d say it really depends on the domain. A main argument of the „utf8everywhere“ website is that indexing strings is rarely relevant to performance in day-to-day programming, if done at all, so the cost of having to fix forgotten handling of international characters when it comes up from user input outweighs the performance benefits of not abstracting it away. Especially since characters may be represented as sequences of code points and separating them may result in something barely more useful than byte-wise indexing.</p><p>That said, for my use cases (data analysis with python) implicit unicode handling is usually an annoyance, as it requires me to write b““ instead of just ““ everywhere, and originally many features were string-only. Thankfully, as of 3.7 essentially the same string and regexp features are available for both strings and byte arrays.</p></div></div><div class='comment'><div class='author'>Abel Stern</div><time datetime='2019-05-30T09:06:42Z'>Thu, 30 May 2019 09:06:42 UTC</time><div class='body'><p>As you mention in passing, Python &gt;=3.3 takes a different approach for <code>str</code> objects: like Emacs, it takes the highest code point in a string to determine the encoding it will use. Unlike Emacs, it then always picks a fixed-width encoding (latin-1,UCS-2 or UCS-4). That is, "fish" would be encoded in latin-1, but "fiŝo" in UCS-2. This is, of course, not the most storage-efficient way to handle long strings containing a few non-ASCII characters. If the programmer wants to pick an encoding him/herself, the <code>bytes</code> type presents a more basic alternative.</p><p>Some references for those interested in the Python specifics: <a href="https://www.b-list.org/weblog/2017/sep/05/how-python-does-unicode/" rel="nofollow noopener" title="https://www.b-list.org/weblog/2017/sep/05/how-python-does-unicode/">How Python does Unicode</a>, <a href="https://rushter.com/blog/python-strings-and-memory/" rel="nofollow noopener" title="https://rushter.com/blog/python-strings-and-memory/">How Python saves memory when storing strings</a>.</p></div></div><div class='comment'><div class='author'>okapia</div><time datetime='2019-05-30T10:16:12Z'>Thu, 30 May 2019 10:16:12 UTC</time><div class='body'><p>Indexing by Unicode codepoint really isn't that useful. When you factor in various Unicode features like combining characters and zero-width joiners you might as well consider UCS-4 to be a variable width encoding too. With that in mind, UTF-8 everywhere and byte indexing makes for a pragmatic approach. You can generally avoid the worst inefficiencies of O(n) indexing by keeping track of relative indexes and sometimes rethinking aspects of your overall algorithm. It also helps if the API actually provides a way to advance an index back and forward over graphemes.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-05-30T12:03:35Z'>Thu, 30 May 2019 12:03:35 UTC</time><div class='body'><p>Agreed. I was only thinking about the situation in Emacs Lisp recently because I was playing around with string hash functions, which is one of those few legitimate cases for iterating over code points. I've hardly ever iterated over code points manually.</p></div></div></div><div class='comment'><div class='author'>Tracker1</div><time datetime='2019-05-30T20:02:34Z'>Thu, 30 May 2019 20:02:34 UTC</time><div class='body'><p>Wouldn't UTF8 + NFKC be sufficient?</p></div></div></div><hr/><div class='thread'><h1 id='2019-06-30'><a href='/blog/2019/06/30/'>Go Slices are Fat Pointers</a></h1><div class='comment'><div class='author'>FRex</div><time datetime='2019-07-01T00:17:08Z'>Mon, 01 Jul 2019 00:17:08 UTC</time><div class='body'><p>In "say, that it’s 16-bit aligned" was it meant to say byte? And alignment freeing low bits is also trick behind JVM's CompressedOops, another nifty ptr trick.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-07-01T01:02:39Z'>Mon, 01 Jul 2019 01:02:39 UTC</time><div class='body'><p>You're right, thanks! Fixed.<br> <a href="https://github.com/skeeto/skeeto.github.com/commit/28e36f1e109260cf1b9cffd1f2c9447df8fc957b" rel="nofollow noopener" title="https://github.com/skeeto/skeeto.github.com/commit/28e36f1e109260cf1b9cffd1f2c9447df8fc957b">https://github.com/skeeto/s...</a></p></div></div></div><div class='comment'><div class='author'>Leandro Moreira</div><time datetime='2019-07-01T09:56:40Z'>Mon, 01 Jul 2019 09:56:40 UTC</time><div class='body'><p>Isn't the correct macro to be used in the definition of the macro ARRAYPTR the FATPTR instead of ADDROF?</p><p>```<br>#define ARRAYPTR(array) \<br>    ADDROF(array, COUNTOF(array))<br>```</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-07-01T10:43:18Z'>Mon, 01 Jul 2019 10:43:18 UTC</time><div class='body'><p>You're right, thanks! Fixed now. I renamed the macro during editing and missed that instance. That's what I get for not having a compiler check my work.</p></div></div></div><div class='comment'><div class='author'>Valentin Deleplace</div><time datetime='2019-07-01T11:34:38Z'>Mon, 01 Jul 2019 11:34:38 UTC</time><div class='body'><p>When you'd want to slice the variable <code>foo</code>, you would usually be in control of the declaration of <code>foo</code>, thus declaring an array of size one (<code>[1]int</code>) would do the job: <a href="https://play.golang.org/p/znBa1rSbuUv" rel="nofollow noopener" title="https://play.golang.org/p/znBa1rSbuUv">https://play.golang.org/p/z...</a></p><p>I have reservations about the safety of <code>unsafe.Pointer</code>, as its name implies. <a href="https://golang.org/pkg/unsafe/#Pointer" rel="nofollow noopener" title="https://golang.org/pkg/unsafe/#Pointer">The spec says</a>: "A uintptr is an integer, not a reference. Converting a Pointer to a uintptr creates an integer value with no pointer semantics. Even if a uintptr holds the address of some object, the garbage collector will not update that uintptr's value if the object moves, nor will that uintptr keep the object from being reclaimed."</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-07-01T13:17:51Z'>Mon, 01 Jul 2019 13:17:51 UTC</time><div class='body'><p>Yes, converting unsafe.Pointer to uintptr is risky. It's not a proper reference, so the variable could be garbage collected, or the variable could be moved by the garbage collector (though gc currently doesn't do this). However, in my example I never convert to uintptr. I go from pointer, to unsafe.Pointer, to pointer. Each of these has proper pointer semantics and would interact correctly with the garbage collector in both situations.</p><p>As far as I can tell, my example doesn't violate any aliasing rules (the Go spec doesn't even discuss aliasing), and the underlying type is the same. That's why I'm pretty confident my example will always be safe.</p></div><div class='comment'><div class='author'>Valentin Deleplace</div><time datetime='2019-07-01T14:21:49Z'>Mon, 01 Jul 2019 14:21:49 UTC</time><div class='body'><p>Indeed!<br>It's not the case (3) that I mentioned, it looks more like the case (1) Conversion of a *T1 to Pointer to *T2</p></div></div></div></div><div class='comment'><div class='author'>Patrick Schlüter</div><time datetime='2019-07-01T15:00:35Z'>Mon, 01 Jul 2019 15:00:35 UTC</time><div class='body'><p>For your C example it is also possible to use array pointers. It's quite unusual because of the uncommon syntax but works quite well for fix sized arrays. Your foo function becomes in that case<br><code>void foo( int(*)[4] );</code> or <br><code>void foo( int(*arr)[4])</code> with a parameter name<br>in the function for exampe <code>sizeof arr == sizeof(int*)</code> but <code>sizeof *arr == 4*sizeof(int)</code></p><p>at tha call site a simple <code>foo(array)</code> will do.</p><p>One can get used to the syntax and it works without problem. There are some weird consequences though. If you want a function returning an array pointer it uses this syntax.</p><p><code>int (*foo(int a, int b))[4];</code> for example</p></div></div></div><hr/><div class='thread'><h1 id='2019-07-10'><a href='/blog/2019/07/10/'>Predictable, Passphrase-Derived PGP Keys</a></h1><div class='comment'><div class='author'>Yu0</div><time datetime='2019-07-10T05:36:42Z'>Wed, 10 Jul 2019 05:36:42 UTC</time><div class='body'><p>So far my approach to the whole topic is: If it is import data and stored offline, don’t use a key file. If it is in Dropbox (e.g. a KeePass database) use a key and transfer it by hand.</p><p>I’d really be interested in finding a solution for handling keys that would be accessible even to average people :/</p><p>Though generally, I find that the real issues are rather related to trust than to encryption. I trust KeePass, but can I trust it’s third-party mobile ports? Especially since they can be updated from a store: If the creator gets hacked or goes rogue, suddenly my passwords may be compromised by a compromised app update.</p><p>I wonder what such scenarios might affect your backup?</p><p>Though your article points out a method, how I might be able to include a key in a backup / sync :) I always thought that to be impossible.</p></div></div><div class='comment'><div class='author'>Nathaniel Harari</div><time datetime='2019-07-10T05:49:28Z'>Wed, 10 Jul 2019 05:49:28 UTC</time><div class='body'><p>Hey there, I know this isn't the appropriate article to post this comment, but as I was using Elfeed in Emacs to read this, and the idea came to me whilst doing so, I had to write it in a comment before forgetting - I really hope that you don't mind.</p><p>In the search view, I often just go down my list of entries by hitting "r" for Mark as Read, but I'm wondering if it is possible that the entry with the cursor on it could be highlighted with a background colour and a different foreground colour as well? That would be super. So I'd have the marked colour above, the unread colour below, and the highlighted colour where the cursour/selected one is currently. It would just make it easier to stand out when I'm reading the news at 6:30am while I'm having my coffee but before I've finished it. :)</p><p>Just a thought. Still loving Elfeed. I use org mode to organize my feeds and wow is it nice and tidy. :D</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-07-11T20:21:56Z'>Thu, 11 Jul 2019 20:21:56 UTC</time><div class='body'><p>The search buffer uses hl-line-mode to highlight the current entry, so perhaps you could customize that mode, at least for the search buffer, in order to achieve what you want. (If I'm understanding you properly.)</p></div></div></div></div><hr/><div class='thread'><h1 id='2019-07-22'><a href='/blog/2019/07/22/'>The Long Key ID Collider</a></h1><div class='comment'><div class='author'>possiblywrong</div><time datetime='2019-07-23T13:47:50Z'>Tue, 23 Jul 2019 13:47:50 UTC</time><div class='body'><p>Very interesting! Do I understand correctly the impact of the choice of N (the length of the zero-suffix indicating when to stop a hash chain)? As you increase/decrease N, you roughly halve/double the *memory* requirement (i.e., the expected number of chains that you need to store), but the *execution time* should be roughly unchanged, though, right? That is, you're still evaluating about the same number of keys, with the exception of the possible "edge effect" of the extra time spent on the *last* chain that you evaluate that uncovers the collision (where by "edge effect" I mean that, for large N, you may have found the collision early in the chain, but won't know it until you reach its distinguishing point)?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-07-24T01:02:50Z'>Wed, 24 Jul 2019 01:02:50 UTC</time><div class='body'><p>Yup, that's exactly right. I largely chose my particular N so that I could get timely progress updates (printing a line as each hash chain completes). For a job I expect to run for several hours, I could certainly have chosen a larger N without significantly affecting the total run time. With the N I chose, the entire lookup table will always fit inside L3, if not L2, so I really have no need to increase N and move the trade-off towards less memory usage.</p></div></div></div></div><hr/><div class='thread'><h1 id='2019-08-09'><a href='/blog/2019/08/09/'>Keyringless GnuPG</a></h1><div class='comment'><div class='author'>Nathaniel Harari</div><time datetime='2019-08-13T16:40:36Z'>Tue, 13 Aug 2019 16:40:36 UTC</time><div class='body'><p>Thanks for the great article yet again! I just switched to Fastmail from Gmail and I was going to implement GPG signing in my mu4e setup, but then I realized: literally none of my friends use encryption PGP/GPG in their emails. I mean zero. Zip. They don't even know what it is. The only people I've seen use it are coders in these kinds of circles, and I don't interact with them via email. So when it comes to emailing people, I could set it up but it would be a complete waste of time for me, which is a shame. :/ I really want to use it, but nobody I email with would ever actually make use of it back.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-08-13T20:57:08Z'>Tue, 13 Aug 2019 20:57:08 UTC</time><div class='body'><p>Yeah, I gave up on the idea of GPG for email years ago. Nobody uses it, and it's a technological dead end anyway. The upside is it makes my email setup simpler, and MUAs that don't support it are viable options.</p></div></div></div></div><hr/><div class='thread'><h1 id='2019-09-25'><a href='/blog/2019/09/25/'>No, PHP Doesn&#39;t Have Closures</a></h1><div class='comment'><div class='author'>Clément Pit-Claudel</div><time datetime='2019-09-26T01:09:38Z'>Thu, 26 Sep 2019 01:09:38 UTC</time><div class='body'><p>Is your beef that PHP captures bindings by value instead of by reference?  I thought that the general agreement was that Python and Java actually got that one wrong (esp. wrt to loop variables).  When the F# people had to tackle this problem, they forbid capturing mutable locals in closures precisely to avoid the resulting confusion (you have to explicitly use a ref cell and mutate the contents of that).</p><p>Besides that, I'm a bit puzzled: did you get to the section on capturing variables by reference?  It's example #3 on the page that you linked to, and it shows how to fix your example (just write &amp;$n instead of $n and you'll get $r == 2).</p><p>A nitpick: you're missing a sigil in front of the f that you return in bar()</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-09-26T02:13:04Z'>Thu, 26 Sep 2019 02:13:04 UTC</time><div class='body'><p>Loop variables can be a gotcha, and ones that aren't explicitly mutated should probably be distinct variables on each iteration (i.e. for ... in loops, or Go's range loops). But loop variables that are explicitly mutated, like C-style for loops (i++) should *not* be distinct variables on each iteration. It was a mistake for JavaScript to make this a special case just to avoid surprising newbies (instead choosing to surprise everyone else with special case semantics).</p><p>I mentioned references towards the end to get something "kinda, sorta like a closure" but *semantically* it's still something different. It's like binding a pointer to a hidden parameter than actually closing over a variable. This is close enough that it really doesn't matter, so I admit I'm being nitpicky. Still, the whole "use" thing is really silly, and I'm baffled they settled on that design.</p><p>Thanks for the note about the missing sigil. I just fixed it.</p></div><div class='comment'><div class='author'>Clément Pit-Claudel</div><time datetime='2019-09-26T02:24:34Z'>Thu, 26 Sep 2019 02:24:34 UTC</time><div class='body'><p>I think the loop case is up for debate.  Rust works around it by making it impossible to use a captured, mutated variable, unless you go through a pointer, which I think is sensible.</p><p>I think what you describe (re references to pointers to hidden parameters) is exactly how I think of closures ^^ That is, in most implementations that I know, a closure is a record of pointers that is passed into the function at every call.</p></div></div><div class='comment'><div class='author'>Clément Pit-Claudel</div><time datetime='2019-09-26T04:31:41Z'>Thu, 26 Sep 2019 04:31:41 UTC</time><div class='body'><p>Also, what alternative do you have in mind for 'use'?  If they just got rid of it there'd be no way to chose capturing by value or by reference, so I imagine you'd default to capturing by reference, and you'd capture everything based on which variables appear in the function's body — but then you'd run the risk of capturing things that you didn't intend to close over and overwriting variables you didn't intend to modify (all of this wouldn't be a problem in a language where you have to declare your variables, of course…)</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-09-26T21:26:51Z'>Thu, 26 Sep 2019 21:26:51 UTC</time><div class='body'><p>Capture by value or by reference is irrelevant to an actual closure: it simply closes over its environment, whatever that means for the language. Since PHP doesn't have closures, it must rely on "use" for a kind of partial function evaluation instead.</p><p>The "risk" of capturing things you don't intend isn't a real problem with closures in practice, just as we don't have a "use" for each inner scopes because we're worried about clobbering values in the outer scope. Closures are little different than being an inner scope.</p></div><div class='comment'><div class='author'>Clément Pit-Claudel</div><time datetime='2019-09-26T22:23:14Z'>Thu, 26 Sep 2019 22:23:14 UTC</time><div class='body'><p>Wait, but clobbering in inner scopes *is* a problem in PHP :) Isn't it a problem in essentially any language that doesn't force you to declare variables before using them?</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-09-26T23:02:11Z'>Thu, 26 Sep 2019 23:02:11 UTC</time><div class='body'><p>Ha, you've got me there. :-) That's one of my biggest annoyance with Python.</p></div></div></div></div></div></div></div><div class='comment'><div class='author'>kallikanzarid</div><time datetime='2019-09-26T08:23:41Z'>Thu, 26 Sep 2019 08:23:41 UTC</time><div class='body'><p>This doesn't seem very different from how C++ does it. In PHP, like in Java, all variables except primitive types are pointers, and you capture the value of the pointer. If you capture "by reference", you capture by the double pointer. Not ideologically pure, but not incomprehensible either.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-09-26T21:21:03Z'>Thu, 26 Sep 2019 21:21:03 UTC</time><div class='body'><p>Capture by reference or capture by value is mostly irrelevant. The question is: Does the "closure" actually *close over* its lexical environment such that it can continue accessing its variables. The answer for PHP is no, even when using reference captures.</p><p>I'm not convinced C++ lambdas technically evaluate to closures either, but the semantics there still make more sense than PHP. For example, in C++ you can't capture global variables, or any variable without automatic storage duration, since that makes no sense. It's also explicit about captures, but you can use [&amp;] or [=] to avoid listing each captured variable. Unlike PHP, C++ has a good excuse for this: it has manual memory management, and closures require thought about allocation. Specifying reference vs. value captures is part of this. (It's also why closures are honestly a poor fit for C++ and probably shouldn't have been added.)</p></div></div></div><div class='comment'><div class='author'>SomeGuy</div><time datetime='2019-09-26T12:59:46Z'>Thu, 26 Sep 2019 12:59:46 UTC</time><div class='body'><p>I guess this is technically correct - PHP doesn't have "real closures". But, having worked with both PHP and JS, I actually prefer the way PHP does things in this case. Using Closures in JS can be quite confusing, especially when you aren't familiar with all the details of how scope is captured, how bind works etc. PHP on the other hand makes this very obvious and hard to mess up.</p></div></div><div class='comment'><div class='author'>Markus Heiler</div><time datetime='2019-09-26T13:55:20Z'>Thu, 26 Sep 2019 13:55:20 UTC</time><div class='body'><p>On reddit this link was given: <a href="https://www.php.net/manual/en/closure.bind.php" rel="nofollow noopener" title="https://www.php.net/manual/en/closure.bind.php">https://www.php.net/manual/...</a> I think it may be useful to extend the article here and look whether this meets your criteria for a closure as-is.</p></div></div><div class='comment'><div class='author'>Olivier Laviale</div><time datetime='2019-09-26T18:06:56Z'>Thu, 26 Sep 2019 18:06:56 UTC</time><div class='body'><p>I have good news for you! You can pass variables by reference by using the "&amp;" sign, like everywhere else in the language. You can reference the closure itself for recursion with this method. Also, short closures are coming with the next release of the language, here's the RFC: <a href="https://wiki.php.net/rfc/arrow_functions_v2" rel="nofollow noopener" title="https://wiki.php.net/rfc/arrow_functions_v2">https://wiki.php.net/rfc/ar...</a></p><p>Try again in a couple of months :)</p></div></div><div class='comment'><div class='author'>郭云鹤(Guo Yunhe)</div><time datetime='2019-09-26T19:56:54Z'>Thu, 26 Sep 2019 19:56:54 UTC</time><div class='body'><p>I think the comparison between php and js only shows how php is doing better. You make less mistakes by whitelisting variables you want to pass to a closure. Also, designing a programming language doesn't mean that you have to keep the same practice as others. Language is practical. Good article share facts. Not opinions.</p></div></div><div class='comment'><div class='author'>sapphirepaw</div><time datetime='2019-09-27T12:20:05Z'>Fri, 27 Sep 2019 12:20:05 UTC</time><div class='body'><p>I'm probably missing something here, but why isn't it a closure, exactly? Consider the following:</p><p><code><br>function makeSequence() {<br>    $i = 0;<br>    return function () use (&amp;$i) {<br>        return ++$i;<br>    };<br>}<br></code></p><p>Call makeSequence() twice, and the result is two distinct callables that generate their own sequence of integers. Nothing one callable does affects the other, nor can code in the global scope affect either one.</p><p>How is this JavaScript version different? Is it a closure?</p><p><code><br>"use strict";<br>function makeSequence() {<br>    let i = 0;<br>    return function () {<br>        return ++i;<br>    };<br>}<br></code></p><p>If a "true closure" requires <i>nested lexical environments,</i> then sure, PHP doesn't have closures. But maybe that's a distinction without a difference. An anonymous function can still have access to a variable outside its own scope, but not in the global scope, which is pretty much what distinguishes "a closure" for me. A closure has variables that persist between invocations, but aren't in the invoker's scope.</p></div><div class='comment'><div class='author'>Lasse Hillerøe Petersen</div><time datetime='2019-12-02T14:04:35Z'>Mon, 02 Dec 2019 14:04:35 UTC</time><div class='body'><p>Your comment puzzles me almost as much as the blog itself. I would think that your example is an excellent proof that using references to pass the local variable to an inner function is a very decent way to implement closures. What do you mean by "nested lexical environments", and how is PHP lacking them? (I will happily admit that I've never used PHP much.) Also, why wouldn't an anonymous function be able to access a variable in the global scope?</p></div><div class='comment'><div class='author'>sapphirepaw</div><time datetime='2019-12-03T16:39:57Z'>Tue, 03 Dec 2019 16:39:57 UTC</time><div class='body'><p>You can define a named function inside another named function in PHP, but that inner function has no way to access the outer function's local variables. (Also, it's really a global definition that runs once the outer function is called, so in general, never do that.) This is part of PHP's legacy design, where there were only global and local scope, and later, "superglobals" (variables that are specially treated by the language, so that access is never local.)</p><p>These scopes are still clearly lexical, I think, because they're not dynamic. A function that uses a local <code>$n</code> can't be affected by setting a global <code>$n</code> before calling it.  But they obviously don't "nest", because of what I said above.</p><p>Python, in contrast, has nested lexical scope because a function inside a function can read (and, using <code>nonlocal</code>, write) to variables in any outer function's scope.</p><p>As for the global scope, that was confusingly worded. Anonymous functions can choose to access global variables, like any other function; but, they also have the ability to access variables in the enclosing scope, even if that scope is non-global.</p><p>To tl;dr my original comment, it's that the OP never proved the thesis. I read the post at least twice, and never came away feeling like I understood the reasoning. I would happily accept "it's because <code>function x() { $a = function () { $b = function () {…}; }; }</code> has no way for $b to use variables in x() that $a did not use", but I didn't get that from the actual post.</p></div><div class='comment'><div class='author'>Lasse Hillerøe Petersen</div><time datetime='2019-12-04T17:20:29Z'>Wed, 04 Dec 2019 17:20:29 UTC</time><div class='body'><p>I didn't quite get it either, nor do I feel sure I get your reply, I'm afraid.<br>Further down, Christopher Wllons writes: "in C++ you can't capture global variables", and that seems absolutely meaningless to me, because as global variables by definition live in the outermost scope, they never go out of scope and are available to any function value without further ado. It is only variables in containing functions that need to have their scope (and by this I mean allocation, not lexical name visibility) outlast the return of their defining function, the socalled upward funarg problem.<br>The reason I am interested is because I am toying with the design of a language, for which the compiler will generate C code, and I intend to implement closures precisely by hoisting inner functions to the global level, and pass any imported variables as references in an extra argument struct, while also ensuring that the containing function allocates these (but only these) variables on the heap instead of on the stack.<br>That an inner function should declare which variables it uses from an outer scope (and how) does not IMO interfere with the "closureness", it's mostly a matter of convenience/lazyness or even a sincere belief that this is a beneficial design for other reasons.<br>Meanwhile, I tried installing Php and playing with it a bit, and so far I seem to have run into trouble definining nested functions inside nested functions and for example assigning them to globals, so the first experiments are not too promising regarding at least the consistency of Php's closure implementation, but maybe I shall try a little harder. (Or even ask my niece, who is an MS in CS, and wrote a thesis on Php memory management - I guess she might know. :-) )</p></div></div></div></div></div></div><hr/><div class='thread'><h1 id='2019-10-27'><a href='/blog/2019/10/27/'>Legitimate Use of Variable Length Arrays</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2019-10-28'><a href='/blog/2019/10/28/'>Legitimate-ish Use of alloca()</a></h1><div class='comment'><div class='author'>Vladimír Kotal</div><time datetime='2019-10-29T22:19:33Z'>Tue, 29 Oct 2019 22:19:33 UTC</time><div class='body'><p>Solaris door mechanism spawns a thread (as a result of kernel upcall perhaps) inside of a user process that never returns. To avoid leaks there, alloca() is legitimate.</p></div></div></div><hr/><div class='thread'><h1 id='2019-11-15'><a href='/blog/2019/11/15/'>Infectious Executable Stacks</a></h1><div class='comment'><div class='author'>ContraPants</div><time datetime='2019-11-15T18:34:26Z'>Fri, 15 Nov 2019 18:34:26 UTC</time><div class='body'><p>That's really interesting. I've done <code>ld -r -b binary</code> a lot for small resources in the past. I had no idea about any of this. Thank you!</p><p>Unrelated to <code>ld</code>, this piqued my curiosity:<br></p><blockquote>No only does one contaminated object file infects the binary, everything dynamically linked with it also gets an executable stack.</blockquote><p></p><p>If your process does not have an executable stack, will libraries that require one fail if you try to use it through <code>dlopen</code> at runtime rather than linking at compile time? Can a process dynamically change from a non-executable stack to an executable one? I would think no because it would be a major security vulnerability, so I don't know how the OS would handle this.</p></div><div class='comment'><div class='author'>ContraPants</div><time datetime='2019-11-15T18:57:38Z'>Fri, 15 Nov 2019 18:57:38 UTC</time><div class='body'><p>My curiosity got the best of me, and I tried it on a Linux box with gcc version 9.2.0.</p><p>As expected, the <code>.so</code> file had an executable stack. The executable, even though it is linked with <code>-ldl</code>, did not. However, the code still worked.</p><p>I don't know if it's a recent change, but compiling even without supplying <code>-Wall</code> or <code>-Wextra</code> still warned me about the generated trampoline.</p><p>Thanks again for the article!</p></div></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-11-15T19:31:27Z'>Fri, 15 Nov 2019 19:31:27 UTC</time><div class='body'><p>Yes, the process' stacks will dynamically become executable when a shared object requiring executable stacks is loaded. This even includes the use of dlopen(), so it can happen late in program execution. On Linux you can observe this by examining /proc/PID/maps as the program runs. I didn't know about this myself until I wrote this article, so it was a surprise for me, too.</p><p>I've never seen a warning about the closure trampoline. What Linux distribution are you using? I don't see it with Debian's GCC, nor with my own build of GCC.</p></div><div class='comment'><div class='author'>ContraPants</div><time datetime='2019-11-15T20:27:32Z'>Fri, 15 Nov 2019 20:27:32 UTC</time><div class='body'><p><code><br>$ gcc --version<br>gcc (Gentoo 9.2.0-r2 p3) 9.2.0<br>Copyright (C) 2019 Free Software Foundation, Inc.<br>This is free software; see the source for copying conditions.  There is NO<br>warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.<br><br>$ gcc -std=c99 -o test test.c<br>test.c: In function ‘intsort2’:<br>test.c:5:9: warning: trampoline generated for nested function ‘cmp’ [-Wtrampolines]<br>    5 |     int cmp(const void *a, const void *b)<br>      |         ^~~<br></code></p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-11-15T20:35:53Z'>Fri, 15 Nov 2019 20:35:53 UTC</time><div class='body'><p>Ah, interesting. Looks like Gentoo uses a hardened GCC build that enables -Wtrampolines by default. Thanks!</p></div></div></div><div class='comment'><div class='author'>Walter Misar</div><time datetime='2019-11-17T00:48:13Z'>Sun, 17 Nov 2019 00:48:13 UTC</time><div class='body'><p>Looking around a bit I found that dynamic lib excutable stack infection happens on debian (deb10u2) with kmail via libQt5WebEngineCore (/usr/lib/x86_64-linux-gnu/libQt5WebEngineCore.so.5.11.3):</p><p><code>7ffc11287000-7ffc112a7000 rwxp 00000000 00:00 0                          [stack]</code></p><p>Another 15 binaries installed on my box link this library too.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-11-17T02:33:22Z'>Sun, 17 Nov 2019 02:33:22 UTC</time><div class='body'><p>Wow, nice catch! I just did a build of qtwebengine-opensource-src and the cause is a bunch of BoringSSL assembly files and a "SaveRegisters" assembly file. Each of these assembly sources lack a .note.GNU-stack section, so QtWebEngine and everything that links against it gets an executable stack. Crazy!</p><p>Were you going to report this as a bug? If not, I can do it.</p></div><div class='comment'><div class='author'>Walter Misar</div><time datetime='2019-11-17T08:12:32Z'>Sun, 17 Nov 2019 08:12:32 UTC</time><div class='body'><p>Would be nice if you can let the appropipiate people know about it . You already seem to have dug deeper into it and I wont find the time to do so soonish.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-11-17T21:59:29Z'>Sun, 17 Nov 2019 21:59:29 UTC</time><div class='body'><p><a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=944971" rel="nofollow noopener" title="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=944971">https://bugs.debian.org/cgi...</a></p></div></div></div></div></div></div></div><div class='comment'><div class='author'>possiblywrong</div><time datetime='2019-11-15T20:40:43Z'>Fri, 15 Nov 2019 20:40:43 UTC</time><div class='body'><p>Very interesting read. This seems... really bad, particularly the silent transition even when dlopen()ing as you discuss in the earlier comments. Am I missing some safety net, or is this really as dangerous/broken as it seems?</p><p>On a side note, re your mention of "Baking Data with Serialization." I just did something similar to this recently to get past a stupid email filter, turning a "binary" file (that I couldn't attach to an email) into a flat-text script file (that I could attach) that fwrote() itself from a Base64 encoding of its bytes. I thought I was clever... but I'm pretty sure the nugget of the idea came from reading your post years ago!</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-11-16T01:08:13Z'>Sat, 16 Nov 2019 01:08:13 UTC</time><div class='body'><p>Nope, you're not missing anything. I'm still honestly surprised how much this is tolerated, and I'm irritated that it's caught me offguard despite being aware of the issue.</p><p>There's still some hope. I said that my manual trampoline demo works on "nearly" any unix-like system. This includes both Linux and FreeBSD, each of which will happily make executable stacks. The main exception is OpenBSD where they've explicitly disabled executable stacks, so it's impossible to screw this up. Actual GCC closures don't work at all on OpenBSD for this reason, and it's noisy about them at compile time. On NetBSD, both my manual trampoline and GCC closures *sometimes* work. Whether or not I get an executable stack is kind of random, which I believe is a bug rather than a deliberate security feature.</p></div></div></div></div><hr/><div class='thread'><h1 id='2019-11-19'><a href='/blog/2019/11/19/'>On-the-fly Linear Congruential Generator Using Emacs Calc</a></h1><div class='empty'>(no comments)</div></div><hr/><div class='thread'><h1 id='2019-12-09'><a href='/blog/2019/12/09/'>Chunking Optimizations: Let the Knife Do the Work</a></h1><div class='comment'><div class='author'>Pedro Henrique</div><time datetime='2019-12-10T14:12:48Z'>Tue, 10 Dec 2019 14:12:48 UTC</time><div class='body'><blockquote>“Letting the knife do the work” means writing a correct program and lifting unnecessary constraints so that the compiler can use whatever chunk size is appropriate for the target.</blockquote><p><br>But how do I learn that art?</p></div></div><div class='comment'><div class='author'>sapphirepaw</div><time datetime='2019-12-10T14:44:31Z'>Tue, 10 Dec 2019 14:44:31 UTC</time><div class='body'><p>I noticed the change to optimization flags. When I compile xor512a with -O3, gcc-9.2.1 produces assembly with semantics <code>if (not overlapping) { use xmm code; } else { use byte-by-byte code; }</code>… and then doesn't call it. It inlines the xmm code in main().</p><p>When I compile xor512d with -Os, then the function is nothing more than the byte-by-byte code, and main() calls it normally.</p><p>It seems that one must choose the proper knife, even before letting it do the work.</p></div></div></div><hr/><div class='thread'><h1 id='2019-12-10'><a href='/blog/2019/12/10/'>Efficient Alias of a Built-In Emacs Lisp Function</a></h1><div class='comment'><div class='author'>Klaus</div><time datetime='2019-12-11T00:17:42Z'>Wed, 11 Dec 2019 00:17:42 UTC</time><div class='body'><p>Another efficiency thing that surprised me: Lexical closures seem to add quite some overhead to the bytecode.</p><p>I came across this when trying to use lazy evaluation. When you have something like<br></p><pre>(lambda ()<br>  (let*(a (f1 (lambda () a)))<br>    (funcall f1)))<br></pre><p><br>as a human, you recognize, that the function <code>f1</code> cannot be called outside that let block, and thus could in principle reference the stack frame of the encompassing function.</p><p>The way it is currently implemented however, the lexical closure causes <code>a</code> to be accessed with <code>varref a</code>... In my practical case, this causes quite some overhead.</p></div><div class='comment'><div class='author'>Christopher Wellons</div><time datetime='2019-12-11T01:41:04Z'>Wed, 11 Dec 2019 01:41:04 UTC</time><div class='body'><p>Are you sure you compiled that lambda with lexical scope? When I tried it, the byte-compiler handled it really well. It even recognizes that the closure doesn't escape, and so it doesn't allocate a fresh closure object each time it's called, and instead uses a "static" one from the constants vector. I suspect this is because the compiler does lambda lifting and is careful with funcall.</p><p>Further, varref is strictly for dynamic variables, so either you compiled with dynamic scope, or you've previously told Emacs that "a" is a "special" variable (e.g. with defvar) and so should be bound dynamically.</p><p>However, if the closure escapes, then it has to create fresh closures since it's nowhere near sophisticated enough to do otherwise. I discussed this issue in my Emacs Lisp performance article: <a href="https://nullprogram.com/blog/2017/01/30/" rel="nofollow noopener" title="https://nullprogram.com/blog/2017/01/30/">https://nullprogram.com/blo...</a></p></div><div class='comment'><div class='author'>Klaus</div><time datetime='2019-12-11T20:52:53Z'>Wed, 11 Dec 2019 20:52:53 UTC</time><div class='body'><p>"Have you tried rebooting Emacs?" :) The hind about <code>varref</code> solved my issue 😅</p><p>Seems like I had polluted my environment by unintentinally executing <code>(setq a ...)</code> without <code>let</code>-binding at some point. In the actual use-case (a macro), the root cause was incorrect use of <code>make-symbol</code> leading to something like<br></p><pre>(let (#:--prefix-var--)<br>   ...<br>   (setq #:--prefix-var--)<br>   ...)<br></pre><p><br>that looked fine when printed, but actually the two symbols were separate; Weirdly enough, it DID work as intended when compiled.</p></div></div></div></div></div><hr/><div class='thread'><h1 id='2019-12-28'><a href='/blog/2019/12/28/'>Unintuitive JSON Parsing</a></h1><div class='comment'><div class='author'>Gregg Irwin</div><time datetime='2019-12-30T22:04:33Z'>Mon, 30 Dec 2019 22:04:33 UTC</time><div class='body'><p>Nice article. On track with how things are not intuitive. Coincidentally, we're working on a syntax diagramming (live coded railroad diagrams) and dev tool, so I was able to use your `[01]` test case on a feature it has. My test session went like this:</p><p>- Load JSON grammar project<br>- Clear existing test input and put in `[01]`<br>- Click `parse` with the main `json-value` rule selected<br>- See that the parse failed<br>- Repeat with the `json-array` rule selected<br>- With `json-array` selected, click Find. No match.<br>- Select `number` rule, click Find. `0` is highlighted.<br>- Click Find again, `1` is highlighted.</p><p>Now I want to tinker on more bad inputs, to see how it can help find more unintuitive cases.</p></div></div></div><hr/><div class='thread'><h1 id='2019-12-29'><a href='/blog/2019/12/29/'>Purgeable Memory Allocations for Linux</a></h1><div class='empty'>(no comments)</div></div>
